<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="[TOC] Some Related Class Files LocationHandler GpsParamsFetcher SetGpsLocationFetcher X1GeoFencingViewController: Preferences - Security - Geographic Range  LocationHandlerCLLocationManagerPriority is">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2025/11/uncategorized/officeDocuments/officeDocs/SecureHub/Location/location/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="[TOC] Some Related Class Files LocationHandler GpsParamsFetcher SetGpsLocationFetcher X1GeoFencingViewController: Preferences - Security - Geographic Range  LocationHandlerCLLocationManagerPriority is">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-11-26T07:30:03.218Z">
<meta property="article:modified_time" content="2025-11-26T07:30:03.219Z">
<meta property="article:author" content="Supremes">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/11/uncategorized/officeDocuments/officeDocs/SecureHub/Location/location/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2025/11/uncategorized/officeDocuments/officeDocs/SecureHub/Location/location/","path":"2025/11/uncategorized/officeDocuments/officeDocs/SecureHub/Location/location/","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title> | Hexo</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Some-Related-Class-Files"><span class="nav-number">1.</span> <span class="nav-text">Some Related Class Files</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#LocationHandler"><span class="nav-number">1.1.</span> <span class="nav-text">LocationHandler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CLLocationManager"><span class="nav-number">1.1.1.</span> <span class="nav-text">CLLocationManager</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SetGpsLocationFetcher"><span class="nav-number">1.2.</span> <span class="nav-text">SetGpsLocationFetcher</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SecureHub"><span class="nav-number">1.2.1.</span> <span class="nav-text">SecureHub</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sendLocationIfNeeded%EF%BC%9A"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">sendLocationIfNeeded：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CEM"><span class="nav-number">1.2.2.</span> <span class="nav-text">CEM</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#setGpsLocation"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">setGpsLocation</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GpsParamsFetcher"><span class="nav-number">1.3.</span> <span class="nav-text">GpsParamsFetcher</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Some-Code-Keys-Mapping-to-Server-Properties"><span class="nav-number">2.</span> <span class="nav-text">Some Code Keys Mapping to Server Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#gps-config"><span class="nav-number">2.1.</span> <span class="nav-text">gps config</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#locSend"><span class="nav-number">2.2.</span> <span class="nav-text">locSend</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Security-Action"><span class="nav-number">3.</span> <span class="nav-text">Security Action</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Locate"><span class="nav-number">3.1.</span> <span class="nav-text">Locate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-Tracking"><span class="nav-number">3.2.</span> <span class="nav-text">Enable Tracking</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Location-Policy"><span class="nav-number">4.</span> <span class="nav-text">Location Policy</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Non-GeoFence"><span class="nav-number">4.1.</span> <span class="nav-text">Non-GeoFence</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Security-Action-1"><span class="nav-number">5.</span> <span class="nav-text">Security Action</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Locate-1"><span class="nav-number">5.1.</span> <span class="nav-text">Locate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Current-Server-logic"><span class="nav-number">5.1.1.</span> <span class="nav-text">Current Server logic:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enable-Tracking-1"><span class="nav-number">5.2.</span> <span class="nav-text">Enable Tracking</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enable-Disable-Lost-Mode"><span class="nav-number">5.3.</span> <span class="nav-text">Enable&#x2F;Disable Lost Mode</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Location-Update-Strategy"><span class="nav-number">6.</span> <span class="nav-text">Location Update Strategy</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#locUpdateDelay"><span class="nav-number">6.1.</span> <span class="nav-text">locUpdateDelay:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#locUpdateTimeout"><span class="nav-number">6.2.</span> <span class="nav-text">locUpdateTimeout:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#locTrackTimeout"><span class="nav-number">6.3.</span> <span class="nav-text">locTrackTimeout:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-Action-Lost-Mode"><span class="nav-number">6.4.</span> <span class="nav-text">Security Action - Lost Mode</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enhancement"><span class="nav-number">7.</span> <span class="nav-text">Enhancement</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Groom"><span class="nav-number">8.</span> <span class="nav-text">Groom</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Supremes</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">82</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/uncategorized/officeDocuments/officeDocs/SecureHub/Location/location/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Supremes">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-11-26 15:30:03" itemprop="dateCreated datePublished" datetime="2025-11-26T15:30:03+08:00">2025-11-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>[TOC]</p>
<h1 id="Some-Related-Class-Files"><a href="#Some-Related-Class-Files" class="headerlink" title="Some Related Class Files"></a>Some Related Class Files</h1><ul>
<li>LocationHandler</li>
<li>GpsParamsFetcher</li>
<li>SetGpsLocationFetcher</li>
<li>X1GeoFencingViewController: Preferences - Security - Geographic Range</li>
</ul>
<h2 id="LocationHandler"><a href="#LocationHandler" class="headerlink" title="LocationHandler"></a>LocationHandler</h2><h3 id="CLLocationManager"><a href="#CLLocationManager" class="headerlink" title="CLLocationManager"></a>CLLocationManager</h3><p>Priority is also as number said, locationManager below delegate self and implement some <code>CLLocationManagerDelegate</code> methods to listen specific location behaviours.</p>
<ol>
<li>gpsLocationManager</li>
</ol>
<blockquote>
<p>The <strong>Standard</strong> location service provides the most precise and regular location data, but uses more power than the other services. Use it primarily if your app provides turn-by-turn navigation or needs a greater precision or frequency of events. This location service is the only one available to apps running in visionOS. Call <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423750-startupdatinglocation?language=objc"><code>startUpdatingLocation</code></a> to start the service, or call <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620548-requestlocation?language=objc"><code>requestLocation</code></a> to get a single location event.</p>
</blockquote>
<ol start="2">
<li>significantChangeManager:</li>
</ol>
<blockquote>
<p>The <strong>Significant-change</strong> location service offers a low-power way to get location updates. This service uses the cellular and Wi-Fi radios (not GPS) to report only location changes that exceed a significantly large distance. Call <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423531-startmonitoringsignificantlocati?language=objc"><code>startMonitoringSignificantLocationChanges</code></a> to start the service.</p>
</blockquote>
<ol start="3">
<li>regionManager: Creating region monitor for geofence</li>
</ol>
<h2 id="SetGpsLocationFetcher"><a href="#SetGpsLocationFetcher" class="headerlink" title="SetGpsLocationFetcher"></a>SetGpsLocationFetcher</h2><h3 id="SecureHub"><a href="#SecureHub" class="headerlink" title="SecureHub"></a>SecureHub</h3><blockquote>
<p>Send location data to server</p>
</blockquote>
<p>![image-20230901094600201](&#x2F;Users&#x2F;junkangd&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230901094600201.png)</p>
<h4 id="sendLocationIfNeeded："><a href="#sendLocationIfNeeded：" class="headerlink" title="sendLocationIfNeeded："></a>sendLocationIfNeeded：</h4><p>Trigger by </p>
<ol>
<li><p><strong>if</strong> ([<strong>self</strong> isGeoFence] &amp;&amp; ![<strong>self</strong> isLocationABadLocation:retrievedLocation])  &#x2F;&#x2F; for geo fence calulation.  </p>
</li>
<li><p><strong>if</strong> ([<strong>self</strong> locationNeedToSendServer] &amp;&amp; [<strong>self</strong> locationAndTimeWithinLimits: retrievedLocation])  &#x2F;&#x2F; if The deviation between this data and the last saved data is greater than is all greater than predefine params, send location.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([<span class="keyword">self</span> locationNeedToSendServer] &amp;&amp; [<span class="keyword">self</span> locationAndTimeWithinLimits: retrievedLocation])</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="keyword">self</span> saveLastLocationAndTime: retrievedLocation];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Drop background flags</span></span><br><span class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span> isServerSignificantChangeAware])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// For protocol version 9 and above, and 8.0.2 patched servers that are aware of significant change implementation</span></span><br><span class="line">            [<span class="keyword">self</span> sendGPSLocationToServerForReason: LocationReasonSignificantChange location: retrievedLocation];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Older servers - send both track and on-demand.</span></span><br><span class="line">            <span class="keyword">if</span> ([<span class="keyword">self</span> isLocationTrack]) &#123;</span><br><span class="line">                [<span class="keyword">self</span> sendGPSLocationToServerForReason:LocationReasonTrack location:retrievedLocation];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ([<span class="keyword">self</span> isLocateMe]) &#123;</span><br><span class="line">                [<span class="keyword">self</span> sendGPSLocationToServerForReason:LocationReasonOnDemand location:retrievedLocation];</span><br><span class="line">                [<span class="keyword">self</span> turnOffLocateMe];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="CEM"><a href="#CEM" class="headerlink" title="CEM"></a>CEM</h3><h4 id="setGpsLocation"><a href="#setGpsLocation" class="headerlink" title="setGpsLocation"></a>setGpsLocation</h4><ol>
<li>Update gps location data to DB</li>
<li>Update locate and track - security action behaviour:<ol>
<li>status(succeed or failed)</li>
<li>timestamp</li>
</ol>
</li>
</ol>
<h2 id="GpsParamsFetcher"><a href="#GpsParamsFetcher" class="headerlink" title="GpsParamsFetcher"></a>GpsParamsFetcher</h2><blockquote>
<p>Get series of location parameters as below table show</p>
</blockquote>
<ul>
<li><p>Add obeserver with <code>kSessionTokenChangedNotification</code> notification</p>
<ul>
<li>setSessionToken, token changed.</li>
</ul>
</li>
<li><p>NSTimer:</p>
<ul>
<li>register remote notification - 7200s: app server send apns server, apns server send to device</li>
<li>Local notification - 300s: app send to device</li>
</ul>
</li>
</ul>
<h1 id="Some-Code-Keys-Mapping-to-Server-Properties"><a href="#Some-Code-Keys-Mapping-to-Server-Properties" class="headerlink" title="Some Code Keys Mapping to Server Properties"></a>Some Code Keys Mapping to Server Properties</h1><table>
<thead>
<tr>
<th>code Key</th>
<th>Property KEY</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>locOn</td>
<td>console.location.enabled</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>locate</td>
<td>N&#x2F;A</td>
<td>NO</td>
<td>Locate in Security Action - No usage in SH</td>
</tr>
<tr>
<td>locTrack</td>
<td>N&#x2F;A</td>
<td>NO</td>
<td>Enable Tracking in Security Action - No usage in SH</td>
</tr>
<tr>
<td>locSend</td>
<td></td>
<td></td>
<td>No usage in SH</td>
</tr>
<tr>
<td>locUpdateDelay</td>
<td>console.location.update.delay</td>
<td>600</td>
<td>poll interval, param in SH timer</td>
</tr>
<tr>
<td>locUpdateOnLaunch</td>
<td>N&#x2F;A</td>
<td></td>
<td>Report on start up (on&#x2F;off) - No usage in SH</td>
</tr>
<tr>
<td>locUpdateTimeout</td>
<td>console.location.update.timeout</td>
<td>60</td>
<td>Location timeout in Location Policy</td>
</tr>
<tr>
<td>locTrackTimeout</td>
<td>console.location.track.timeout</td>
<td>21600</td>
<td>Tracking duration in Location Policy</td>
</tr>
<tr>
<td>locAccuracy</td>
<td>console.location.accuracy</td>
<td>100</td>
<td>Accuracy in Location Policy</td>
</tr>
<tr>
<td>locationFenceRadius</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config, Radius in Location Policy</td>
</tr>
<tr>
<td>locationFenceX</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config, Center point longitude in Location Policy</td>
</tr>
<tr>
<td>locationFenceY</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config, Center point latitude in Location Policy</td>
</tr>
<tr>
<td>locationFenceBreachAction</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config, Warn user on perimeter breach in Location Policy</td>
</tr>
<tr>
<td>locSelWipeDelay</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config</td>
</tr>
<tr>
<td>locSignificantInterval</td>
<td>console.location.significant.interval</td>
<td></td>
<td>300</td>
</tr>
<tr>
<td>locSignificantDistance</td>
<td>console.location.significant.distance</td>
<td></td>
<td>500</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="gps-config"><a href="#gps-config" class="headerlink" title="gps config"></a>gps config</h2><p>Location Policy</p>
<h2 id="locSend"><a href="#locSend" class="headerlink" title="locSend"></a>locSend</h2><p>locUpdateOnLaunch || locUpdateOnPolling || locate || locTrack;</p>
<h1 id="Security-Action"><a href="#Security-Action" class="headerlink" title="Security Action"></a>Security Action</h1><blockquote>
<p><code>Location</code> and <code>Enable Tracking</code> won’t take effect in SecureHub. It totally works in CEM server.</p>
</blockquote>
<h3 id="Locate"><a href="#Locate" class="headerlink" title="Locate"></a>Locate</h3><ul>
<li>locate: no valid logic in SH, should have some logic in the server.</li>
</ul>
<h3 id="Enable-Tracking"><a href="#Enable-Tracking" class="headerlink" title="Enable Tracking"></a>Enable Tracking</h3><p>Key below no valid logic in SH, should have some logic in the server.</p>
<ul>
<li><p>locTrack</p>
</li>
<li><p>locTrackTimeout</p>
</li>
</ul>
<h1 id="Location-Policy"><a href="#Location-Policy" class="headerlink" title="Location Policy"></a>Location Policy</h1><p>If this policy is configured, it will show same dg details as security action - locate : <strong>Device located</strong>.</p>
<p>The difference is that we could view the request time and event in the security action.</p>
<p>![image-20230901155922392](&#x2F;Users&#x2F;junkangd&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230901155922392.png)</p>
<table>
<thead>
<tr>
<th>code Key</th>
<th>Property KEY</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>locUpdateTimeout</td>
<td>console.location.update.timeout</td>
<td>60</td>
<td><strong>Location timeout</strong> in Location Policy</td>
</tr>
<tr>
<td>locTrackTimeout</td>
<td>console.location.track.timeout</td>
<td>21600</td>
<td><strong>Tracking duration</strong> in Location Policy</td>
</tr>
<tr>
<td>locAccuracy</td>
<td>console.location.accuracy</td>
<td>100</td>
<td><strong>Accuracy</strong> in Location Policy</td>
</tr>
<tr>
<td>locationFenceRadius</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config, <strong>Radius</strong> in Location Policy</td>
</tr>
<tr>
<td>locationFenceX</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config, <strong>Center point longitude</strong> in Location Policy</td>
</tr>
<tr>
<td>locationFenceY</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config, Center point latitude in Location Policy</td>
</tr>
<tr>
<td>locationFenceBreachAction</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config, <strong>Warn user on perimeter breach</strong> in Location Policy</td>
</tr>
<tr>
<td>locSelWipeDelay</td>
<td>N&#x2F;A</td>
<td></td>
<td>Fetch from gps config</td>
</tr>
</tbody></table>
<p>locUpdateTimeout: timer logic like below</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)locationTimeOutTimerTimeout:(<span class="built_in">NSTimer</span> *)timer    &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CLLocation</span>* mostRecentGPSLocation = gpsLocationManager.location;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!mostRecentGPSLocation || ![<span class="keyword">self</span> isLocationWithinLastUpdateInterval:mostRecentGPSLocation]) &#123;</span><br><span class="line">        <span class="comment">// Store a bad location</span></span><br><span class="line">        <span class="keyword">self</span>.gpsStatus = LocationAuthStatusUnavail;</span><br><span class="line">        mostRecentGPSLocation = <span class="keyword">self</span>.badLocation;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> sendLocationIfNeeded:mostRecentGPSLocation];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>locTrackTimeout:</strong> </p>
<p>No usage</p>
<p><strong>locAccuracy:</strong> </p>
<p>if the new location’s accuracy is lower than predefined locAccuracy, will send location to server when delegate method is called.</p>
<h2 id="Non-GeoFence"><a href="#Non-GeoFence" class="headerlink" title="Non-GeoFence"></a>Non-GeoFence</h2><h1 id="Security-Action-1"><a href="#Security-Action-1" class="headerlink" title="Security Action"></a>Security Action</h1><h2 id="Locate-1"><a href="#Locate-1" class="headerlink" title="Locate"></a>Locate</h2><blockquote>
<p>Locates a device and reports the device location, including a map, on the Manage &gt; Devices page, under Device details &gt; General. Locate is a one-time action. Use Locate to display the current device location at the time you do the action. To continuously track the device over a period, use Enable tracking</p>
<p>When applying this feature to iOS or Android Enterprise devices, be aware of the following limitations:</p>
<ul>
<li>For iOS devices, the command succeeds only if the devices are in MDM Lost Mode.</li>
</ul>
</blockquote>
<ul>
<li>only if the devices are in MDM Lost Mode.???</li>
</ul>
<h3 id="Current-Server-logic"><a href="#Current-Server-logic" class="headerlink" title="Current Server logic:"></a>Current Server logic:</h3><p>Update Action status:</p>
<ul>
<li>At first, action status is set as <code>Requested</code></li>
<li>And then, trigger a apns command, apns send type - <strong>alert</strong></li>
<li>At last, if location data is fetched from <code>device_property</code> table, action status is set as <code>Success</code></li>
</ul>
<h2 id="Enable-Tracking-1"><a href="#Enable-Tracking-1" class="headerlink" title="Enable Tracking"></a>Enable Tracking</h2><blockquote>
<p>On Android or iOS devices, this command allows Endpoint Management to poll the location of specific devices at a frequency you define. To view device coordinates and location on a map, go to <strong>Manage &gt; Devices</strong>, select a device, and then click <strong>Edit</strong>. The device info is on the <strong>General</strong> tab under <strong>Security</strong>. Use <strong>Enable tracking</strong> to track the device continuously. Secure Hub reports the location periodically when the device is running.</p>
</blockquote>
<h2 id="Enable-Disable-Lost-Mode"><a href="#Enable-Disable-Lost-Mode" class="headerlink" title="Enable&#x2F;Disable Lost Mode"></a>Enable&#x2F;Disable Lost Mode</h2><p>For supervised iOS device only: DEP or Shared iPADs</p>
<blockquote>
<p>Puts a <strong>supervised iOS</strong> device in Lost Mode and sends the device a message, phone number, and a footnote to display. The second time that you send this command takes the device out of Lost Mode.</p>
</blockquote>
<p>Request the location of a device when in Lost Mode. Already implemented in CEM. </p>
<ul>
<li>DOC: <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/devicemanagement/get_the_location_of_a_device?language=objc">https://developer.apple.com/documentation/devicemanagement/get_the_location_of_a_device?language=objc</a></li>
</ul>
<h1 id="Location-Update-Strategy"><a href="#Location-Update-Strategy" class="headerlink" title="Location Update Strategy"></a>Location Update Strategy</h1><h2 id="locUpdateDelay"><a href="#locUpdateDelay" class="headerlink" title="locUpdateDelay:"></a>locUpdateDelay:</h2><p>fetch from client property - console.location.update.delay: default value 60</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> initialize:<span class="literal">NO</span>];</span><br></pre></td></tr></table></figure>

<p>go to <strong>sendLocationIfNeeded</strong> logic</p>
<h2 id="locUpdateTimeout"><a href="#locUpdateTimeout" class="headerlink" title="locUpdateTimeout:"></a>locUpdateTimeout:</h2><p>fetch from location policy - Location timeout</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)locationTimeOutTimerTimeout:(<span class="built_in">NSTimer</span> *)timer    &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CLLocation</span>* mostRecentGPSLocation = gpsLocationManager.location;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!mostRecentGPSLocation || ![<span class="keyword">self</span> isLocationWithinLastUpdateInterval:mostRecentGPSLocation]) &#123;</span><br><span class="line">        <span class="comment">// Store a bad location</span></span><br><span class="line">        <span class="keyword">self</span>.gpsStatus = LocationAuthStatusUnavail;</span><br><span class="line">        mostRecentGPSLocation = <span class="keyword">self</span>.badLocation;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> sendLocationIfNeeded:mostRecentGPSLocation];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="locTrackTimeout"><a href="#locTrackTimeout" class="headerlink" title="locTrackTimeout:"></a>locTrackTimeout:</h2><p>fetch from location policy - Track timeout</p>
<h2 id="Security-Action-Lost-Mode"><a href="#Security-Action-Lost-Mode" class="headerlink" title="Security Action - Lost Mode"></a>Security Action - Lost Mode</h2><h1 id="Enhancement"><a href="#Enhancement" class="headerlink" title="Enhancement"></a>Enhancement</h1><ul>
<li><p>SecureHub could not report location and get gps parameter continuously when app is in background?</p>
</li>
<li><p>Security Action including locate and enable tracking do not work as expected, send an apns command(alert type) to device, and SH need to take action.Also, server may change the command type to location.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/pushing_background_updates_to_your_app?language=objc">https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/pushing_background_updates_to_your_app?language=objc</a></p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"> CEM update APNS command logic</li>
<li><input disabled="" type="checkbox"> SH calls your app delegate’s method</li>
<li><input disabled="" type="checkbox"> Integrate location push service, add a new target- <code>Location Push Service Extension</code></li>
</ul>
</li>
<li><p>Location policy won’t take effect, those params like timeout is not valid.</p>
</li>
</ul>
<h1 id="Groom"><a href="#Groom" class="headerlink" title="Groom"></a>Groom</h1><p>Stage1:</p>
<ul>
<li>Fix Security Action 2</li>
<li>Update CEM document 2</li>
</ul>
<p>Stage2: 5</p>
<ul>
<li><p>Integrate All Needed Background Modes in SecureHub : <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/xcode/configuring-background-execution-modes">https://developer.apple.com/documentation/xcode/configuring-background-execution-modes</a></p>
<blockquote>
<p>Including: </p>
<ul>
<li>Location updates</li>
<li>Background fetch</li>
<li>Background processing</li>
</ul>
<p>Make corresponding changes for four CLLocationManager</p>
<ul>
<li><strong>@property</strong> (<strong>nonatomic</strong>, <strong>strong</strong>) CLLocationManager *gpsLocationManager;</li>
<li><strong>@property</strong> (<strong>nonatomic</strong>, <strong>strong</strong>) CLLocationManager *significantChangeManager;</li>
<li><strong>@property</strong> (<strong>nonatomic</strong>, <strong>strong</strong>) CLLocationManager *regionManager;</li>
<li><strong>@property</strong> (<strong>nonatomic</strong>, <strong>strong</strong>) CLLocationManager *authorizationListener;</li>
</ul>
</blockquote>
</li>
</ul>
<p>Stage3: 13 points</p>
<p>Design + Test 6</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/11/uncategorized/officeDocuments/officeDocs/SecureHub/APNS/" rel="prev" title="">
                  <i class="fa fa-angle-left"></i> 
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/11/uncategorized/officeDocuments/officeDocs/SecureHub/objective-c/" rel="next" title="">
                   <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Supremes</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
