<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Git å­¦ä¹ ç¬”è®°</title>
      <link href="/posts/3c3cdb74.html"/>
      <url>/posts/3c3cdb74.html</url>
      
        <content type="html"><![CDATA[<h1 id="ğŸ„-Git-å…¨æ–¹ä½å®æˆ˜æ‰‹å†Œï¼šä»å…¥é—¨åˆ°é€šå…³"><a href="#ğŸ„-Git-å…¨æ–¹ä½å®æˆ˜æ‰‹å†Œï¼šä»å…¥é—¨åˆ°é€šå…³" class="headerlink" title="ğŸ„ Git å…¨æ–¹ä½å®æˆ˜æ‰‹å†Œï¼šä»å…¥é—¨åˆ°é€šå…³"></a>ğŸ„ Git å…¨æ–¹ä½å®æˆ˜æ‰‹å†Œï¼šä»å…¥é—¨åˆ°é€šå…³</h1><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/git-workflow.webp" alt="img"></p><blockquote><p>æ ¸å¿ƒæ¦‚å¿µå›¾è§£ (The Mental Model)</p><p>Git çš„æ“ä½œä¸»è¦åœ¨ä¸‰ä¸ªåŒºåŸŸæµè½¬ï¼š</p><ol><li><p><strong>å·¥ä½œåŒº (Working Directory)</strong>ï¼šä½ å®é™…å†™ä»£ç çš„åœ°æ–¹ã€‚</p></li><li><p><strong>æš‚å­˜åŒº (Staging Area&#x2F;Index)</strong>ï¼š<code>git add</code> åæ–‡ä»¶å­˜æ”¾çš„åœ°æ–¹ï¼ˆå‡†å¤‡æäº¤çš„åŒ…è£¹ï¼‰ã€‚</p></li><li><p><strong>æœ¬åœ°ä»“åº“ (Local Repository)</strong>ï¼š<code>git commit</code> åç‰ˆæœ¬å­˜æ¡£çš„åœ°æ–¹ã€‚</p></li><li><p><strong>è¿œç¨‹ä»“åº“ (Remote Repository)</strong>ï¼šGitHub&#x2F;GitLab ç­‰æœåŠ¡å™¨ç«¯ã€‚</p></li></ol></blockquote><h1 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a><code>.gitignore</code></h1><p>åªå¯¹ <code>æœªè¢«è¿½è¸ª untracked</code> çš„æ–‡ä»¶æœ‰æ•ˆï¼Œä¸€æ—¦æ–‡ä»¶ä¹‹å‰è¢« commit è¿‡ï¼Œgit ä¾¿ä¼šæ— è§†è¯¥æ–‡ä»¶çš„é…ç½®ï¼Œå› æ­¤éœ€è¦é…åˆ <code>git rm --cahce</code> ä½¿ç”¨ã€‚</p><h2 id="git-rm-â€“cache"><a href="#git-rm-â€“cache" class="headerlink" title="git rm â€“cache "></a>git rm â€“cache <filename></h2><blockquote><p> è®© git åœæ­¢è·Ÿè¸ªæŸä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯ä¸åˆ é™¤æœ¬åœ°çš„æ–‡ä»¶</p></blockquote><p>å¸¸ç”¨è¯­æŸäº›â€œäº¡ç¾Šè¡¥ç‰¢â€çš„åœºæ™¯ï¼ŒæŠŠä¸è¯¥æäº¤çš„é…ç½®æ–‡ä»¶æåˆ°åˆ°äº† Gitï¼Œç°åœ¨éœ€è¦ä»ä»“åº“ä¸­åˆ é™¤ï¼Œä½†æœ¬åœ°è¿˜éœ€è¦ä½¿ç”¨ï¼Œé€šå¸¸é…åˆ <code>.gitignore</code>ä½¿ç”¨ã€‚</p><h1 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a><code>git stash</code></h1><h2 id="git-stash-u"><a href="#git-stash-u" class="headerlink" title="git stash -u"></a>git stash -u</h2><p>u å‚æ•°ï¼Œä¼šæŠŠ untracked files ä¹Ÿä¸€å¹¶æš‚å­˜</p><h2 id="git-stash-push-m"><a href="#git-stash-push-m" class="headerlink" title="git stash push -m &lt;å¤šä¸ªæ–‡ä»¶åæˆ–ç›®å½•å&gt;"></a>git stash push -m &lt;å¤šä¸ªæ–‡ä»¶åæˆ–ç›®å½•å&gt;</h2><ul><li>æ—§ç‰ˆï¼šgit stash save â€œstash messageâ€</li><li>æ–°ç‰ˆï¼šgit stash push -m â€œstash messageâ€</li></ul><h2 id="git-stash-p"><a href="#git-stash-p" class="headerlink" title="git stash -p"></a>git stash -p</h2><p> äº¤äº’å¼å‘½ä»¤ï¼Œå¯ä»¥é€‰æ‹©å“ªäº›éœ€è¦æš‚å­˜</p><h2 id="git-stash-branch"><a href="#git-stash-branch" class="headerlink" title="git stash branch &lt;æ–°åˆ†æ”¯å&gt;"></a>git stash branch &lt;æ–°åˆ†æ”¯å&gt;</h2><p>åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œæ£€å‡ºä½ stash æ—¶çš„é‚£ä¸ª commitï¼Œç„¶ååº”ç”¨ stashã€‚è¿™æ ·æ‹…å¿ƒæœ‰å†²çªï¼Œå°±åœ¨æ–°åˆ†æ”¯é‡Œè§£å†³ï¼Œä¸ä¼šå½±å“ä¸»åˆ†æ”¯ã€‚</p><hr><h1 id="åˆ é™¤åˆ†æ”¯-git-branch-d"><a href="#åˆ é™¤åˆ†æ”¯-git-branch-d" class="headerlink" title="åˆ é™¤åˆ†æ”¯ - git branch -d"></a><code>åˆ é™¤åˆ†æ”¯ - git branch -d</code></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯</span></span><br><span class="line">git branch -d feature-login</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼ºåˆ¶åˆ é™¤æœªåˆå¹¶çš„åˆ†æ”¯ (æ…ç”¨)</span></span><br><span class="line">git branch -D feature-login</span><br></pre></td></tr></table></figure><hr><h1 id="åæ‚”è¯-Undoing-Changes-git-restore-reset-revert"><a href="#åæ‚”è¯-Undoing-Changes-git-restore-reset-revert" class="headerlink" title="åæ‚”è¯ (Undoing Changes) - git restore/reset/revert"></a><code>åæ‚”è¯ (Undoing Changes) - git restore/reset/revert</code></h1><p>æ¯ä¸ªäººéƒ½ä¼šçŠ¯é”™ï¼ŒGit ç»™äº†ä½ é‡æ¥çš„æœºä¼šã€‚</p><h3 id="1-æ’¤é”€å·¥ä½œåŒºçš„ä¿®æ”¹-æœª-add"><a href="#1-æ’¤é”€å·¥ä½œåŒºçš„ä¿®æ”¹-æœª-add" class="headerlink" title="1. æ’¤é”€å·¥ä½œåŒºçš„ä¿®æ”¹ (æœª add)"></a>1. æ’¤é”€å·¥ä½œåŒºçš„ä¿®æ”¹ (æœª add)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸¢å¼ƒæ–‡ä»¶çš„ä¿®æ”¹ï¼Œæ¢å¤åˆ°æœ€è¿‘ä¸€æ¬¡ commit çš„çŠ¶æ€</span></span><br><span class="line">git restore &lt;file&gt;</span><br><span class="line"><span class="comment"># æˆ–è€…æ—§ç‰ˆå‘½ä»¤ï¼šgit checkout -- &lt;file&gt;</span></span><br></pre></td></tr></table></figure><h4 id="git-restore"><a href="#git-restore" class="headerlink" title="git restore &lt;filename&gt;"></a><code>git restore &lt;filename&gt;</code></h4><p>æ—§ç‰ˆå‘½ä»¤ï¼š<code>git checkout -- &lt;æ–‡ä»¶å&gt;</code></p><p>æ”¾å¼ƒ <code>å·¥ä½œåŒº</code> çš„ä¿®æ”¹ï¼Œç”¨ <code>æš‚å­˜åŒº</code> è¦†ç›– <code>å·¥ä½œåŒº</code>ã€‚</p><ul><li>å¦‚æœ <code>å·¥ä½œåŒº</code> æ²¡æœ‰æ”¹åŠ¨ï¼Œä¾¿ä¼šç›´æ¥æ’¤é”€å·¥ä½œåŒºçš„æ”¹åŠ¨</li><li>å¦‚æœ <code>å·¥ä½œåŒº</code> æœ‰æ”¹åŠ¨ï¼Œä¾¿ä¼šè¦†ç›–</li></ul><h3 id="2-æ’¤é”€æš‚å­˜åŒºçš„ä¿®æ”¹-å·²-addï¼Œæœª-commit"><a href="#2-æ’¤é”€æš‚å­˜åŒºçš„ä¿®æ”¹-å·²-addï¼Œæœª-commit" class="headerlink" title="2. æ’¤é”€æš‚å­˜åŒºçš„ä¿®æ”¹ (å·² addï¼Œæœª commit)"></a>2. æ’¤é”€æš‚å­˜åŒºçš„ä¿®æ”¹ (å·² addï¼Œæœª commit)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ–‡ä»¶ä»æš‚å­˜åŒºç§»é™¤ï¼Œä½†ä¿ç•™æ–‡ä»¶å†…å®¹ä¿®æ”¹</span></span><br><span class="line">git restore --staged &lt;file&gt;</span><br><span class="line"><span class="comment"># æˆ–è€…æ—§ç‰ˆå‘½ä»¤ï¼šgit reset HEAD &lt;file&gt;</span></span><br></pre></td></tr></table></figure><h4 id="git-restore-staged"><a href="#git-restore-staged" class="headerlink" title="git restore --staged &lt;filename&gt;"></a><code>git restore --staged &lt;filename&gt;</code></h4><p>æ—§å‘½ä»¤: &#96;git reset HEAD <filename>&#96;&#96;</p><p>å°†æ–‡ä»¶ä» <code>æš‚å­˜åŒº</code> åˆ‡æ¢åˆ° <code>å·¥ä½œåŒº</code> , å³åœ¨æ‰§è¡Œå®Œ <code>git add</code> å‘½ä»¤åï¼Œç”¨æ¥æ’¤å›ã€‚</p><h3 id="3-æ’¤é”€æäº¤-å·²-commit-â€”â€”-Reset"><a href="#3-æ’¤é”€æäº¤-å·²-commit-â€”â€”-Reset" class="headerlink" title="3. æ’¤é”€æäº¤ (å·² commit) â€”â€” Reset"></a>3. æ’¤é”€æäº¤ (å·² commit) â€”â€” <strong>Reset</strong></h3><p>è¿™é‡Œæœ‰ä¸‰ç§æ¨¡å¼ï¼Œåˆ‡è®°åŒºåˆ†ï¼š</p><ul><li><strong><code>--soft</code> (æ¸©æŸ”æ¨¡å¼)</strong>ï¼šæ’¤é”€ commitï¼Œä½†ä»£ç ä¿ç•™åœ¨<strong>æš‚å­˜åŒº</strong>ï¼ˆé€‚åˆæƒ³é‡æ–°ä¿®æ”¹ commit messageï¼‰ã€‚</li><li><strong><code>--mixed</code> (é»˜è®¤æ¨¡å¼)</strong>ï¼šæ’¤é”€ commitï¼Œä»£ç ä¿ç•™åœ¨<strong>å·¥ä½œåŒº</strong>ï¼ˆæœª add çŠ¶æ€ï¼‰ã€‚</li><li><strong><code>--hard</code> (æ¯ç­æ¨¡å¼)</strong>ï¼šæ’¤é”€ commitï¼Œ<strong>åˆ é™¤æ‰€æœ‰ä»£ç ä¿®æ”¹</strong>ï¼Œå½»åº•å›åˆ°è¿‡å»ï¼ˆæ…ç”¨ï¼ï¼‰ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ (ä¿ç•™ä»£ç åœ¨æš‚å­˜åŒº)</span></span><br><span class="line">git reset --soft HEAD^</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½»åº•å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬ (ä»£ç å…¨ä¸¢ï¼Œæ…ç”¨)</span></span><br><span class="line">git reset --hard &lt;commit-hash&gt;</span><br></pre></td></tr></table></figure><h3 id="4-å®‰å…¨æ’¤é”€-â€”â€”-Revert"><a href="#4-å®‰å…¨æ’¤é”€-â€”â€”-Revert" class="headerlink" title="4. å®‰å…¨æ’¤é”€ â€”â€” Revert"></a>4. å®‰å…¨æ’¤é”€ â€”â€” <strong>Revert</strong></h3><p>å¦‚æœä½ å·²ç»æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œ<strong>ç»å¯¹ä¸è¦ç”¨ Reset</strong>ï¼Œè¦ç”¨ Revertã€‚å®ƒä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ commit æ¥â€œåå‘â€æŠµæ¶ˆä¹‹å‰çš„æ“ä½œã€‚</p><p>Bash</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;commit-hash&gt;</span><br></pre></td></tr></table></figure><hr><h1 id="é…ç½®åˆ«å-Aliases"><a href="#é…ç½®åˆ«å-Aliases" class="headerlink" title="é…ç½®åˆ«å (Aliases)"></a>é…ç½®åˆ«å (Aliases)</h1><p>ä½œä¸ºä¸€åç†Ÿç»ƒå·¥ï¼Œæ•² <code>git commit</code> å¤ªæ…¢äº†ã€‚åœ¨ <code>~/.gitconfig</code> ä¸­æ·»åŠ è¿™äº›åˆ«åï¼Œæ•ˆç‡èµ·é£ã€‚</p><p><strong>æ¨èé…ç½®é¡¹:</strong></p><ul><li>è®¾ç½® <em>git add, commit, push åˆ«å</em>ï¼š <code>git config --global alias.acp &#39;!f() { git add -A &amp;&amp; git commit -m &quot;$1&quot; &amp;&amp; git push; }; f&#39;</code><ul><li>ç¤ºä¾‹ : <code>git acp &quot;ä¿®å¤äº†ä¸€ä¸ªbug&quot;</code></li></ul></li><li>è®¾ç½® <em>git add, amend no-edit, push -f åˆ«å</em>: <code>git config --global alias.amendpush &#39;!git add . &amp;&amp; git commit --amend --no-edit &amp;&amp; git push -f&#39;</code></li><li>è®¾ç½®  <em>git log æ¼‚äº®çš„è¾“å‡º</em>: <code>git config --global alias.acp log --color --graph --pretty=format:&#39;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#39; --abbrev-commit</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·æ•ˆç‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java</title>
      <link href="/posts/5363d109.html"/>
      <url>/posts/5363d109.html</url>
      
        <content type="html"><![CDATA[<h1 id="Java-8-æ–°ç‰¹æ€§"><a href="#Java-8-æ–°ç‰¹æ€§" class="headerlink" title="Java 8 æ–°ç‰¹æ€§"></a>Java 8 æ–°ç‰¹æ€§</h1><h2 id="Lambda-è¡¨è¾¾å¼"><a href="#Lambda-è¡¨è¾¾å¼" class="headerlink" title="Lambda è¡¨è¾¾å¼"></a>Lambda è¡¨è¾¾å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testLambda</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;sex&quot;</span>, <span class="string">&quot;hobby&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// with method reference -- static method</span></span><br><span class="line">    names.forEach(System.out::println);</span><br><span class="line">    names.forEach(name -&gt; System.out.println(name));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// with method reference -- instance method</span></span><br><span class="line">    names.sort(String::compareTo);</span><br><span class="line">    names.sort((a, b) -&gt; a.compareTo(b));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// with method reference -- constructor method</span></span><br><span class="line">    Supplier&lt;Map&lt;String, String&gt;&gt; mm = () -&gt; <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    Supplier&lt;Map&lt;String, String&gt;&gt; supplier = HashMap::<span class="keyword">new</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¯­æ³•æ ¼å¼"><a href="#è¯­æ³•æ ¼å¼" class="headerlink" title="è¯­æ³•æ ¼å¼"></a>è¯­æ³•æ ¼å¼</h4><p>Lamda çš„åŸºæœ¬è¯­æ³•æœ‰ä¸‰æ­¥æ„æˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(å‚æ•°åˆ—è¡¨) -&gt; &#123;æ–¹æ³•ä½“&#125;</span><br></pre></td></tr></table></figure><ul><li>å‚æ•°åˆ—è¡¨ï¼š<code>å¯çœç•¥ç±»å‹</code>ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨æ–­</li><li>å³ä¾§ï¼šLamda ä½“ï¼Œè‹¥åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¯ä»¥çœç•¥ <code>èŠ±æ‹¬å·{}å’Œ return å…³é”®å­—</code></li></ul><h3 id="å‡½æ•°å¼æ¥å£-Functional-Interface"><a href="#å‡½æ•°å¼æ¥å£-Functional-Interface" class="headerlink" title="å‡½æ•°å¼æ¥å£ - Functional Interface"></a>å‡½æ•°å¼æ¥å£ - Functional Interface</h3><p>Lambda è¡¨è¾¾å¼ä¸èƒ½å‡­ç©ºå­˜åœ¨ï¼Œå®ƒå¿…é¡»ä¾é™„äº<strong>å‡½æ•°å¼æ¥å£</strong>ã€‚</p><blockquote><ul><li>Lambda è¡¨è¾¾å¼<strong>å¿…é¡»</strong>ä¾æ‰˜äºä¸€ä¸ª<strong>ç¡®å®šçš„æ¥å£</strong>ï¼ˆJDK è‡ªå¸¦çš„å¦‚ <code>Runnable</code>, <code>Predicate</code> æˆ–è€…ä½ è‡ªå®šä¹‰çš„æ¥å£ï¼‰ã€‚</li><li>è¿™ä¸ªæ¥å£å……å½“äº† Lambda çš„â€œèº«ä»½è¯æ˜â€ã€‚æ²¡æœ‰è¿™ä¸ªæ¥å£ï¼ŒJava ç¼–è¯‘å™¨å°±ä¸çŸ¥é“å¦‚ä½•å­˜å‚¨å’Œè°ƒç”¨è¿™æ®µä»£ç ã€‚</li></ul></blockquote><ul><li><strong>å®šä¹‰</strong>ï¼šåªåŒ…å«<strong>ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</strong>çš„æ¥å£ã€‚</li><li><strong>æ³¨è§£</strong>ï¼šé€šå¸¸ä½¿ç”¨ <code>@FunctionalInterface</code> æ ‡è®°ï¼ˆéå¼ºåˆ¶ï¼Œä½†æ¨èï¼‰ã€‚</li><li><strong>å¸¸è§æ¥å£</strong>ï¼š<code>Runnable</code>, <code>Comparator</code>, ä»¥åŠ Java 8 æ–°å¢çš„ <code>java.util.function</code> åŒ…ä¸‹çš„ <code>Predicate</code>, <code>Consumer</code>, <code>Function</code>, <code>Supplier</code>ã€‚</li></ul><h4 id="å››ç§ç³»ç»Ÿé¢„å®šä¹‰å‡½æ•°å¼æ¥å£-ç¤ºä¾‹ä»£ç "><a href="#å››ç§ç³»ç»Ÿé¢„å®šä¹‰å‡½æ•°å¼æ¥å£-ç¤ºä¾‹ä»£ç " class="headerlink" title="å››ç§ç³»ç»Ÿé¢„å®šä¹‰å‡½æ•°å¼æ¥å£ - ç¤ºä¾‹ä»£ç "></a>å››ç§ç³»ç»Ÿé¢„å®šä¹‰å‡½æ•°å¼æ¥å£ - <a href="https://github.com/Supremes/blog_demo_application/blob/master/src/main/java/org/dododo/StreamDemo.java">ç¤ºä¾‹ä»£ç </a></h4><h5 id="1-Consumer-æ¶ˆè´¹è€…"><a href="#1-Consumer-æ¶ˆè´¹è€…" class="headerlink" title="1. Consumer (æ¶ˆè´¹è€…)"></a>1. Consumer (æ¶ˆè´¹è€…)</h5><blockquote><p><strong>å£è¯€ï¼šåªåƒä¸åï¼ˆæœ‰å»æ— å›ï¼‰</strong></p></blockquote><ul><li><strong>ä½œç”¨</strong>ï¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¿›è¡Œå¤„ç†ï¼Œ<strong>ä¸è¿”å›ä»»ä½•å€¼</strong>ã€‚</li><li><strong>æŠ½è±¡æ–¹æ³•</strong>ï¼š<code>void accept(T t)</code></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰“å°æ—¥å¿—ã€å†™å…¥æ•°æ®åº“ã€å‘é€æ¶ˆæ¯ç­‰â€œå‰¯ä½œç”¨â€æ“ä½œã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ï¼šæ¥æ”¶ä¸€ä¸ª Stringï¼ŒæŠŠå®ƒæ‰“å°å‡ºæ¥ï¼ˆæ²¡æœ‰è¿”å›å€¼ï¼‰</span></span><br><span class="line">Consumer&lt;String&gt; printer = s -&gt; System.out.println(<span class="string">&quot;Processing: &quot;</span> + s);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ï¼š</span></span><br><span class="line">printer.accept(<span class="string">&quot;Hello World&quot;</span>); </span><br><span class="line"><span class="comment">// è¾“å‡º: Processing: Hello World</span></span><br></pre></td></tr></table></figure><h5 id="2-Supplier-ä¾›ç»™è€…"><a href="#2-Supplier-ä¾›ç»™è€…" class="headerlink" title="2. Supplier (ä¾›ç»™è€…)"></a>2. Supplier (ä¾›ç»™è€…)</h5><blockquote><p><strong>å£è¯€ï¼šæ— ä¸­ç”Ÿæœ‰ï¼ˆåªåä¸åƒï¼‰</strong></p></blockquote><ul><li><strong>ä½œç”¨</strong>ï¼šä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œ<strong>è¿”å›ä¸€ä¸ªç»“æœ</strong>ã€‚</li><li><strong>æŠ½è±¡æ–¹æ³•</strong>ï¼š<code>T get()</code></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç”Ÿæˆéšæœºæ•°ã€è·å–å½“å‰æ—¶é—´ã€æ‡’åŠ è½½å¯¹è±¡ã€å·¥å‚æ¨¡å¼ã€‚</li></ul><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ï¼šä¸æ¥å—å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªéšæœºæ•´æ•°</span></span><br><span class="line">Supplier&lt;Integer&gt; randomizer = () -&gt; (<span class="type">int</span>)(Math.random() * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ï¼š</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> randomizer.get();</span><br><span class="line">System.out.println(num);</span><br></pre></td></tr></table></figure><hr><h5 id="3-Function-å‡½æ•°-è½¬æ¢è€…"><a href="#3-Function-å‡½æ•°-è½¬æ¢è€…" class="headerlink" title="3. Function (å‡½æ•°&#x2F;è½¬æ¢è€…)"></a>3. Function (å‡½æ•°&#x2F;è½¬æ¢è€…)</h5><blockquote><p><strong>å£è¯€ï¼šæœ‰å»æœ‰å›ï¼ˆåŠ å·¥å¤„ç†ï¼‰</strong></p></blockquote><ul><li><strong>ä½œç”¨</strong>ï¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œç»è¿‡å¤„ç†åï¼Œ<strong>è¿”å›ä¸€ä¸ªç»“æœ</strong>ã€‚è¿™æ˜¯æœ€ç»å…¸çš„æ•°å­¦å‡½æ•°æ¦‚å¿µ $y &#x3D; f(x)$ã€‚</li><li><strong>æŠ½è±¡æ–¹æ³•</strong>ï¼š<code>R apply(T t)</code> (T æ˜¯è¾“å…¥ç±»å‹ï¼ŒR æ˜¯è¾“å‡ºç±»å‹)</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç±»å‹è½¬æ¢ï¼ˆString è½¬ Integerï¼‰ã€å¯¹è±¡æå–ï¼ˆUser å¯¹è±¡è½¬ UserIDï¼‰ã€æ•°æ®å¤„ç†ã€‚</li></ul><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ï¼šæ¥æ”¶ä¸€ä¸ª Stringï¼Œè¿”å›å®ƒçš„é•¿åº¦ Integer</span></span><br><span class="line"><span class="comment">// Function&lt;è¾“å…¥ç±»å‹, è¾“å‡ºç±»å‹&gt;</span></span><br><span class="line">Function&lt;String, Integer&gt; lengthMapper = s -&gt; s.length();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ï¼š</span></span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> lengthMapper.apply(<span class="string">&quot;Java8&quot;</span>);</span><br><span class="line">System.out.println(len); <span class="comment">// è¾“å‡º: 5</span></span><br></pre></td></tr></table></figure><hr><h5 id="4-Predicate-æ–­è¨€-è£åˆ¤"><a href="#4-Predicate-æ–­è¨€-è£åˆ¤" class="headerlink" title="4. Predicate (æ–­è¨€&#x2F;è£åˆ¤)"></a>4. Predicate (æ–­è¨€&#x2F;è£åˆ¤)</h5><blockquote><p><strong>å£è¯€ï¼šéé»‘å³ç™½ï¼ˆçœŸå‡åˆ¤æ–­ï¼‰</strong></p></blockquote><ul><li><strong>ä½œç”¨</strong>ï¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œ<strong>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ (boolean)</strong>ã€‚</li><li><strong>æŠ½è±¡æ–¹æ³•</strong>ï¼š<code>boolean test(T t)</code></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ•°æ®è¿‡æ»¤ï¼ˆfilterï¼‰ã€æ¡ä»¶åˆ¤æ–­ã€æƒé™æ£€æŸ¥ã€‚</li></ul><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ï¼šæ¥æ”¶ä¸€ä¸ª Stringï¼Œåˆ¤æ–­å®ƒçš„é•¿åº¦æ˜¯å¦å¤§äº 5</span></span><br><span class="line">Predicate&lt;String&gt; isLongText = s -&gt; s.length() &gt; <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ï¼š</span></span><br><span class="line">System.out.println(isLongText.test(<span class="string">&quot;Java&quot;</span>));   <span class="comment">// false</span></span><br><span class="line">System.out.println(isLongText.test(<span class="string">&quot;Java8_Lambda&quot;</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><hr><h5 id="æ€»ç»“å¯¹æ¯”è¡¨-Cheat-Sheet"><a href="#æ€»ç»“å¯¹æ¯”è¡¨-Cheat-Sheet" class="headerlink" title="æ€»ç»“å¯¹æ¯”è¡¨ (Cheat Sheet)"></a>æ€»ç»“å¯¹æ¯”è¡¨ (Cheat Sheet)</h5><p>é’ˆå¯¹ <code>Consumer</code>, <code>Function</code>, <code>Predicate</code> æä¾›äº† â€œBiâ€ (Binaryï¼ŒäºŒå…ƒ) ç‰ˆæœ¬ï¼š</p><ol><li><strong>BiConsumer&lt;T, U&gt;</strong>ï¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæ— è¿”å›å€¼ã€‚<ul><li><em>æ¯”å¦‚ï¼šæŠŠ Key å’Œ Value æ”¾å…¥ Mapã€‚</em></li></ul></li><li><strong>BiFunction&lt;T, U, R&gt;</strong>ï¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•° (T, U)ï¼Œè¿”å›ä¸€ä¸ªç»“æœ (R)ã€‚<ul><li><em>æ¯”å¦‚ï¼šä¸¤ä¸ªæ•´æ•°ç›¸åŠ  <code>(a, b) -&gt; a + b</code>ã€‚</em></li></ul></li><li><strong>BiPredicate&lt;T, U&gt;</strong>ï¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œè¿”å› booleanã€‚<ul><li><em>æ¯”å¦‚ï¼šåˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ã€‚</em><br><em>(æ³¨ï¼šSupplier ä¸éœ€è¦ Bi ç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±ä¸æ¥å—å‚æ•°)</em></li></ul></li></ol><table><thead><tr><th><strong>æ¥å£å</strong></th><th><strong>è¾“å…¥å‚æ•°</strong></th><th><strong>è¿”å›å€¼</strong></th><th><strong>æ–¹æ³•å</strong></th><th><strong>æ ¸å¿ƒé€»è¾‘</strong></th><th><strong>å…¸å‹åº”ç”¨</strong></th></tr></thead><tbody><tr><td><strong>Consumer<T></strong></td><td>T</td><td>void</td><td><code>accept(t)</code></td><td><strong>æ¶ˆè´¹</strong>æ•°æ®</td><td><code>forEach</code> æ‰“å°ã€ä¿å­˜</td></tr><tr><td><strong>Supplier<T></strong></td><td>æ— </td><td>T</td><td><code>get()</code></td><td><strong>æä¾›</strong>æ•°æ®</td><td><code>generate</code> ç”Ÿæˆã€å·¥å‚æ–¹æ³•</td></tr><tr><td><strong>Function&lt;T, R&gt;</strong></td><td>T</td><td>R</td><td><code>apply(t)</code></td><td><strong>è½¬æ¢</strong>æ•°æ®</td><td><code>map</code> è½¬æ¢ã€æå–å­—æ®µ</td></tr><tr><td><strong>Predicate<T></strong></td><td>T</td><td>boolean</td><td><code>test(t)</code></td><td><strong>åˆ¤æ–­</strong>æ•°æ®</td><td><code>filter</code> è¿‡æ»¤ã€éªŒè¯</td></tr></tbody></table><h2 id="Method-Reference-æ–¹æ³•å¼•ç”¨"><a href="#Method-Reference-æ–¹æ³•å¼•ç”¨" class="headerlink" title="Method Reference - æ–¹æ³•å¼•ç”¨"></a>Method Reference - æ–¹æ³•å¼•ç”¨</h2><blockquote><p> æ–¹æ³•å¼•ç”¨æ˜¯ Lambda è¡¨è¾¾å¼çš„<strong>è¯­æ³•ç³–</strong>ï¼ˆSyntactic Sugarï¼‰ã€‚å¦‚æœä½ çš„ Lambda è¡¨è¾¾å¼ä»…ä»…æ˜¯<strong>è°ƒç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–¹æ³•</strong>ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨æ¥æ›¿ä»£ Lambdaã€‚</p></blockquote><h4 id="è¯­æ³•æ ¼å¼-1"><a href="#è¯­æ³•æ ¼å¼-1" class="headerlink" title="è¯­æ³•æ ¼å¼"></a>è¯­æ³•æ ¼å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç±»åæˆ–å¯¹è±¡å::æ–¹æ³•å</span><br></pre></td></tr></table></figure><h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lamba</span></span><br><span class="line">Function&lt;String, Integer&gt; func = input -&gt; Integer.parseInt(input)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">Function&lt;String, Integer&gt; ref = Integer::parseInt;</span><br></pre></td></tr></table></figure><ul><li><strong>Lambda</strong> æ˜¯ä¸ºäº†è®©æˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°å½“ä½œå‚æ•°ä¼ é€’ï¼Œæ‘†è„±ç¹ççš„åŒ¿åå†…éƒ¨ç±»ã€‚</li><li><strong>æ–¹æ³•å¼•ç”¨</strong> æ˜¯åœ¨ Lambda çš„åŸºç¡€ä¸Šï¼Œå¦‚æœé€»è¾‘åªæ˜¯â€œè°ƒç”¨ä¸€ä¸ªå·²æœ‰çš„æ–¹æ³•â€ï¼Œåˆ™è¿›ä¸€æ­¥ç®€åŒ–ä»£ç ã€‚</li></ul><h2 id="Supplier"><a href="#Supplier" class="headerlink" title="Supplier"></a>Supplier</h2><p><code>Supplier</code> æ¥å£çš„åº”ç”¨åœºæ™¯é€šå¸¸æ¶‰åŠéœ€è¦å»¶è¿Ÿè®¡ç®—ã€åŠ¨æ€ç”Ÿæˆå€¼ã€æˆ–è€…åœ¨éœ€è¦æä¾›æŸç§é»˜è®¤å€¼çš„æƒ…å†µã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„åº”ç”¨åœºæ™¯ï¼š</p><ol><li><p><strong>å»¶è¿Ÿè®¡ç®—ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Supplier&lt;Double&gt; randomSupplier = Math::random;</span><br><span class="line"><span class="comment">// è¿™é‡Œå¹¶ä¸ä¼šç«‹å³ç”Ÿæˆéšæœºæ•°ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨get()æ—¶æ‰ç”Ÿæˆ</span></span><br><span class="line"><span class="type">double</span> <span class="variable">randomValue</span> <span class="operator">=</span> randomSupplier.get();</span><br></pre></td></tr></table></figure></li><li><p><strong>æä¾›é»˜è®¤å€¼ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Supplier&lt;String&gt; defaultStringSupplier = () -&gt; <span class="string">&quot;Default Value&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> getValueFromSomeSource(); <span class="comment">// æŸä¸ªæ–¹æ³•è·å–å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> (value != <span class="literal">null</span>) ? value : defaultStringSupplier.get();</span><br></pre></td></tr></table></figure></li><li><p><strong>åŠ¨æ€ç”Ÿæˆå¯¹è±¡ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Supplier&lt;List&lt;String&gt;&gt; listSupplier = ArrayList::<span class="keyword">new</span>;</span><br><span class="line">List&lt;String&gt; list = listSupplier.get();</span><br></pre></td></tr></table></figure></li><li><p><strong>æ‡’åŠ è½½ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazyInitializedObject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Supplier&lt;ExpensiveObject&gt; expensiveObjectSupplier = </span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            <span class="type">ExpensiveObject</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExpensiveObject</span>();</span><br><span class="line">            <span class="comment">// è¿›è¡Œä¸€äº›åˆå§‹åŒ–æˆ–è€…å…¶ä»–æ“ä½œ</span></span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ExpensiveObject <span class="title function_">getExpensiveObject</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expensiveObjectSupplier.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>è¿™äº›ä¾‹å­éƒ½å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>Supplier</code> æ¥å£æ¥æä¾›ä¸€ç§æ–¹æ³•ï¼Œä½¿å¾—æŸäº›å€¼æˆ–æ“ä½œçš„è®¡ç®—è¢«æ¨è¿Ÿï¼Œç›´åˆ°çœŸæ­£éœ€è¦è¿™äº›å€¼çš„æ—¶å€™å†è¿›è¡Œè®¡ç®—ã€‚è¿™ç§å»¶è¿Ÿè®¡ç®—çš„ç‰¹æ€§å¯ä»¥æé«˜æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æ˜‚è´µæˆ–è€…èµ„æºå¯†é›†å‹çš„æ“ä½œæ—¶ã€‚</p><h2 id="Stream-API"><a href="#Stream-API" class="headerlink" title="Stream API"></a>Stream API</h2><p>Stream API å¼•å…¥äº†ä¸€ç§æ–°çš„æŠ½è±¡ï¼Œç”¨äºå¯¹é›†åˆè¿›è¡Œæµå¼æ“ä½œã€‚å®ƒæä¾›äº†ä¸€ç§å£°æ˜æ€§çš„æ–¹å¼æ¥æ“ä½œæ•°æ®ï¼Œæ”¯æŒç±»ä¼¼ SQL çš„æŸ¥è¯¢è¯­è¨€ï¼Œä½¿å¾—ä»£ç æ›´ä¸ºæ¸…æ™°å’Œç®€æ´ã€‚Stream æ“ä½œå¯ä»¥åˆ†ä¸ºä¸­é—´æ“ä½œå’Œç»ˆç«¯æ“ä½œã€‚</p><p>ä¸­é—´æ“ä½œå¯ä»¥æ˜¯é“¾å¼çš„ï¼Œå½¢æˆä¸€æ¡æµæ°´çº¿ï¼Œä¾‹å¦‚è¿‡æ»¤ã€æ˜ å°„ã€æ’åºç­‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; filteredNames = names.stream()</span><br><span class="line">                                  .filter(name -&gt; name.startsWith(<span class="string">&quot;A&quot;</span>))</span><br><span class="line">                                  .map(String::toUpperCase)</span><br><span class="line">                                  .collect(Collectors.toList());</span><br></pre></td></tr></table></figure><p>ç»ˆç«¯æ“ä½œä¼šè§¦å‘æµæ°´çº¿çš„æ‰§è¡Œï¼Œä¾‹å¦‚æ”¶é›†ã€è®¡æ•°ã€èšåˆç­‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> names.stream().count();</span><br></pre></td></tr></table></figure><p>Stream API ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿä»¥ä¸€ç§æ›´å‡½æ•°å¼çš„æ–¹å¼æ¥å¤„ç†æ•°æ®ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>Lambda è¡¨è¾¾å¼å’Œ Stream API é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å®ç°æ›´ç®€æ´ã€é«˜æ•ˆçš„é›†åˆæ“ä½œã€‚å®ƒä»¬æ˜¯ Java å‘å‡½æ•°å¼ç¼–ç¨‹çš„è½¬å˜è¿ˆå‡ºçš„é‡è¦ä¸€æ­¥ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ›´å¤šçµæ´»æ€§å’Œè¡¨è¾¾åŠ›ã€‚</p><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><ol><li><p><strong>é»˜è®¤æ–¹æ³•ï¼ˆDefault Methodsï¼‰ï¼š</strong></p><ul><li>æ¥å£ä¸­å¯ä»¥åŒ…å«é»˜è®¤æ–¹æ³•ï¼Œå…è®¸åœ¨æ¥å£ä¸­æä¾›å…·ä½“å®ç°ï¼Œè€Œä¸å½±å“å®ç°è¯¥æ¥å£çš„ç°æœ‰ç±»ã€‚è¿™ä¸ºæ¥å£çš„æ¼”è¿›æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">myMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Default implementation&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å‡½æ•°å¼æ¥å£ï¼š</strong></p><ul><li>å‡½æ•°å¼æ¥å£æ˜¯åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚Java 8 é€šè¿‡ <code>@FunctionalInterface</code> æ³¨è§£æ¥æ”¯æŒå‡½æ•°å¼æ¥å£çš„å®šä¹‰ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ”¯æŒ Lambda è¡¨è¾¾å¼ã€‚</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyFunctionalInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">myMethod</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><p><strong>æ–°çš„æ—¥æœŸå’Œæ—¶é—´ APIï¼š</strong></p><ul><li><code>java.time</code> åŒ…æä¾›äº†å…¨æ–°çš„æ—¥æœŸå’Œæ—¶é—´ APIï¼Œæ”¯æŒæ›´æ–¹ä¾¿çš„æ—¥æœŸå’Œæ—¶é—´æ“ä½œï¼Œè§£å†³äº†æ—§çš„ <code>java.util.Date</code> å’Œ <code>java.util.Calendar</code> ç±»çš„é—®é¢˜ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line"><span class="type">LocalTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalTime.now();</span><br></pre></td></tr></table></figure></li><li><p><strong>CompletableFutureï¼š</strong></p><ul><li><code>CompletableFuture</code> æ˜¯ä¸€ä¸ªæ”¯æŒå¼‚æ­¥ç¼–ç¨‹çš„å·¥å…·ï¼Œå¯ä»¥è½»æ¾å¤„ç†å¼‚æ­¥æ“ä½œå’Œæ„å»ºå¼‚æ­¥åº”ç”¨ç¨‹åºã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">                                                   .thenApply(s -&gt; s + <span class="string">&quot; World&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>æ–¹æ³•å¼•ç”¨ï¼ˆMethod Referencesï¼‰ï¼š</strong></p><ul><li>æ–¹æ³•å¼•ç”¨æ˜¯ä¸€ç§ç®€åŒ– Lambda è¡¨è¾¾å¼çš„è¯­æ³•ï¼Œå®ƒæä¾›äº†ä¸€ç§ç›´æ¥å¼•ç”¨å·²æœ‰æ–¹æ³•ï¼ˆé™æ€æ–¹æ³•ã€å®ä¾‹æ–¹æ³•æˆ–æ„é€ æ–¹æ³•ï¼‰çš„æ–¹å¼ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.forEach(System.out::println);</span><br></pre></td></tr></table></figure></li></ol><p>è¿™äº›ç‰¹æ€§ä½¿å¾— Java 8 åœ¨ä»£ç ç¼–å†™ã€é›†åˆæ“ä½œã€å¹¶å‘ç¼–ç¨‹ç­‰æ–¹é¢å˜å¾—æ›´åŠ å¼ºå¤§å’Œçµæ´»ã€‚å­¦ä¹ è¿™äº›ç‰¹æ€§å¯ä»¥æé«˜ä»£ç çš„æ•ˆç‡ã€å¯è¯»æ€§ï¼Œå¹¶ä½¿ä»£ç æ›´å…·ç°ä»£åŒ–ã€‚</p><h2 id="Java-17-æ–°ç‰¹æ€§"><a href="#Java-17-æ–°ç‰¹æ€§" class="headerlink" title="Java 17 æ–°ç‰¹æ€§"></a>Java 17 æ–°ç‰¹æ€§</h2><h3 id="1-æ–‡æœ¬å—-Text-Blocks"><a href="#1-æ–‡æœ¬å—-Text-Blocks" class="headerlink" title="1. æ–‡æœ¬å— (Text Blocks)"></a>1. æ–‡æœ¬å— (Text Blocks)</h3><blockquote><p><strong>è§£å†³ç—›ç‚¹</strong>ï¼šåœ¨ Java ä»£ç ä¸­æ‹¼æ¥ JSONã€SQL æˆ– HTML å­—ç¬¦ä¸²ç®€ç›´æ˜¯å™©æ¢¦ï¼ˆéœ€è¦å¤§é‡çš„ <code>+</code> å·å’Œè½¬ä¹‰å­—ç¬¦ <code>\&quot;</code>ï¼‰ã€‚</p></blockquote><ul><li><strong>Java 13&#x2F;15 å¼•å…¥</strong></li><li>ä½¿ç”¨ä¸‰ä¸ªåŒå¼•å· <code>&quot;&quot;&quot;</code> åŒ…è£¹ã€‚</li></ul><p><strong>Java 8 å†™æ³•ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String json = &quot;&#123;\n&quot; +</span><br><span class="line">              &quot;  \&quot;name\&quot;: \&quot;Java\&quot;,\n&quot; +</span><br><span class="line">              &quot;  \&quot;age\&quot;: 17\n&quot; +</span><br><span class="line">              &quot;&#125;&quot;;</span><br></pre></td></tr></table></figure><p><strong>Java 17 å†™æ³•ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String json = &quot;&quot;&quot;</span><br><span class="line">              &#123;</span><br><span class="line">                &quot;name&quot;: &quot;Java&quot;,</span><br><span class="line">                &quot;age&quot;: 17</span><br><span class="line">              &#125;</span><br><span class="line">              &quot;&quot;&quot;;</span><br><span class="line">// æ‰€è§å³æ‰€å¾—ï¼Œè‡ªåŠ¨å¤„ç†ç¼©è¿›ï¼Œæ— éœ€æ‰‹åŠ¨è½¬ä¹‰å¼•å·</span><br></pre></td></tr></table></figure><hr><h3 id="2-Record-ç±»-Records"><a href="#2-Record-ç±»-Records" class="headerlink" title="2. Record ç±» (Records)"></a>2. Record ç±» (Records)</h3><blockquote><p><strong>è§£å†³ç—›ç‚¹</strong>ï¼šä¸ºäº†å†™ä¸€ä¸ªç®€å•çš„ DTO (æ•°æ®ä¼ è¾“å¯¹è±¡)ï¼Œéœ€è¦å†™æ„é€ å™¨ã€Getterã€<code>equals()</code>ã€<code>hashCode()</code>ã€<code>toString()</code>ï¼Œæˆ–è€…ä¾èµ– Lombokã€‚</p></blockquote><ul><li><strong>Java 14&#x2F;16 å¼•å…¥</strong></li><li><strong>Record</strong> æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå®ƒæ˜¯<strong>ä¸å¯å˜ (Immutable)</strong> çš„ï¼Œä¸“é—¨ç”¨äºæ‰¿è½½æ•°æ®ã€‚</li></ul><p><strong>Java 8 å†™æ³• (éœ€è¦ Lombok æˆ–æ‰‹åŠ¨å†™ä¸€å¤§å †)ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class Point &#123;</span><br><span class="line">    private final int x;</span><br><span class="line">    private final int y;</span><br><span class="line"></span><br><span class="line">    public Point(int x, int y) &#123; </span><br><span class="line">        this.x = x; </span><br><span class="line">        this.y = y; </span><br><span class="line">    &#125;</span><br><span class="line">    // è¿˜è¦å†™ getter, equals, hashCode, toString...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Java 17 å†™æ³•ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// ä¸€è¡Œä»£ç æå®šï¼</span><br><span class="line">// è‡ªåŠ¨ç”Ÿæˆï¼šæ„é€ å™¨ã€x() å’Œ y() è®¿é—®æ–¹æ³•ï¼ˆæ³¨æ„ä¸å« getXï¼‰ã€equalsã€hashCodeã€toString</span><br><span class="line">public record Point(int x, int y) &#123;&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Lombok @Data</strong></th><th><strong>Java 17 Record</strong></th></tr></thead><tbody><tr><td><strong>æœ¬è´¨</strong></td><td>ä»£ç ç”Ÿæˆå·¥å…· (Annotation Processor)</td><td>Java è¯­è¨€ç‰¹æ€§ (Class çš„å˜ä½“)</td></tr><tr><td><strong>å¯å˜æ€§</strong></td><td><strong>Mutable</strong> (æœ‰ Setters)</td><td><strong>Immutable</strong> (æ—  Setters, å…¨ final)</td></tr><tr><td><strong>ç»§æ‰¿</strong></td><td>å¯ä»¥ç»§æ‰¿&#x2F;è¢«ç»§æ‰¿</td><td><strong>ä¸å¯ç»§æ‰¿</strong> (éšå¼ final)</td></tr><tr><td><strong>è®¿é—®å™¨å‘½å</strong></td><td><code>getName()</code></td><td><code>name()</code></td></tr><tr><td><strong>æ— å‚æ„é€ å™¨</strong></td><td>é»˜è®¤æœ‰ (æˆ–é€šè¿‡ <code>@NoArgsConstructor</code>)</td><td><strong>é»˜è®¤æ— </strong> (åªæœ‰å…¨å‚æ„é€ å™¨)</td></tr><tr><td><strong>æ¡†æ¶æ”¯æŒ</strong></td><td>100% æ”¯æŒ (JavaBean è§„èŒƒ)</td><td>éœ€è¦è¾ƒæ–°æ¡†æ¶æ”¯æŒ (Jackson 2.12+, Spring 5.3+)</td></tr><tr><td><strong>æœ€ä½³ç”¨é€”</strong></td><td><strong>JPA Entity (å®ä½“ç±»)</strong></td><td><strong>DTO, VO, Config, Map Key</strong></td></tr></tbody></table><hr><h3 id="3-Switch-è¡¨è¾¾å¼-Switch-Expressions"><a href="#3-Switch-è¡¨è¾¾å¼-Switch-Expressions" class="headerlink" title="3. Switch è¡¨è¾¾å¼ (Switch Expressions)"></a>3. Switch è¡¨è¾¾å¼ (Switch Expressions)</h3><blockquote><p><strong>è§£å†³ç—›ç‚¹</strong>ï¼šæ—§çš„ switch è¯­æ³•ç¹çï¼Œå®¹æ˜“æ¼å†™ <code>break</code> å¯¼è‡´ bugï¼Œä¸”ä¸èƒ½ç›´æ¥ä½œä¸ºè¿”å›å€¼èµ‹å€¼ç»™å˜é‡ã€‚</p></blockquote><ul><li><strong>Java 12&#x2F;14 å¼•å…¥</strong></li><li>æ”¯æŒ <code>-&gt;</code> ç®­å¤´è¯­æ³•ï¼Œæ— éœ€ <code>break</code>ã€‚</li></ul><p><strong>Java 8 å†™æ³•ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">String day = &quot;MONDAY&quot;;</span><br><span class="line">int num;</span><br><span class="line">switch (day) &#123;</span><br><span class="line">    case &quot;MONDAY&quot;:</span><br><span class="line">    case &quot;FRIDAY&quot;:</span><br><span class="line">    case &quot;SUNDAY&quot;:</span><br><span class="line">        num = 6;</span><br><span class="line">        break;</span><br><span class="line">    case &quot;TUESDAY&quot;:</span><br><span class="line">        num = 7;</span><br><span class="line">        break;</span><br><span class="line">    default:</span><br><span class="line">        num = 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Java 17 å†™æ³•ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// ç›´æ¥è¿”å›å€¼ï¼Œé€»è¾‘æ¸…æ™°ï¼Œæ—  break</span><br><span class="line">int num = switch (day) &#123;</span><br><span class="line">    case &quot;MONDAY&quot;, &quot;FRIDAY&quot;, &quot;SUNDAY&quot; -&gt; 6;</span><br><span class="line">    case &quot;TUESDAY&quot; -&gt; 7;</span><br><span class="line">    default -&gt; 0;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h3 id="4-instanceof-æ¨¡å¼åŒ¹é…-Pattern-Matching-for-instanceof"><a href="#4-instanceof-æ¨¡å¼åŒ¹é…-Pattern-Matching-for-instanceof" class="headerlink" title="4. instanceof æ¨¡å¼åŒ¹é… (Pattern Matching for instanceof)"></a>4. instanceof æ¨¡å¼åŒ¹é… (Pattern Matching for instanceof)</h3><blockquote><p><strong>è§£å†³ç—›ç‚¹</strong>ï¼šæ¯æ¬¡åˆ¤æ–­å®Œ <code>instanceof</code>ï¼Œè¿˜å¾—å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸€æ¬¡ï¼Œéå¸¸å•°å—¦ã€‚</p></blockquote><ul><li><strong>Java 14&#x2F;16 å¼•å…¥</strong></li></ul><p><strong>Java 8 å†™æ³•ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object obj = &quot;Hello&quot;;</span><br><span class="line">if (obj instanceof String) &#123;</span><br><span class="line">    String s = (String) obj; // å¿…é¡»å¼ºè½¬</span><br><span class="line">    System.out.println(s.length());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Java 17 å†™æ³•ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object obj = &quot;Hello&quot;;</span><br><span class="line">// å¦‚æœæ˜¯ Stringï¼Œç›´æ¥è½¬ä¸ºå˜é‡ sï¼Œå¤§æ‹¬å·å†…ç›´æ¥ç”¨</span><br><span class="line">if (obj instanceof String s) &#123;</span><br><span class="line">    System.out.println(s.length());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å…¶ä»–é‡è¦æ›´æ–°-ä¸€å¥è¯å¸¦è¿‡"><a href="#å…¶ä»–é‡è¦æ›´æ–°-ä¸€å¥è¯å¸¦è¿‡" class="headerlink" title="å…¶ä»–é‡è¦æ›´æ–° (ä¸€å¥è¯å¸¦è¿‡)"></a>å…¶ä»–é‡è¦æ›´æ–° (ä¸€å¥è¯å¸¦è¿‡)</h3><ol><li><p><strong>var å…³é”®å­— (Java 10)</strong>ï¼šå±€éƒ¨å˜é‡ç±»å‹æ¨æ–­ã€‚</p><ul><li><code>var list = new ArrayList&lt;String&gt;();</code> ï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ list æ˜¯ ArrayList ç±»å‹ï¼‰ã€‚</li></ul></li><li><p><strong>å¯†å°ç±» Sealed Classes (Java 15&#x2F;17)</strong>ï¼š</p><ul><li>å…è®¸ä½ æ§åˆ¶<strong>è°å¯ä»¥ç»§æ‰¿æˆ‘</strong>ã€‚</li><li><code>public sealed class Shape permits Circle, Square {}</code></li><li>è¿™å¯¹äºç¼–å†™ä¸¥è°¨çš„é¢†åŸŸæ¨¡å‹æˆ–æ¡†æ¶éå¸¸æœ‰ç”¨ã€‚</li></ul></li><li><p><strong>æ›´æœ‰ç”¨çš„ NullPointerException (Java 14)</strong>ï¼š</p><ul><li>ä»¥å‰åªæŠ¥ NPEï¼Œä¸å‘Šè¯‰ä½ æ˜¯å“ªä¸ªå¯¹è±¡ç©ºäº†ã€‚</li><li>ç°åœ¨ä¼šæç¤ºï¼š<code>Cannot invoke &quot;String.length()&quot; because &quot;name&quot; is null</code>ã€‚</li></ul></li><li><p><strong>Stream.toList() (Java 16)</strong>ï¼š</p><ul><li>ä»¥å‰ï¼š<code>.collect(Collectors.toList())</code></li><li>ç°åœ¨ï¼š<code>.toList()</code> (æ³¨æ„ï¼šè¿™ä¸ªè¿”å›çš„æ˜¯ä¸å¯å˜ List)ã€‚</li></ul></li></ol><hr><h3 id="æ€»ç»“ï¼šä¸ºä»€ä¹ˆè¦å‡-Java-17ï¼Ÿ"><a href="#æ€»ç»“ï¼šä¸ºä»€ä¹ˆè¦å‡-Java-17ï¼Ÿ" class="headerlink" title="æ€»ç»“ï¼šä¸ºä»€ä¹ˆè¦å‡ Java 17ï¼Ÿ"></a>æ€»ç»“ï¼šä¸ºä»€ä¹ˆè¦å‡ Java 17ï¼Ÿ</h3><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>å½±å“</strong></th></tr></thead><tbody><tr><td><strong>Record</strong></td><td><strong>å¹²æ‰ DTO æ ·æ¿ä»£ç </strong>ï¼Œç”šè‡³å¯èƒ½ä¸å†éœ€è¦ Lombok çš„ <code>@Data</code>ã€‚</td></tr><tr><td><strong>Text Blocks</strong></td><td><strong>SQL&#x2F;JSON æ‹¼æ¥ç¥å™¨</strong>ï¼Œä»£ç å¯è¯»æ€§æå‡ 10 å€ã€‚</td></tr><tr><td><strong>Switch è¡¨è¾¾å¼</strong></td><td>é€»è¾‘æ›´ç´§å‡‘ï¼Œå‡å°‘ Bugã€‚</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>G1 åƒåœ¾å›æ”¶å™¨ä¼˜åŒ–ï¼Œä»¥åŠ <strong>ZGC</strong> (ä½å»¶è¿Ÿ GC) çš„æˆç†Ÿï¼Œåº”ç”¨ååé‡æ›´é«˜ã€‚</td></tr><tr><td><strong>Spring Boot 3</strong></td><td><strong>å¼ºåˆ¶è¦æ±‚</strong> Java 17+ã€‚</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå¹¶å‘ç¼–ç¨‹</title>
      <link href="/posts/eb9166f8.html"/>
      <url>/posts/eb9166f8.html</url>
      
        <content type="html"><![CDATA[<p>å¥½çš„ï¼Œé˜…è¯» JUCï¼ˆJava Util Concurrentï¼‰æºç æ˜¯ä¸€é¡¹éå¸¸æ£’çš„å­¦ä¹ ä»»åŠ¡ï¼Œå®ƒèƒ½è®©ä½ æ·±å…¥ç†è§£ Java å¹¶å‘ç¼–ç¨‹çš„ç²¾é«“ï¼Œä»¥åŠ JVM å’Œæ“ä½œç³»ç»Ÿå±‚é¢çš„ä¸€äº›çŸ¥è¯†ã€‚JUC åŒ…æ˜¯ Java å¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ï¼ŒåŒ…å«äº†çº¿ç¨‹æ± ã€é”ã€åŸå­æ“ä½œã€å¹¶å‘é›†åˆç­‰æ ¸å¿ƒç»„ä»¶ã€‚</p><p>ä¸‹é¢ä¸ºä½ åˆ—ä¸€ä¸ª JUC æºç å­¦ä¹ çš„å¤§çº²ï¼Œå¹¶æä¾›ä¸€äº›å­¦ä¹ å»ºè®®ï¼š</p><hr><h3 id="JUC-æºç å­¦ä¹ å¤§çº²"><a href="#JUC-æºç å­¦ä¹ å¤§çº²" class="headerlink" title="JUC æºç å­¦ä¹ å¤§çº²"></a>JUC æºç å­¦ä¹ å¤§çº²</h3><p><strong>ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€çŸ¥è¯†å›é¡¾ä¸å·¥å…·å‡†å¤‡</strong></p><ol><li><strong>å¹¶å‘åŸºç¡€ç†è®ºï¼š</strong><ul><li><strong>å¯è§æ€§ã€åŸå­æ€§ã€æœ‰åºæ€§ï¼š</strong> æ·±å…¥ç†è§£è¿™ä¸‰å¤§ç‰¹æ€§åŠå…¶åœ¨å¹¶å‘ä¸­çš„é‡è¦æ€§ã€‚</li><li><strong>JMM (Java Memory Model)ï¼š</strong> äº†è§£ Java å†…å­˜æ¨¡å‹å¦‚ä½•ä¿è¯å¹¶å‘çš„æ­£ç¡®æ€§ã€‚</li><li><strong>Happens-Before åŸåˆ™ï¼š</strong> ç†è§£å®ƒå¦‚ä½•å®šä¹‰æ“ä½œä¹‹é—´çš„é¡ºåºã€‚</li><li><strong>é”çš„åŸç†ï¼š</strong> äº†è§£æ‚²è§‚é”ã€ä¹è§‚é”ï¼Œä»¥åŠè‡ªæ—‹é”ç­‰æ¦‚å¿µã€‚</li><li><strong>AQS (AbstractQueuedSynchronizer) æ¦‚è¿°ï¼š</strong> å¯¹ AQS æœ‰ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼Œå®ƒæ˜¯ JUC è®¸å¤šé«˜çº§åŒæ­¥å™¨çš„åŸºçŸ³ã€‚</li><li><strong>CAS (Compare-And-Swap) åŸç†ï¼š</strong> ç†è§£å…¶ä¸‰æ­¥æ“ä½œå’Œ ABA é—®é¢˜ã€‚</li></ul></li><li><strong>Lombok ä¸ <code>@SneakyThrows</code>ï¼š</strong><ul><li>Lombok åœ¨ JUC æºç ä¸­ä¸å¸¸ç”¨ï¼Œä½†å¦‚æœä½ åœ¨å…¶ä»–é¡¹ç›®ä¸­å¤§é‡ä½¿ç”¨ Lombokï¼Œå¯ä»¥äº†è§£å…¶åŸç†ã€‚</li><li><code>@SneakyThrows</code>ï¼šç†è§£å…¶ä½œç”¨ã€ä¼˜ç¼ºç‚¹åŠä½•æ—¶ä½¿ç”¨ã€‚</li></ul></li><li><strong>å·¥å…·å‡†å¤‡ï¼š</strong><ul><li><strong>IntelliJ IDEAï¼š</strong> æœ€æ¨èçš„ IDEï¼Œå…¶æºç å¯¼èˆªå’Œè°ƒè¯•åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚</li><li><strong>JAD æˆ– JD-GUIï¼š</strong> åç¼–è¯‘å·¥å…·ï¼Œç”¨äºæŸ¥çœ‹å­—èŠ‚ç ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚</li><li><strong>VisualVM æˆ– JProfilerï¼š</strong> æ€§èƒ½åˆ†æå·¥å…·ï¼Œç”¨äºè§‚å¯Ÿçº¿ç¨‹çŠ¶æ€ã€é”ç«äº‰ç­‰ï¼ˆå¯é€‰ï¼‰ã€‚</li><li><strong>ç”»å›¾å·¥å…·ï¼š</strong> å¦‚ draw. Io, XMind, Excalidraw ç­‰ï¼Œç”¨äºç»˜åˆ¶ç±»å›¾ã€çŠ¶æ€è½¬æ¢å›¾ã€‚</li></ul></li></ol><p><strong>ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŸå­æ“ä½œä¸ CAS æ·±å…¥</strong></p><ol><li><code>java.util.concurrent.atomic</code> åŒ…ï¼š<ul><li><code>AtomicInteger</code>ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> å…³æ³¨å…¶æ ¸å¿ƒæ–¹æ³• <code>compareAndSet()</code>ã€‚</li><li><strong>åº•å±‚æœºåˆ¶ï¼š</strong> äº†è§£å®ƒå¦‚ä½•åˆ©ç”¨ <code>Unsafe</code> ç±»çš„ CAS æ“ä½œï¼ˆ<code>compareAndSwapInt</code>ï¼‰ã€‚</li><li><strong><code>volatile</code> å…³é”®å­—ï¼š</strong> ç†è§£å®ƒåœ¨è¿™é‡Œçš„ä½œç”¨ï¼ˆä¿è¯å¯è§æ€§ï¼‰ã€‚</li></ul></li><li><code>AtomicLong</code> &#x2F; <code>AtomicBoolean</code> &#x2F; <code>AtomicReference</code>ï¼š<ul><li>ä¸ <code>AtomicInteger</code> ç±»ä¼¼ï¼Œé‡ç‚¹ç†è§£ <code>AtomicReference</code> å¦‚ä½•å®ç°å¯¹è±¡å¼•ç”¨çš„åŸå­æ›´æ–°ã€‚</li></ul></li><li><code>AtomicStampedReference</code> &#x2F; <code>AtomicMarkableReference</code>ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> é‡ç‚¹ç†è§£å®ƒä»¬å¦‚ä½•é€šè¿‡ç‰ˆæœ¬å·ï¼ˆæˆ–æ ‡è®°ï¼‰è§£å†³ CAS çš„ ABA é—®é¢˜ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> ä½•æ—¶éœ€è¦è€ƒè™‘ ABA é—®é¢˜ã€‚</li></ul></li><li><code>AtomicIntegerFieldUpdater</code> &#x2F; <code>AtomicLongFieldUpdater</code> &#x2F; <code>AtomicReferenceFieldUpdater</code>ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> äº†è§£å…¶å·¥ä½œåŸç†ï¼ˆé€šè¿‡åå°„å®ç°å¯¹æŒ‡å®šå¯¹è±¡çš„ç‰¹å®šå­—æ®µçš„åŸå­æ›´æ–°ï¼‰ã€‚</li><li><strong>ä½¿ç”¨é™åˆ¶ï¼š</strong> ä¸ºä»€ä¹ˆå­—æ®µå¿…é¡»æ˜¯ <code>volatile</code> ä¸”ä¸èƒ½æ˜¯ <code>static</code> æˆ– <code>final</code>ã€‚</li></ul></li><li><code>LongAdder</code> &#x2F; <code>DoubleAdder</code> &#x2F; <code>LongAccumulator</code> &#x2F; <code>DoubleAccumulator</code> (Java 8+):<ul><li><strong>æºç åˆ†æï¼š</strong> ç†è§£å®ƒä»¬å¦‚ä½•é€šè¿‡åˆ†æ®µï¼ˆcellsï¼‰æŠ€æœ¯ï¼Œå°†çƒ­ç‚¹ CAS ç«äº‰åˆ†æ•£ï¼Œæé«˜é«˜å¹¶å‘ä¸‹çš„æ€§èƒ½ã€‚</li><li><strong>ä¸ <code>AtomicLong</code> çš„å¯¹æ¯”ï¼š</strong> æ€§èƒ½ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯ã€‚</li></ul></li></ul></li></ol><p><strong>ç¬¬ä¸‰é˜¶æ®µï¼šé”çš„å®ç°åŸºçŸ³ - AQS (AbstractQueuedSynchronizer)</strong></p><ol><li><p><strong>AQS æ ¸å¿ƒåŸç†ï¼š</strong></p><ul><li><strong>å†…éƒ¨çŠ¶æ€ï¼ˆ<code>state</code>ï¼‰ï¼š</strong> å¦‚ä½•é€šè¿‡ <code>volatile int state</code> è¡¨ç¤ºåŒæ­¥çŠ¶æ€ã€‚</li><li><strong>FIFO åŒå‘é˜Ÿåˆ—ï¼š</strong> ç†è§£ç­‰å¾…çº¿ç¨‹å¦‚ä½•å°è£…æˆ <code>Node</code> èŠ‚ç‚¹ï¼Œå¹¶æ’é˜Ÿç­‰å¾…é”ã€‚</li><li>ç‹¬å æ¨¡å¼ä¸å…±äº«æ¨¡å¼ï¼š<ul><li><p>ç‹¬å æ¨¡å¼ï¼š</p><p> å¦‚ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReentrantLock</span><br></pre></td></tr></table></figure><p>ã€‚</p><ul><li><code>acquire()</code> &#x2F; <code>release()</code>ï¼šå¦‚ä½•è·å–å’Œé‡Šæ”¾é”ã€‚</li><li><code>tryAcquire()</code> &#x2F; <code>tryRelease()</code>ï¼šå°è¯•è·å–&#x2F;é‡Šæ”¾ï¼Œç”±å­ç±»å®ç°ã€‚</li></ul></li><li><p>å…±äº«æ¨¡å¼ï¼š</p><p> å¦‚ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Semaphore</span><br></pre></td></tr></table></figure><p>ã€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CountDownLatch</span><br></pre></td></tr></table></figure><p>ã€‚</p><ul><li><code>acquireShared()</code> &#x2F; <code>releaseShared()</code>ï¼šå¦‚ä½•è·å–å’Œé‡Šæ”¾å…±äº«é”ã€‚</li><li><code>tryAcquireShared()</code> &#x2F; <code>tryReleaseShared()</code>ï¼šå°è¯•è·å–&#x2F;é‡Šæ”¾ï¼Œç”±å­ç±»å®ç°ã€‚</li></ul></li></ul></li><li>æ¡ä»¶å˜é‡ (<code>ConditionObject</code>)ï¼š<ul><li>ç†è§£ AQS å†…éƒ¨çš„æ¡ä»¶é˜Ÿåˆ—ï¼Œä»¥åŠ <code>await()</code> &#x2F; <code>signal()</code> &#x2F; <code>signalAll()</code> çš„å®ç°ã€‚</li></ul></li></ul></li><li><p><strong>AQS å…¸å‹å®ç°ç±»ï¼š</strong></p><ul><li><code>ReentrantLock</code>ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> é‡ç‚¹çœ‹ <code>Sync</code> æŠ½è±¡ç±» (<code>NonfairSync</code> å’Œ <code>FairSync</code>) çš„å®ç°ã€‚</li><li><strong>å…¬å¹³é”ä¸éå…¬å¹³é”ï¼š</strong> å®ƒä»¬çš„åŒºåˆ«å’Œå®ç°æ–¹å¼ï¼ˆAQS <code>tryAcquire</code> çš„å·®å¼‚ï¼‰ã€‚</li><li><strong>å¯é‡å…¥æ€§ï¼š</strong> å¦‚ä½•é€šè¿‡ <code>state</code> è®¡æ•°å’Œå½“å‰æŒæœ‰çº¿ç¨‹æ¥ç®¡ç†ã€‚</li></ul></li><li><code>Semaphore</code> (ä¿¡å·é‡)ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> ç†è§£å®ƒå¦‚ä½•åŸºäº AQS çš„å…±äº«æ¨¡å¼å®ç°è®¸å¯è¯è®¡æ•°ã€‚</li><li><strong><code>acquire()</code> &#x2F; <code>release()</code>ï¼š</strong> å®ƒä»¬å¦‚ä½•ä¸ AQS çš„ <code>acquireShared</code> &#x2F; <code>releaseShared</code> äº¤äº’ã€‚</li></ul></li><li><code>CountDownLatch</code> (å€’è®¡æ—¶é—¨é—©)ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> ç†è§£å…¶ <code>count</code> å¦‚ä½•åŸºäº AQS çš„å…±äº«æ¨¡å¼å®ç°è®¡æ•°å’Œç­‰å¾…ã€‚</li><li><strong><code>await()</code> &#x2F; <code>countDown()</code>ï¼š</strong> å®ƒä»¬å¦‚ä½•ä¸ AQS çš„ <code>acquireShared</code> &#x2F; <code>releaseShared</code> äº¤äº’ã€‚</li></ul></li><li><code>CyclicBarrier</code> (å¾ªç¯å±éšœ)ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> å®ƒçš„å®ç°ç›¸å¯¹å¤æ‚ï¼Œç»“åˆäº† ReentrantLock å’Œ Conditionã€‚</li><li><strong>ä¸ <code>CountDownLatch</code> çš„åŒºåˆ«ï¼š</strong> å¯é‡ç”¨æ€§å’Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾ã€‚</li></ul></li><li><code>ReentrantReadWriteLock</code> (è¯»å†™é”)ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> æ ¸å¿ƒæ˜¯ <code>Sync</code> ç±»ï¼Œå¦‚ä½•åˆ©ç”¨ä¸€ä¸ª <code>state</code> å˜é‡åŒæ—¶è¡¨ç¤ºè¯»é”å’Œå†™é”ï¼ˆé«˜ 16 ä½å’Œä½ 16 ä½ï¼‰ã€‚</li><li><strong>è¯»å†™åˆ†ç¦»ï¼š</strong> è¯»é”å…±äº«ï¼Œå†™é”ç‹¬å çš„å®ç°ç»†èŠ‚ã€‚</li><li><strong>é”é™çº§ï¼š</strong> ä»€ä¹ˆæ˜¯é”é™çº§ï¼Œå¦‚ä½•å®ç°ã€‚</li></ul></li></ul></li></ol><p><strong>ç¬¬å››é˜¶æ®µï¼šçº¿ç¨‹æ±  (Executor æ¡†æ¶)</strong></p><ol><li><strong><code>Executor</code> æ¥å£å±‚çº§ï¼š</strong><ul><li><code>Executor</code> -&gt; <code>ExecutorService</code> -&gt; <code>AbstractExecutorService</code> -&gt; <code>ThreadPoolExecutor</code>ã€‚</li><li><strong><code>Callable</code> å’Œ <code>Future</code>ï¼š</strong> å›é¡¾å®ƒä»¬ä¸ <code>ExecutorService</code> çš„å…³ç³»ã€‚</li></ul></li><li><strong><code>ThreadPoolExecutor</code>ï¼š</strong><ul><li><strong>æºç åˆ†æï¼š</strong> JUC ä¸­æœ€å¤æ‚çš„ç±»ä¹‹ä¸€ã€‚</li><li><strong>æ ¸å¿ƒå‚æ•°ï¼š</strong> <code>corePoolSize</code>, <code>maximumPoolSize</code>, <code>keepAliveTime</code>, <code>TimeUnit</code>, <code>workQueue</code>, <code>ThreadFactory</code>, <code>RejectedExecutionHandler</code>ã€‚æ·±å…¥ç†è§£æ¯ä¸ªå‚æ•°çš„ä½œç”¨ã€‚</li><li><strong>çº¿ç¨‹æ± çŠ¶æ€ï¼š</strong> <code>RUNNING</code>, <code>SHUTDOWN</code>, <code>STOP</code>, <code>TIDYING</code>, <code>TERMINATED</code>ã€‚ç†è§£å®ƒä»¬çš„è½¬æ¢ã€‚</li><li>ä»»åŠ¡æäº¤æµç¨‹ (<code>execute()</code> æ–¹æ³•)ï¼š<ul><li>å¦‚ä½•æ ¹æ®æ ¸å¿ƒçº¿ç¨‹æ•°ã€é˜»å¡é˜Ÿåˆ—ã€æœ€å¤§çº¿ç¨‹æ•°æ¥å†³å®šä»»åŠ¡çš„å¤„ç†æ–¹å¼ï¼ˆç›´æ¥æ‰§è¡Œã€å…¥é˜Ÿã€æ–°å»ºçº¿ç¨‹ï¼‰ã€‚</li></ul></li><li>å·¥ä½œçº¿ç¨‹ (<code>Worker</code> ç±»)ï¼š<ul><li>å¦‚ä½•å¤ç”¨çº¿ç¨‹ï¼Œå¦‚ä½•ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚</li><li>çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</li></ul></li><li><strong>æ‹’ç»ç­–ç•¥ (<code>RejectedExecutionHandler</code>)ï¼š</strong> ç†è§£å››ç§é»˜è®¤ç­–ç•¥å’Œè‡ªå®šä¹‰ç­–ç•¥ã€‚</li><li><strong>å¸¸ç”¨çš„å·¥å‚æ–¹æ³• (<code>Executors</code>)ï¼š</strong> ç†è§£ <code>newFixedThreadPool</code>, <code>newSingleThreadExecutor</code>, <code>newCachedThreadPool</code>, <code>newScheduledThreadPool</code> çš„åº•å±‚å®ç°ã€‚</li></ul></li></ol><p><strong>ç¬¬äº”é˜¶æ®µï¼šå¹¶å‘é›†åˆ</strong></p><ol><li><strong><code>ConcurrentHashMap</code>ï¼š</strong><ul><li><strong>æºç åˆ†æï¼š</strong> Java 7 (åˆ†æ®µé”) å’Œ Java 8 (CAS + synchronized + æ•°ç»„ + é“¾è¡¨&#x2F;çº¢é»‘æ ‘) çš„å®ç°å·®å¼‚ã€‚é‡ç‚¹å…³æ³¨ Java 8ã€‚</li><li>Java 8 å®ç°ï¼š<ul><li><strong><code>Node</code> æ•°ç»„ + é“¾è¡¨&#x2F;çº¢é»‘æ ‘ï¼š</strong> æ•°æ®ç»“æ„ã€‚</li><li><strong><code>volatile</code> + CASï¼š</strong> å¦‚ä½•ä¿è¯è¯»å†™å¯è§æ€§å’ŒåŸå­æ€§ã€‚</li><li><strong><code>synchronized</code>ï¼š</strong> å†…éƒ¨ä½•æ—¶ä½¿ç”¨ <code>synchronized</code> (å¦‚ <code>put</code> æ—¶çš„é“¾è¡¨&#x2F;çº¢é»‘æ ‘æ“ä½œï¼Œ<code>resize</code> æ—¶çš„æ‰©å®¹)ã€‚</li><li><strong>æ‰©å®¹æœºåˆ¶ (<code>transfer()</code> &#x2F; <code>helpTransfer()</code>):</strong> å¤šçº¿ç¨‹ä¸‹çš„æ‰©å®¹å¦‚ä½•å®ç°ã€‚</li></ul></li><li><strong>ä¸ <code>Hashtable</code> å’Œ <code>Collections.synchronizedMap</code> çš„å¯¹æ¯”ã€‚</strong></li></ul></li><li><strong><code>ConcurrentLinkedQueue</code> (éé˜»å¡é˜Ÿåˆ—)ï¼š</strong><ul><li><strong>æºç åˆ†æï¼š</strong> é‡ç‚¹ç†è§£å…¶éé˜»å¡çš„å…¥é˜Ÿ (<code>offer()</code>) å’Œå‡ºé˜Ÿ (<code>poll()</code>) æ“ä½œå¦‚ä½•åŸºäº CAS å®ç°ã€‚</li><li><strong><code>head</code> å’Œ <code>tail</code> æŒ‡é’ˆï¼š</strong> å¦‚ä½•ç»´æŠ¤ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> ä¸ºä»€ä¹ˆå®ƒæ¯”åŸºäºé”çš„é˜Ÿåˆ—åœ¨é«˜å¹¶å‘ä¸‹æ€§èƒ½æ›´å¥½ã€‚</li></ul></li><li><strong><code>BlockingQueue</code> æ¥å£ï¼š</strong><ul><li><strong>ç†è§£å…¶é˜»å¡ç‰¹æ€§ï¼š</strong> <code>put()</code> å’Œ <code>take()</code> æ–¹æ³•ã€‚</li><li>å…¸å‹å®ç°ç±»ï¼š<ul><li><strong><code>ArrayBlockingQueue</code>ï¼š</strong> åŸºäºæ•°ç»„ï¼Œæœ‰ç•Œï¼ŒReentrantLock + Condition å®ç°ã€‚</li><li><strong><code>LinkedBlockingQueue</code>ï¼š</strong> åŸºäºé“¾è¡¨ï¼Œå¯é€‰æœ‰ç•Œï¼Œä¸¤ä¸ª ReentrantLock + ä¸¤ä¸ª Condition å®ç°ã€‚</li><li><strong><code>SynchronousQueue</code>ï¼š</strong> ä¸å­˜å‚¨å…ƒç´ çš„é˜Ÿåˆ—ï¼Œç›´æ¥å°†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é…å¯¹ã€‚</li><li><strong><code>PriorityBlockingQueue</code>ï¼š</strong> æ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li><strong><code>DelayQueue</code>ï¼š</strong> å»¶è¿Ÿé˜Ÿåˆ—ã€‚</li></ul></li></ul></li></ol><p><strong>ç¬¬å…­é˜¶æ®µï¼šCompletableFuture (Java 8)</strong></p><ol><li><code>CompletionStage</code> æ¥å£ï¼š<ul><li><strong>ç†è§£å…¶è®¾è®¡æ€æƒ³ï¼š</strong> å¼‚æ­¥è®¡ç®—é˜¶æ®µï¼Œé“¾å¼è°ƒç”¨ï¼Œéé˜»å¡å›è°ƒã€‚</li><li><strong>æ ¸å¿ƒæ–¹æ³•åˆ†ç±»ï¼š</strong> è½¬æ¢ã€ç»„åˆã€å¼‚å¸¸å¤„ç†ç­‰ã€‚</li></ul></li><li><code>CompletableFuture</code>ï¼š<ul><li><strong>æºç åˆ†æï¼š</strong> ç†è§£å®ƒå¦‚ä½•ä½œä¸º <code>Future</code> å’Œ <code>CompletionStage</code> çš„å®ç°ã€‚</li><li><strong>å¼‚æ­¥å·¥å‚æ–¹æ³•ï¼š</strong> <code>supplyAsync()</code>, <code>runAsync()</code>, <code>completedFuture()</code>, <code>failedFuture()</code>ã€‚</li><li><strong>å›è°ƒæ–¹æ³•ï¼š</strong> <code>thenApply()</code>, <code>thenAccept()</code>, <code>thenRun()</code>, <code>whenComplete()</code>ã€‚</li><li><strong>ç»„åˆæ–¹æ³•ï¼š</strong> <code>thenCompose()</code>, <code>thenCombine()</code>, <code>allOf()</code>, <code>anyOf()</code>ã€‚</li><li><strong>å¼‚å¸¸å¤„ç†ï¼š</strong> <code>exceptionally()</code>, <code>handle()</code>ã€‚</li><li><strong>æ‰§è¡Œå™¨ (Executor)ï¼š</strong> ç†è§£å…¶å¼‚æ­¥æ–¹æ³•å¦‚ä½•ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± æˆ–æŒ‡å®šçº¿ç¨‹æ± ã€‚</li><li><strong>å†…éƒ¨ <code>Completion</code> é“¾ï¼š</strong> ç†è§£å…¶å›è°ƒå¦‚ä½•é€šè¿‡å†…éƒ¨ <code>Completion</code> é“¾è¡¨å®ç°ä»»åŠ¡çš„çº§è”æ‰§è¡Œã€‚</li></ul></li></ol><hr><h3 id="å­¦ä¹ å»ºè®®"><a href="#å­¦ä¹ å»ºè®®" class="headerlink" title="å­¦ä¹ å»ºè®®"></a>å­¦ä¹ å»ºè®®</h3><ol><li><strong>ä»å®è§‚åˆ°å¾®è§‚ï¼š</strong><ul><li>é¦–å…ˆç†è§£æ•´ä¸ª JUC æ¨¡å—çš„æ¶æ„å’Œæ¯ä¸ªç»„ä»¶çš„èŒè´£ã€‚</li><li>ç„¶åé€‰æ‹©ä¸€ä¸ªæ¨¡å—ï¼ˆå¦‚ <code>atomic</code> åŒ…ï¼‰æ·±å…¥ï¼Œæ¥ç€æ˜¯ <code>AQS</code>ï¼Œå†åˆ°å…¶å®ç°ç±»ã€‚</li><li>ä¸è¦ä¸€å¼€å§‹å°±é’»å…¥ç»†èŠ‚ï¼Œå¦åˆ™å®¹æ˜“è¿·å¤±ã€‚</li></ul></li><li><strong>å¸¦ç€é—®é¢˜å»é˜…è¯»ï¼š</strong><ul><li>è¿™ä¸ªç±»è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li><li>å®ƒæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</li><li>å®ƒæ˜¯å¦‚ä½•åˆ©ç”¨ CAS æˆ–é”çš„ï¼Ÿ</li><li>å®ƒçš„æ ¸å¿ƒæ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>å®ƒçš„å…³é”®æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li><li>æ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œä»¥åŠå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</li></ul></li><li><strong>è°ƒè¯•æ˜¯æœ€å¥½çš„è€å¸ˆï¼š</strong><ul><li>ä¸è¦åªçœ‹ä»£ç ï¼Œè¦å¤šä½¿ç”¨ IntelliJ IDEA çš„è°ƒè¯•å™¨ã€‚</li><li>è®¾ç½®æ–­ç‚¹ï¼Œå•æ­¥æ‰§è¡Œï¼Œè§‚å¯Ÿå˜é‡ï¼ˆç‰¹åˆ«æ˜¯ <code>state</code> å€¼ã€é˜Ÿåˆ—ç»“æ„ï¼‰çš„å˜åŒ–ï¼Œè¿™å¯¹äºç†è§£ AQS ç­‰å¤æ‚æœºåˆ¶è‡³å…³é‡è¦ã€‚</li></ul></li><li><strong>ç”»å›¾è¾…åŠ©ç†è§£ï¼š</strong><ul><li>å¯¹äºå¤æ‚çš„ç±»ï¼ˆå¦‚ AQSã€ConcurrentHashMapã€ThreadPoolExecutorï¼‰ï¼Œå°è¯•ç»˜åˆ¶å®ƒä»¬çš„å†…éƒ¨æ•°æ®ç»“æ„å›¾ï¼ˆé˜Ÿåˆ—ã€æ•°ç»„ã€Nodeï¼‰å’ŒçŠ¶æ€è½¬æ¢å›¾ã€‚</li><li>UML ç±»å›¾åŠŸèƒ½åœ¨ IntelliJ IDEA Ultimate ä¸­éå¸¸æœ‰ç”¨ã€‚</li></ul></li><li><strong>å¯¹ç…§å®˜æ–¹æ–‡æ¡£å’Œç›¸å…³åšå®¢ï¼š</strong><ul><li>Java Doc æ˜¯æœ€å¥½çš„å‚è€ƒèµ„æ–™ï¼Œå®ƒæè¿°äº†æ¯ä¸ªç±»å’Œæ–¹æ³•çš„è¡Œä¸ºã€‚</li><li>ç½‘ä¸Šæœ‰å¾ˆå¤šä¼˜ç§€çš„ JUC æºç åˆ†ææ–‡ç« å’Œè§†é¢‘ï¼Œå¯ä»¥ä½œä¸ºè¡¥å……ææ–™ï¼Œä½†è¦å¸¦ç€æ‰¹åˆ¤æ€§æ€ç»´å»é˜…è¯»ï¼Œä»¥å®˜æ–¹æºç ä¸ºå‡†ã€‚</li></ul></li><li><strong>é€æ­¥å®è·µï¼š</strong><ul><li>é˜…è¯»å®Œä¸€ä¸ªæ¨¡å—åï¼Œå°è¯•ç¼–å†™ä¸€äº›ç®€å•çš„ç¤ºä¾‹ä»£ç æ¥éªŒè¯ä½ çš„ç†è§£ã€‚</li><li>å°è¯•é‡ç°ä¸€äº›å¹¶å‘é—®é¢˜ï¼Œç„¶åè§‚å¯Ÿ JUC ç»„ä»¶å¦‚ä½•è§£å†³å®ƒä»¬ã€‚</li></ul></li><li><strong>å¾ªåºæ¸è¿›ï¼ŒæŒä¹‹ä»¥æ’ï¼š</strong><ul><li>JUC æºç å†…å®¹åºå¤§ä¸”å¤æ‚ï¼Œä¸è¦æœŸæœ›ä¸€å£åƒæˆèƒ–å­ã€‚</li><li>æ¯å¤©æŠ•å…¥ä¸€å®šçš„æ—¶é—´ï¼ŒåšæŒä¸‹å»ï¼Œä½ ä¼šé€æ¸æŒæ¡å…¶ä¸­çš„å¥¥ç§˜ã€‚</li></ul></li></ol><p>ç¥ä½ å­¦ä¹ é¡ºåˆ©ï¼è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ä»·å€¼çš„æŒ‘æˆ˜ï¼</p><h1 id="CompletableFuture-å¼‚æ­¥ç¼–ç¨‹é¦–é€‰"><a href="#CompletableFuture-å¼‚æ­¥ç¼–ç¨‹é¦–é€‰" class="headerlink" title="CompletableFuture - å¼‚æ­¥ç¼–ç¨‹é¦–é€‰"></a>CompletableFuture - å¼‚æ­¥ç¼–ç¨‹é¦–é€‰</h1><ul><li>æ”¯æŒé“¾å¼è°ƒç”¨</li><li>æ”¯æŒéé˜»å¡å›è°ƒ</li></ul><h1 id="Atomic-åŒ…"><a href="#Atomic-åŒ…" class="headerlink" title="Atomic åŒ…"></a>Atomic åŒ…</h1><p>æä¾›äº†ä¸€ç³»åˆ—åŸå­æ“ä½œçš„ç±»ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹å®ç°æ— é”ï¼ˆLock-freeï¼‰çš„çº¿ç¨‹å®‰å…¨æ“ä½œã€‚</p><h3 id="atomic-åŒ…çš„æ ¸å¿ƒæ€æƒ³ï¼šCAS-Compare-And-Swap"><a href="#atomic-åŒ…çš„æ ¸å¿ƒæ€æƒ³ï¼šCAS-Compare-And-Swap" class="headerlink" title="atomic åŒ…çš„æ ¸å¿ƒæ€æƒ³ï¼šCAS (Compare-And-Swap)"></a><code>atomic</code> åŒ…çš„æ ¸å¿ƒæ€æƒ³ï¼šCAS (Compare-And-Swap)</h3><p><code>atomic</code> åŒ…ä¸­çš„æ‰€æœ‰åŸå­æ“ä½œç±»éƒ½æ˜¯åŸºäº <strong>CASï¼ˆCompare-And-Swapï¼‰</strong> è¿™ç§ç¡¬ä»¶æŒ‡ä»¤å®ç°çš„ã€‚</p><p><strong>CAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼š</strong></p><ol><li><strong>V (Value)</strong>ï¼šè¦æ›´æ–°çš„å˜é‡çš„å†…å­˜ä½ç½®ã€‚</li><li><strong>A (Expected)</strong>ï¼šæœŸæœ›çš„æ—§å€¼ã€‚</li><li><strong>B (New)</strong>ï¼šè¦è®¾ç½®çš„æ–°å€¼ã€‚</li></ol><p><strong>CAS çš„æ“ä½œé€»è¾‘ï¼š</strong> å¦‚æœå†…å­˜ä½ç½® V çš„å€¼ç­‰äºæœŸæœ›çš„æ—§å€¼ Aï¼Œé‚£ä¹ˆå°±å°† V çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ Bã€‚å¦åˆ™ï¼Œä¸åšä»»ä½•æ“ä½œã€‚æ— è®ºæ›´æ–°æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼ŒCAS æ“ä½œéƒ½ä¼šè¿”å› V çš„å½“å‰å€¼ï¼ˆæˆ–è€…å¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦æˆåŠŸï¼‰ã€‚</p><p><strong>CAS çš„ç¼ºç‚¹ (ABA é—®é¢˜)ï¼š</strong> å¦‚æœä¸€ä¸ªå€¼ä» A å˜æˆäº† Bï¼Œç„¶ååˆå˜å›äº† Aã€‚å½“æ‰§è¡Œ CAS æ“ä½œæ—¶ï¼Œå‘ç°å½“å‰å€¼æ˜¯ Aï¼Œå°±ä¼šæˆåŠŸæ›´æ–°ã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªå€¼å·²ç»è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†ã€‚</p><h3 id="ABA-é—®é¢˜è§£å†³æ–¹æ¡ˆï¼š"><a href="#ABA-é—®é¢˜è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="ABA é—®é¢˜è§£å†³æ–¹æ¡ˆï¼š"></a><strong>ABA é—®é¢˜è§£å†³æ–¹æ¡ˆ</strong>ï¼š</h3><ul><li><p>ä½¿ç”¨ <code>AtomicMarkableReference</code>: å¸¦ç‰ˆæœ¬å·çš„åŸå­å¼•ç”¨ã€‚å®ƒä¸ä»…æ¯”è¾ƒå¼•ç”¨æ˜¯å¦ç›¸åŒï¼Œè¿˜ä¼šæ¯”è¾ƒç‰ˆæœ¬å·æ˜¯å¦ç›¸åŒã€‚è¿™å¯ä»¥æœ‰æ•ˆè§£å†³ ABA é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> T reference;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> mark;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Pair</span><span class="params">(T reference, <span class="type">boolean</span> mark)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.reference = reference;</span><br><span class="line">        <span class="built_in">this</span>.mark = mark;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">boolean</span> mark)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>(reference, mark);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ <code>AtomicStampedReference</code>: å¼•å…¥ int ç±»å‹ stamp å˜é‡ï¼Œè®°å½•å€¼çš„æ ‡è®°çŠ¶æ€ï¼Œé€‚åˆæ›´åŠ å¤æ‚çš„åœºæ™¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">final</span> T reference;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> stamp;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Pair</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.reference = reference;</span><br><span class="line">            <span class="built_in">this</span>.stamp = stamp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>(reference, stamp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç´¯åŠ å™¨ï¼ˆAccumulatorsï¼‰å’ŒåŠ æ³•å™¨ï¼ˆAddersï¼‰"><a href="#ç´¯åŠ å™¨ï¼ˆAccumulatorsï¼‰å’ŒåŠ æ³•å™¨ï¼ˆAddersï¼‰" class="headerlink" title="ç´¯åŠ å™¨ï¼ˆAccumulatorsï¼‰å’ŒåŠ æ³•å™¨ï¼ˆAddersï¼‰"></a>ç´¯åŠ å™¨ï¼ˆAccumulatorsï¼‰å’ŒåŠ æ³•å™¨ï¼ˆAddersï¼‰</h3><p>è§£å†³åœ¨å¤§é‡çº¿ç¨‹æ›´æ–°åŒä¸€ä¸ª <code>AtomicLong</code> æˆ– <code>AtomicInteger</code> æ—¶ï¼ŒCAS æ“ä½œå†²çªä¸¥é‡å¯¼è‡´æ€§èƒ½ä¸‹é™çš„é—®é¢˜ï¼ˆçƒ­ç‚¹é—®é¢˜ï¼‰ã€‚</p><ul><li><strong><code>LongAdder</code></strong>: ä¸“ä¸ºé«˜å¹¶å‘çš„ <code>long</code> å‹è®¡æ•°è®¾è®¡ã€‚</li><li><strong><code>DoubleAdder</code></strong>: ä¸“ä¸ºé«˜å¹¶å‘çš„ <code>double</code> å‹è®¡æ•°è®¾è®¡ã€‚</li><li><strong><code>LongAccumulator</code></strong>: æ³›åŒ–çš„ <code>LongAdder</code>ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„çš„äºŒå…ƒæ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯åŠ æ³•ã€‚</li><li><strong><code>DoubleAccumulator</code></strong>: æ³›åŒ–çš„ <code>DoubleAdder</code>ã€‚</li></ul><h1 id="Locks-åŒ…"><a href="#Locks-åŒ…" class="headerlink" title="Locks åŒ…"></a>Locks åŒ…</h1><h3 id="å¯¹æ¯”-Sychronzied-ã€Reentrantlock"><a href="#å¯¹æ¯”-Sychronzied-ã€Reentrantlock" class="headerlink" title="å¯¹æ¯” Sychronzied ã€Reentrantlock"></a>å¯¹æ¯” Sychronzied ã€Reentrantlock</h3><h1 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h1><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><p>AQS è®¾è®¡ä¸­æ¶‰åŠä¸¤ç§é˜Ÿåˆ—ï¼š</p><ol><li>åŒæ­¥é˜Ÿåˆ—ï¼šæ ¸å¿ƒéƒ¨åˆ†ï¼Œç®¡ç†å°è¯•è·å–é”ä½†å¤±è´¥çš„çº¿ç¨‹ã€‚</li><li>æ¡ä»¶é˜Ÿåˆ—ï¼šä¸æ¡ä»¶å˜é‡ç›¸å…³ï¼Œæ”¯æŒ locks. Condition æ¥å£çš„æ“ä½œ -  await å’Œ signal æ–¹æ³•</li></ol><h3 id="åŒæ­¥é˜Ÿåˆ—"><a href="#åŒæ­¥é˜Ÿåˆ—" class="headerlink" title="åŒæ­¥é˜Ÿåˆ—"></a>åŒæ­¥é˜Ÿåˆ—</h3><p>åŒæ­¥é˜Ÿåˆ—ä¸­æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç­‰å¾…é”çš„çº¿ç¨‹ï¼ŒæŒ‰ç…§ FIFO çš„åŸåˆ™æ’åˆ—ç»„ç»‡ã€‚</p><table><thead><tr><th>çŠ¶æ€å€¼</th><th>å¸¸é‡å</th><th>æ•°å€¼</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>ç­‰å¾…å”¤é†’</td><td><code>SIGNAL</code></td><td>-1</td><td>ç‹¬å é”&#x2F;å…±äº«é”çš„åŒæ­¥é˜Ÿåˆ—ï¼Œç¡®ä¿åç»§èŠ‚ç‚¹è¢«å”¤é†’</td></tr><tr><td>å–æ¶ˆç«äº‰</td><td><code>CANCELLED</code></td><td>1</td><td>çº¿ç¨‹å› è¶…æ—¶æˆ–ä¸­æ–­æ”¾å¼ƒé”ç«äº‰</td></tr><tr><td>æ¡ä»¶ç­‰å¾…</td><td><code>CONDITION</code></td><td>-2</td><td>æ¡ä»¶é˜Ÿåˆ—ï¼ˆå¦‚ <code>Condition.await()</code>ï¼‰</td></tr><tr><td>ä¼ æ’­é‡Šæ”¾</td><td><code>PROPAGATE</code></td><td>-3</td><td>å…±äº«æ¨¡å¼ä¸‹ä¼ é€’é‡Šæ”¾ä¿¡å·ï¼ˆå¦‚ <code>Semaphore</code>ï¼‰</td></tr><tr><td>åˆå§‹åŒ–&#x2F;æœªä½¿ç”¨</td><td>é»˜è®¤çŠ¶æ€</td><td>0</td><td>èŠ‚ç‚¹åˆšåŠ å…¥é˜Ÿåˆ—æ—¶çš„åˆå§‹çŠ¶æ€</td></tr></tbody></table><h3 id="æ¡ä»¶é˜Ÿåˆ—"><a href="#æ¡ä»¶é˜Ÿåˆ—" class="headerlink" title="æ¡ä»¶é˜Ÿåˆ—"></a>æ¡ä»¶é˜Ÿåˆ—</h3><p><strong>Await æ–¹æ³•</strong></p><blockquote><p>è°ƒç”¨ Await æ–¹æ³•ä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„é”ï¼Œå¹¶å°†è¯¥çº¿ç¨‹åŠ å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«å”¤é†’</p></blockquote><ol><li><strong>å¿…é¡»å…ˆæŒæœ‰é”</strong>ï¼šè°ƒç”¨ <code>await()</code> å‰ï¼Œçº¿ç¨‹å¿…é¡»å·²ç»æˆåŠŸè·å–äº†é”ï¼ˆå³å¤„äºåŒæ­¥çŠ¶æ€ä¸­ï¼‰ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li><li><strong>é‡Šæ”¾é”</strong>ï¼šåœ¨è¿›å…¥ç­‰å¾…ä¹‹å‰ï¼Œçº¿ç¨‹ä¼š<strong>å®Œå…¨é‡Šæ”¾å®ƒæ‰€æŒæœ‰çš„é”</strong>ï¼ˆæ³¨æ„æ˜¯å…¨éƒ¨çš„é‡å…¥æ¬¡æ•°ï¼‰ã€‚</li><li><strong>æ„é€ èŠ‚ç‚¹å¹¶æ’å…¥æ¡ä»¶é˜Ÿåˆ—</strong>ï¼šçº¿ç¨‹ä¼šè¢«å°è£…æˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼Œæ·»åŠ åˆ°å¯¹åº”çš„ <strong>æ¡ä»¶é˜Ÿåˆ—</strong> ä¸­ã€‚</li><li><strong>é˜»å¡è‡ªå·±</strong>ï¼šçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹é€šè¿‡ <code>signal()</code> æˆ– <code>signalAll()</code> å”¤é†’ã€‚</li><li><strong>é‡æ–°ç«äº‰é”</strong>ï¼šå½“è¢«å”¤é†’åï¼Œçº¿ç¨‹éœ€è¦é‡æ–°å»å°è¯•è·å–é”ï¼ˆæ­¤æ—¶è¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼‰ï¼Œåªæœ‰æˆåŠŸè·å–é”ä¹‹åæ‰èƒ½ä» <code>await()</code> è¿”å›ã€‚</li></ol><p><strong>Signal æ–¹æ³•</strong></p><blockquote><p>è°ƒç”¨ signal æ–¹æ³•ï¼Œå°†ä¸€ä¸ªç­‰å¾…åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸Šçº¿ç¨‹åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè®©å…¶å‡†å¤‡å‚ä¸é”çš„ç«äº‰</p></blockquote><ul><li><code>signal()</code> ä¼šä»æ¡ä»¶é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªç­‰å¾…çš„èŠ‚ç‚¹ï¼ˆé€šå¸¸æ˜¯å¤´èŠ‚ç‚¹ï¼‰ï¼Œå°†å…¶<strong>è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­</strong>ã€‚</li><li>è½¬ç§»å®Œæˆåï¼Œå¦‚æœåŒæ­¥é˜Ÿåˆ—ä¸­å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ä¸º <code>SIGNAL</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆšè½¬ç§»è¿‡æ¥çš„èŠ‚ç‚¹å¯èƒ½ä¼šè¢«å”¤é†’ï¼ˆå…·ä½“ç”± AQS è°ƒåº¦å†³å®šï¼‰ã€‚</li><li>åªæœ‰å½“è¿™ä¸ªçº¿ç¨‹é‡æ–°è·å–åˆ°é”ä¹‹åï¼Œå®ƒæ‰ä¼šä» <code>await()</code> è¿”å›ç»§ç»­æ‰§è¡Œã€‚</li></ul><h1 id="JUC-åŒ…ä¸­æ ¸å¿ƒç»„ä»¶"><a href="#JUC-åŒ…ä¸­æ ¸å¿ƒç»„ä»¶" class="headerlink" title="JUC åŒ…ä¸­æ ¸å¿ƒç»„ä»¶"></a>JUC åŒ…ä¸­æ ¸å¿ƒç»„ä»¶</h1><p>ä»¥ä¸‹æ˜¯ JUC åŒ…ä¸­æ ¸å¿ƒç»„ä»¶çš„ä¸­æ–‡è§£æï¼š</p><hr><h3 id="1-åŸå­ç±»-java-util-concurrent-atomic"><a href="#1-åŸå­ç±»-java-util-concurrent-atomic" class="headerlink" title="1. åŸå­ç±» (java.util.concurrent.atomic)"></a>1. åŸå­ç±» (<code>java.util.concurrent.atomic</code>)</h3><p>è¿™äº›ç±»æä¾›äº†å¯¹å•ä¸ªå˜é‡è¿›è¡Œ<strong>çº¿ç¨‹å®‰å…¨</strong>æ“ä½œçš„èƒ½åŠ›ï¼Œè€Œæ— éœ€ä½¿ç”¨é‡é‡çº§çš„ <code>synchronized</code> å…³é”®å­—ã€‚å®ƒä»¬ä¸»è¦ä¾èµ–äºç¡¬ä»¶çº§åˆ«çš„ <strong>CAS (Compare-And-Swap&#x2F;æ¯”è¾ƒå¹¶äº¤æ¢)</strong> ç®—æ³•æ¥å®ç°é«˜æ€§èƒ½ã€‚</p><ul><li><strong>å¸¸è§ç±»ï¼š</strong> <code>AtomicInteger</code>, <code>AtomicLong</code>, <code>AtomicReference</code>, <code>LongAdder</code> (é«˜å¹¶å‘ä¸‹æ€§èƒ½ä¼˜äº AtomicLong)ã€‚</li></ul><h3 id="2-é”æœºåˆ¶-java-util-concurrent-locks"><a href="#2-é”æœºåˆ¶-java-util-concurrent-locks" class="headerlink" title="2. é”æœºåˆ¶ (java.util.concurrent.locks)"></a>2. é”æœºåˆ¶ (<code>java.util.concurrent.locks</code>)</h3><p>æä¾›äº†æ¯” Java å†…ç½®çš„ <code>synchronized</code> æ›´åŠ çµæ´»çš„é”å’Œç­‰å¾…æœºåˆ¶ã€‚</p><ul><li><strong><code>ReentrantLock</code> (å¯é‡å…¥é”)ï¼š</strong> ä¸€ç§äº’æ–¥é”ï¼ŒåŠŸèƒ½ç±»ä¼¼ <code>synchronized</code>ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ï¼ˆæ”¯æŒå…¬å¹³é”&#x2F;éå…¬å¹³é”ã€å¯ä¸­æ–­ã€å¯è¶…æ—¶ï¼‰ã€‚</li><li><strong><code>ReentrantReadWriteLock</code> (è¯»å†™é”)ï¼š</strong> å…è®¸å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œä½†å†™çº¿ç¨‹ç‹¬å ã€‚é€‚åˆâ€œè¯»å¤šå†™å°‘â€çš„åœºæ™¯ã€‚</li><li><strong><code>Condition</code>ï¼š</strong> é…åˆ Lock ä½¿ç”¨ï¼Œç±»ä¼¼äº <code>Object</code> çš„ <code>wait/notify</code>ï¼Œå¯ä»¥å®ç°æ›´ç²¾ç»†çš„çº¿ç¨‹ç­‰å¾…ä¸å”¤é†’æ§åˆ¶ã€‚</li></ul><h3 id="3-å¹¶å‘å®¹å™¨-Concurrent-Collections"><a href="#3-å¹¶å‘å®¹å™¨-Concurrent-Collections" class="headerlink" title="3. å¹¶å‘å®¹å™¨ (Concurrent Collections)"></a>3. å¹¶å‘å®¹å™¨ (Concurrent Collections)</h3><p>ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒä¼˜åŒ–çš„é›†åˆç±»ï¼Œè§£å†³äº†æ ‡å‡†é›†åˆï¼ˆå¦‚ <code>HashMap</code>, <code>ArrayList</code>ï¼‰çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ï¼Œæ€§èƒ½ä¼˜äºä½¿ç”¨ <code>Collections.synchronizedMap</code>ã€‚</p><ul><li><strong><code>ConcurrentHashMap</code>ï¼š</strong> å¹¶å‘ç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„ Mapã€‚æ—©æœŸç‰ˆæœ¬ä½¿ç”¨åˆ†æ®µé”ï¼ŒJDK 8 ä¹‹åæ”¹ä¸º CAS + <code>synchronized</code>ï¼Œæ€§èƒ½æé«˜ã€‚</li><li><strong><code>CopyOnWriteArrayList</code>ï¼š</strong> å†™å…¥æ—¶å¤åˆ¶ã€‚è¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œæ—¶å¤åˆ¶æ–°æ•°ç»„ã€‚é€‚åˆâ€œè¯»å¤šå†™æå°‘â€çš„åœºæ™¯ã€‚</li><li><strong><code>BlockingQueue</code> (é˜»å¡é˜Ÿåˆ—)ï¼š</strong> çº¿ç¨‹æ± çš„æ ¸å¿ƒç»„ä»¶ã€‚å½“é˜Ÿåˆ—ç©ºæ—¶å–å…ƒç´ ä¼šé˜»å¡ï¼Œæ»¡æ—¶å­˜å…ƒç´ ä¼šé˜»å¡ï¼ˆå¦‚ <code>ArrayBlockingQueue</code>, <code>LinkedBlockingQueue</code>ï¼‰ã€‚</li></ul><h3 id="4-çº¿ç¨‹æ± -æ‰§è¡Œå™¨æ¡†æ¶-java-util-concurrent-Executor"><a href="#4-çº¿ç¨‹æ± -æ‰§è¡Œå™¨æ¡†æ¶-java-util-concurrent-Executor" class="headerlink" title="4. çº¿ç¨‹æ±  &#x2F; æ‰§è¡Œå™¨æ¡†æ¶ (java.util.concurrent.Executor)"></a>4. çº¿ç¨‹æ±  &#x2F; æ‰§è¡Œå™¨æ¡†æ¶ (<code>java.util.concurrent.Executor</code>)</h3><p>å°†ä»»åŠ¡çš„æäº¤ä¸æ‰§è¡Œè§£è€¦ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æå°‘æ‰‹åŠ¨ <code>new Thread()</code>ï¼Œè€Œæ˜¯ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œå¤ç”¨çº¿ç¨‹ä»¥é™ä½å¼€é”€ã€‚</p><ul><li><strong><code>ThreadPoolExecutor</code>ï¼š</strong> çº¿ç¨‹æ± çš„æ ¸å¿ƒå®ç°ç±»ï¼ŒåŒ…å«æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€æ‹’ç»ç­–ç•¥ç­‰å‚æ•°ã€‚</li><li><strong><code>Executors</code>ï¼š</strong> åˆ›å»ºçº¿ç¨‹æ± çš„å·¥å‚ç±»ï¼ˆå¦‚ <code>newFixedThreadPool</code>ï¼‰ï¼Œä½†é€šå¸¸å»ºè®®æ‰‹åŠ¨åˆ›å»º <code>ThreadPoolExecutor</code> ä»¥é¿å… OOM é£é™©ã€‚</li><li><strong><code>Future</code> &amp; <code>Callable</code>ï¼š</strong> ç›¸æ¯” <code>Runnable</code>ï¼Œå®ƒä»¬å…è®¸çº¿ç¨‹æœ‰è¿”å›å€¼å¹¶èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h3 id="5-åŒæ­¥å·¥å…·ç±»-Synchronizers"><a href="#5-åŒæ­¥å·¥å…·ç±»-Synchronizers" class="headerlink" title="5. åŒæ­¥å·¥å…·ç±» (Synchronizers)"></a>5. åŒæ­¥å·¥å…·ç±» (Synchronizers)</h3><p>ç”¨äºåè°ƒå¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ§åˆ¶ã€‚</p><ul><li><strong><code>CountDownLatch</code> (å€’è®¡æ—¶å™¨)ï¼š</strong> è®©ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä¸€ç»„æ“ä½œåå†æ‰§è¡Œï¼ˆä¸€æ¬¡æ€§ä½¿ç”¨ï¼‰ã€‚</li><li><strong><code>CyclicBarrier</code> (å¾ªç¯æ …æ )ï¼š</strong> è®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆåŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœï¼Œå¤§å®¶æ‰ç»§ç»­è¿è¡Œï¼ˆå¯å¾ªç¯ä½¿ç”¨ï¼‰ã€‚</li><li><strong><code>Semaphore</code> (ä¿¡å·é‡)ï¼š</strong> æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œå¸¸ç”¨äºé™æµã€‚</li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud</title>
      <link href="/posts/750d7523.html"/>
      <url>/posts/750d7523.html</url>
      
        <content type="html"><![CDATA[<p>Spring Cloud æ˜¯ä¸€ä¸ªå¹¿æ³›ç”¨äºæ„å»ºå¾®æœåŠ¡æ¶æ„çš„æ¡†æ¶é›†åˆï¼Œæ¶µç›–äº†æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­å™¨ã€API ç½‘å…³ã€æ¶ˆæ¯æ€»çº¿ç­‰å¤šä¸ªæ–¹é¢ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„ <strong>Spring Cloud å­¦ä¹ è·¯çº¿</strong>ï¼Œé€‚åˆåˆå­¦è€…å¾ªåºæ¸è¿›åœ°æŒæ¡å…¶æ ¸å¿ƒå†…å®¹ã€‚</p><hr><h2 id="1-åŸºç¡€å‡†å¤‡"><a href="#1-åŸºç¡€å‡†å¤‡" class="headerlink" title="1. åŸºç¡€å‡†å¤‡"></a><strong>1. åŸºç¡€å‡†å¤‡</strong></h2><p>åœ¨å­¦ä¹  Spring Cloud ä¹‹å‰ï¼Œéœ€è¦æ‰“å¥½ä»¥ä¸‹åŸºç¡€ï¼š</p><ul><li><strong>Java åŸºç¡€</strong>ï¼šç†Ÿæ‚‰ Java ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬é¢å‘å¯¹è±¡ç¼–ç¨‹ã€é›†åˆæ¡†æ¶ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚</li><li><strong>Spring Boot</strong>ï¼šSpring Cloud åŸºäº Spring Boot æ„å»ºï¼Œéœ€æŒæ¡ Spring Boot çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¦‚è‡ªåŠ¨é…ç½®ã€ä¾èµ–æ³¨å…¥ã€RESTful API å¼€å‘ã€Spring Data JPA ç­‰ã€‚</li><li><strong>å¾®æœåŠ¡æ¶æ„</strong>ï¼šäº†è§£å¾®æœåŠ¡çš„åŸºæœ¬æ¦‚å¿µã€ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠä¸ä¼ ç»Ÿå•ä½“åº”ç”¨çš„åŒºåˆ«ã€‚</li><li><strong>HTTP å’Œ REST</strong>ï¼šæŒæ¡ HTTP åè®®å’Œ RESTful æœåŠ¡è®¾è®¡åŸåˆ™ã€‚</li><li><strong>Maven æˆ– Gradle</strong>ï¼šç†Ÿæ‚‰é¡¹ç›®æ„å»ºå·¥å…·ï¼Œå­¦ä¼šç®¡ç†ä¾èµ–å’Œæ„å»ºé¡¹ç›®ã€‚</li></ul><hr><h2 id="2-Spring-Cloud-æ ¸å¿ƒç»„ä»¶å­¦ä¹ "><a href="#2-Spring-Cloud-æ ¸å¿ƒç»„ä»¶å­¦ä¹ " class="headerlink" title="2. Spring Cloud æ ¸å¿ƒç»„ä»¶å­¦ä¹ "></a><strong>2. Spring Cloud æ ¸å¿ƒç»„ä»¶å­¦ä¹ </strong></h2><p>Spring Cloud ç”±å¤šä¸ªå­é¡¹ç›®ç»„æˆï¼Œæ¯ä¸ªå­é¡¹ç›®è§£å†³å¾®æœåŠ¡æ¶æ„ä¸­çš„ç‰¹å®šé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒç»„ä»¶åŠå…¶æ¨èçš„å­¦ä¹ é¡ºåºï¼š</p><h3 id="2-1-æœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#2-1-æœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="2.1 æœåŠ¡æ³¨å†Œä¸å‘ç°"></a><strong>2.1 æœåŠ¡æ³¨å†Œä¸å‘ç°</strong></h3><ul><li><strong>æ¨èç»„ä»¶</strong>ï¼šEurekaï¼ˆNetflix OSSï¼‰æˆ– Spring Cloud Alibaba Nacos  </li><li><strong>å­¦ä¹ å†…å®¹</strong>ï¼š<ul><li>ç†è§£æœåŠ¡æ³¨å†Œä¸å‘ç°çš„ä½œç”¨ã€‚</li><li>æ­å»º Eureka Server å’Œ Eureka Clientã€‚</li><li>æŒæ¡æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€å¥åº·æ£€æŸ¥ç­‰æ“ä½œã€‚</li><li>æ¢ç´¢é«˜å¯ç”¨é…ç½®ã€‚</li></ul></li><li><strong>å®è·µ</strong>ï¼šæ­å»ºä¸€ä¸ª Eureka Server å’Œå¤šä¸ª Clientï¼Œè§‚å¯ŸæœåŠ¡æ³¨å†Œè¿‡ç¨‹ã€‚</li></ul><h3 id="2-2-å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"><a href="#2-2-å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡" class="headerlink" title="2.2 å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"></a><strong>2.2 å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</strong></h3><ul><li><strong>æ¨èç»„ä»¶</strong>ï¼šRibbonï¼ˆNetflix OSSï¼‰æˆ– Spring Cloud LoadBalancer  </li><li><strong>å­¦ä¹ å†…å®¹</strong>ï¼š<ul><li>ç†è§£å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„åŸç†ã€‚</li><li>é›†æˆ Ribbon ä¸ Eurekaï¼Œå®ç°æœåŠ¡è°ƒç”¨æ—¶çš„è´Ÿè½½å‡è¡¡ã€‚</li><li>å­¦ä¹ è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºï¼‰ã€‚</li></ul></li><li><strong>å®è·µ</strong>ï¼šåœ¨æœåŠ¡æ¶ˆè´¹è€…ä¸­ç”¨ Ribbon å®ç°å¯¹æä¾›è€…çš„è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚</li></ul><h3 id="2-3-å£°æ˜å¼æœåŠ¡è°ƒç”¨"><a href="#2-3-å£°æ˜å¼æœåŠ¡è°ƒç”¨" class="headerlink" title="2.3 å£°æ˜å¼æœåŠ¡è°ƒç”¨"></a><strong>2.3 å£°æ˜å¼æœåŠ¡è°ƒç”¨</strong></h3><ul><li><strong>æ¨èç»„ä»¶</strong>ï¼šOpenFeign  </li><li><strong>å­¦ä¹ å†…å®¹</strong>ï¼š<ul><li>äº†è§£ OpenFeign çš„ä½œç”¨å’Œä¼˜åŠ¿ã€‚</li><li>ä½¿ç”¨ OpenFeign ç®€åŒ–æœåŠ¡é—´çš„ HTTP è°ƒç”¨ã€‚</li><li>å­¦ä¹ é…ç½®ã€æ‹¦æˆªå™¨å’Œé”™è¯¯å¤„ç†ã€‚</li></ul></li><li><strong>å®è·µ</strong>ï¼šç”¨ OpenFeign æ›¿æ¢ RestTemplate å®ç°æœåŠ¡è°ƒç”¨ã€‚</li></ul><h3 id="2-4-API-ç½‘å…³"><a href="#2-4-API-ç½‘å…³" class="headerlink" title="2.4 API ç½‘å…³"></a><strong>2.4 API ç½‘å…³</strong></h3><ul><li><strong>æ¨èç»„ä»¶</strong>ï¼šSpring Cloud Gateway æˆ– Zuulï¼ˆNetflix OSSï¼‰  </li><li><strong>å­¦ä¹ å†…å®¹</strong>ï¼š<ul><li>ç†è§£ API ç½‘å…³çš„ä½œç”¨ï¼ˆå¦‚è·¯ç”±ã€è¿‡æ»¤ï¼‰ã€‚</li><li>æ­å»º Spring Cloud Gatewayï¼Œé…ç½®è·¯ç”±è§„åˆ™ã€‚</li><li>å­¦ä¹ è‡ªå®šä¹‰è¿‡æ»¤å™¨å’Œé™æµåŠŸèƒ½ã€‚</li></ul></li><li><strong>å®è·µ</strong>ï¼šåˆ›å»ºä¸€ä¸ª API ç½‘å…³ï¼Œè·¯ç”±å¤šä¸ªå¾®æœåŠ¡è¯·æ±‚ã€‚</li></ul><h3 id="2-5-é…ç½®ç®¡ç†"><a href="#2-5-é…ç½®ç®¡ç†" class="headerlink" title="2.5 é…ç½®ç®¡ç†"></a><strong>2.5 é…ç½®ç®¡ç†</strong></h3><ul><li><strong>æ¨èç»„ä»¶</strong>ï¼šSpring Cloud Config æˆ– Spring Cloud Alibaba Nacos Config  </li><li><strong>å­¦ä¹ å†…å®¹</strong>ï¼š<ul><li>ç†è§£é›†ä¸­å¼é…ç½®ç®¡ç†çš„æ„ä¹‰ã€‚</li><li>æ­å»º Config Server å’Œ Clientã€‚</li><li>å­¦ä¹ åŠ¨æ€åˆ·æ–°å’Œç‰ˆæœ¬ç®¡ç†ã€‚</li></ul></li><li><strong>å®è·µ</strong>ï¼šé›†ä¸­ç®¡ç†å¾®æœåŠ¡é…ç½®å¹¶å®ç°åŠ¨æ€æ›´æ–°ã€‚</li></ul><h3 id="2-6-ç†”æ–­ä¸é™çº§"><a href="#2-6-ç†”æ–­ä¸é™çº§" class="headerlink" title="2.6 ç†”æ–­ä¸é™çº§"></a><strong>2.6 ç†”æ–­ä¸é™çº§</strong></h3><ul><li><strong>æ¨èç»„ä»¶</strong>ï¼šHystrixï¼ˆNetflix OSSï¼‰æˆ– Resilience 4 j  </li><li><strong>å­¦ä¹ å†…å®¹</strong>ï¼š<ul><li>ç†è§£ç†”æ–­å™¨æ¨¡å¼çš„ä½œç”¨ã€‚</li><li>é›†æˆ Hystrix æˆ– Resilience 4 jï¼Œå®ç°é™çº§å’Œç†”æ–­ã€‚</li><li>å­¦ä¹  Hystrix Dashboard ç›‘æ§ã€‚</li></ul></li><li><strong>å®è·µ</strong>ï¼šåœ¨æœåŠ¡è°ƒç”¨ä¸­æ·»åŠ ç†”æ–­é€»è¾‘ï¼Œæ¨¡æ‹Ÿæ•…éšœåœºæ™¯ã€‚</li></ul><h3 id="2-7-åˆ†å¸ƒå¼è¿½è¸ª"><a href="#2-7-åˆ†å¸ƒå¼è¿½è¸ª" class="headerlink" title="2.7 åˆ†å¸ƒå¼è¿½è¸ª"></a><strong>2.7 åˆ†å¸ƒå¼è¿½è¸ª</strong></h3><ul><li><strong>æ¨èç»„ä»¶</strong>ï¼šSpring Cloud Sleuth + Zipkin  </li><li><strong>å­¦ä¹ å†…å®¹</strong>ï¼š<ul><li>ç†è§£åˆ†å¸ƒå¼è¿½è¸ªçš„æ„ä¹‰ã€‚</li><li>é›†æˆ Sleuth ç”Ÿæˆè¿½è¸ª IDã€‚</li><li>æ­å»º Zipkin Server æŸ¥çœ‹è°ƒç”¨é“¾ã€‚</li></ul></li><li><strong>å®è·µ</strong>ï¼šåœ¨å¾®æœåŠ¡ä¸­é›†æˆ Sleuth å’Œ Zipkinï¼Œè§‚å¯Ÿè°ƒç”¨é“¾è·¯ã€‚</li></ul><h3 id="2-8-æ¶ˆæ¯é©±åŠ¨"><a href="#2-8-æ¶ˆæ¯é©±åŠ¨" class="headerlink" title="2.8 æ¶ˆæ¯é©±åŠ¨"></a><strong>2.8 æ¶ˆæ¯é©±åŠ¨</strong></h3><ul><li><strong>æ¨èç»„ä»¶</strong>ï¼šSpring Cloud Stream æˆ– Spring Cloud Bus  </li><li><strong>å­¦ä¹ å†…å®¹</strong>ï¼š<ul><li>äº†è§£æ¶ˆæ¯é©±åŠ¨çš„å¥½å¤„ã€‚</li><li>ä½¿ç”¨ Spring Cloud Stream é›†æˆ RabbitMQ æˆ– Kafkaã€‚</li><li>å­¦ä¹  Spring Cloud Bus å®ç°é…ç½®å¹¿æ’­ã€‚</li></ul></li><li><strong>å®è·µ</strong>ï¼šç”¨ Spring Cloud Stream å®ç°å¼‚æ­¥é€šä¿¡ã€‚</li></ul><hr><h2 id="3-è¿›é˜¶ä¸»é¢˜"><a href="#3-è¿›é˜¶ä¸»é¢˜" class="headerlink" title="3. è¿›é˜¶ä¸»é¢˜"></a><strong>3. è¿›é˜¶ä¸»é¢˜</strong></h2><p>æŒæ¡æ ¸å¿ƒç»„ä»¶åï¼Œå¯ä»¥æ·±å…¥ä»¥ä¸‹ä¸»é¢˜ï¼š</p><ul><li><strong>æœåŠ¡å®‰å…¨</strong>ï¼šé›†æˆ Spring Security å’Œ OAuth 2 å®ç°è®¤è¯æˆæƒã€‚</li><li><strong>å®¹å™¨åŒ–ä¸éƒ¨ç½²</strong>ï¼šå­¦ä¹  Docker å’Œ Kubernetesï¼Œéƒ¨ç½²å¾®æœåŠ¡ã€‚</li><li><strong>Spring Cloud Alibaba</strong>ï¼šæ¢ç´¢ Nacosã€Sentinel ç­‰ç»„ä»¶ã€‚</li><li><strong>å¾®æœåŠ¡ç›‘æ§</strong>ï¼šä½¿ç”¨ Prometheus å’Œ Grafana ç›‘æ§æœåŠ¡ã€‚</li></ul><hr><h2 id="4-å®è·µé¡¹ç›®"><a href="#4-å®è·µé¡¹ç›®" class="headerlink" title="4. å®è·µé¡¹ç›®"></a><strong>4. å®è·µé¡¹ç›®</strong></h2><p>ç†è®ºç»“åˆå®è·µæ˜¯å…³é”®ï¼Œå»ºè®®ï¼š</p><ul><li><strong>æ­å»ºå®Œæ•´é¡¹ç›®</strong>ï¼šåŒ…å«ç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ç­‰ï¼Œé›†æˆæ ¸å¿ƒç»„ä»¶ã€‚</li><li><strong>æ¨¡æ‹Ÿæ•…éšœ</strong>ï¼šå¼•å…¥æ•…éšœï¼Œæµ‹è¯•ç†”æ–­ã€è¿½è¸ªç­‰æœºåˆ¶ã€‚</li><li><strong>äº‘éƒ¨ç½²</strong>ï¼šéƒ¨ç½²åˆ° AWS æˆ–é˜¿é‡Œäº‘ï¼Œä½“éªŒäº‘åŸç”Ÿåº”ç”¨ã€‚</li></ul><hr><h2 id="5-å­¦ä¹ èµ„æºæ¨è"><a href="#5-å­¦ä¹ èµ„æºæ¨è" class="headerlink" title="5. å­¦ä¹ èµ„æºæ¨è"></a><strong>5. å­¦ä¹ èµ„æºæ¨è</strong></h2><ul><li><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼šSpring Cloud å®˜æ–¹æ–‡æ¡£ã€‚</li><li><strong>ä¹¦ç±</strong>ï¼šã€ŠSpring Cloud å¾®æœåŠ¡å®æˆ˜ã€‹ã€‚</li><li><strong>åœ¨çº¿è¯¾ç¨‹</strong>ï¼šUdemyã€Coursera çš„ Spring Cloud è¯¾ç¨‹ã€‚</li><li><strong>ç¤¾åŒº</strong>ï¼šSpring å®˜æ–¹åšå®¢ã€Stack Overflowã€‚</li></ul><hr><h2 id="6-å­¦ä¹ å»ºè®®"><a href="#6-å­¦ä¹ å»ºè®®" class="headerlink" title="6. å­¦ä¹ å»ºè®®"></a><strong>6. å­¦ä¹ å»ºè®®</strong></h2><ul><li><strong>å¾ªåºæ¸è¿›</strong>ï¼šä» Spring Boot å¼€å§‹ï¼Œé€æ­¥å­¦ä¹ å„ç»„ä»¶ã€‚</li><li><strong>å¤šå®è·µ</strong>ï¼šé€šè¿‡ä»£ç åŠ æ·±ç†è§£ã€‚</li><li><strong>å…³æ³¨ç‰ˆæœ¬</strong>ï¼šç¡®ä¿ Spring Cloud å’Œ Spring Boot ç‰ˆæœ¬å…¼å®¹ã€‚</li></ul><p>é€šè¿‡è¿™æ¡è·¯çº¿ï¼Œä½ å¯ä»¥ç³»ç»ŸæŒæ¡ Spring Cloudï¼Œæ„å»ºå¥å£®çš„å¾®æœåŠ¡æ¶æ„ï¼</p><h2 id="Spring-Cloud-çŸ¥è¯†ç‚¹"><a href="#Spring-Cloud-çŸ¥è¯†ç‚¹" class="headerlink" title="Spring Cloud çŸ¥è¯†ç‚¹:"></a>Spring Cloud çŸ¥è¯†ç‚¹:</h2><ol><li><p><strong>æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼š</strong></p><ul><li><strong>Eurekaï¼š</strong> Spring Cloud Eureka æ˜¯ä¸€ä¸ªç”¨äºæœåŠ¡æ³¨å†Œå’Œå‘ç°çš„æœåŠ¡å™¨ï¼Œå®ç°äº† Netflix çš„ Eurekaã€‚</li><li><strong>Consulï¼š</strong> Consul æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†å·¥å…·ï¼ŒSpring Cloud å¯ä»¥é€šè¿‡ Consul æ¥å®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚</li></ul></li><li><p><strong>è´Ÿè½½å‡è¡¡ï¼š</strong></p><ul><li><strong>Ribbonï¼š</strong> Spring Cloud Ribbon æ˜¯ä¸€ä¸ªåŸºäº HTTP å’Œ TCP å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ã€‚</li><li><strong>LoadBalancerï¼š</strong> Spring Cloud æä¾›äº†@LoadBalanced æ³¨è§£ï¼Œç”¨äºé›†æˆè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</li></ul></li><li><p><strong>é…ç½®ç®¡ç†ï¼š</strong></p><ul><li><strong>Configï¼š</strong> Spring Cloud Config ç”¨äºé›†ä¸­ç®¡ç†åº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œæ”¯æŒä» Git ç­‰å¤–éƒ¨æºåŠ è½½é…ç½®ã€‚</li><li><strong>Busï¼š</strong> Spring Cloud Bus ç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¼ æ’­äº‹ä»¶ï¼Œé€šå¸¸ç”¨äºå®æ—¶åˆ·æ–°é…ç½®ã€‚</li></ul></li><li><p><strong>ç†”æ–­å™¨ï¼š</strong></p><ul><li><strong>Hystrixï¼š</strong> Spring Cloud Hystrix æ˜¯ä¸€ç§ç”¨äºå¤„ç†å»¶è¿Ÿå’Œå®¹é”™çš„åº“ï¼Œå®ƒæä¾›äº†æ–­è·¯å™¨æ¨¡å¼çš„å®ç°ã€‚</li></ul></li><li><p><strong>æœåŠ¡ç½‘å…³ï¼š</strong></p><ul><li><strong>Zuulï¼š</strong> Spring Cloud Zuul æ˜¯ä¸€ä¸ª API ç½‘å…³ï¼Œå¯ä»¥ç”¨äºè·¯ç”±ã€è¿‡æ»¤ã€åŠ è½½å‡è¡¡ç­‰ã€‚</li></ul></li><li><p><strong>åˆ†å¸ƒå¼æ¶ˆæ¯æ€»çº¿ï¼š</strong></p><ul><li><strong>Spring Cloud Streamï¼š</strong> ç”¨äºæ„å»ºæ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡ï¼Œæä¾›äº†å¯¹å¤šç§æ¶ˆæ¯ä¸­é—´ä»¶çš„æ”¯æŒã€‚</li></ul></li><li><p><strong>åˆ†å¸ƒå¼è¿½è¸ªï¼š</strong></p><ul><li><strong>Zipkinï¼š</strong> ç”¨äºåˆ†å¸ƒå¼è¿½è¸ªçš„ç³»ç»Ÿï¼Œå¯ä»¥ç”¨äºè§£å†³å¾®æœåŠ¡æ¶æ„ä¸­çš„æ€§èƒ½é—®é¢˜ã€‚</li></ul></li><li><p><strong>æœåŠ¡è°ƒç”¨ï¼š</strong></p><ul><li><strong>Feignï¼š</strong> Spring Cloud Feign æ˜¯ä¸€ç§å£°æ˜å¼çš„ Web æœåŠ¡å®¢æˆ·ç«¯ï¼Œç®€åŒ–äº†æœåŠ¡è°ƒç”¨ã€‚</li></ul></li></ol><h2 id="Spring-Cloud-é¢è¯•é¢˜"><a href="#Spring-Cloud-é¢è¯•é¢˜" class="headerlink" title="Spring Cloud é¢è¯•é¢˜:"></a>Spring Cloud é¢è¯•é¢˜:</h2><ol><li><p><strong>ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ï¼ŒSpring Cloud æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶ç”¨äºæ”¯æŒå¾®æœåŠ¡ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§å°†åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºä¸€ç»„å°å‹ã€ç‹¬ç«‹çš„æœåŠ¡çš„è®¾è®¡é£æ ¼ã€‚Spring Cloud çš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ Eurekaã€Ribbonã€Configã€Hystrixã€Zuul ç­‰ã€‚</li></ul></li><li><p><strong>ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ŒSpring Cloud ä¸­çš„ Eureka æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> æœåŠ¡æ³¨å†Œä¸å‘ç°æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸æœåŠ¡åœ¨è¿è¡Œæ—¶æ³¨å†Œè‡ªå·±ï¼Œå¹¶å…è®¸å…¶ä»–æœåŠ¡æŸ¥æ‰¾å’Œå‘ç°å¯ç”¨çš„æœåŠ¡ã€‚Eureka é€šè¿‡æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ–¹å¼å·¥ä½œï¼ŒæœåŠ¡æ³¨å†Œåˆ° Eureka æœåŠ¡å™¨ï¼Œå…¶ä»–æœåŠ¡é€šè¿‡ Eureka å®¢æˆ·ç«¯æŸ¥è¯¢å¯ç”¨çš„æœåŠ¡ã€‚</li></ul></li><li><p><strong>å¦‚ä½•å®ç°æœåŠ¡ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> å¯ä»¥ä½¿ç”¨ Spring Cloud Ribbon å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Spring Cloud çš„@LoadBalanced æ³¨è§£ä½¿ RestTemplate å…·å¤‡è´Ÿè½½å‡è¡¡èƒ½åŠ›ã€‚</li></ul></li><li><p><strong>Spring Cloud Config çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•å®ç°åŠ¨æ€åˆ·æ–°é…ç½®ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> Spring Cloud Config ç”¨äºé›†ä¸­ç®¡ç†åº”ç”¨ç¨‹åºçš„é…ç½®ã€‚åŠ¨æ€åˆ·æ–°é…ç½®å¯ä»¥é€šè¿‡ Spring Cloud Bus é…åˆæ¶ˆæ¯ä¸­é—´ä»¶å®ç°ï¼Œå½“é…ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡æ¶ˆæ¯æ€»çº¿é€šçŸ¥å„ä¸ªå¾®æœåŠ¡ã€‚</li></ul></li><li><p><strong>ä»€ä¹ˆæ˜¯ç†”æ–­å™¨æ¨¡å¼ï¼ŸSpring Cloud ä¸­çš„ Hystrix æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> ç†”æ–­å™¨æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºå¤„ç†å»¶è¿Ÿå’Œå®¹é”™çš„è®¾è®¡æ¨¡å¼ã€‚Hystrix é€šè¿‡åœ¨æœåŠ¡è°ƒç”¨é“¾ä¸­å¼•å…¥ç†”æ–­å™¨ï¼Œå½“æœåŠ¡å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥è¿…é€Ÿåœ°è¿”å›ä¸€ä¸ªé™çº§çš„å“åº”ï¼Œé¿å…çº§è”æ•…éšœã€‚</li></ul></li><li><p><strong>Spring Cloud Zuul æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> Spring Cloud Zuul æ˜¯ä¸€ä¸ª API ç½‘å…³ï¼Œå¯ä»¥ç”¨äºè·¯ç”±ã€è¿‡æ»¤ã€åŠ è½½å‡è¡¡ç­‰ã€‚å®ƒå……å½“äº†æ‰€æœ‰å¾®æœåŠ¡çš„å…¥å£ï¼Œæä¾›äº†é›†ä¸­çš„è·¯ç”±ã€è®¤è¯ã€ç›‘æ§ç­‰åŠŸèƒ½ã€‚</li></ul></li><li><p><strong>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼è¿½è¸ªï¼ŒSpring Cloud ä¸­çš„ Zipkin æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> åˆ†å¸ƒå¼è¿½è¸ªç”¨äºè·Ÿè¸ªå¾®æœåŠ¡æ¶æ„ä¸­çš„è¯·æ±‚æµï¼Œä»¥ä¾¿åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®šä½å’Œè§£å†³æ€§èƒ½é—®é¢˜ã€‚Zipkin æ˜¯ä¸€ä¸ªç”¨äºåˆ†å¸ƒå¼è¿½è¸ªçš„ç³»ç»Ÿï¼Œå¯ä»¥ç”¨äºæŸ¥çœ‹è¯·æ±‚åœ¨å¾®æœåŠ¡ä¹‹é—´çš„ä¼ é€’è·¯å¾„å’Œå»¶è¿Ÿã€‚</li></ul></li><li><p><strong>Spring Cloud Feign æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> Spring Cloud Feign æ˜¯ä¸€ç§å£°æ˜å¼çš„ Web æœåŠ¡å®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–æœåŠ¡è°ƒç”¨ã€‚é€šè¿‡ä½¿ç”¨ Feignï¼Œå¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œé¿å…äº†æ‰‹åŠ¨å¤„ç† HTTP è¯·æ±‚çš„ç¹çå·¥ä½œã€‚</li></ul></li></ol><p>è¿™äº›é—®é¢˜æ¶µç›–äº† Spring Cloud çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨ç»„ä»¶ï¼Œå¸®åŠ©äº†è§£å¾®æœåŠ¡æ¶æ„ä»¥åŠå¦‚ä½•ä½¿ç”¨ Spring Cloud æ„å»ºå’Œç®¡ç†å¾®æœåŠ¡ã€‚åœ¨é¢è¯•ä¸­ï¼Œæ·±å…¥ç†è§£è¿™äº›çŸ¥è¯†ç‚¹å¹¶èƒ½å¤Ÿç»“åˆå®é™…ç»éªŒè¿›è¡Œè®¨è®ºæ˜¯éå¸¸é‡è¦çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring MVC</title>
      <link href="/posts/2d0b435f.html"/>
      <url>/posts/2d0b435f.html</url>
      
        <content type="html"><![CDATA[<h1 id="SpringMVC-å·¥ä½œåŸç†"><a href="#SpringMVC-å·¥ä½œåŸç†" class="headerlink" title="SpringMVC å·¥ä½œåŸç†"></a>SpringMVC å·¥ä½œåŸç†</h1><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Spring MVC æ¡†æ¶ä½œä¸º Java Web åº”ç”¨ç¨‹åºå¼€å‘ä¸­å¹¿æ³›é‡‡ç”¨çš„æ¡†æ¶ï¼Œä»¥å…¶åˆ†å±‚å’Œæ¾è€¦åˆçš„æ¶æ„è€Œé—»åã€‚è¿™ç§æ¶æ„æ¸…æ™°åœ°åˆ†ç¦»äº†è¡¨ç¤ºå±‚ã€æŒä¹…å±‚å’Œæ§åˆ¶å±‚ï¼Œä½¿å¾—å¼€å‘äººå‘˜èƒ½å¤Ÿç‹¬ç«‹åœ°å¤„ç†å„ä¸ªæ¨¡å—ï¼Œå¹¶å°†å…¶ç»„åˆæˆä¸“ä¸šçš„ Web åº”ç”¨ç¨‹åºã€‚éµå¾ª MVC æ ‡å‡†å¼€å‘çš„ Web åº”ç”¨ç¨‹åºæ›´æ˜“äºæ‰©å±•ã€æ›´æ–°å’Œç®¡ç†ï¼Œå› ä¸ºæ¾è€¦åˆçš„åˆ†å±‚ç»“æ„ä½¿å¾—åœ¨ç‰¹å®šå±‚è¿›è¡Œä¿®æ”¹å˜å¾—æ›´åŠ ä¾¿æ· 1ã€‚æœ¬æŠ¥å‘Šæ—¨åœ¨æ·±å…¥æ¢è®¨ Spring MVC æ¡†æ¶å†… HTTP è¯·æ±‚çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œä»å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åˆ°æœ€ç»ˆå“åº”è¿”å›ï¼Œè¯¦ç»†é˜è¿°å…¶å†…éƒ¨çš„å·¥ä½œåŸç†ã€‚</p><h2 id="ç†è§£æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¨¡å¼"><a href="#ç†è§£æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¨¡å¼" class="headerlink" title="ç†è§£æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¨¡å¼"></a>ç†è§£æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¨¡å¼</h2><p>æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨äºè½¯ä»¶å·¥ç¨‹ä¸­çš„æ¶æ„æ¨¡å¼ï¼Œæ—¨åœ¨åˆ†ç¦»åº”ç”¨ç¨‹åºçš„ä¸åŒå…³æ³¨ç‚¹ï¼Œä»è€Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ 3ã€‚åœ¨ MVC æ¨¡å¼ä¸­ï¼Œåº”ç”¨ç¨‹åºè¢«åˆ’åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p><ul><li><strong>æ¨¡å‹ï¼ˆModelï¼‰ï¼š</strong> æ¨¡å‹è´Ÿè´£å°è£…åº”ç”¨ç¨‹åºçš„æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ 2ã€‚å®ƒæ˜¯åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒï¼Œç®¡ç†ç€æ•°æ®çš„å­˜å‚¨ã€æ£€ç´¢å’Œå¤„ç† 4ã€‚æ¨¡å‹ç‹¬ç«‹äºç”¨æˆ·ç•Œé¢ï¼Œå½“æ¨¡å‹ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä¼šé€šçŸ¥è§†å›¾è¿›è¡Œæ›´æ–° 4ã€‚</li><li><strong>è§†å›¾ï¼ˆViewï¼‰ï¼š</strong> è§†å›¾è´Ÿè´£å‘ˆç°æ¨¡å‹ä¸­çš„æ•°æ®ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºç”¨æˆ·å¯ä»¥ç†è§£çš„æ ¼å¼ï¼Œä¾‹å¦‚ HTMLã€JSON ç­‰ 2ã€‚è§†å›¾æ˜¯è¢«åŠ¨ç»„ä»¶ï¼Œå®ƒä»æ¨¡å‹ä¸­è·å–æ•°æ®å¹¶è¿›è¡Œæ˜¾ç¤ºï¼Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ 4ã€‚</li><li><strong>æ§åˆ¶å™¨ï¼ˆControllerï¼‰ï¼š</strong> æ§åˆ¶å™¨å……å½“æ¨¡å‹å’Œè§†å›¾ä¹‹é—´çš„ä¸­ä»‹ 2ã€‚å®ƒæ¥æ”¶ç”¨æˆ·çš„è¾“å…¥ï¼ˆé€šå¸¸æ¥è‡ªæµè§ˆå™¨ï¼‰ï¼Œå¹¶æ ¹æ®è¾“å…¥è°ƒç”¨æ¨¡å‹æ¥æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ 4ã€‚å¤„ç†å®Œæˆåï¼Œæ§åˆ¶å™¨ä¼šé€‰æ‹©åˆé€‚çš„è§†å›¾æ¥æ˜¾ç¤ºæ¨¡å‹ä¸­çš„æ•°æ® 4ã€‚</li></ul><p>Spring MVC æ¡†æ¶æ­£æ˜¯åŸºäº MVC è®¾è®¡æ¨¡å¼æ„å»ºçš„ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶â€”â€”DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰æ¥ç®¡ç†æ•´ä¸ªè¯·æ±‚å¤„ç†æµç¨‹ 2ã€‚DispatcherServlet æ¥æ”¶æ‰€æœ‰ä¼ å…¥çš„ HTTP è¯·æ±‚ï¼Œå¹¶å°†å…¶åˆ†å‘ç»™é€‚å½“çš„å¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œä»è€Œå®ç°äº† MVC æ¨¡å¼åœ¨ Web åº”ç”¨ç¨‹åºä¸­çš„åº”ç”¨ 2ã€‚</p><h2 id="æ ¸å¿ƒè°ƒåº¦å™¨-DispatcherServlet"><a href="#æ ¸å¿ƒè°ƒåº¦å™¨-DispatcherServlet" class="headerlink" title="æ ¸å¿ƒè°ƒåº¦å™¨ DispatcherServlet"></a>æ ¸å¿ƒè°ƒåº¦å™¨ DispatcherServlet</h2><p>DispatcherServlet åœ¨ Spring MVC æ¡†æ¶ä¸­æ‰®æ¼”ç€å‰ç«¯æ§åˆ¶å™¨çš„å…³é”®è§’è‰²ï¼Œå®ƒè´Ÿè´£æ‹¦æˆªæ‰€æœ‰è¿›å…¥åº”ç”¨ç¨‹åºçš„ HTTP è¯·æ±‚ 1ã€‚ä½œä¸ºåº”ç”¨ç¨‹åºçš„å”¯ä¸€å…¥å£ç‚¹ï¼ŒDispatcherServlet å¹¶ä¸ç›´æ¥å¤„ç†è¯·æ±‚ï¼Œè€Œæ˜¯å°†è¯·æ±‚çš„å¤„ç†å§”æ´¾ç»™å…¶ä»–ç»„ä»¶ï¼Œä»è€Œå®ç°è¯·æ±‚çš„ç»Ÿä¸€ç®¡ç†å’Œè°ƒåº¦ 5ã€‚</p><p>DispatcherServlet çš„åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ç”± Web æœåŠ¡å™¨ï¼ˆå¦‚ Tomcatï¼‰è´Ÿè´£ã€‚åœ¨åŸºäº XML çš„é…ç½®ä¸­ï¼ŒDispatcherServlet é€šå¸¸åœ¨ <code>web.xml</code> æ–‡ä»¶ä¸­å£°æ˜å’Œæ˜ å°„ 1ã€‚å¯¹äºåŸºäº Java çš„é…ç½®ï¼Œåˆ™å¯ä»¥é€šè¿‡ <code>WebConfiguration</code> ç±»è¿›è¡Œé…ç½® 1ã€‚ä¸ºäº†ç¡®ä¿åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ DispatcherServlet è¢«åˆå§‹åŒ–ï¼Œé€šå¸¸ä¼šé…ç½® <code>&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</code> 5ã€‚DispatcherServlet æ‹¥æœ‰è‡ªå·±çš„ <code>WebApplicationContext</code>ï¼Œå®ƒæ˜¯æ ¹åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å­ä¸Šä¸‹æ–‡ï¼Œè¿™ç§å±‚çº§ç»“æ„æœ‰åŠ©äºæ¸…æ™°åœ°åˆ†ç¦» Web ç›¸å…³çš„ Bean å’Œåº”ç”¨ç¨‹åºèŒƒå›´å†…çš„ Bean 5ã€‚é€šè¿‡åœ¨ <code>web.xml</code> ä¸­å°† DispatcherServlet çš„ servlet æ˜ å°„é…ç½®ä¸º <code>&quot;/&quot;</code>ï¼Œå¯ä»¥ä½¿å¾—æ‰€æœ‰å‘å¾€åº”ç”¨ç¨‹åºçš„è¯·æ±‚éƒ½ç”±è¯¥ DispatcherServlet å¤„ç† 1ã€‚</p><h2 id="è¯·æ±‚å¯¼èˆªï¼šè¯·æ±‚å¤„ç†æµç¨‹"><a href="#è¯·æ±‚å¯¼èˆªï¼šè¯·æ±‚å¤„ç†æµç¨‹" class="headerlink" title="è¯·æ±‚å¯¼èˆªï¼šè¯·æ±‚å¤„ç†æµç¨‹"></a>è¯·æ±‚å¯¼èˆªï¼šè¯·æ±‚å¤„ç†æµç¨‹</h2><p>Spring MVC æ¡†æ¶å¤„ç† HTTP è¯·æ±‚çš„è¿‡ç¨‹å¯ä»¥ç»†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ 1ï¼š</p><ol><li><strong>å®¢æˆ·ç«¯è¯·æ±‚ï¼š</strong> ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ Web URLï¼Œå‘èµ·å¯¹ç‰¹å®šé¡µé¢çš„è¯·æ±‚ 1ã€‚</li><li><strong>DispatcherServlet æ‹¦æˆªï¼š</strong> æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚é¦–å…ˆè¢«å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet æ‹¦æˆª 1ã€‚è¿™ä¸€æ­¥æ ‡å¿—ç€ Spring MVC æ¡†æ¶å¼€å§‹ä»‹å…¥è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ 1ã€‚</li><li><strong>HandlerMappingï¼š</strong> DispatcherServlet ä½¿ç”¨ HandlerMapping ç»„ä»¶æ¥æŸ¥æ‰¾ä¸å½“å‰è¯·æ±‚ URL ç›¸åŒ¹é…çš„æ§åˆ¶å™¨ï¼ˆHandlerï¼‰ 1ã€‚HandlerMapping å°±åƒä¸€ä¸ªè·¯ç”±å™¨ï¼Œå®ƒæ ¹æ®è¯·æ±‚çš„ç‰¹å¾ï¼ˆå¦‚ URLï¼‰å°†è¯·æ±‚å¯¼å‘è´Ÿè´£å¤„ç†å®ƒçš„ç‰¹å®šæ§åˆ¶å™¨ 1ã€‚</li><li><strong>æ§åˆ¶å™¨è°ƒç”¨ï¼š</strong> ä¸€æ—¦æ‰¾åˆ°åˆé€‚çš„æ§åˆ¶å™¨ï¼ŒDispatcherServlet å°±å°†è¯·æ±‚åˆ†å‘ç»™è¯¥æ§åˆ¶å™¨è¿›è¡Œå¤„ç† 1ã€‚</li><li><strong>æ§åˆ¶å™¨å¤„ç†ï¼š</strong> æ§åˆ¶å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ¨¡å‹ï¼ˆè´Ÿè´£ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ï¼‰è¿›è¡Œäº¤äº’ï¼Œå¹¶å‡†å¤‡å¥½è¦å±•ç¤ºç»™è§†å›¾çš„æ•°æ® 1ã€‚è¿™æ˜¯åº”ç”¨ç¨‹åºä¸­å¤„ç†ç‰¹å®šè¯·æ±‚çš„æ ¸å¿ƒé€»è¾‘æ‰€åœ¨ 1ã€‚</li><li><strong>ModelAndView è¿”å›ï¼š</strong> æ§åˆ¶å™¨å¤„ç†å®Œè¯·æ±‚åï¼Œé€šå¸¸ä¼šè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ã€‚è¯¥å¯¹è±¡åŒ…å«äº†æ¨¡å‹æ•°æ®ï¼ˆéœ€è¦å±•ç¤ºçš„æ•°æ®ï¼‰ä»¥åŠè§†å›¾çš„é€»è¾‘åç§° 1ã€‚ModelAndView å¯¹è±¡å……å½“äº†æ•°æ®å’Œè§†å›¾å±•ç¤ºæ–¹å¼çš„è½½ä½“ 1ã€‚</li><li><strong>è§†å›¾è§£æï¼š</strong> DispatcherServlet æ¥æ”¶åˆ° ModelAndView å¯¹è±¡åï¼Œä¼šä½¿ç”¨ ViewResolver ç»„ä»¶æ ¹æ®è§†å›¾çš„é€»è¾‘åç§°æ¥æŸ¥æ‰¾å®é™…çš„è§†å›¾å®ç°ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ª JSP æ–‡ä»¶ï¼‰ 2ã€‚ViewResolver çš„ä½œç”¨åœ¨äºå°†æŠ½è±¡çš„è§†å›¾åç§°ä¸å…·ä½“çš„è§†å›¾æŠ€æœ¯è¿æ¥èµ·æ¥ï¼Œæä¾›äº†æ¡†æ¶çš„çµæ´»æ€§ 4ã€‚</li><li><strong>è§†å›¾æ¸²æŸ“ï¼š</strong> DispatcherServlet å°†æ¨¡å‹æ•°æ®ä¼ é€’ç»™è§£æå¾—åˆ°çš„è§†å›¾è¿›è¡Œæ¸²æŸ“ 1ã€‚è§†å›¾ä½¿ç”¨æ¨¡å‹ä¸­çš„æ•°æ®ç”Ÿæˆæœ€ç»ˆçš„ HTML å“åº”ï¼Œè¯¥å“åº”å°†è¢«å‘é€å›å®¢æˆ·ç«¯ 1ã€‚</li><li><strong>å“åº”è¿”å›å®¢æˆ·ç«¯ï¼š</strong> æœ€ç»ˆï¼Œæ¸²æŸ“åçš„è§†å›¾ä½œä¸º HTTP å“åº”è¿”å›ç»™ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°è¯·æ±‚çš„ç»“æœ 1ã€‚</li></ol><p><strong>Spring MVC è¯·æ±‚å¤„ç†æµç¨‹</strong></p><table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>æ¶‰åŠç»„ä»¶</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>1</td><td>å®¢æˆ·ç«¯</td><td>ç”¨æˆ·å‘èµ· HTTP è¯·æ±‚ã€‚</td></tr><tr><td>2</td><td>DispatcherServlet</td><td>æ‹¦æˆªæ‰€æœ‰è¿›å…¥åº”ç”¨ç¨‹åºçš„è¯·æ±‚ã€‚</td></tr><tr><td>3</td><td>HandlerMapping</td><td>ç¡®å®šå¤„ç†è¯¥è¯·æ±‚çš„æ§åˆ¶å™¨ã€‚</td></tr><tr><td>4</td><td>æ§åˆ¶å™¨</td><td>æ¥æ”¶å¹¶å¤„ç†è¯·æ±‚ã€‚</td></tr><tr><td>5</td><td>æ§åˆ¶å™¨</td><td>ä¸æ¨¡å‹äº¤äº’ï¼Œå‡†å¤‡æ•°æ®ã€‚</td></tr><tr><td>6</td><td>æ§åˆ¶å™¨</td><td>è¿”å›åŒ…å«æ¨¡å‹æ•°æ®å’Œè§†å›¾é€»è¾‘åç§°çš„ ModelAndView å¯¹è±¡ã€‚</td></tr><tr><td>7</td><td>ViewResolver</td><td>å°†è§†å›¾é€»è¾‘åç§°è§£æä¸ºå®é™…çš„è§†å›¾å¯¹è±¡ã€‚</td></tr><tr><td>8</td><td>è§†å›¾</td><td>ä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“å“åº”ã€‚</td></tr><tr><td>9</td><td>DispatcherServlet</td><td>å°†æ¸²æŸ“åçš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</td></tr></tbody></table><h2 id="å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨ï¼šHandlerMapping-çš„ä½œç”¨"><a href="#å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨ï¼šHandlerMapping-çš„ä½œç”¨" class="headerlink" title="å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨ï¼šHandlerMapping çš„ä½œç”¨"></a>å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨ï¼šHandlerMapping çš„ä½œç”¨</h2><p>HandlerMapping æ¥å£å®šä¹‰äº†å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨å¯¹è±¡çš„å¥‘çº¦ 13ã€‚Spring MVC æä¾›äº†å¤šç§ HandlerMapping æ¥å£çš„å®ç°ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºç»§æ‰¿è‡ª <code>AbstractHandlerMethodMapping</code> å’Œ <code>AbstractUrlHandlerMapping</code> çš„ä¸¤ç±» 16ã€‚</p><p><code>RequestMappingHandlerMapping</code> æ˜¯æœ€å¸¸ç”¨çš„å®ç°ï¼Œå®ƒå°† <code>@Controller</code> ç±»ä¸­å¸¦æœ‰ <code>@RequestMapping</code> æ³¨è§£çš„æ–¹æ³•æ˜ å°„ä¸ºè¯·æ±‚å¤„ç†å™¨ 13ã€‚åœ¨åº”ç”¨ç¨‹åºåˆå§‹åŒ–é˜¶æ®µï¼Œ<code>RequestMappingHandlerMapping</code> ä¼šæ‰«æå¸¦æœ‰ <code>@Controller</code> å’Œ <code>@RequestMapping</code> æ³¨è§£çš„ç±»ï¼Œå¹¶æ ¹æ®è¿™äº›æ³¨è§£æ„å»ºè¯·æ±‚æ˜ å°„ 2ã€‚å®ƒä½¿ç”¨ <code>RequestMappingInfo</code> å¯¹è±¡æ¥è¡¨ç¤ºæ˜ å°„å…³ç³»ï¼Œè¯¥å¯¹è±¡å°è£…äº†è¯·æ±‚åŒ¹é…çš„å„ç§æ¡ä»¶ï¼Œå¦‚è·¯å¾„ã€è¯·æ±‚å¤´ã€å‚æ•°ã€HTTP æ–¹æ³•å’Œåª’ä½“ç±»å‹ 16ã€‚<code>getMappingForMethod</code> æ–¹æ³•è´Ÿè´£æ ¹æ®å¤„ç†å™¨æ–¹æ³•ä¸Šçš„ <code>@RequestMapping</code> æ³¨è§£åˆ›å»º <code>RequestMappingInfo</code> å¯¹è±¡ 16ã€‚<code>@RequestMapping</code> æ³¨è§£æä¾›äº†ä¸€ç§çµæ´»ä¸”å£°æ˜å¼çš„æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®å¤šç§æ¡ä»¶å°†ç‰¹å®šçš„ HTTP è¯·æ±‚æ˜ å°„åˆ°æ§åˆ¶å™¨æ–¹æ³• 2ã€‚</p><p><code>BeanNameUrlHandlerMapping</code> æ˜¯é»˜è®¤çš„ <code>HandlerMapping</code> å®ç°ï¼Œå®ƒå°† URL è·¯å¾„æ˜ å°„åˆ°ä¸ URL è·¯å¾„åŒåçš„ Beanï¼ˆBean çš„åç§°ä»¥ â€œ&#x2F;â€œ å¼€å¤´ï¼‰ 13ã€‚å®ƒæ”¯æŒç›´æ¥åç§°åŒ¹é…å’Œä½¿ç”¨ â€œ*â€ è¿›è¡Œçš„æ¨¡å¼åŒ¹é… 13ã€‚è¿™ç§æ–¹å¼æä¾›äº†ä¸€ç§åŸºäºçº¦å®šçš„æ˜ å°„æ–¹æ³•ï¼ŒBean çš„åç§°ç›´æ¥å¯¹åº”äº URL è·¯å¾„ 13ã€‚</p><p><code>SimpleUrlHandlerMapping</code> å…è®¸é€šè¿‡ Spring é…ç½®ä¸­çš„ <code>Properties</code> å¯¹è±¡æˆ– <code>Map</code> æ˜¾å¼åœ°é…ç½® URL åˆ°å¤„ç†å™¨çš„æ˜ å°„ï¼ˆå¤„ç†å™¨å¯ä»¥æ˜¯ Bean å®ä¾‹æˆ– Bean åç§°ï¼‰ 13ã€‚è¿™ç§æ–¹å¼æä¾›äº†ä¸€ç§æ›´å…·å£°æ˜æ€§çš„æ–¹å¼åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰æ˜ å°„è§„åˆ™ï¼Œä¸ºå¤æ‚çš„è·¯ç”±åœºæ™¯æä¾›äº†çµæ´»æ€§ 13ã€‚</p><p><code>@RequestMapping</code> ä»¥åŠå…¶ä»–æ´¾ç”Ÿæ³¨è§£ï¼ˆå¦‚ <code>@GetMapping</code>ã€<code>@PostMapping</code> ç­‰ï¼‰ç®€åŒ–äº†åœ¨æ§åˆ¶å™¨ç±»ä¸­å®šä¹‰è¯·æ±‚æ˜ å°„çš„è¿‡ç¨‹ 2ã€‚è¿™äº›æ³¨è§£ä½¿å¾—ä»£ç æ›´æ˜“è¯»å’Œç»´æŠ¤ 2ã€‚</p><p>HandlerMapping æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ª <code>HandlerExecutionChain</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†æ‰¾åˆ°çš„å¤„ç†å™¨ä»¥åŠä¸€ä¸ªæœ‰åºçš„æ‹¦æˆªå™¨åˆ—è¡¨ 14ã€‚<code>HandlerExecutionChain</code> å…è®¸åœ¨ä¸»è¦å¤„ç†å™¨æ‰§è¡Œå‰åæ‰§è¡Œæ‹¦æˆªå™¨ï¼Œä»è€Œå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å¤„ç† 14ã€‚å¯ä»¥ä½¿ç”¨ <code>order</code> å±æ€§æ¥è®¾ç½®ä¸åŒ HandlerMapping å®ç°çš„ä¼˜å…ˆçº§ 13ã€‚</p><p><strong>å¸¸è§çš„ HandlerMapping å®ç°</strong></p><table><thead><tr><th><strong>HandlerMapping å®ç°</strong></th><th><strong>æè¿°</strong></th><th><strong>ä¸»è¦æ³¨è§£&#x2F;é…ç½®</strong></th></tr></thead><tbody><tr><td><code>RequestMappingHandlerMapping</code></td><td>å°†è¯·æ±‚æ˜ å°„åˆ°å¸¦æœ‰ <code>@RequestMapping</code> æ³¨è§£çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚</td><td><code>@Controller</code>, <code>@RequestMapping</code>, <code>@GetMapping</code>, <code>@PostMapping</code> ç­‰ã€‚</td></tr><tr><td><code>BeanNameUrlHandlerMapping</code></td><td>å°† URL æ˜ å°„åˆ°åç§°ä»¥ â€œ&#x2F;â€œ å¼€å¤´çš„åŒå Beanã€‚</td><td>Bean çš„åç§°ä½œä¸º URL è·¯å¾„ã€‚</td></tr><tr><td><code>SimpleUrlHandlerMapping</code></td><td>é€šè¿‡é…ç½®æ˜¾å¼åœ°å°† URL æ˜ å°„åˆ°å¤„ç†å™¨ Bean æˆ– Bean åç§°ã€‚</td><td>Spring é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§æˆ– Mapã€‚</td></tr></tbody></table><h2 id="æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼šæ§åˆ¶å™¨å¤„ç†"><a href="#æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼šæ§åˆ¶å™¨å¤„ç†" class="headerlink" title="æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼šæ§åˆ¶å™¨å¤„ç†"></a>æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼šæ§åˆ¶å™¨å¤„ç†</h2><p>DispatcherServlet åœ¨ç¡®å®šäº†åˆé€‚çš„æ§åˆ¶å™¨åï¼Œä¼šå°†è¯·æ±‚åˆ†å‘ç»™è¯¥æ§åˆ¶å™¨è¿›è¡Œå¤„ç† 1ã€‚æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•ä¼šæ ¹æ®è¯·æ±‚çš„ HTTP æ–¹æ³•ï¼ˆå¦‚ GETã€POST ç­‰ï¼‰æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ 1ã€‚æ§åˆ¶å™¨é€šå¸¸ä¼šå®šä¹‰å¤„ç†ç‰¹å®š HTTP æ–¹æ³•çš„æ–¹æ³•ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿå¯¹ä¸åŒç±»å‹çš„è¯·æ±‚åšå‡ºé€‚å½“çš„å“åº” 1ã€‚</p><p>åœ¨æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒSpring MVC æä¾›äº†çµæ´»çš„å‚æ•°è§£æå’Œæ•°æ®ç»‘å®šæœºåˆ¶ 10ã€‚Spring MVC å…è®¸ä½¿ç”¨ä»»ä½•å¯¹è±¡ä½œä¸ºå‘½ä»¤æˆ–è¡¨å•å¯¹è±¡ï¼Œè€Œæ— éœ€å®ç°æ¡†æ¶ç‰¹å®šçš„æ¥å£ 25ã€‚<code>@RequestParam</code> æ³¨è§£ç”¨äºå°†æŸ¥è¯¢å‚æ•°æˆ–è¡¨å•æ•°æ®æ˜ å°„åˆ°æ–¹æ³•å‚æ•°ï¼Œå°¤å…¶é€‚ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ 28ã€‚ä½¿ç”¨ <code>@RequestParam</code> å¯ä»¥ç®€åŒ–åœ¨æ§åˆ¶å™¨æ–¹æ³•ç­¾åä¸­ç›´æ¥è®¿é—®è¯·æ±‚å‚æ•°çš„è¿‡ç¨‹ 28ã€‚æ•°æ®ç»‘å®šæœºåˆ¶èƒ½å¤Ÿæ ¹æ®å‚æ•°åç§°å’Œç±»å‹è‡ªåŠ¨å°†è¯·æ±‚æ•°æ®è½¬æ¢ä¸º Java å¯¹è±¡ 28ã€‚Spring çš„æ•°æ®ç»‘å®šæœºåˆ¶ç®€åŒ–äº†å°† HTTP è¯·æ±‚æ•°æ®è½¬æ¢ä¸ºå¯ç”¨çš„ Java å¯¹è±¡çš„è¿‡ç¨‹ï¼Œå‡å°‘äº†æ ·æ¿ä»£ç  28ã€‚<code>@ModelAttribute</code> æ³¨è§£å¯ç”¨äºå°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°æ–¹æ³•å‚æ•°æˆ–æ–¹æ³•è¿”å›å€¼ï¼Œå¹¶å°†å…¶ä½œä¸ºå‘½åçš„æ¨¡å‹å±æ€§æš´éœ²ç»™è§†å›¾ 21ã€‚<code>@ModelAttribute</code> æœ‰åŠ©äºå®ç°åŒå‘æ•°æ®ç»‘å®šï¼Œæ–¹ä¾¿è¡¨å•æ•°æ®ä¸æ¨¡å‹å¯¹è±¡ä¹‹é—´çš„æ˜ å°„ 21ã€‚<code>DataBinder</code> ç±»æ”¯æŒæ„é€ å™¨ç»‘å®šå’Œå±æ€§ç»‘å®šï¼Œç”¨äºä½¿ç”¨è¯·æ±‚æ•°æ®å¡«å……å¯¹è±¡ 27ã€‚è¾ƒæ–°ç‰ˆæœ¬çš„ Spring ä¸­å¼•å…¥çš„æ„é€ å™¨ç»‘å®šæä¾›äº†ä¸€ç§æ›´å®‰å…¨çš„æ–¹å¼ï¼Œé€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°å¹¶ä¼ å…¥è¯·æ±‚æ•°æ®æ¥ç»‘å®šé¢„æœŸçš„å‚æ•° 29ã€‚æ•°æ®ç»‘å®šè¿‡ç¨‹ä¸­å‘ç”Ÿçš„ç±»å‹ä¸åŒ¹é…ä¼šè¢«è§†ä¸ºéªŒè¯é”™è¯¯ï¼Œä»è€Œå…è®¸åœ¨åº”ç”¨ç¨‹åºå±‚é¢è¿›è¡Œå¤„ç† 25ã€‚Spring çµæ´»çš„æ•°æ®ç»‘å®šèƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†å¸¸è§çš„é”™è¯¯ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥å‘ç”¨æˆ·æä¾›æœ‰ç”¨çš„åé¦ˆ 25ã€‚è¾ƒæ–°ç‰ˆæœ¬çš„ Spring è¿˜æ”¯æŒç›´æ¥åœ¨æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ä¸Šä½¿ç”¨ <code>@Constraint</code> æ³¨è§£è¿›è¡Œæ–¹æ³•éªŒè¯ï¼Œä¸å†éœ€è¦åœ¨ç±»çº§åˆ«ä½¿ç”¨ <code>@Validated</code> 27ã€‚å†…ç½®çš„æ–¹æ³•éªŒè¯ç®€åŒ–äº†æ§åˆ¶å™¨æ–¹æ³•ä¸­è¾“å…¥å‚æ•°çš„éªŒè¯è¿‡ç¨‹ï¼Œæé«˜äº†ä»£ç çš„æ¸…æ™°åº¦å¹¶å‡å°‘äº†æ‰‹åŠ¨ç¼–å†™éªŒè¯é€»è¾‘çš„éœ€æ±‚ 27ã€‚</p><h2 id="ä¼ é€’æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼šModelAndView"><a href="#ä¼ é€’æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼šModelAndView" class="headerlink" title="ä¼ é€’æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼šModelAndView"></a>ä¼ é€’æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼šModelAndView</h2><p>ModelAndView å¯¹è±¡æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒåŒæ—¶æŒæœ‰æ¨¡å‹æ•°æ®å’Œè¦æ¸²æŸ“çš„è§†å›¾çš„åç§° 1ã€‚æ§åˆ¶å™¨åœ¨å¤„ç†å®Œè¯·æ±‚åï¼Œé€šå¸¸ä¼šåˆ›å»ºå¹¶è¿”å› ModelAndView å¯¹è±¡ 1ã€‚æ¨¡å‹æ•°æ®ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨åœ¨ Map ä¸­ï¼Œé”®æ˜¯å±æ€§åç§°ï¼Œå€¼æ˜¯è¦åœ¨è§†å›¾ä¸­æ˜¾ç¤ºçš„æ•°æ® 1ã€‚è§†å›¾åç§°æ˜¯ä¸€ä¸ªé€»è¾‘æ ‡è¯†ç¬¦ï¼ŒViewResolver ä¼šå°†å…¶è§£æä¸ºå®é™…çš„è§†å›¾æŠ€æœ¯ 1ã€‚</p><p>æ§åˆ¶å™¨ä½¿ç”¨ ModelAndView å¯¹è±¡æ¥åŒæ—¶è¿”å›æ¨¡å‹æ•°æ®å’Œè§†å›¾çš„é€»è¾‘åç§° 1ã€‚ModelAndView å¯¹è±¡å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥è§†å›¾åç§°ï¼Œç„¶åæ·»åŠ æ¨¡å‹å±æ€§ï¼Œä¹Ÿå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„ ModelAndView å¯¹è±¡ï¼Œå†åˆ†åˆ«è®¾ç½®æ¨¡å‹å±æ€§å’Œè§†å›¾åç§° 17ã€‚å®ƒä¸ºæ§åˆ¶å™¨æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼æ¥ä¼ é€’å“åº”æ‰€éœ€çš„æ•°æ®ä»¥åŠæŒ‡ç¤ºåº”è¯¥ä½¿ç”¨å“ªä¸ªè§†å›¾æ¥å‘ˆç°å“åº” 1ã€‚</p><p>é™¤äº†ä½¿ç”¨ ModelAndViewï¼Œè¿˜æœ‰å…¶ä»–æ–¹å¼å¯ä»¥å°†æ¨¡å‹æ•°æ®ä¼ é€’ç»™è§†å›¾ï¼Œä¾‹å¦‚å°† <code>Model</code> æˆ– <code>ModelMap</code> ä½œä¸ºæ–¹æ³•å‚æ•° 17ã€‚<code>Model</code> å’Œ <code>ModelMap</code> æ˜¯ç”¨äºå‘è§†å›¾ä¼ é€’æ•°æ®çš„æ¥å£&#x2F;ç±»ï¼Œå®ƒä»¬ç”± Spring ç›´æ¥æ³¨å…¥åˆ°æ§åˆ¶å™¨æ–¹æ³•ä¸­ 17ã€‚å½“ä½¿ç”¨ <code>Model</code> æˆ– <code>ModelMap</code> æ—¶ï¼Œæ§åˆ¶å™¨æ–¹æ³•é€šå¸¸åªè¿”å›è§†å›¾çš„é€»è¾‘åç§°ä½œä¸ºå­—ç¬¦ä¸² 17ã€‚Spring æä¾›äº†å¤šç§å‘è§†å›¾ä¼ é€’æ•°æ®çš„æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®æ§åˆ¶å™¨çš„éœ€æ±‚å’Œåå¥½é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ³• 17ã€‚</p><h2 id="è§£æè§†å›¾ï¼šViewResolver-çš„åŠŸèƒ½"><a href="#è§£æè§†å›¾ï¼šViewResolver-çš„åŠŸèƒ½" class="headerlink" title="è§£æè§†å›¾ï¼šViewResolver çš„åŠŸèƒ½"></a>è§£æè§†å›¾ï¼šViewResolver çš„åŠŸèƒ½</h2><p>ViewResolver æ¥å£è´Ÿè´£å°†æ§åˆ¶å™¨è¿”å›çš„è§†å›¾é€»è¾‘åç§°æ˜ å°„åˆ°å®é™…çš„ View å¯¹è±¡ 2ã€‚å®ƒä½¿å¾—åœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“æ¨¡å‹æ•°æ®æˆä¸ºå¯èƒ½ï¼Œè€Œæ— éœ€å°†å®ç°ç»‘å®šåˆ°ç‰¹å®šçš„è§†å›¾æŠ€æœ¯ 21ã€‚ViewResolver æ¥å£å®šä¹‰äº† <code>resolveViewName(String viewName, Locale locale)</code> æ–¹æ³• 23ã€‚</p><p><code>InternalResourceViewResolver</code> ç”¨äºå°†è§†å›¾åç§°è§£æä¸ºå†…éƒ¨èµ„æºï¼Œå¦‚ä½äº <code>WEB-INF</code> ç›®å½•ä¸‹çš„ JSP æ–‡ä»¶ 21ã€‚å®ƒé€šè¿‡é…ç½®å‰ç¼€ï¼ˆä¾‹å¦‚ <code>/WEB-INF/views/</code>ï¼‰å’Œåç¼€ï¼ˆä¾‹å¦‚ <code>.jsp</code>ï¼‰æ¥å®šä½è§†å›¾æ–‡ä»¶ 22ã€‚æ­¤è§£æå™¨å¸¸ç”¨äºä½¿ç”¨ JSP ä½œä¸ºè§†å›¾æŠ€æœ¯çš„ä¼ ç»Ÿ Java Web åº”ç”¨ç¨‹åº 21ã€‚</p><p><code>XmlViewResolver</code> ä½¿ç”¨åœ¨ XML æ–‡ä»¶ä¸­å®šä¹‰çš„è§†å›¾ Bean å®šä¹‰æ¥è§£æè§†å›¾åç§° 21ã€‚å®ƒå…è®¸é…ç½®å…·æœ‰ç‰¹å®šç±»ï¼ˆä¾‹å¦‚ <code>JstlView</code>ï¼‰å’Œ URL çš„è§†å›¾ Bean 21ã€‚è¿™ç§æ–¹å¼æä¾›äº†ä¸€ç§é…ç½®é©±åŠ¨çš„è§†å›¾è§£ææ–¹æ³•ï¼Œå…è®¸åœ¨åŒä¸€åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ä¸åŒçš„è§†å›¾æŠ€æœ¯ 21ã€‚</p><p><code>ResourceBundleViewResolver</code> ä½¿ç”¨å±æ€§æ–‡ä»¶æ¥è§£æè§†å›¾åç§°ï¼Œè§†å›¾é…ç½®åœ¨å±æ€§æ–‡ä»¶ä¸­ä»¥é”®å€¼å¯¹çš„å½¢å¼å®šä¹‰ 21ã€‚æ­¤è§£æå™¨é€‚ç”¨äºä»¥æ›´å¤–éƒ¨åŒ–çš„æ–¹å¼ç®¡ç†è§†å›¾é…ç½®ï¼Œå¯èƒ½æœ‰åŠ©äºå›½é™…åŒ–æˆ–ç‰¹å®šäºç¯å¢ƒçš„è®¾ç½® 21ã€‚</p><p>è¿˜æœ‰å…¶ä»–å¸¸ç”¨çš„è§£æå™¨ï¼Œå¦‚ç”¨äº Velocity æ¨¡æ¿çš„ <code>VelocityViewResolver</code> å’Œç”¨äº FreeMarker æ¨¡æ¿çš„ <code>FreeMarkerViewResolver</code> 7ã€‚Spring MVC æ”¯æŒä¸å„ç§æµè¡Œçš„æ¨¡æ¿å¼•æ“é›†æˆï¼Œä¸ºå¼€å‘è€…æä¾›äº†å¹¿æ³›çš„è§†å›¾å±‚é€‰æ‹© 7ã€‚</p><p>Spring MVC æ”¯æŒé…ç½®å¤šä¸ªè§†å›¾è§£æå™¨ï¼Œå¹¶ä½¿ç”¨ <code>setOrder()</code> æ–¹æ³•è®¾ç½®å®ƒä»¬çš„ä¼˜å…ˆçº§ 21ã€‚é€šè¿‡é…ç½®å…·æœ‰ç‰¹å®šé¡ºåºçš„å¤šä¸ªè§†å›¾è§£æå™¨ï¼ŒSpring å¯ä»¥å°è¯•ä¸åŒçš„è§£æå™¨ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„è§†å›¾ï¼Œä»è€Œå…è®¸åœ¨åŒä¸€åº”ç”¨ç¨‹åºä¸­åŸºäºè§†å›¾åç§°æ¨¡å¼ä½¿ç”¨ä¸åŒçš„è§†å›¾æŠ€æœ¯ 21ã€‚</p><p><strong>å¸¸è§çš„ ViewResolver å®ç°</strong></p><table><thead><tr><th><strong>ViewResolver å®ç°</strong></th><th><strong>æè¿°</strong></th><th><strong>å…¸å‹é…ç½®</strong></th></tr></thead><tbody><tr><td><code>InternalResourceViewResolver</code></td><td>å°†è§†å›¾åç§°è§£æä¸ºå†…éƒ¨èµ„æºï¼ˆå¦‚ JSP æ–‡ä»¶ï¼‰ã€‚</td><td>é…ç½®å‰ç¼€ï¼ˆå¦‚ <code>/WEB-INF/views/</code>ï¼‰å’Œåç¼€ï¼ˆå¦‚ <code>.jsp</code>ï¼‰ã€‚</td></tr><tr><td><code>XmlViewResolver</code></td><td>ä½¿ç”¨åœ¨ XML æ–‡ä»¶ä¸­å®šä¹‰çš„è§†å›¾ Bean æ¥è§£æè§†å›¾åç§°ã€‚</td><td>é…ç½®åŒ…å«è§†å›¾ Bean å®šä¹‰çš„ XML æ–‡ä»¶è·¯å¾„ã€‚</td></tr><tr><td><code>ResourceBundleViewResolver</code></td><td>ä½¿ç”¨å±æ€§æ–‡ä»¶ä¸­çš„é…ç½®æ¥è§£æè§†å›¾åç§°ã€‚</td><td>é…ç½®å±æ€§æ–‡ä»¶çš„åŸºæœ¬åç§°ã€‚</td></tr><tr><td><code>VelocityViewResolver</code></td><td>å°†è§†å›¾åç§°è§£æä¸º Velocity æ¨¡æ¿ã€‚</td><td>é…ç½® Velocity æ¨¡æ¿çš„è·¯å¾„å’Œåç¼€ã€‚</td></tr><tr><td><code>FreeMarkerViewResolver</code></td><td>å°†è§†å›¾åç§°è§£æä¸º FreeMarker æ¨¡æ¿ã€‚</td><td>é…ç½® FreeMarker æ¨¡æ¿çš„è·¯å¾„å’Œåç¼€ã€‚</td></tr></tbody></table><h2 id="æ¸²æŸ“å“åº”ï¼šè§†å›¾ç»„ä»¶"><a href="#æ¸²æŸ“å“åº”ï¼šè§†å›¾ç»„ä»¶" class="headerlink" title="æ¸²æŸ“å“åº”ï¼šè§†å›¾ç»„ä»¶"></a>æ¸²æŸ“å“åº”ï¼šè§†å›¾ç»„ä»¶</h2><p>é€‰å®šçš„è§†å›¾è´Ÿè´£æ¸²æŸ“æ¨¡å‹æ•°æ®ï¼Œç”Ÿæˆæœ€ç»ˆçš„å“åº” 1ã€‚è§†å›¾æ¥æ”¶æ¨¡å‹æ•°æ®ï¼ˆé€šè¿‡ <code>Model</code>ã€<code>ModelMap</code> æˆ– <code>ModelAndView</code> æ·»åŠ çš„å±æ€§ï¼‰ï¼Œå¹¶å°†å…¶ä¸è§†å›¾æ¨¡æ¿åˆå¹¶ 1ã€‚ä¸åŒçš„è§†å›¾æŠ€æœ¯ï¼ˆJSPã€Thymeleafã€FreeMarker ç­‰ï¼‰æœ‰å„è‡ªçš„è¯­æ³•å’Œæœºåˆ¶æ¥è®¿é—®æ¨¡æ¿ä¸­çš„æ¨¡å‹æ•°æ® 1ã€‚ä¾‹å¦‚ï¼Œåœ¨ JSP ä¸­ï¼Œé€šå¸¸ä½¿ç”¨è¡¨è¾¾å¼è¯­è¨€ï¼ˆELï¼‰ï¼Œå¦‚ <code>${attributeName}</code> 17ã€‚æ¸²æŸ“è¿‡ç¨‹æœ€ç»ˆä¼šç”Ÿæˆ HTMLï¼ˆæˆ–å…¶ä»–å†…å®¹ç±»å‹ï¼‰ï¼Œå¹¶ä½œä¸ºå“åº”å‘é€å›å®¢æˆ·ç«¯çš„æµè§ˆå™¨ 1ã€‚</p><p>Spring MVC æ”¯æŒå¤šç§è§†å›¾æŠ€æœ¯åŠå…¶é›†æˆ 1ã€‚JSPï¼ˆJavaServer Pagesï¼‰æ˜¯ä¸€ç§ä¼ ç»Ÿçš„è§†å›¾æŠ€æœ¯ï¼ŒSpring MVC å¯¹å…¶æä¾›äº†è‰¯å¥½çš„æ”¯æŒ 1ã€‚Thymeleaf æ˜¯ä¸€ç§ç°ä»£çš„æœåŠ¡å™¨ç«¯ Java æ¨¡æ¿å¼•æ“ï¼Œå®ƒæä¾›äº†è‡ªç„¶çš„æ¨¡æ¿ 5ã€‚FreeMarker å’Œ Velocity æ˜¯å…¶ä»–å¯ä»¥ä¸ Spring MVC é›†æˆçš„æ¨¡æ¿å¼•æ“ 7ã€‚æ­¤å¤–ï¼ŒSpring MVC è¿˜æ”¯æŒå°†è§†å›¾æ¸²æŸ“ä¸º JSON æˆ– XML æ ¼å¼ï¼Œç”¨äºæ„å»º RESTful API 4ã€‚Spring MVC åœ¨è§†å›¾å±‚é¢çš„çµæ´»æ€§ä½¿å…¶èƒ½å¤Ÿé€‚åº”å„ç§ Web åº”ç”¨ç¨‹åºå’Œ API çš„æ„å»ºéœ€æ±‚ 4ã€‚</p><h2 id="æ‹¦æˆªè¯·æ±‚ï¼šä½¿ç”¨-HandlerInterceptor"><a href="#æ‹¦æˆªè¯·æ±‚ï¼šä½¿ç”¨-HandlerInterceptor" class="headerlink" title="æ‹¦æˆªè¯·æ±‚ï¼šä½¿ç”¨ HandlerInterceptor"></a>æ‹¦æˆªè¯·æ±‚ï¼šä½¿ç”¨ HandlerInterceptor</h2><p>HandlerInterceptor æ¥å£å…è®¸åœ¨è¯·æ±‚åˆ°è¾¾å¤„ç†å™¨ä¹‹å‰ï¼ˆ<code>preHandle</code>ï¼‰ã€å¤„ç†å™¨æ‰§è¡Œä¹‹åä½†åœ¨è§†å›¾æ¸²æŸ“ä¹‹å‰ï¼ˆ<code>postHandle</code>ï¼‰ã€ä»¥åŠæ•´ä¸ªè¯·æ±‚å®Œæˆä¹‹åï¼ˆ<code>afterCompletion</code>ï¼‰å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªå’Œå¤„ç† 13ã€‚</p><ul><li><code>preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)</code> æ–¹æ³•åœ¨å¤„ç†å™¨æ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ï¼›è¿”å› <code>true</code> ä»¥ç»§ç»­å¤„ç†ï¼Œè¿”å› <code>false</code> åˆ™åœæ­¢å¤„ç† 19ã€‚æ­¤æ–¹æ³•å¸¸ç”¨äºæ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒæ£€æŸ¥å’Œæ—¥å¿—è®°å½•ç­‰æ“ä½œï¼Œè¿™äº›æ“ä½œéœ€è¦åœ¨ä¸»è¦çš„è¯·æ±‚å¤„ç†é€»è¾‘ä¹‹å‰å®Œæˆ 19ã€‚</li><li><code>postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</code> æ–¹æ³•åœ¨å¤„ç†å™¨æˆåŠŸæ‰§è¡Œä¹‹åä½†åœ¨è§†å›¾æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨ï¼›å¯ä»¥ä¿®æ”¹ ModelAndView å¯¹è±¡ 19ã€‚è¿™å…è®¸æ ¹æ®å¤„ç†å™¨æ‰§è¡Œçš„ç»“æœä¿®æ”¹æ¨¡å‹æˆ–è§†å›¾ï¼Œä¾‹å¦‚æ·»åŠ é€šç”¨å±æ€§æˆ–æ›´æ”¹è§†å›¾åç§° 19ã€‚</li><li><code>afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</code> æ–¹æ³•åœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæˆä¹‹åè¢«è°ƒç”¨ï¼Œæ— è®ºå¤„ç†æˆåŠŸä¸å¦ï¼›å¸¸ç”¨äºæ‰§è¡Œæ¸…ç†ä»»åŠ¡å’Œè®°å½•æ—¥å¿— 19ã€‚å³ä½¿åœ¨è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œæ­¤æ–¹æ³•ä¹Ÿèƒ½ç¡®ä¿å¿…è¦çš„æ¸…ç†æ“ä½œæˆ–æœ€ç»ˆçš„æ—¥å¿—è®°å½•è¯­å¥å¾—åˆ°æ‰§è¡Œ 19ã€‚</li></ul><p>HandlerInterceptor çš„å¸¸è§ç”¨ä¾‹åŒ…æ‹¬è®°å½•è¯·æ±‚è¯¦ç»†ä¿¡æ¯å’Œå“åº”æ—¶é—´ 19ã€å®ç°èº«ä»½éªŒè¯å’Œæˆæƒæ£€æŸ¥ä»¥ä¿æŠ¤åº”ç”¨ç¨‹åºèµ„æº 19ã€é€šè¿‡è®°å½•è¯·æ±‚å¼€å§‹å’Œç»“æŸæ—¶é—´æ¥æ‰§è¡Œæ€§èƒ½ç›‘æ§ 19 ä»¥åŠä¿®æ”¹è¯·æ±‚æˆ–å“åº”å¤´ 19ã€‚</p><p>HandlerInterceptor éœ€è¦åœ¨ Spring MVC æ¡†æ¶ä¸­æ³¨å†Œæ‰èƒ½åœ¨è¯·æ±‚å¤„ç†ç”Ÿå‘½å‘¨æœŸä¸­è¢«è°ƒç”¨ 19ã€‚é€šå¸¸é€šè¿‡å®ç° <code>WebMvcConfigurer</code> æ¥å£å¹¶è¦†ç›– <code>addInterceptors</code> æ–¹æ³•æ¥é…ç½® HandlerInterceptor 19ã€‚</p><p><strong>HandlerInterceptor æ–¹æ³•</strong></p><table><thead><tr><th><strong>æ–¹æ³•åç§°</strong></th><th><strong>è°ƒç”¨æ—¶æœº</strong></th><th><strong>ä¸»è¦ç›®çš„</strong></th><th><strong>è¿”å›å€¼&#x2F;å‚æ•°</strong></th></tr></thead><tbody><tr><td><code>preHandle</code></td><td>åœ¨å¤„ç†å™¨æ‰§è¡Œä¹‹å‰</td><td>æ‰§è¡Œé¢„å¤„ç†ï¼Œå¦‚èº«ä»½éªŒè¯ã€æˆæƒã€æ—¥å¿—è®°å½•ç­‰ï¼›å¯ä»¥å†³å®šæ˜¯å¦ç»§ç»­å¤„ç†è¯·æ±‚ã€‚</td><td><code>boolean</code> (true ç»§ç»­ï¼Œfalse åœæ­¢)ï¼›<code>HttpServletRequest</code>, <code>HttpServletResponse</code>, <code>Object handler</code></td></tr><tr><td><code>postHandle</code></td><td>åœ¨å¤„ç†å™¨æ‰§è¡Œä¹‹åï¼Œè§†å›¾æ¸²æŸ“ä¹‹å‰</td><td>ä¿®æ”¹ ModelAndView å¯¹è±¡ï¼Œæ·»åŠ é¢å¤–çš„æ¨¡å‹å±æ€§æˆ–ä¿®æ”¹è§†å›¾åç§°ã€‚</td><td><code>void</code>ï¼›<code>HttpServletRequest</code>, <code>HttpServletResponse</code>, <code>Object handler</code>, <code>ModelAndView modelAndView</code></td></tr><tr><td><code>afterCompletion</code></td><td>åœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæˆä¹‹å</td><td>æ‰§è¡Œæ¸…ç†ä»»åŠ¡ï¼Œå¦‚é‡Šæ”¾èµ„æºã€è®°å½•è¯·æ±‚å®Œæˆæ—¶é—´ã€å¤„ç†å¼‚å¸¸ç­‰ã€‚</td><td><code>void</code>ï¼›<code>HttpServletRequest</code>, <code>HttpServletResponse</code>, <code>Object handler</code>, <code>Exception ex</code> (å¯é€‰)</td></tr></tbody></table><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Spring MVC æ¡†æ¶çš„å·¥ä½œåŸç†å›´ç»•ç€ä¸­å¤®è°ƒåº¦å™¨ DispatcherServlet å±•å¼€ï¼Œå®ƒä¸ HandlerMappingã€Controllerã€ModelAndViewã€ViewResolver å’Œ View ç­‰ç»„ä»¶ååŒå·¥ä½œï¼Œå…±åŒå¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„ Web è¯·æ±‚ã€‚DispatcherServlet æ¥æ”¶æ‰€æœ‰è¯·æ±‚ï¼ŒHandlerMapping è´Ÿè´£å°†è¯·æ±‚æ˜ å°„åˆ°åˆé€‚çš„æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨å¤„ç†ä¸šåŠ¡é€»è¾‘å¹¶è¿”å›åŒ…å«æ¨¡å‹æ•°æ®å’Œè§†å›¾åç§°çš„ ModelAndView å¯¹è±¡ï¼ŒViewResolver å°†è§†å›¾åç§°è§£æä¸ºå®é™…çš„è§†å›¾ï¼Œæœ€åè§†å›¾ä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“å“åº”å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚HandlerInterceptor åˆ™æä¾›äº†åœ¨è¯·æ±‚å¤„ç†çš„ä¸åŒé˜¶æ®µè¿›è¡Œæ‹¦æˆªå’Œå¤„ç†çš„èƒ½åŠ›ã€‚</p><p>ä½¿ç”¨ Spring MVC æ¡†æ¶å…·æœ‰è¯¸å¤šä¼˜åŠ¿ã€‚é¦–å…ˆï¼ŒMVC æ¨¡å¼å®ç°äº†æ¸…æ™°çš„å…³æ³¨ç‚¹åˆ†ç¦» 2ã€‚å…¶æ¬¡ï¼Œç»„ä»¶ä¹‹é—´çš„æ¾è€¦åˆä½¿å¾—åº”ç”¨ç¨‹åºæ›´æ˜“äºç»´æŠ¤å’Œæµ‹è¯• 1ã€‚æ¡†æ¶æä¾›äº†é«˜åº¦çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œè¿™å¾—ç›Šäºå…¶å¯é…ç½®çš„ç»„ä»¶å’Œæ¥å£ 1ã€‚Spring MVC æ”¯æŒå„ç§è§†å›¾æŠ€æœ¯ 2ï¼Œå¹¶æä¾›äº†å¼ºå¤§çš„æ•°æ®ç»‘å®šå’ŒéªŒè¯æœºåˆ¶ 25ã€‚é€šè¿‡ HandlerInterceptorï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°é¢å‘åˆ‡é¢çš„åŠŸèƒ½ 19ã€‚æ­¤å¤–ï¼ŒSpring MVC è¿˜ä¸ Spring æ¡†æ¶çš„å…¶ä»–åŠŸèƒ½ï¼ˆå¦‚ä¾èµ–æ³¨å…¥å’Œ AOPï¼‰æ— ç¼é›†æˆ 3ï¼Œå¹¶æœ‰åŠ©äºå¿«é€Ÿåº”ç”¨ç¨‹åºå¼€å‘ 2ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾— Spring MVC æˆä¸ºæ„å»ºå¥å£®ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•çš„ Java Web åº”ç”¨ç¨‹åºçš„é¦–é€‰æ¡†æ¶ä¹‹ä¸€ã€‚</p><h1 id="Spring-MVC-é¢è¯•é¢˜"><a href="#Spring-MVC-é¢è¯•é¢˜" class="headerlink" title="Spring MVC é¢è¯•é¢˜:"></a>Spring MVC é¢è¯•é¢˜:</h1><p><strong>ä»€ä¹ˆæ˜¯ Spring MVC æ¡†æ¶ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> Spring MVC æ˜¯åŸºäºæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰è®¾è®¡æ¨¡å¼çš„ Web æ¡†æ¶ï¼Œç”¨äºæ„å»º Web åº”ç”¨ç¨‹åºã€‚</li></ul><p><strong>Spring MVC çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> å®¢æˆ·ç«¯è¯·æ±‚ç”±å‰ç«¯æ§åˆ¶å™¨ï¼ˆDispatcherServletï¼‰å¤„ç†ï¼Œç„¶åé€šè¿‡å¤„ç†å™¨æ˜ å°„å™¨ï¼ˆHandlerMappingï¼‰æ‰¾åˆ°ç›¸åº”çš„æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›æ¨¡å‹å’Œè§†å›¾ã€‚</li></ul><p><strong>Spring MVC ä¸­çš„æ§åˆ¶å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> æ§åˆ¶å™¨æ¥æ”¶å¹¶å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç„¶åè¿”å›ä¸€ä¸ªåŒ…å«æ¨¡å‹æ•°æ®çš„é€»è¾‘è§†å›¾åç§°ã€‚</li></ul><p><strong>Spring MVC çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> åŒ…æ‹¬ DispatcherServletã€Controllerã€HandlerMappingã€ViewResolver ç­‰ã€‚</li></ul><p><strong>è§£é‡Šä¸€ä¸‹ Spring MVC ä¸­çš„ DispatcherServletã€‚</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> DispatcherServlet æ˜¯ Spring MVC çš„å‰ç«¯æ§åˆ¶å™¨ï¼Œè´Ÿè´£æ¥æ”¶å¹¶åˆ†å‘å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</li></ul><p><strong>Spring MVC ä¸­çš„ Modelã€Viewã€Controller æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> Model ç”¨äºå°è£…æ•°æ®ï¼ŒView è´Ÿè´£å±•ç¤ºæ•°æ®ï¼ŒController å¤„ç†ç”¨æˆ·è¯·æ±‚å¹¶è¿”å›é€‚å½“çš„æ¨¡å‹å’Œè§†å›¾ã€‚</li></ul><p> <strong>å¦‚ä½•å¤„ç†è¡¨å•æäº¤å’Œå‚æ•°ç»‘å®šï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> ä½¿ç”¨@ModelAttribute æ³¨è§£è¿›è¡Œå‚æ•°ç»‘å®šï¼Œä½¿ç”¨<a href="form:form">form:form</a>æ ‡ç­¾å¤„ç†è¡¨å•æäº¤ã€‚</li></ul><p><strong>Spring MVC ä¸­çš„æ‹¦æˆªå™¨æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> æ‹¦æˆªå™¨ç”¨äºåœ¨è¯·æ±‚å¤„ç†å‰æˆ–å¤„ç†åæ‰§è¡Œä¸€äº›é¢å¤–çš„é€»è¾‘ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ç­‰ã€‚</li></ul><p><strong>ä»€ä¹ˆæ˜¯ RESTful Web æœåŠ¡ï¼ŒSpring MVC å¦‚ä½•æ”¯æŒ RESTful é£æ ¼ï¼Ÿ</strong></p><ul><li><strong>ç­”æ¡ˆï¼š</strong> RESTful æ˜¯ä¸€ç§ Web æœåŠ¡è®¾è®¡é£æ ¼ï¼ŒSpring MVC é€šè¿‡æ³¨è§£ï¼ˆ@RequestMappingï¼‰å’Œ HTTP æ–¹æ³•æ¥æ”¯æŒ RESTful é£æ ¼ã€‚</li></ul><p><strong>Spring MVC ä¸­çš„@ModelAttribute å’Œ@SessionAttributes æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong><br>    - <strong>ç­”æ¡ˆï¼š</strong> @ModelAttribute ç”¨äºç»‘å®šè¯·æ±‚å‚æ•°åˆ°æ¨¡å‹ä¸­ï¼Œ@SessionAttributes ç”¨äºå°†æ¨¡å‹ä¸­çš„å±æ€§æš‚æ—¶å­˜å‚¨åœ¨ä¼šè¯ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring è¿‡æ»¤å™¨</title>
      <link href="/posts/fed01c2.html"/>
      <url>/posts/fed01c2.html</url>
      
        <content type="html"><![CDATA[<h2 id="Filter-å’Œ-Interceptor"><a href="#Filter-å’Œ-Interceptor" class="headerlink" title="Filter å’Œ Interceptor"></a>Filter å’Œ Interceptor</h2><h3 id="Filter-è¿‡æ»¤å™¨"><a href="#Filter-è¿‡æ»¤å™¨" class="headerlink" title="Filter è¿‡æ»¤å™¨"></a>Filter è¿‡æ»¤å™¨</h3><ul><li>Servlet å®¹å™¨ç»´åº¦çš„ï¼Œæ‹¦æˆª Servlet çš„è¯·æ±‚ã€‚</li><li>é€šè¿‡ <code>Filter</code> æ¥å£å®ç°çš„</li></ul><p>Servlet å®¹å™¨ï¼š Tomcatã€Jettyã€‚éµå¾ª Java Servlet è§„èŒƒï¼Œé€šå¸¸åŒ…æ‹¬ HTTP æœåŠ¡å™¨ï¼Œå¤„ç† web è¯·æ±‚å’Œå“åº”ã€‚</p><h3 id="Interceptor-æ‹¦æˆªå™¨"><a href="#Interceptor-æ‹¦æˆªå™¨" class="headerlink" title="Interceptor æ‹¦æˆªå™¨"></a>Interceptor æ‹¦æˆªå™¨</h3><ul><li>Spring å®¹å™¨ç»´åº¦çš„ï¼Œå¯¹ Spring MVC çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªã€‚</li><li>é€šè¿‡å®ç° <code>HandlerInterceptor</code> æ¥å£å®ç°çš„ï¼Œå¹¶é€šè¿‡ Spring çš„é…ç½®è¿›è¡Œæ³¨å†Œã€‚</li></ul><h4 id="PSï¼š"><a href="#PSï¼š" class="headerlink" title="PSï¼š"></a>PSï¼š</h4><p>Spring æ¡†æ¶åµŒå…¥åˆ° Servlet å®¹å™¨ä¸­ï¼Œåˆ©ç”¨ spring å®¹å™¨ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–ç»„ä»¶:</p><ul><li><strong>Spring Beansï¼š</strong> åœ¨ Spring æ¡†æ¶ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰å’Œé…ç½®å„ç§ Beanï¼ŒåŒ…æ‹¬ä¸šåŠ¡é€»è¾‘ç»„ä»¶ã€æ•°æ®è®¿é—®ç»„ä»¶ã€æœåŠ¡ç­‰ã€‚è¿™äº› Bean çš„ç”Ÿå‘½å‘¨æœŸã€ä¾èµ–å…³ç³»ç­‰éƒ½ç”± Spring å®¹å™¨ç®¡ç†ã€‚</li><li><strong>Service å±‚å’Œä¸šåŠ¡é€»è¾‘ï¼š</strong> ä½ å¯ä»¥ä½¿ç”¨ Spring æ¥ç®¡ç†ä¸šåŠ¡é€»è¾‘å±‚çš„ç»„ä»¶ï¼Œä½¿å…¶æˆä¸º Spring å®¹å™¨ç®¡ç†çš„ Beanã€‚è¿™äº›ä¸šåŠ¡é€»è¾‘ç»„ä»¶é€šå¸¸åŒ…æ‹¬æœåŠ¡å±‚çš„å®ç°ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ç­‰ã€‚</li><li><strong>æ•°æ®è®¿é—®ç»„ä»¶ï¼š</strong> Spring æ¡†æ¶æä¾›äº†å¯¹æ•°æ®è®¿é—®çš„æ”¯æŒï¼ŒåŒ…æ‹¬æ•´åˆ Hibernateã€MyBatis ç­‰æŒä¹…åŒ–æ¡†æ¶ã€‚ä½ å¯ä»¥å°†æ•°æ®è®¿é—®ç»„ä»¶é…ç½®ä¸º Spring Beanï¼Œå¹¶ç”± Spring å®¹å™¨è¿›è¡Œç®¡ç†ã€‚</li><li><strong>äº‹åŠ¡ç®¡ç†ï¼š</strong> Spring å®¹å™¨å¯ä»¥ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„äº‹åŠ¡ï¼Œç¡®ä¿äº‹åŠ¡çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ã€‚é€šè¿‡å°†äº‹åŠ¡ç®¡ç†é…ç½®ä¸º Spring Beanï¼Œå¯ä»¥è½»æ¾åœ°è¿›è¡Œå£°æ˜æ€§äº‹åŠ¡ç®¡ç†ã€‚</li><li><strong>AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ï¼š</strong> Spring æ¡†æ¶æä¾› AOP çš„æ”¯æŒï¼Œä½ å¯ä»¥å°†åˆ‡é¢é…ç½®ä¸º Spring Beanï¼Œä»¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–ç®¡ç†ã€‚</li><li><strong>é…ç½®ä¿¡æ¯ï¼š</strong> Spring å®¹å™¨å¯ä»¥ç®¡ç†åº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯ï¼Œé€šè¿‡å°†é…ç½®æ–‡ä»¶è§£æä¸º Spring Beanï¼Œå®ç°é…ç½®çš„é›†ä¸­åŒ–ç®¡ç†ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•</title>
      <link href="/posts/b7e144d1.html"/>
      <url>/posts/b7e144d1.html</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ·é¢˜æ–¹æ¡ˆ"><a href="#åˆ·é¢˜æ–¹æ¡ˆ" class="headerlink" title="åˆ·é¢˜æ–¹æ¡ˆ"></a>åˆ·é¢˜æ–¹æ¡ˆ</h2><p>ä½œä¸ºä¸€ä¸ªä»¥ <strong>Java åå°å¼€å‘</strong> ä¸ºèŒä¸šç›®æ ‡çš„åˆå­¦è€…ï¼Œä½ çš„åˆ·é¢˜ç­–ç•¥ä¸èƒ½ä»…ä»…æ˜¯â€œè§£å‡ºé¢˜ç›®â€ï¼Œæ›´éœ€è¦ä½“ç°å‡ºä½ å¯¹ Java è¯­è¨€ç‰¹æ€§çš„ç†è§£ä»¥åŠè‰¯å¥½çš„å·¥ç¨‹ç´ å…»ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸ºä½ å®šåˆ¶çš„æœ€ä½³åˆ·é¢˜æ–¹æ¡ˆå’Œè¯­è¨€å»ºè®®ï¼š</p><hr><h3 id="ä¸€ã€-æ ¸å¿ƒé—®é¢˜ï¼šé€‰ä»€ä¹ˆè¯­è¨€ï¼Ÿ"><a href="#ä¸€ã€-æ ¸å¿ƒé—®é¢˜ï¼šé€‰ä»€ä¹ˆè¯­è¨€ï¼Ÿ" class="headerlink" title="ä¸€ã€ æ ¸å¿ƒé—®é¢˜ï¼šé€‰ä»€ä¹ˆè¯­è¨€ï¼Ÿ"></a>ä¸€ã€ æ ¸å¿ƒé—®é¢˜ï¼šé€‰ä»€ä¹ˆè¯­è¨€ï¼Ÿ</h3><p><strong>ç»“è®ºï¼šæ¯«æ— ç–‘é—®ï¼Œå¿…é¡»ç”¨ Javaã€‚</strong></p><p>è™½ç„¶ Python ä»£ç æ›´çŸ­ï¼ŒC++ è¿è¡Œæ›´å¿«ï¼Œä½†å¯¹äºé¢è¯• <strong>Java åå°</strong> å²—ä½ï¼Œä½¿ç”¨ Java åˆ·é¢˜æœ‰å·¨å¤§çš„æˆ˜ç•¥ä¼˜åŠ¿ï¼š</p><ol><li><strong>è¯æ˜ç†Ÿç»ƒåº¦ï¼š</strong> é¢è¯•å®˜ä¼šè€ƒå¯Ÿä½ å¯¹ Java API çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼ˆä¾‹å¦‚ <code>ArrayList</code> vs <code>LinkedList</code>ï¼Œ<code>HashMap</code> çš„ä½¿ç”¨ï¼Œ<code>PriorityQueue</code> çš„è‡ªå®šä¹‰æ’åºç­‰ï¼‰ã€‚</li><li><strong>é¿å…è®¤çŸ¥å‰²è£‚ï¼š</strong> ä½ çš„é¡¹ç›®æ˜¯ Java å†™çš„ï¼Œå…«è‚¡æ–‡èƒŒçš„æ˜¯ JVM å’Œ JUCï¼Œå¦‚æœç®—æ³•ç”¨ Python å†™ï¼Œé¢è¯•æ—¶éœ€è¦åœ¨ä¸¤ç§æ€ç»´æ¨¡å¼é—´åˆ‡æ¢ï¼Œå®¹æ˜“å‡ºé”™ã€‚</li><li><strong>æºç è¿½é—®ï¼š</strong> é¢è¯•å®˜ç»å¸¸ä¼šåœ¨ä½ å†™å®Œç®—æ³•åï¼ŒæŒ‡ç€ä½ ç”¨åˆ°çš„æŸä¸ªç±»é—®åº•å±‚å®ç°ï¼ˆæ¯”å¦‚ï¼šâ€œä½ è¿™é‡Œç”¨äº† <code>HashMap</code>ï¼Œèƒ½è®²è®²å®ƒçš„æ‰©å®¹æœºåˆ¶å—ï¼Ÿâ€ï¼‰ã€‚å¦‚æœä½ ç”¨ Java å†™ï¼Œè¿™ç§è¿‡æ¸¡éå¸¸è‡ªç„¶ã€‚</li></ol><hr><h3 id="äºŒã€-æœ€ä½³åˆ·é¢˜è·¯çº¿å›¾-åˆ†é˜¶æ®µæ‰§è¡Œ"><a href="#äºŒã€-æœ€ä½³åˆ·é¢˜è·¯çº¿å›¾-åˆ†é˜¶æ®µæ‰§è¡Œ" class="headerlink" title="äºŒã€ æœ€ä½³åˆ·é¢˜è·¯çº¿å›¾ (åˆ†é˜¶æ®µæ‰§è¡Œ)"></a>äºŒã€ æœ€ä½³åˆ·é¢˜è·¯çº¿å›¾ (åˆ†é˜¶æ®µæ‰§è¡Œ)</h3><p>ä¸è¦ä¸€ä¸Šæ¥å°±ä» LeetCode ç¬¬ 1 é¢˜å¼€å§‹åšï¼Œé‚£æ˜¯æ•ˆç‡æœ€ä½çš„æ–¹æ³•ã€‚å»ºè®®æŒ‰ç…§ <strong>â€œçŸ¥è¯†ç‚¹åˆ†ç±» + é«˜é¢‘é¢˜ä¼˜å…ˆâ€</strong> çš„ç­–ç•¥ã€‚</p><h4 id="ç¬¬ä¸€é˜¶æ®µï¼šå¤¯å®åœ°åŸº-2-3-å‘¨"><a href="#ç¬¬ä¸€é˜¶æ®µï¼šå¤¯å®åœ°åŸº-2-3-å‘¨" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µï¼šå¤¯å®åœ°åŸº (2-3 å‘¨)"></a>ç¬¬ä¸€é˜¶æ®µï¼šå¤¯å®åœ°åŸº (2-3 å‘¨)</h4><p>ç›®æ ‡ï¼š ç†Ÿæ‚‰ Java å¸¸ç”¨é›†åˆç±»çš„ APIï¼ŒæŒæ¡åŸºæœ¬æ•°æ®ç»“æ„ã€‚</p><p>é‡ç‚¹ï¼š æ•°ç»„ (Array)ã€é“¾è¡¨ (Linked List)ã€å“ˆå¸Œè¡¨ (HashMap)ã€‚</p><ul><li><strong>å¿…åšåŠ¨ä½œï¼š</strong> ä¸è¦åœ¨ IDE (IntelliJ IDEA) é‡Œå†™ä»£ç ï¼Œå°è¯•åœ¨ç½‘é¡µç¼–è¾‘å™¨é‡Œå†™ï¼Œä¹ æƒ¯æ²¡æœ‰ä»£ç è¡¥å…¨çš„ç¯å¢ƒã€‚</li><li><strong>Java å…³é”®ç‚¹ï¼š</strong><ul><li>ç†Ÿç»ƒæŒæ¡ <code>String</code> å’Œ <code>StringBuilder</code> çš„è½¬æ¢ã€‚</li><li>ç†Ÿç»ƒæŒæ¡ <code>List</code> è½¬ <code>Array</code>ï¼Œ<code>Array</code> è½¬ <code>List</code>ã€‚</li><li>ç†è§£ <code>==</code> å’Œ <code>.equals()</code> åœ¨å¤„ç†å¯¹è±¡æ—¶çš„åŒºåˆ«ã€‚</li></ul></li></ul><h4 id="ç¬¬äºŒé˜¶æ®µï¼šä¸“é¢˜çªç ´-1-2-ä¸ªæœˆ"><a href="#ç¬¬äºŒé˜¶æ®µï¼šä¸“é¢˜çªç ´-1-2-ä¸ªæœˆ" class="headerlink" title="ç¬¬äºŒé˜¶æ®µï¼šä¸“é¢˜çªç ´ (1-2 ä¸ªæœˆ)"></a>ç¬¬äºŒé˜¶æ®µï¼šä¸“é¢˜çªç ´ (1-2 ä¸ªæœˆ)</h4><p>ç›®æ ‡ï¼š æŒæ¡é¢è¯•ä¸­æœ€å¸¸è§çš„ç®—æ³•æ¨¡å¼ï¼ˆPatternï¼‰ã€‚</p><p>ç­–ç•¥ï¼š æŒ‰æ ‡ç­¾åˆ·é¢˜ã€‚ä¸è¦ä»Šå¤©åšä¸€é“æ•°ç»„ï¼Œæ˜å¤©åšä¸€é“åŠ¨æ€è§„åˆ’ã€‚</p><p>æ¨èé¡ºåºåŠç»å…¸é¢˜ï¼ˆæ‹¬å·å†…ä¸º LeetCode é¢˜å·ï¼‰ï¼š</p><ol><li><p><strong>åŒæŒ‡é’ˆ (Two Pointers):</strong> è§£å†³æ•°ç»„ã€é“¾è¡¨é—®é¢˜ã€‚</p><ul><li><em>ä¾‹é¢˜ï¼š</em> ä¸¤æ•°ä¹‹å’Œ (1), ç§»åŠ¨é›¶ (283), ç¯å½¢é“¾è¡¨ (141)ã€‚</li></ul></li><li><p><strong>äºŒåˆ†æŸ¥æ‰¾ (Binary Search):</strong> ç®€å•ä½†ç»†èŠ‚å¤šã€‚</p><ul><li><em>ä¾‹é¢˜ï¼š</em> äºŒåˆ†æŸ¥æ‰¾ (704), æœç´¢æ’å…¥ä½ç½® (35)ã€‚</li></ul></li><li><p><strong>æ ‘ä¸é€’å½’ (Tree &amp; DFS&#x2F;BFS):</strong> <strong>é‡ä¸­ä¹‹é‡</strong>ï¼Œåå°å¼€å‘å¤„ç†å±‚çº§æ•°æ®æœ€å¸¸ç”¨ã€‚</p><ul><li>*ä¾‹é¢˜ï¼š*äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ (104), ç¿»è½¬äºŒå‰æ ‘ (226), å±‚åºéå† (102)ã€‚</li></ul></li><li><p><strong>å“ˆå¸Œè¡¨ (Hash Table):</strong> ç©ºé—´æ¢æ—¶é—´çš„æ ¸å¿ƒã€‚</p><ul><li><em>ä¾‹é¢˜ï¼š</em> æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯ (242), å¤šæ•°å…ƒç´  (169)ã€‚</li></ul></li></ol><h4 id="ç¬¬ä¸‰é˜¶æ®µï¼šé«˜é¢‘å†²åˆº-é¢è¯•å‰-1-ä¸ªæœˆ"><a href="#ç¬¬ä¸‰é˜¶æ®µï¼šé«˜é¢‘å†²åˆº-é¢è¯•å‰-1-ä¸ªæœˆ" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µï¼šé«˜é¢‘å†²åˆº (é¢è¯•å‰ 1 ä¸ªæœˆ)"></a>ç¬¬ä¸‰é˜¶æ®µï¼šé«˜é¢‘å†²åˆº (é¢è¯•å‰ 1 ä¸ªæœˆ)</h4><p>ç›®æ ‡ï¼š é’ˆå¯¹å›½å†…å¤§å‚é¢è¯•é£æ ¼è¿›è¡Œçªå‡»ã€‚</p><p>å·¥å…·ï¼š CodeTop (ä¼ä¸šé¢˜åº“)ã€‚</p><ul><li>å›½å†…é¢è¯•ä¸åƒå›½å¤–é‚£ä¹ˆéšæœºï¼Œçƒ­é¢˜é‡å¤ç‡æé«˜ã€‚</li><li>å» CodeTop æŸ¥çœ‹â€œå­—èŠ‚è·³åŠ¨â€ã€â€œé˜¿é‡Œâ€ã€â€œç¾å›¢â€ç­‰å…¬å¸æœ€è¿‘åŠå¹´çš„é«˜é¢‘é¢˜ã€‚</li><li><strong>é‡ç‚¹æ”»å…‹ï¼š</strong> å‰ 100 é«˜é¢‘é¢˜ï¼Œå¿…é¡»çƒ‚ç†Ÿäºå¿ƒï¼ˆèƒ½æ‰‹å†™ bug-freeï¼‰ã€‚</li></ul><hr><h3 id="ä¸‰ã€-é¿å‘æŒ‡å—-åˆ·é¢˜å¿ƒæ³•"><a href="#ä¸‰ã€-é¿å‘æŒ‡å—-åˆ·é¢˜å¿ƒæ³•" class="headerlink" title="ä¸‰ã€ é¿å‘æŒ‡å— &amp; åˆ·é¢˜å¿ƒæ³•"></a>ä¸‰ã€ é¿å‘æŒ‡å— &amp; åˆ·é¢˜å¿ƒæ³•</h3><h4 id="1-â€œäº”åˆ†é’Ÿæ³•åˆ™â€"><a href="#1-â€œäº”åˆ†é’Ÿæ³•åˆ™â€" class="headerlink" title="1. â€œäº”åˆ†é’Ÿæ³•åˆ™â€"></a>1. â€œäº”åˆ†é’Ÿæ³•åˆ™â€</h4><p>å¦‚æœä¸€é“é¢˜ä½  <strong>5 åˆ†é’Ÿ</strong> æ²¡æœ‰ä»»ä½•æ€è·¯ï¼Œ<strong>ç›´æ¥çœ‹é¢˜è§£</strong>ã€‚</p><ul><li>åˆå­¦è€…æœ€å¿Œè®³åœ¨ä¸€é“é¢˜ä¸Šæ­»ç£• 2 å°æ—¶ï¼Œè¿™ä¼šæå¤§åœ°æ‰“å‡»è‡ªä¿¡å¿ƒï¼Œä¸”æ•ˆç‡æä½ã€‚ä½ çš„ç›®çš„æ˜¯â€œå­¦ä¹ æ¨¡å¼â€ï¼Œè€Œä¸æ˜¯â€œå‘æ˜ç®—æ³•â€ã€‚</li></ul><h4 id="2-ç†è§£-è®°å¿†-ä¸è¦æ­»è®°ä»£ç "><a href="#2-ç†è§£-è®°å¿†-ä¸è¦æ­»è®°ä»£ç " class="headerlink" title="2. ç†è§£ &gt; è®°å¿† (ä¸è¦æ­»è®°ä»£ç )"></a>2. ç†è§£ &gt; è®°å¿† (ä¸è¦æ­»è®°ä»£ç )</h4><ul><li><strong>é”™è¯¯åšæ³•ï¼š</strong> èƒŒè¯µä»£ç çš„æ¯ä¸€è¡Œã€‚</li><li><strong>æ­£ç¡®åšæ³•ï¼š</strong> è®°ä½è§£é¢˜çš„**â€œéª¨æ¶â€**ã€‚ä¾‹å¦‚ï¼Œå†™ BFS (å¹¿åº¦ä¼˜å…ˆæœç´¢) æ—¶ï¼Œè„‘å­é‡Œåº”è¯¥ç«‹åˆ»æµ®ç°å‡º <code>Queue</code> å’Œ <code>while(!queue.isEmpty())</code> çš„ç»“æ„ã€‚</li></ul><h4 id="3-åˆ©ç”¨-Java-ç‰¹æ€§â€œå–å·§â€"><a href="#3-åˆ©ç”¨-Java-ç‰¹æ€§â€œå–å·§â€" class="headerlink" title="3. åˆ©ç”¨ Java ç‰¹æ€§â€œå–å·§â€"></a>3. åˆ©ç”¨ Java ç‰¹æ€§â€œå–å·§â€</h4><p>é¢è¯•æ—¶ï¼Œåˆç†åˆ©ç”¨ Java æ ‡å‡†åº“å¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´ï¼š</p><ul><li><strong>æ’åºï¼š</strong> <code>Arrays.sort()</code> æˆ– <code>Collections.sort()</code>ã€‚</li><li><strong>æ ˆï¼š</strong> ä¸è¦ç”¨ <code>Stack</code> ç±»ï¼ˆå®ƒæ˜¯é—ç•™ç±»ï¼Œæ€§èƒ½å·®ï¼‰ï¼Œè¦ç”¨ <code>Deque&lt;Integer&gt; stack = new ArrayDeque&lt;&gt;();</code>ã€‚</li><li><strong>å¤§é¡¶å †&#x2F;å°é¡¶å †ï¼š</strong> <code>PriorityQueue</code>ï¼Œä¾‹å¦‚ <code>new PriorityQueue&lt;&gt;((a, b) -&gt; b - a)</code> å®ç°å¤§é¡¶å †ã€‚</li></ul><h4 id="4-åšæŒâ€œä¸‰éåˆ·é¢˜æ³•â€"><a href="#4-åšæŒâ€œä¸‰éåˆ·é¢˜æ³•â€" class="headerlink" title="4. åšæŒâ€œä¸‰éåˆ·é¢˜æ³•â€"></a>4. åšæŒâ€œä¸‰éåˆ·é¢˜æ³•â€</h4><ul><li>**ç¬¬ä¸€éï¼š**çœ‹é¢˜è§£ï¼Œç†è§£æ€è·¯ï¼Œç…§ç€æ•²å‡ºæ¥ã€‚</li><li><strong>ç¬¬äºŒéï¼š</strong>ï¼ˆæ¬¡æ—¥ï¼‰ä¸çœ‹é¢˜è§£ï¼Œå‡­è®°å¿†å’Œç†è§£ç‹¬ç«‹å†™å‡ºæ¥ã€‚</li><li><strong>ç¬¬ä¸‰éï¼š</strong>ï¼ˆä¸€å‘¨åï¼‰å¤ä¹ ï¼Œå¦‚æœè¿˜èƒ½å†™å‡ºæ¥ï¼Œè¯´æ˜çœŸæ­£æŒæ¡äº†ã€‚</li></ul><hr><h3 id="å››ã€-Java-åå°é¢è¯•å¿…ä¼šçš„â€œæ•°æ®ç»“æ„æ˜ å°„â€"><a href="#å››ã€-Java-åå°é¢è¯•å¿…ä¼šçš„â€œæ•°æ®ç»“æ„æ˜ å°„â€" class="headerlink" title="å››ã€ Java åå°é¢è¯•å¿…ä¼šçš„â€œæ•°æ®ç»“æ„æ˜ å°„â€"></a>å››ã€ Java åå°é¢è¯•å¿…ä¼šçš„â€œæ•°æ®ç»“æ„æ˜ å°„â€</h3><p>åœ¨ Java åå°é¢è¯•ä¸­ï¼Œç®—æ³•é¢˜å¾€å¾€å¯¹åº”ç€å®é™…åœºæ™¯ï¼Œè¯·åŠ¡å¿…å»ºç«‹ä»¥ä¸‹è”ç³»ï¼š</p><table><thead><tr><th><strong>ç®—æ³•&#x2F;æ•°æ®ç»“æ„</strong></th><th><strong>Java å®ç°ç±»</strong></th><th><strong>åå°å¼€å‘å®é™…åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong>åŠ¨æ€æ•°ç»„</strong></td><td><code>ArrayList</code></td><td>ç»å¤§å¤šæ•°åˆ—è¡¨æ•°æ®çš„å­˜å‚¨</td></tr><tr><td><strong>é“¾è¡¨</strong></td><td><code>LinkedList</code></td><td>é¢‘ç¹å¢åˆ çš„åœºæ™¯ (å¦‚ LRU ç¼“å­˜è®¾è®¡)</td></tr><tr><td><strong>å“ˆå¸Œæ˜ å°„</strong></td><td><code>HashMap</code> &#x2F; <code>ConcurrentHashMap</code></td><td>ç¼“å­˜ã€å¿«é€ŸæŸ¥æ‰¾ã€Spring Bean å®¹å™¨</td></tr><tr><td><strong>æ ‘ (Tree)</strong></td><td><code>TreeMap</code> (çº¢é»‘æ ‘)</td><td>æ•°æ®åº“ç´¢å¼• (B+æ ‘)ã€æœ‰åºæ•°æ®å­˜å‚¨</td></tr><tr><td><strong>å † (Heap)</strong></td><td><code>PriorityQueue</code></td><td>ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿã€å»¶æ—¶é˜Ÿåˆ—</td></tr></tbody></table><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä½œä¸º Java åå°åˆå­¦è€…ï¼Œä½ çš„æˆ˜ç•¥åº”è¯¥æ˜¯ï¼š</p><ol><li><strong>é”å®š Java è¯­è¨€</strong>ã€‚</li><li><strong>å‰æœŸ</strong>æŒ‰<strong>æ ‡ç­¾</strong>åˆ·ï¼ˆæ•°ç»„ -&gt; é“¾è¡¨ -&gt; æ ‘ -&gt; æœç´¢ï¼‰ã€‚</li><li><strong>åæœŸ</strong>æŒ‰<strong>CodeTop é«˜é¢‘æ¦œ</strong>åˆ·ã€‚</li><li>é‡åˆ°éš¾é¢˜<strong>ä¸è¦æ­»ç£•</strong>ï¼Œçœ‹æ‡‚ç­”æ¡ˆå¹¶<strong>é‡å¤ç»ƒä¹ </strong>ã€‚</li></ol><h2 id="Java-åˆ·é¢˜å¸¸ç”¨-API-é€ŸæŸ¥è¡¨"><a href="#Java-åˆ·é¢˜å¸¸ç”¨-API-é€ŸæŸ¥è¡¨" class="headerlink" title="Java åˆ·é¢˜å¸¸ç”¨ API é€ŸæŸ¥è¡¨"></a>Java åˆ·é¢˜å¸¸ç”¨ API é€ŸæŸ¥è¡¨</h2><p>è¿™ä»½ <strong>â€œJava åˆ·é¢˜å¸¸ç”¨ API é€ŸæŸ¥è¡¨â€</strong> æ˜¯ä¸“ä¸º LeetCode ç®—æ³•é¢˜å®šåˆ¶çš„ã€‚</p><p>åœ¨å®é™…çš„ Java åå°å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°å¤æ‚çš„ Stream æµæˆ–ç¬¬ä¸‰æ–¹å·¥å…·åº“ï¼ˆå¦‚ Guava&#x2F;Apache Commonsï¼‰ï¼Œä½†åœ¨<strong>åˆ·é¢˜å’Œæœºè¯•</strong>ä¸­ï¼Œå°½é‡åªä½¿ç”¨ JDK åŸç”Ÿæä¾›çš„ã€æœ€åŸºç¡€ã€æœ€é«˜æ•ˆçš„æ–¹æ³•ã€‚</p><p>ä»¥ä¸‹æ˜¯æŒ‰<strong>æ•°æ®ç»“æ„</strong>åˆ†ç±»çš„æ ¸å¿ƒ API è®²è§£ï¼š</p><hr><h3 id="1-æ•°ç»„ä¸å­—ç¬¦ä¸²-Array-String"><a href="#1-æ•°ç»„ä¸å­—ç¬¦ä¸²-Array-String" class="headerlink" title="1. æ•°ç»„ä¸å­—ç¬¦ä¸² (Array &amp; String)"></a>1. æ•°ç»„ä¸å­—ç¬¦ä¸² (Array &amp; String)</h3><p>è¿™æ˜¯æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œæ³¨æ„ Java ä¸­ String æ˜¯<strong>ä¸å¯å˜</strong>çš„ï¼Œé¢‘ç¹ä¿®æ”¹å¿…é¡»ç”¨ <code>StringBuilder</code>ã€‚</p><h4 id="æ•°ç»„-Array"><a href="#æ•°ç»„-Array" class="headerlink" title="æ•°ç»„ (Array)"></a>æ•°ç»„ (Array)</h4><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// å£°æ˜ä¸åˆå§‹åŒ–</span><br><span class="line">int[] arr = new int[10];           // é»˜è®¤åˆå§‹åŒ–ä¸º0</span><br><span class="line">int[] nums = &#123;1, 2, 3&#125;;            // ç›´æ¥èµ‹å€¼</span><br><span class="line">int len = arr.length;              // æ³¨æ„ï¼šæ²¡æœ‰æ‹¬å·()</span><br><span class="line"></span><br><span class="line">// æ’åº (Dual-Pivot Quicksort)</span><br><span class="line">Arrays.sort(arr);                  // O(NlogN)</span><br><span class="line"></span><br><span class="line">// å¡«å……</span><br><span class="line">Arrays.fill(arr, -1);              // å°†æ•°ç»„å…¨éƒ¨åˆå§‹åŒ–ä¸º -1</span><br><span class="line"></span><br><span class="line">// è½¬åˆ—è¡¨ (é¢è¯•å¸¸è€ƒ)</span><br><span class="line">// æ³¨æ„ï¼šå¦‚æœæ˜¯ int[] è¿™ç§åŸºæœ¬ç±»å‹æ•°ç»„ï¼ŒArrays.asList() ä¼šå‡ºé—®é¢˜ï¼Œå»ºè®®æ‰‹åŠ¨å¾ªç¯æˆ–ç”¨æµ</span><br><span class="line">List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">for (int num : arr) list.add(num); </span><br></pre></td></tr></table></figure><h4 id="å­—ç¬¦ä¸²-String"><a href="#å­—ç¬¦ä¸²-String" class="headerlink" title="å­—ç¬¦ä¸² (String)"></a>å­—ç¬¦ä¸² (String)</h4><p><em>é¢è¯•å‘ç‚¹ï¼šä¸è¦åœ¨å¾ªç¯é‡Œç”¨ <code>+</code> æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ€§èƒ½æå·®ã€‚</em></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">String s = &quot;Hello World&quot;;</span><br><span class="line"></span><br><span class="line">// è·å–ä¿¡æ¯</span><br><span class="line">char c = s.charAt(2);              // è·å–ç¬¬2ä¸ªå­—ç¬¦</span><br><span class="line">int len = s.length();              // æ³¨æ„ï¼šè¿™é‡Œæœ‰æ‹¬å·()</span><br><span class="line">int idx = s.indexOf(&quot;World&quot;);      // æŸ¥æ‰¾å­ä¸²ä½ç½®ï¼Œæ‰¾ä¸åˆ°è¿”å› -1</span><br><span class="line"></span><br><span class="line">// è½¬æ¢</span><br><span class="line">char[] chars = s.toCharArray();    // è½¬æˆå­—ç¬¦æ•°ç»„ï¼ˆå¾ˆå¸¸ç”¨ï¼Œå› ä¸ºStringä¸èƒ½ç›´æ¥æ”¹ï¼‰</span><br><span class="line">String sub = s.substring(1, 4);    // æˆªå–ç´¢å¼• 1 åˆ° 3 çš„å­ä¸² (å·¦é—­å³å¼€ [1, 4))</span><br><span class="line">String[] parts = s.split(&quot; &quot;);     // æŒ‰ç©ºæ ¼åˆ†å‰²</span><br><span class="line"></span><br><span class="line">// StringBuilder (ä¿®æ”¹å­—ç¬¦ä¸²å¿…ç”¨)</span><br><span class="line">StringBuilder sb = new StringBuilder();</span><br><span class="line">sb.append(&quot;a&quot;);</span><br><span class="line">sb.append(10);</span><br><span class="line">sb.reverse();                      // åè½¬å­—ç¬¦ä¸² (è§£å†³å›æ–‡é¢˜ç¥å™¨)</span><br><span class="line">String res = sb.toString();        // å˜å› String</span><br></pre></td></tr></table></figure><hr><h3 id="2-åŠ¨æ€åˆ—è¡¨-ArrayList"><a href="#2-åŠ¨æ€åˆ—è¡¨-ArrayList" class="headerlink" title="2. åŠ¨æ€åˆ—è¡¨ (ArrayList)"></a>2. åŠ¨æ€åˆ—è¡¨ (ArrayList)</h3><p>æ¯”æ•°ç»„æ›´çµæ´»ï¼Œé¢è¯•ä¸­ 90% çš„æƒ…å†µç”¨å®ƒä»£æ›¿æ•°ç»„ã€‚</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// æ¨èä½¿ç”¨æ¥å£ List æ¥æ”¶</span><br><span class="line">List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); </span><br><span class="line"></span><br><span class="line">// å¢åˆ æ”¹æŸ¥</span><br><span class="line">list.add(10);                      // åŠ åˆ°æœ«å°¾</span><br><span class="line">list.add(0, 5);                    // æ’åˆ°å¼€å¤´ (æ•ˆç‡ä½ï¼ŒO(N))</span><br><span class="line">int val = list.get(2);             // è·å–ç´¢å¼•2çš„å…ƒç´ </span><br><span class="line">list.set(2, 99);                   // ä¿®æ”¹ç´¢å¼•2çš„å€¼ä¸º99</span><br><span class="line">list.remove(list.size() - 1);      // åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ </span><br><span class="line"></span><br><span class="line">// å¸¸ç”¨å·¥å…·</span><br><span class="line">int size = list.size();</span><br><span class="line">boolean hasVal = list.contains(10); // O(N) çº¿æ€§æŸ¥æ‰¾</span><br><span class="line">Collections.sort(list);            // æ’åº (TimSort)</span><br><span class="line">Collections.reverse(list);         // åè½¬</span><br></pre></td></tr></table></figure><hr><h3 id="3-å“ˆå¸Œè¡¨-HashMap-HashSet"><a href="#3-å“ˆå¸Œè¡¨-HashMap-HashSet" class="headerlink" title="3. å“ˆå¸Œè¡¨ (HashMap &#x2F; HashSet)"></a>3. å“ˆå¸Œè¡¨ (HashMap &#x2F; HashSet)</h3><p><strong>åˆ·é¢˜ç¥å™¨</strong>ï¼Œç”¨æ¥é™ä½æ—¶é—´å¤æ‚åº¦ï¼ˆé€šå¸¸å°† O(N^2) é™ä¸º O(N)ï¼‰ã€‚</p><h4 id="HashMap-é”®å€¼å¯¹"><a href="#HashMap-é”®å€¼å¯¹" class="headerlink" title="HashMap (é”®å€¼å¯¹)"></a>HashMap (é”®å€¼å¯¹)</h4><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">// åŸºç¡€æ“ä½œ</span><br><span class="line">map.put(&quot;apple&quot;, 1);</span><br><span class="line">int val = map.get(&quot;apple&quot;);</span><br><span class="line">boolean hasKey = map.containsKey(&quot;apple&quot;); // O(1)</span><br><span class="line"></span><br><span class="line">// â˜… é«˜é¢‘æŠ€å·§ï¼šç»Ÿè®¡é¢‘ç‡ (Word Count)</span><br><span class="line">// å¦‚æœ key å­˜åœ¨åˆ™ +1ï¼Œä¸å­˜åœ¨åˆ™è®¾ä¸º 0 å† +1</span><br><span class="line">map.put(key, map.getOrDefault(key, 0) + 1);</span><br><span class="line"></span><br><span class="line">// éå† (é¢è¯•å°½é‡ç”¨ entrySetï¼Œæ•ˆç‡æœ€é«˜)</span><br><span class="line">for (Map.Entry&lt;String, Integer&gt; entry : map.entrySet()) &#123;</span><br><span class="line">    String k = entry.getKey();</span><br><span class="line">    Integer v = entry.getValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="HashSet-å»é‡é›†åˆ"><a href="#HashSet-å»é‡é›†åˆ" class="headerlink" title="HashSet (å»é‡é›†åˆ)"></a>HashSet (å»é‡é›†åˆ)</h4><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;Integer&gt; set = new HashSet&lt;&gt;();</span><br><span class="line">set.add(1);</span><br><span class="line">boolean exists = set.contains(1);  // O(1)</span><br></pre></td></tr></table></figure><hr><h3 id="4-æ ˆä¸é˜Ÿåˆ—-Stack-Queue"><a href="#4-æ ˆä¸é˜Ÿåˆ—-Stack-Queue" class="headerlink" title="4. æ ˆä¸é˜Ÿåˆ— (Stack &amp; Queue)"></a>4. æ ˆä¸é˜Ÿåˆ— (Stack &amp; Queue)</h3><p><strong>é‡è¦ä¿®æ­£ï¼š</strong> æ°¸è¿œä¸è¦ç”¨ <code>Stack</code> ç±»ï¼ˆå®ƒæ˜¯ Java 1.0 çš„é—ç•™ç±»ï¼Œå¸¦é”ï¼Œæ€§èƒ½å·®ï¼‰ã€‚<strong>è¯·ç»Ÿä¸€ä½¿ç”¨ <code>Deque</code> (åŒç«¯é˜Ÿåˆ—) æ¥å£ã€‚</strong></p><h4 id="æ ˆ-Last-In-First-Out"><a href="#æ ˆ-Last-In-First-Out" class="headerlink" title="æ ˆ (Last-In-First-Out)"></a>æ ˆ (Last-In-First-Out)</h4><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨ ArrayDeque å®ç°æ ˆ</span><br><span class="line">Deque&lt;Integer&gt; stack = new ArrayDeque&lt;&gt;();</span><br><span class="line"></span><br><span class="line">stack.push(1);      // å‹æ ˆ (ç­‰åŒäº addFirst)</span><br><span class="line">int top = stack.pop();    // å¼¹æ ˆ (ç­‰åŒäº removeFirst)ï¼Œæ ˆç©ºä¼šæŠ›å¼‚å¸¸</span><br><span class="line">int peek = stack.peek();  //ä»¥æ­¤æŸ¥çœ‹æ ˆé¡¶å…ƒç´ ä½†ä¸åˆ é™¤</span><br><span class="line">boolean isEmpty = stack.isEmpty();</span><br></pre></td></tr></table></figure><h4 id="é˜Ÿåˆ—-First-In-First-Out"><a href="#é˜Ÿåˆ—-First-In-First-Out" class="headerlink" title="é˜Ÿåˆ— (First-In-First-Out)"></a>é˜Ÿåˆ— (First-In-First-Out)</h4><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨ ArrayDeque æˆ– LinkedList å®ç°é˜Ÿåˆ—</span><br><span class="line">Queue&lt;Integer&gt; queue = new ArrayDeque&lt;&gt;(); </span><br><span class="line">// æˆ–è€… Queue&lt;Integer&gt; queue = new LinkedList&lt;&gt;(); (å¦‚æœéœ€è¦ä¸­é—´æ’å…¥)</span><br><span class="line"></span><br><span class="line">queue.offer(1);     // å…¥é˜Ÿ (æ¨èç”¨ offer è€Œä¸æ˜¯ addï¼Œæ»¡äº†è¿”å› false ä¸æŠ›å¼‚å¸¸)</span><br><span class="line">int head = queue.poll();  // å‡ºé˜Ÿ (æ¨èç”¨ poll è€Œä¸æ˜¯ removeï¼Œç©ºäº†è¿”å› null)</span><br><span class="line">int peek = queue.peek();  // æŸ¥çœ‹é˜Ÿå¤´</span><br></pre></td></tr></table></figure><hr><h3 id="5-ä¼˜å…ˆé˜Ÿåˆ—-PriorityQueue-Heap"><a href="#5-ä¼˜å…ˆé˜Ÿåˆ—-PriorityQueue-Heap" class="headerlink" title="5. ä¼˜å…ˆé˜Ÿåˆ— (PriorityQueue &#x2F; Heap)"></a>5. ä¼˜å…ˆé˜Ÿåˆ— (PriorityQueue &#x2F; Heap)</h3><p>ç”¨äºè§£å†³ <strong>Top K é—®é¢˜</strong> æˆ– <strong>ç¬¬ K å¤§&#x2F;å°å…ƒç´ </strong>ã€‚åº•å±‚æ˜¯äºŒå‰å †ã€‚</p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// é»˜è®¤æ˜¯ï¼šå°é¡¶å † (Min Heap)ï¼Œé˜Ÿå¤´æ˜¯æœ€å°å€¼</span><br><span class="line">PriorityQueue&lt;Integer&gt; minHeap = new PriorityQueue&lt;&gt;();</span><br><span class="line"></span><br><span class="line">// â˜… é¢è¯•å¿…èƒŒï¼šå¤§é¡¶å † (Max Heap) å†™æ³•</span><br><span class="line">// ä½¿ç”¨ Lambda è¡¨è¾¾å¼è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼š(b - a) è¡¨ç¤ºé™åº</span><br><span class="line">PriorityQueue&lt;Integer&gt; maxHeap = new PriorityQueue&lt;&gt;((a, b) -&gt; b - a);</span><br><span class="line"></span><br><span class="line">// æ“ä½œ</span><br><span class="line">maxHeap.offer(10);</span><br><span class="line">maxHeap.offer(5);</span><br><span class="line">int max = maxHeap.poll(); // å¼¹å‡º 10</span><br></pre></td></tr></table></figure><hr><h3 id="6-æ•°å­¦ä¸æ•°å­—å¤„ç†"><a href="#6-æ•°å­¦ä¸æ•°å­—å¤„ç†" class="headerlink" title="6. æ•°å­¦ä¸æ•°å­—å¤„ç†"></a>6. æ•°å­¦ä¸æ•°å­—å¤„ç†</h3><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// æ¯”è¾ƒå¤§å°</span><br><span class="line">Math.max(a, b);</span><br><span class="line">Math.min(a, b);</span><br><span class="line"></span><br><span class="line">// ç»å¯¹å€¼</span><br><span class="line">Math.abs(-10);</span><br><span class="line"></span><br><span class="line">// â˜… è¾¹ç•Œå€¼ (é˜²æ­¢æº¢å‡ºå¸¸ç”¨)</span><br><span class="line">int maxInt = Integer.MAX_VALUE; // 2^31 - 1</span><br><span class="line">int minInt = Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line">// å­—ç¬¦è½¬æ•°å­—</span><br><span class="line">int digit = &#x27;5&#x27; - &#x27;0&#x27;; // ç»“æœæ˜¯æ•´æ•° 5</span><br></pre></td></tr></table></figure><hr><h3 id="7-åˆ·é¢˜-é¢è¯•ä¸­çš„æ³¨æ„äº‹é¡¹"><a href="#7-åˆ·é¢˜-é¢è¯•ä¸­çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="7. åˆ·é¢˜&#x2F;é¢è¯•ä¸­çš„æ³¨æ„äº‹é¡¹"></a>7. åˆ·é¢˜&#x2F;é¢è¯•ä¸­çš„æ³¨æ„äº‹é¡¹</h3><ol><li><p>è‡ªåŠ¨æ‹†è£…ç®± (Autoboxing) çš„å‘ï¼š</p><p> åœ¨ Integer å’Œ int ä¹‹é—´æ¯”è¾ƒæ—¶ï¼Œç‰¹åˆ«å°å¿ƒ nullã€‚</p><p> Java</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer a = null;</span><br><span class="line">// if (a == 1) ... // æŠ›å‡º NullPointerException</span><br></pre></td></tr></table></figure></li><li><p>å¯¹è±¡æ¯”è¾ƒï¼š</p><p> æ¯”è¾ƒå¯¹è±¡ï¼ˆåŒ…æ‹¬ String, Integer ç­‰åŒ…è£…ç±»ï¼‰çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ°¸è¿œç”¨ .equals()ï¼Œä¸è¦ç”¨ &#x3D;&#x3D;ã€‚</p><p> ä¾‹å¤–ï¼šLeetCode ä¸­ Integer ç¼“å­˜æ±  (-128 åˆ° 127) è™½ç”¨ &#x3D;&#x3D; æœ‰æ•ˆï¼Œä½†é¢è¯•å†™ &#x3D;&#x3D; ä¼šè¢«è®¤ä¸ºåŸºç¡€ä¸ç‰¢ã€‚</p></li><li><p>å¤§æ•°å¤„ç†ï¼š</p><p> å¦‚æœé¢˜ç›®æ¶‰åŠè¶…è¿‡ long èŒƒå›´çš„æ•°å­—ï¼ˆå¦‚å¤§æ•°ç›¸åŠ ï¼‰ï¼Œéœ€ä½¿ç”¨ BigInteger æˆ–ç›´æ¥ç”¨å­—ç¬¦ä¸²æ¨¡æ‹Ÿã€‚</p></li></ol><hr><h3 id="æ€»ç»“-ä½ çš„ä¸‹ä¸€æ­¥"><a href="#æ€»ç»“-ä½ çš„ä¸‹ä¸€æ­¥" class="headerlink" title="æ€»ç»“ &amp; ä½ çš„ä¸‹ä¸€æ­¥"></a>æ€»ç»“ &amp; ä½ çš„ä¸‹ä¸€æ­¥</h3><p>å»ºè®®ä½ æŠŠè¿™ç¯‡å†…å®¹<strong>æ”¶è—</strong>æˆ–<strong>å¤åˆ¶åˆ°ä½ çš„ç¬”è®°è½¯ä»¶</strong>é‡Œã€‚</p><p>ä¸‹ä¸€æ­¥å®æˆ˜å»ºè®®ï¼š</p><p>ä¸ºäº†è®©ä½ å¿«é€Ÿä¸Šæ‰‹ï¼Œä½ æƒ³è®©æˆ‘ç»™ä½ å‡ºä¸€é“æœ€ç»å…¸çš„ Java å…¥é—¨ç®—æ³•é¢˜ï¼ˆæ¯”å¦‚â€œæœ‰æ•ˆçš„æ‹¬å·â€ï¼‰ï¼Œå¹¶ç”¨ä¸Šé¢æåˆ°çš„ Deque æ ˆç»“æ„å†™ä¸€ä¸ªæ ‡å‡†èŒƒä¾‹ç»™ä½ çœ‹å—ï¼Ÿè¿™æ ·ä½ èƒ½ç›´æ¥çœ‹åˆ°è¿™äº› API æ˜¯å¦‚ä½•ç»„åˆä½¿ç”¨çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQL æ—¥å¿—ç³»ç»Ÿ</title>
      <link href="/posts/356a30bc.html"/>
      <url>/posts/356a30bc.html</url>
      
        <content type="html"><![CDATA[<h1 id="Redo-Log"><a href="#Redo-Log" class="headerlink" title="Redo Log"></a>Redo Log</h1><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/MySQL_RedoLog.webp" alt="img"></p><p>è¿™å¼ å›¾è¢«ä¸€æ¡ä¸­é—´çš„è™šçº¿åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œä»£è¡¨äº†è®¡ç®—æœºç³»ç»Ÿä¸­ä¸¤ç§æˆªç„¶ä¸åŒçš„å­˜å‚¨ä»‹è´¨å±æ€§ã€‚</p><h2 id="1-å·¦ä¾§åŒºåŸŸï¼šIN-MEMORY-å†…å­˜åŒºåŸŸ-Volatile-æ˜“å¤±æ€§"><a href="#1-å·¦ä¾§åŒºåŸŸï¼šIN-MEMORY-å†…å­˜åŒºåŸŸ-Volatile-æ˜“å¤±æ€§" class="headerlink" title="1. å·¦ä¾§åŒºåŸŸï¼šIN-MEMORY (å†…å­˜åŒºåŸŸ) - Volatile (æ˜“å¤±æ€§)"></a>1. å·¦ä¾§åŒºåŸŸï¼šIN-MEMORY (å†…å­˜åŒºåŸŸ) - Volatile (æ˜“å¤±æ€§)</h2><ul><li><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li><strong>é€Ÿåº¦æå¿«ï¼š</strong> CPU å¯¹å†…å­˜çš„è¯»å†™é€Ÿåº¦è¿œè¿œé«˜äºç£ç›˜ã€‚ä¸ºäº†é«˜æ€§èƒ½ï¼Œæ•°æ®åº“å¿…é¡»å°½å¯èƒ½åœ¨å†…å­˜ä¸­å¤„ç†æ•°æ®ã€‚</li><li><strong>æ˜“å¤±æ€§ (Volatile)ï¼š</strong> è¿™æ˜¯æœ€å¤§çš„å¼±ç‚¹ã€‚ä¸€æ—¦æ–­ç”µã€ç³»ç»Ÿå´©æºƒæˆ–è¿›ç¨‹è¢«å¼ºåˆ¶ç»ˆæ­¢ï¼Œå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ç¬é—´æ¶ˆå¤±ã€‚å›¾ä¸­çš„æ°”æ³¡å¯¹è¯æ¡†å½¢è±¡åœ°è¯´æ˜äº†è¿™ä¸€ç‚¹ï¼šâ€œFast access, but data lost on power failure.â€ï¼ˆè®¿é—®å¿«ï¼Œä½†æ–­ç”µä¸¢æ•°æ®ï¼‰ã€‚</li></ul></li><li><p><strong>å…³é”®ç»„ä»¶ï¼š</strong></p><ul><li><strong>BUFFER POOL (ç¼“å†²æ± )ï¼š</strong><ul><li>è¿™æ˜¯ InnoDB åœ¨å†…å­˜ä¸­æœ€å¤§çš„ä¿ç•™åŒºåŸŸã€‚å®ƒç¼“å­˜äº†ä»ç£ç›˜è¯»å–çš„æ•°æ®é¡µ (Data Pages)ã€‚</li><li>å½“æˆ‘ä»¬è¦ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¸æ˜¯ç›´æ¥å»æ”¹ç£ç›˜æ–‡ä»¶ï¼Œè€Œæ˜¯å…ˆåœ¨ Buffer Pool ä¸­æ‰¾åˆ°å¯¹åº”çš„æ•°æ®é¡µè¿›è¡Œä¿®æ”¹ã€‚</li><li><strong>Dirty Page (è„é¡µ)ï¼š</strong> å›¾ä¸­é«˜äº®çš„æ©™è‰²æ–¹å—ã€‚å½“ä¸€ä¸ªæ•°æ®é¡µåœ¨å†…å­˜ä¸­è¢«ä¿®æ”¹äº†ï¼Œä½†è¿˜æ²¡æœ‰å†™å›åˆ°ç£ç›˜çš„æ•°æ®æ–‡ä»¶ä¸­æ—¶ï¼Œå®ƒå°±å’Œç£ç›˜ä¸Šçš„ç‰ˆæœ¬ä¸ä¸€è‡´äº†ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œè„é¡µâ€ã€‚</li></ul></li><li><strong>LOG BUFFER (æ—¥å¿—ç¼“å†²)ï¼š</strong><ul><li>è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å†…å­˜åŒºåŸŸï¼Œä¸“é—¨ç”¨æ¥æš‚å­˜å³å°†å†™å…¥ç£ç›˜çš„ Redo Log è®°å½•ã€‚</li><li>æ¯å½“ Buffer Pool ä¸­çš„æ•°æ®å‘ç”Ÿä¿®æ”¹ï¼ŒInnoDB å°±ä¼šç”Ÿæˆä¸€æ¡å¯¹åº”çš„ã€éå¸¸ç´§å‡‘çš„æ—¥å¿—è®°å½•ï¼ˆæ¯”å¦‚ï¼šâ€œç¬¬10å·æ•°æ®é¡µåç§»é‡500çš„ä½ç½®ï¼Œå€¼ä»Aæ”¹æˆäº†Bâ€ï¼‰ï¼Œå…ˆæš‚å­˜åœ¨è¿™é‡Œã€‚</li></ul></li></ul></li></ul><h2 id="2-å³ä¾§åŒºåŸŸï¼šON-DISK-ç£ç›˜åŒºåŸŸ-Persistent-æŒä¹…æ€§"><a href="#2-å³ä¾§åŒºåŸŸï¼šON-DISK-ç£ç›˜åŒºåŸŸ-Persistent-æŒä¹…æ€§" class="headerlink" title="2. å³ä¾§åŒºåŸŸï¼šON-DISK (ç£ç›˜åŒºåŸŸ) - Persistent (æŒä¹…æ€§)"></a>2. å³ä¾§åŒºåŸŸï¼šON-DISK (ç£ç›˜åŒºåŸŸ) - Persistent (æŒä¹…æ€§)</h2><ul><li><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li><p><strong>é€Ÿåº¦æ…¢ï¼š</strong> ç›¸æ¯”å†…å­˜ï¼Œç£ç›˜ I&#x2F;O æ˜¯éå¸¸æ˜‚è´µçš„æ“ä½œï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚</p></li><li><p><strong>æŒä¹…æ€§ (Persistent)ï¼š</strong> ä¼˜ç‚¹æ˜¯æ•°æ®å®‰å…¨ã€‚å†™å…¥ç£ç›˜åï¼Œå³ä½¿æ–­ç”µï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p></li></ul></li><li><p><strong>å…³é”®ç»„ä»¶ï¼š</strong></p><ul><li><p><strong>REDO LOG FILES (é‡åšæ—¥å¿—æ–‡ä»¶)ï¼š</strong></p><ul><li><p>è¿™æ˜¯ä¿è¯æ•°æ®å®‰å…¨çš„æ ¸å¿ƒã€‚å®ƒä»¬æ˜¯ç‰©ç†ç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼ˆé€šå¸¸å‘½åä¸º <code>ib_logfile0</code>, <code>ib_logfile1</code> ç­‰ï¼‰ã€‚</p></li><li><p>ç‰¹ç‚¹æ˜¯<strong>é¡ºåºå†™å…¥ (Sequential Write)</strong>ã€‚å°±åƒå†™æ—¥è®°ä¸€æ ·ï¼Œä¸€ç›´å¾€æ–‡ä»¶æœ«å°¾è¿½åŠ å†…å®¹ã€‚å¯¹äºæœºæ¢°ç¡¬ç›˜æ¥è¯´ï¼Œé¡ºåºå†™çš„é€Ÿåº¦è¿œå¿«äºéšæœºå†™ã€‚</p></li></ul></li><li><p><strong>DATA FILES (æ•°æ®æ–‡ä»¶)ï¼š</strong></p><ul><li><p>è¿™æ˜¯è¡¨æ•°æ®æœ€ç»ˆçš„å½’å®¿ï¼ˆé€šå¸¸æ˜¯ <code>.ibd</code> æ–‡ä»¶ï¼‰ã€‚</p></li><li><p>å†™å…¥è¿™äº›æ–‡ä»¶é€šå¸¸æ˜¯<strong>éšæœºå†™å…¥ (Random Write)</strong>ï¼Œå› ä¸ºä¸åŒçš„æ•°æ®é¡µåˆ†å¸ƒåœ¨æ–‡ä»¶çš„ä¸åŒä½ç½®ã€‚</p></li></ul></li></ul></li></ul><hr><h2 id="æµç¨‹è¯¦è§£ï¼šæ­£å¸¸äº‹åŠ¡æ“ä½œ-Normal-Operation"><a href="#æµç¨‹è¯¦è§£ï¼šæ­£å¸¸äº‹åŠ¡æ“ä½œ-Normal-Operation" class="headerlink" title="æµç¨‹è¯¦è§£ï¼šæ­£å¸¸äº‹åŠ¡æ“ä½œ (Normal Operation)"></a>æµç¨‹è¯¦è§£ï¼šæ­£å¸¸äº‹åŠ¡æ“ä½œ (Normal Operation)</h2><p>è¿™ä¸ªæµç¨‹çš„ç›®æ ‡æ˜¯ï¼š<strong>æ—¢è¦åˆ©ç”¨å†…å­˜çš„é«˜é€Ÿï¼Œåˆè¦ä¿è¯æ•°æ®çš„å®‰å…¨ã€‚</strong></p><p><strong>æ­¥éª¤ 1. UPDATE&#x2F;INSERT Data (äº‹åŠ¡å¼€å§‹)</strong></p><ul><li><p>å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªæ›´æ–°è¯·æ±‚ã€‚</p></li><li><p>InnoDB é¦–å…ˆåœ¨ <strong>Buffer Pool</strong> ä¸­æŸ¥æ‰¾éœ€è¦ä¿®æ”¹çš„æ•°æ®é¡µã€‚å¦‚æœä¸åœ¨ï¼Œå°±å…ˆä»ç£ç›˜è¯»å…¥ã€‚</p></li><li><p>åœ¨å†…å­˜ä¸­ç›´æ¥ä¿®æ”¹è¯¥æ•°æ®é¡µã€‚æ­¤æ—¶ï¼Œè¯¥é¡µå˜æˆäº† <strong>Dirty Page (è„é¡µ)</strong>ã€‚</p></li></ul><p><strong>æ­¥éª¤ 2. COMMIT Transaction (æäº¤äº‹åŠ¡)</strong></p><ul><li><p>å®¢æˆ·ç«¯ä¿®æ”¹å®Œæ•°æ®åï¼Œå‘èµ· <code>COMMIT</code> å‘½ä»¤ï¼Œå‘Šè¯‰æ•°æ®åº“ï¼šâ€œæˆ‘å®Œæˆäº†ï¼Œè¯·æŠŠè¿™äº›ä¿®æ”¹æ°¸ä¹…ä¿å­˜ã€‚â€</p></li><li><p>æ­¤æ—¶ï¼Œå…³äºè¿™æ¬¡ä¿®æ”¹çš„æ—¥å¿—è®°å½•å·²ç»è¢«æ”¾å…¥äº† <strong>Log Buffer</strong> ä¸­ç­‰å¾…ã€‚</p></li></ul><p><strong>æ­¥éª¤ 3. WAL: WRITE-AHEAD LOGGING (é¢„å†™å¼æ—¥å¿—) â€”â€” æœ€å…³é”®çš„ä¸€æ­¥ï¼</strong></p><ul><li><p><strong>è¿™æ˜¯è·¨è¶Šâ€œæ˜“å¤±â€å’Œâ€œæŒä¹…â€è¾¹ç•Œçš„å…³é”®åŠ¨ä½œã€‚</strong></p></li><li><p>åœ¨äº‹åŠ¡è¢«è®¤ä¸ºæ˜¯â€œæäº¤æˆåŠŸâ€ä¹‹å‰ï¼ŒInnoDB å¿…é¡»éµå¾ª WAL åŸåˆ™ï¼š<strong>æ—¥å¿—å…ˆè¡Œ</strong>ã€‚</p></li><li><p>ç³»ç»Ÿä¼šå°† Log Buffer ä¸­çš„æ—¥å¿—è®°å½•ï¼Œå¼ºåˆ¶å†™å…¥åˆ°ç£ç›˜ä¸Šçš„ <strong>Redo Log Files</strong> ä¸­ï¼Œå¹¶æ‰§è¡Œ <code>fsync()</code> æ“ä½œï¼ˆç¡®ä¿æ•°æ®çœŸçš„è½åˆ°ç‰©ç†ç£ç›˜ä»‹è´¨ä¸Šï¼Œè€Œä¸æ˜¯åœç•™åœ¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç¼“å­˜é‡Œï¼‰ã€‚</p></li><li><p><strong>å›¾ä¸­æ–‡å­—å¼ºè°ƒï¼š</strong> â€œMust reach disk BEFORE transaction is confirmed.â€ï¼ˆåœ¨ç¡®è®¤äº‹åŠ¡ä¹‹å‰ï¼Œæ—¥å¿—å¿…é¡»åˆ°è¾¾ç£ç›˜ï¼‰ã€‚</p></li><li><p><em>æ³¨ï¼šä¸€æ—¦è¿™ä¸€æ­¥å®Œæˆï¼Œå“ªæ€•æ•°æ®æ–‡ä»¶è¿˜æ²¡æ›´æ–°ï¼Œäº‹åŠ¡ä¹Ÿè¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„äº†ã€‚å›¾é‡Œè™½ç„¶æ²¡ç”»æ­¥éª¤4ï¼Œä½†æ­¤æ—¶æ•°æ®åº“ä¼šå‘å®¢æˆ·ç«¯è¿”å›â€œCommit OKâ€ã€‚</em></p></li></ul><p><strong>æ­¥éª¤ 5. ASYNC CHECKPOINT (å¼‚æ­¥æ£€æŸ¥ç‚¹&#x2F;åˆ·è„é¡µ)</strong></p><ul><li><p>è¿™æ˜¯ä¸€ä¸ªåå°çš„ã€å¼‚æ­¥çš„è¿‡ç¨‹ï¼Œ<strong>ä¸å½±å“å®¢æˆ·ç«¯çš„å“åº”é€Ÿåº¦</strong>ã€‚</p></li><li><p>Buffer Pool ä¸­çš„â€œè„é¡µâ€ä¸èƒ½æ°¸è¿œå¾…åœ¨å†…å­˜é‡Œï¼Œå†…å­˜æœ‰é™ï¼Œä¸”ä¸å®‰å…¨ã€‚</p></li><li><p>InnoDB çš„åå°çº¿ç¨‹ä¼šé€‰æ‹©åˆé€‚çš„æ—¶æœºï¼ˆæ¯”å¦‚ç³»ç»Ÿç©ºé—²æ—¶ï¼Œæˆ– Redo Log å¿«å†™æ»¡æ—¶ï¼‰ï¼Œæ…¢æ…¢åœ°å°†è¿™äº›è„é¡µåˆ·æ–°åˆ°ç£ç›˜ä¸Šçš„ <strong>Data Files</strong> ä¸­ã€‚æˆ‘ä»¬å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œåˆ·è„â€æˆ– Checkpointã€‚</p></li><li><p>å›¾ä¸­è™šçº¿ç®­å¤´å’Œæ–‡å­— â€œLazy write of data pagesâ€ï¼ˆæ•°æ®çš„å»¶è¿Ÿå†™å…¥ï¼‰å‡†ç¡®åœ°æè¿°äº†è¿™ä¸ªè¿‡ç¨‹ã€‚</p></li></ul><hr><h2 id="æµç¨‹è¯¦è§£ï¼šå´©æºƒæ¢å¤-Crash-Recovery-Process"><a href="#æµç¨‹è¯¦è§£ï¼šå´©æºƒæ¢å¤-Crash-Recovery-Process" class="headerlink" title="æµç¨‹è¯¦è§£ï¼šå´©æºƒæ¢å¤ (Crash Recovery Process)"></a>æµç¨‹è¯¦è§£ï¼šå´©æºƒæ¢å¤ (Crash Recovery Process)</h2><p>è¿™ä¸ªæµç¨‹çš„ç›®æ ‡æ˜¯ï¼š<strong>å½“å‘ç”Ÿæ„å¤–æ—¶ï¼ŒæŠŠè¿˜æ²¡æ¥å¾—åŠå†™å…¥æ•°æ®æ–‡ä»¶çš„ä¿®æ”¹æ‰¾å›æ¥ã€‚</strong></p><p><strong>åœºæ™¯å‡è®¾ï¼š</strong> å‡è®¾åœ¨ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œ<strong>æ­¥éª¤ 3 åˆšåˆšå®Œæˆ</strong>ï¼ˆRedo Log å·²ç»è½ç›˜ï¼‰ï¼Œä½†æ˜¯<strong>æ­¥éª¤ 5 è¿˜æ²¡æœ‰å‘ç”Ÿ</strong>ï¼ˆè„é¡µè¿˜åœ¨å†…å­˜é‡Œï¼Œæ²¡å†™åˆ°æ•°æ®æ–‡ä»¶ï¼‰ï¼Œçªç„¶æœºæˆ¿æ–­ç”µäº†ã€‚</p><p><strong>åæœï¼š</strong> å†…å­˜ä¸­çš„ Dirty Page ç¬é—´æ¶ˆå¤±ã€‚ç£ç›˜ä¸Šçš„ Data Files é‡Œå­˜çš„è¿˜æ˜¯æ—§æ•°æ®ã€‚</p><p><strong>æ¢å¤è¿‡ç¨‹ (å›¾çš„åº•éƒ¨åŒºåŸŸ)ï¼š</strong></p><ol><li><p><strong>SYSTEM CRASH &#x2F; POWER OUTAGE (ç³»ç»Ÿå´©æºƒ&#x2F;æ–­ç”µ)</strong>ã€‚</p></li><li><p><strong>RESTART (é‡å¯)</strong>ï¼šMySQL æœåŠ¡å™¨é‡æ–°å¯åŠ¨ã€‚</p></li><li><p><strong>Read from Last Checkpoint (ä»ä¸Šæ¬¡æ£€æŸ¥ç‚¹è¯»å–)</strong>ï¼š</p><ul><li><p>InnoDB å¯åŠ¨æ—¶ä¼šæ£€æŸ¥çŠ¶æ€ï¼Œå‘ç°ä¸Šæ¬¡æ˜¯éæ­£å¸¸å…³é—­ã€‚</p></li><li><p>å®ƒä¼šå»è¯»å–ç£ç›˜ä¸Šçš„ <strong>REDO LOG FILES</strong>ã€‚å®ƒéœ€è¦æ‰¾åˆ°ä¸€ä¸ªâ€œæ£€æŸ¥ç‚¹ (Checkpoint)â€ï¼Œè¿™ä¸ªç‚¹ä¹‹å‰çš„æ•°æ®ä¿è¯éƒ½å·²ç»å†™å…¥æ•°æ®æ–‡ä»¶äº†ã€‚</p></li></ul></li><li><p><strong>REPLAY LOGS (é‡æ”¾æ—¥å¿—)</strong>ï¼š</p><ul><li><p>InnoDB ä»æ£€æŸ¥ç‚¹å¼€å§‹ï¼Œå¾€åè¯»å–æ‰€æœ‰çš„ Redo Log è®°å½•ã€‚</p></li><li><p>å®ƒæŒ‰ç…§æ—¥å¿—è®°å½•çš„å†…å®¹ï¼Œåœ¨å†…å­˜çš„ <strong>Buffer Pool</strong> ä¸­é‡æ–°æ‰§è¡Œä¸€éä¿®æ”¹æ“ä½œã€‚</p></li></ul></li><li><p><strong>Restore Dirty Pages to Memory (æ¢å¤è„é¡µåˆ°å†…å­˜)</strong>ï¼š</p><ul><li><p>é€šè¿‡é‡æ”¾æ—¥å¿—ï¼Œå´©æºƒå‰é‚£ä¸€åˆ»å†…å­˜ä¸­çš„ <strong>Dirty Page</strong> å°±è¢«å®Œç¾è¿˜åŸäº†ã€‚</p></li><li><p>æ­¤æ—¶ï¼Œæ•°æ®åº“æ¢å¤åˆ°äº†å´©æºƒå‰çš„ä¸€è‡´çŠ¶æ€ï¼Œå¯ä»¥å¯¹å¤–æä¾›æœåŠ¡äº†ã€‚éšåï¼Œåå°çº¿ç¨‹ä¼šå†æ¬¡å°è¯•æ‰§è¡Œæ­¥éª¤ 5ï¼ŒæŠŠè¿™äº›æ¢å¤å‡ºæ¥çš„è„é¡µå†™å…¥æ•°æ®æ–‡ä»¶ã€‚</p></li></ul></li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™å¼ å›¾å®Œç¾åœ°å±•ç¤ºäº† MySQL InnoDB çš„è®¾è®¡å“²å­¦ï¼š</p><ul><li><p>åˆ©ç”¨ <strong>å†…å­˜ (Buffer Pool)</strong> æ¥ä¿è¯<strong>é«˜æ€§èƒ½</strong>ï¼ˆè¯»å†™éƒ½åœ¨å†…å­˜ï¼‰ã€‚</p></li><li><p>åˆ©ç”¨ <strong>Redo Log (WALæœºåˆ¶)</strong> æ¥ä¿è¯<strong>æŒä¹…æ€§</strong>ï¼ˆå…³é”®æ—¶åˆ»åˆ©ç”¨é¡ºåºå†™å¿«é€Ÿè½ç›˜æ—¥å¿—ï¼‰ã€‚</p></li><li><p>åˆ©ç”¨ <strong>å¼‚æ­¥åˆ·è„ (Checkpoint)</strong> æ¥å¹³è¡¡æ€§èƒ½å’Œæ•°æ®æœ€ç»ˆçš„ä¸€è‡´æ€§ã€‚</p></li></ul><h1 id="Bin-Log"><a href="#Bin-Log" class="headerlink" title="Bin Log"></a>Bin Log</h1><ul><li>Server å±‚ä¹Ÿæœ‰è‡ªå·±çš„æ—¥å¿—ï¼Œç§°ä¸º binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚</li><li>binlog æ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡ binlog æ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/MySQL_BinLog.webp" alt="img"></li></ul><h2 id="å·¥ä½œæµç¨‹å›¾è¯¦è§£"><a href="#å·¥ä½œæµç¨‹å›¾è¯¦è§£" class="headerlink" title="å·¥ä½œæµç¨‹å›¾è¯¦è§£"></a>å·¥ä½œæµç¨‹å›¾è¯¦è§£</h2><p>è¿™å¼ å›¾ç‰‡ç›´è§‚åœ°å±•ç¤ºäº† <strong>MySQL Binlog (Binary Logï¼ŒäºŒè¿›åˆ¶æ—¥å¿—)</strong> çš„å·¥ä½œåŸç†ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•æ”¯æ’‘ <strong>ä¸»ä»å¤åˆ¶ (Replication)</strong> çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™å¼ å›¾çš„æµç¨‹æ‹†è§£ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š<strong>ä¸»åº“ï¼ˆMasterï¼‰çš„è®°å½•</strong>ã€<strong>æ•°æ®çš„ä¼ è¾“</strong>ã€<strong>ä»åº“ï¼ˆSlave&#x2F;Replicaï¼‰çš„é‡æ”¾</strong>ã€‚</p><p>ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤è§£é‡Šï¼š</p><h3 id="1-ä¸»åº“ç«¯-Master-Server-ï¼šè®°å½•å˜æ›´"><a href="#1-ä¸»åº“ç«¯-Master-Server-ï¼šè®°å½•å˜æ›´" class="headerlink" title="1. ä¸»åº“ç«¯ (Master Server)ï¼šè®°å½•å˜æ›´"></a>1. ä¸»åº“ç«¯ (Master Server)ï¼šè®°å½•å˜æ›´</h3><p>è¿™æ˜¯æµç¨‹çš„èµ·ç‚¹ï¼Œå¯¹åº”å›¾ä¸­å·¦ä¾§æˆ–ä¸Šæ–¹çš„éƒ¨åˆ†ã€‚</p><ul><li><p>å†™å…¥æ“ä½œ (Write Operations):</p><p>  å½“å®¢æˆ·ç«¯åº”ç”¨ï¼ˆClient Applicationï¼‰å‘æ•°æ®åº“å‘é€ ä¿®æ”¹æ•°æ® çš„è¯·æ±‚ï¼ˆå¦‚ INSERT, UPDATE, DELETEï¼‰æ—¶ï¼Œè¿™äº›æ“ä½œé¦–å…ˆåœ¨ä¸»åº“çš„å­˜å‚¨å¼•æ“ä¸­æ‰§è¡Œã€‚</p><ul><li><em>æ³¨æ„ï¼š<code>SELECT</code> ç­‰è¯»å–æ“ä½œä¸ä¼šè¢«è®°å½•ï¼Œå› ä¸ºå®ƒä»¬ä¸æ”¹å˜æ•°æ®ã€‚</em></li></ul></li><li><p>å†™å…¥ Binlog æ–‡ä»¶ (Binary Log File):</p><p>  åœ¨æ•°æ®è¢«æäº¤ï¼ˆCommitï¼‰åˆ°åº•å±‚å­˜å‚¨ä¹‹å‰ï¼ˆæˆ–åŒæ—¶ï¼‰ï¼ŒMySQL ä¼šå°†è¿™æ¬¡æ•°æ®å˜æ›´çš„è¯¦ç»†ä¿¡æ¯é¡ºåºå†™å…¥åˆ°ç£ç›˜ä¸Šçš„ Binlog æ–‡ä»¶ ä¸­ã€‚</p><ul><li><strong>Binlog çš„å†…å®¹ï¼š</strong> å®ƒå¯ä»¥è®°å½•å…·ä½“çš„ SQL è¯­å¥ï¼ˆStatement æ ¼å¼ï¼‰ï¼Œä¹Ÿå¯ä»¥è®°å½•è¡Œæ•°æ®çš„å˜åŒ–ï¼ˆRow æ ¼å¼ï¼‰ï¼Œæˆ–è€…ä¸¤è€…çš„æ··åˆï¼ˆMixed æ ¼å¼ï¼‰ã€‚</li></ul></li></ul><h3 id="2-å¤åˆ¶ä¸ä¼ è¾“è¿‡ç¨‹ï¼šä¸‰ä¸ªå…³é”®çº¿ç¨‹"><a href="#2-å¤åˆ¶ä¸ä¼ è¾“è¿‡ç¨‹ï¼šä¸‰ä¸ªå…³é”®çº¿ç¨‹" class="headerlink" title="2. å¤åˆ¶ä¸ä¼ è¾“è¿‡ç¨‹ï¼šä¸‰ä¸ªå…³é”®çº¿ç¨‹"></a>2. å¤åˆ¶ä¸ä¼ è¾“è¿‡ç¨‹ï¼šä¸‰ä¸ªå…³é”®çº¿ç¨‹</h3><p>è¿™æ˜¯è¿æ¥ä¸»åº“å’Œä»åº“çš„æ ¸å¿ƒæœºåˆ¶ï¼Œä¹Ÿæ˜¯å›¾ä¸­çš„æ ¸å¿ƒé€»è¾‘ã€‚ä¸ºäº†æŠŠæ•°æ®åŒæ­¥è¿‡å»ï¼ŒMySQL ä½¿ç”¨äº†ä¸‰ä¸ªä¸“é—¨çš„çº¿ç¨‹ï¼š</p><h4 id="A-Binlog-Dump-Thread-ä¸»åº“ç«¯"><a href="#A-Binlog-Dump-Thread-ä¸»åº“ç«¯" class="headerlink" title="A. Binlog Dump Thread (ä¸»åº“ç«¯)"></a>A. Binlog Dump Thread (ä¸»åº“ç«¯)</h4><ul><li><p>å½“ä»åº“è¿æ¥åˆ°ä¸»åº“å¹¶è¯·æ±‚åŒæ­¥æ—¶ï¼Œä¸»åº“ä¼šåˆ›å»ºä¸€ä¸ª <strong>Binlog Dump çº¿ç¨‹</strong>ã€‚</p></li><li><p>å®ƒçš„ä»»åŠ¡æ˜¯è¯»å–ä¸»åº“çš„ Binlog æ–‡ä»¶ï¼Œå¹¶å°†å†…å®¹é€šè¿‡ç½‘ç»œå‘é€ç»™ä»åº“ã€‚</p></li></ul><h4 id="B-I-O-Thread-ä»åº“ç«¯"><a href="#B-I-O-Thread-ä»åº“ç«¯" class="headerlink" title="B. I&#x2F;O Thread (ä»åº“ç«¯)"></a>B. I&#x2F;O Thread (ä»åº“ç«¯)</h4><ul><li><p>ä»åº“å¯åŠ¨åï¼Œä¼šåˆ›å»ºä¸€ä¸ª <strong>I&#x2F;O çº¿ç¨‹</strong>ã€‚</p></li><li><p>å®ƒçš„ä»»åŠ¡æ˜¯â€œæ¬è¿å·¥â€ï¼šå®ƒè¿æ¥åˆ°ä¸»åº“ï¼Œæ¥æ”¶ Dump çº¿ç¨‹å‘æ¥çš„ Binlog æ•°æ®å—ã€‚</p></li><li><p><strong>å…³é”®ç‚¹ï¼š</strong> I&#x2F;O çº¿ç¨‹æ”¶åˆ°æ•°æ®åï¼Œ<strong>ä¸ä¼šç›´æ¥å†™å…¥ä»åº“çš„æ•°æ®åº“</strong>ï¼Œè€Œæ˜¯å°†å…¶å†™å…¥åˆ°ä»åº“ç£ç›˜ä¸Šçš„ä¸€ä¸ªä¸´æ—¶ä¸­è½¬æ–‡ä»¶ï¼Œå«åš <strong>Relay Log (ä¸­ç»§æ—¥å¿—)</strong>ã€‚</p></li></ul><h4 id="C-SQL-Thread-ä»åº“ç«¯"><a href="#C-SQL-Thread-ä»åº“ç«¯" class="headerlink" title="C. SQL Thread (ä»åº“ç«¯)"></a>C. SQL Thread (ä»åº“ç«¯)</h4><ul><li><p>è¿™æ˜¯ä»åº“çš„ç¬¬äºŒä¸ªå…³é”®çº¿ç¨‹ã€‚</p></li><li><p>å®ƒçš„ä»»åŠ¡æ˜¯â€œæ‰§è¡Œè€…â€ï¼šå®ƒå®æ—¶æ£€æµ‹ Relay Log ä¸­æœ‰æ²¡æœ‰æ–°å†…å®¹ã€‚</p></li><li><p>ä¸€æ—¦å‘ç°æ–°å†…å®¹ï¼Œå®ƒå°±è¯»å–è¿™äº›æ—¥å¿—ï¼Œå¹¶å°†å…¶è§£æä¸ºå…·ä½“çš„æ•°æ®åº“æ“ä½œï¼Œç„¶ååœ¨ä»åº“çš„æ•°æ®åº“ä¸­<strong>é‡æ–°æ‰§è¡Œ (Replay)</strong> ä¸€éã€‚</p></li></ul><h3 id="3-ä»åº“ç«¯-Replica-Server-ï¼šæœ€ç»ˆä¸€è‡´æ€§"><a href="#3-ä»åº“ç«¯-Replica-Server-ï¼šæœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="3. ä»åº“ç«¯ (Replica Server)ï¼šæœ€ç»ˆä¸€è‡´æ€§"></a>3. ä»åº“ç«¯ (Replica Server)ï¼šæœ€ç»ˆä¸€è‡´æ€§</h3><p>å¯¹åº”å›¾ä¸­å³ä¾§æˆ–ä¸‹æ–¹çš„éƒ¨åˆ†ã€‚</p><ul><li><p>Relay Log (ä¸­ç»§æ—¥å¿—):</p><p>  è¿™æ˜¯ä¸€ä¸ªç¼“å†²åœ°å¸¦ã€‚å®ƒçš„å­˜åœ¨ä½¿å¾—â€œè·å–æ—¥å¿—â€å’Œâ€œæ‰§è¡Œæ—¥å¿—â€è§£è€¦äº†ã€‚å³ä½¿ä»åº“æ‰§è¡Œ SQL æ¯”è¾ƒæ…¢ï¼ˆSQL Thread é˜»å¡ï¼‰ï¼ŒI&#x2F;O çº¿ç¨‹ä¾ç„¶å¯ä»¥å¿«é€Ÿåœ°æŠŠä¸»åº“çš„æ—¥å¿—æ‹‰å–å›æ¥å­˜åœ¨æœ¬åœ°ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚</p></li><li><p>æ•°æ®åŒæ­¥å®Œæˆ:</p><p>  å½“ SQL çº¿ç¨‹æ‰§è¡Œå®Œ Relay Log ä¸­çš„æ“ä½œåï¼Œä»åº“çš„æ•°æ®çŠ¶æ€å°±å’Œä¸»åº“ä¿æŒäº†ä¸€è‡´ã€‚</p></li></ul><hr><h3 id="æ€»ç»“ï¼šè¿™å¼ å›¾å‘Šè¯‰äº†æˆ‘ä»¬ä»€ä¹ˆï¼Ÿ"><a href="#æ€»ç»“ï¼šè¿™å¼ å›¾å‘Šè¯‰äº†æˆ‘ä»¬ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ€»ç»“ï¼šè¿™å¼ å›¾å‘Šè¯‰äº†æˆ‘ä»¬ä»€ä¹ˆï¼Ÿ"></a>æ€»ç»“ï¼šè¿™å¼ å›¾å‘Šè¯‰äº†æˆ‘ä»¬ä»€ä¹ˆï¼Ÿ</h3><ol><li><p><strong>å¼‚æ­¥å¤åˆ¶ (Asynchronous):</strong> ä¸»åº“å†™å®Œ Binlog å°±å¯ä»¥å‘Šè¯‰å®¢æˆ·ç«¯â€œæˆåŠŸäº†â€ï¼Œå®ƒä¸éœ€è¦ç­‰ä»åº“ç¡®è®¤ã€‚ä»åº“æ˜¯åæ¥æ…¢æ…¢è¿½ä¸Šæ¥çš„ã€‚</p></li><li><p><strong>è§£è€¦:</strong> é€šè¿‡ Binlog å’Œ Relay Logï¼Œä¸»åº“å’Œä»åº“çš„å‹åŠ›è¢«éš”ç¦»å¼€äº†ã€‚</p></li><li><p><strong>æ ¸å¿ƒç”¨é€”:</strong></p><ul><li><p><strong>ä¸»ä»å¤åˆ¶:</strong> å®ç°è¯»å†™åˆ†ç¦»ï¼ˆä¸»åº“å†™ï¼Œä»åº“è¯»ï¼‰æˆ–é«˜å¯ç”¨çƒ­å¤‡ã€‚</p></li><li><p><strong>æ•°æ®æ¢å¤:</strong> å¦‚æœæ•°æ®åº“è¯¯åˆ äº†ï¼Œå¯ä»¥é€šè¿‡é‡æ”¾ Binlog æŠŠæ•°æ®æ¢å¤åˆ°è¯¯åˆ å‰çš„ä»»æ„æ—¶åˆ»ï¼ˆPoint-in-Time Recoveryï¼‰ã€‚</p></li></ul></li></ol><p>ä½ å¯ä»¥æŠŠè¿™ä¸ªè¿‡ç¨‹æƒ³è±¡æˆï¼š</p><p>ä¸»åº“æ˜¯æ¼”è®²è€…ï¼ˆæ‰§è¡Œå†™æ“ä½œï¼‰ï¼Œå®ƒæŠŠæ¼”è®²å†…å®¹å½•åœ¨ç£å¸¦ï¼ˆBinlogï¼‰é‡Œã€‚ä»åº“æ´¾äº†ä¸€ä¸ªå¿«é€’å‘˜ï¼ˆI&#x2F;O çº¿ç¨‹ï¼‰æŠŠç£å¸¦å¤åˆ»ä¸€ä»½æ‹¿å›å®¶ï¼ˆRelay Logï¼‰ï¼Œç„¶åä»åº“è‡ªå·±åœ¨å®¶é‡Œæ”¾ç£å¸¦ï¼ˆSQL çº¿ç¨‹ï¼‰ï¼Œè·Ÿç€å½•éŸ³å†åšä¸€éåŠ¨ä½œã€‚</p><p><strong>éœ€è¦æˆ‘ä¸ºæ‚¨è§£é‡Š Binlog çš„ä¸‰ç§æ ¼å¼ï¼ˆStatement, Row, Mixedï¼‰çš„åŒºåˆ«å—ï¼Ÿè¿™å¯¹æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§æœ‰å¾ˆå¤§å½±å“ã€‚</strong></p><h1 id="Undo-Log"><a href="#Undo-Log" class="headerlink" title="Undo Log"></a>Undo Log</h1><p>å¦‚æœè¯´ <strong>Redo Log</strong> æ˜¯â€œå‘ç”Ÿæ„å¤–æ—¶çš„æ•‘å‘½ç¨»è‰â€ï¼Œ<strong>Bin Log</strong> æ˜¯â€œä¼ ç»™åˆ«äººçš„æ“ä½œæ‰‹å†Œâ€ï¼Œé‚£ä¹ˆ <strong>Undo Log</strong> å°±æ˜¯**â€œåæ‚”è¯â€**ï¼ˆæˆ–è€…è¯´æ˜¯ç”µè„‘ä¸Šçš„ <code>Ctrl+Z</code>ï¼‰ã€‚</p><p>å®ƒæ˜¯ MySQL ä¿è¯äº‹åŠ¡ <strong>åŸå­æ€§ (Atomicity)</strong> å’Œå®ç° <strong>MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)</strong> çš„æ ¸å¿ƒç»„ä»¶ã€‚</p><p>ä»¥ä¸‹æ˜¯ Undo Log çš„è¯¦ç»†è§£æåŠå…¶ä¸å¦å¤–ä¸¤ä¸ªæ—¥å¿—çš„åŒºåˆ«ã€‚</p><hr><h2 id="1-ä»€ä¹ˆæ˜¯-Undo-Logï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-Undo-Logï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ Undo Logï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯ Undo Logï¼Ÿ</h2><p>Undo Logï¼ˆå›æ»šæ—¥å¿—ï¼‰è®°å½•çš„æ˜¯æ•°æ®çš„<strong>é€»è¾‘å˜åŒ–</strong>ï¼Œä½†å®ƒçš„è®°å½•æ–¹å¼æ˜¯**â€œåç€æ¥çš„â€**ã€‚</p><ul><li><p><strong>è®°å½•åŸç†ï¼š</strong> åªè¦ä½ ä¿®æ”¹æ•°æ®ï¼ŒMySQL å°±ä¼šåœ¨ Undo Log é‡Œè®°å½•ä¸€æ¡<strong>ç›¸å</strong>çš„æ“ä½œï¼Œä»¥ä¾¿éšæ—¶å›æ»šã€‚</p><ul><li><p>ä½ æ‰§è¡Œ <code>INSERT</code>ï¼Œå®ƒè®°å½• <code>DELETE</code>ã€‚</p></li><li><p>ä½ æ‰§è¡Œ <code>DELETE</code>ï¼Œå®ƒè®°å½• <code>INSERT</code>ã€‚</p></li><li><p>ä½ æ‰§è¡Œ <code>UPDATE</code> æŠŠ <code>age</code> ä» 10 æ”¹ä¸º 20ï¼Œå®ƒè®°å½• <code>UPDATE age = 10</code>ã€‚</p></li></ul></li></ul><h4 id="å®ƒçš„ä¸¤å¤§æ ¸å¿ƒä½œç”¨ï¼š"><a href="#å®ƒçš„ä¸¤å¤§æ ¸å¿ƒä½œç”¨ï¼š" class="headerlink" title="å®ƒçš„ä¸¤å¤§æ ¸å¿ƒä½œç”¨ï¼š"></a><strong>å®ƒçš„ä¸¤å¤§æ ¸å¿ƒä½œç”¨ï¼š</strong></h4><ol><li><p><strong>äº‹åŠ¡å›æ»š (Rollback)ï¼š</strong></p><ul><li>å½“äº‹åŠ¡æ‰§è¡Œåˆ°ä¸€åŠï¼Œç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ <code>ROLLBACK</code>ï¼Œæˆ–è€…ç¨‹åºå‘ç”Ÿé”™è¯¯ï¼ˆå¦‚å”¯ä¸€ç´¢å¼•å†²çªï¼‰ï¼ŒMySQL å°±åˆ©ç”¨ Undo Log å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„æ ·å­ã€‚</li></ul></li><li><p><strong>MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)ï¼š</strong></p><ul><li>å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨ä¿®æ”¹æŸè¡Œæ•°æ®ï¼ˆè¿˜æ²¡æäº¤ï¼‰ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ¥è¯»å–è¿™è¡Œæ•°æ®æ—¶ï¼Œä¸ºäº†ä¸åŠ é”ä¸”ä¸è¯»åˆ°è„æ•°æ®ï¼ŒMySQL ä¼šåˆ©ç”¨ Undo Log æ„å»ºä¸€ä¸ª**â€œå†å²ç‰ˆæœ¬å¿«ç…§â€**ï¼Œè®©è¯»å–è€…çœ‹åˆ°ä¿®æ”¹ä¹‹å‰çš„æ•°æ®ã€‚</li></ul></li></ol><hr><h2 id="2-Undo-Log-çš„å·¥ä½œæµç¨‹å›¾è§£"><a href="#2-Undo-Log-çš„å·¥ä½œæµç¨‹å›¾è§£" class="headerlink" title="2. Undo Log çš„å·¥ä½œæµç¨‹å›¾è§£"></a>2. Undo Log çš„å·¥ä½œæµç¨‹å›¾è§£</h2><p>å‡è®¾æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼š<code>UPDATE user SET age = 20 WHERE id = 1;</code> (åŸ age &#x3D; 10)</p><h4 id="Step-1-å‡†å¤‡å›æ»šæ•°æ®"><a href="#Step-1-å‡†å¤‡å›æ»šæ•°æ®" class="headerlink" title="Step 1: å‡†å¤‡å›æ»šæ•°æ®"></a><strong>Step 1: å‡†å¤‡å›æ»šæ•°æ®</strong></h4><p>åœ¨çœŸæ­£ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ä¹‹å‰ï¼ŒInnoDB ä¼šå…ˆç”Ÿæˆä¸€æ¡ Undo Logï¼š</p><blockquote><p>â€œå¦‚æœè¦æŠŠ id&#x3D;1 çš„æ•°æ®å›æ»šï¼Œè¯·æ‰§è¡Œ <code>UPDATE user SET age = 10 WHERE id = 1;</code>â€</p></blockquote><h4 id="Step-2-ä¿®æ”¹å†…å­˜-å†™-Redo-Log"><a href="#Step-2-ä¿®æ”¹å†…å­˜-å†™-Redo-Log" class="headerlink" title="Step 2: ä¿®æ”¹å†…å­˜ &amp; å†™ Redo Log"></a><strong>Step 2: ä¿®æ”¹å†…å­˜ &amp; å†™ Redo Log</strong></h4><p>æ‰§è¡Œä¿®æ”¹ï¼Œå†…å­˜ä¸­çš„ age å˜ä¸º 20ã€‚åŒæ—¶å†™å…¥ Redo Logï¼ˆè®°å½•ç‰©ç†ä¿®æ”¹ï¼‰ã€‚</p><h4 id="Step-3-æ­¤æ—¶å¦‚æœæœ‰åˆ«çš„äº‹åŠ¡æ¥æŸ¥-MVCC"><a href="#Step-3-æ­¤æ—¶å¦‚æœæœ‰åˆ«çš„äº‹åŠ¡æ¥æŸ¥-MVCC" class="headerlink" title="Step 3: æ­¤æ—¶å¦‚æœæœ‰åˆ«çš„äº‹åŠ¡æ¥æŸ¥ (MVCC)"></a><strong>Step 3: æ­¤æ—¶å¦‚æœæœ‰åˆ«çš„äº‹åŠ¡æ¥æŸ¥ (MVCC)</strong></h4><p>äº‹åŠ¡è¿˜æ²¡æäº¤ã€‚æ­¤æ—¶äº‹åŠ¡ B æ¥æŸ¥ id&#x3D;1ã€‚</p><p>InnoDB å‘ç°è¿™è¡Œæ•°æ®è¢«é”å®šäº†ï¼ˆæˆ–å¤„äºæ´»è·ƒäº‹åŠ¡ä¸­ï¼‰ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯é¡ºç€å›æ»šæŒ‡é’ˆ (Rollback Pointer) æ‰¾åˆ° Undo Log é‡Œçš„è®°å½•ã€‚</p><ul><li><p><strong>ç»“æœï¼š</strong> äº‹åŠ¡ B è¯»åˆ°äº† <code>age = 10</code>ã€‚</p></li><li><p><strong>æ„ä¹‰ï¼š</strong> è¯»å†™äº’ä¸é˜»å¡ï¼Œé«˜å¹¶å‘æ€§èƒ½çš„å…³é”®ã€‚</p></li></ul><h4 id="Step-4-äº‹åŠ¡æäº¤-Commit-æˆ–-å›æ»š-Rollback"><a href="#Step-4-äº‹åŠ¡æäº¤-Commit-æˆ–-å›æ»š-Rollback" class="headerlink" title="Step 4: äº‹åŠ¡æäº¤ (Commit) æˆ– å›æ»š (Rollback)"></a><strong>Step 4: äº‹åŠ¡æäº¤ (Commit) æˆ– å›æ»š (Rollback)</strong></h4><ul><li><p><strong>å¦‚æœæäº¤ï¼š</strong> Undo Log ä¸ä¼šç«‹å³åˆ é™¤ï¼ˆå› ä¸ºå¯èƒ½è¿˜æœ‰é•¿äº‹åŠ¡éœ€è¦çœ‹æ—§ç‰ˆæœ¬ï¼‰ï¼Œè€Œæ˜¯æ”¾å…¥â€œå¾…æ¸…ç†åˆ—è¡¨ (History List)â€ï¼Œç”± Purge çº¿ç¨‹åç»­æ¸…ç†ã€‚</p></li><li><p><strong>å¦‚æœå›æ»šï¼š</strong> ç«‹å³æ‰§è¡Œ Undo Log é‡Œçš„åå‘æ“ä½œï¼Œå°† age å˜å› 10ã€‚</p></li></ul><hr><h2 id="3-ä¸€ä¸ªåˆé’»çš„é—®é¢˜ï¼šUndo-Log-æœ¬èº«éœ€è¦æŒä¹…åŒ–å—ï¼Ÿ"><a href="#3-ä¸€ä¸ªåˆé’»çš„é—®é¢˜ï¼šUndo-Log-æœ¬èº«éœ€è¦æŒä¹…åŒ–å—ï¼Ÿ" class="headerlink" title="3. ä¸€ä¸ªåˆé’»çš„é—®é¢˜ï¼šUndo Log æœ¬èº«éœ€è¦æŒä¹…åŒ–å—ï¼Ÿ"></a>3. ä¸€ä¸ªåˆé’»çš„é—®é¢˜ï¼šUndo Log æœ¬èº«éœ€è¦æŒä¹…åŒ–å—ï¼Ÿ</h2><p><strong>éœ€è¦ã€‚</strong></p><p>è¿™å¬èµ·æ¥æœ‰ç‚¹ç»•ï¼šUndo Log æ˜¯ç”¨æ¥ä¿®æ•°æ®çš„ï¼Œé‚£è°æ¥ä¿® Undo Log å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ Redo Logã€‚</p><ul><li><p>Undo Log åœ¨ MySQL ä¸­ä¹Ÿè¢«è§†ä¸ºâ€œæ•°æ®â€çš„ä¸€ç§ï¼ˆå­˜åœ¨äºç³»ç»Ÿè¡¨ç©ºé—´æˆ– undo è¡¨ç©ºé—´ä¸­ï¼‰ã€‚</p></li><li><p>å½“ä½ å†™ Undo Log æ—¶ï¼Œè¿™ä¸ªå†™å…¥æ“ä½œæœ¬èº«ä¹Ÿä¼šäº§ç”Ÿå¯¹åº”çš„ Redo Logã€‚</p></li><li><p><strong>åœºæ™¯ï¼š</strong> å‡è®¾äº‹åŠ¡æ‰§è¡Œäº†ä¸€åŠï¼ŒMySQL å´©æºƒäº†ã€‚</p><ol><li><p>é‡å¯åï¼ŒRedo Log ä¼šå…ˆæ¢å¤æ•°æ®ï¼Œ<strong>åŒæ—¶ä¹Ÿæ¢å¤äº† Undo Log</strong>ã€‚</p></li><li><p>æ•°æ®åº“å‘ç°æœ‰ä¸€ä¸ªäº‹åŠ¡å¤„äºâ€œæœªæäº¤â€çŠ¶æ€ã€‚</p></li><li><p>åˆ©ç”¨åˆšåˆšæ¢å¤å‡ºæ¥çš„ Undo Logï¼Œå¯¹è¯¥äº‹åŠ¡è¿›è¡Œå›æ»š (Rollback)ã€‚</p></li><li><p>æ•°æ®åº“æ¢å¤ä¸€è‡´æ€§ã€‚</p></li></ol></li></ul><hr><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><p><strong>Redo Log</strong> è®©ä½ <strong>å‘å‰èµ°</strong>ï¼ˆæ‰ç”µäº†ä¹Ÿèƒ½ç»§ç»­å¾€å‰èµ°å®Œï¼‰ã€‚</p></li><li><p><strong>Undo Log</strong> è®©ä½ <strong>å‘åé€€</strong>ï¼ˆåšé”™äº†å¯ä»¥é€€å›åˆ°åŸç‚¹ï¼‰ã€‚</p></li><li><p><strong>Bin Log</strong> è®©ä½ <strong>å…‹éš†</strong>ï¼ˆæŠŠä½ çš„ç»å†å®Œæ•´å¤åˆ¶ç»™å¦ä¸€ä¸ªåº“ï¼‰ã€‚</p></li></ul><p>ä¸‰è€…é…åˆï¼š</p><ol><li><p>äº‹åŠ¡å¼€å¯ã€‚</p></li><li><p>å†™ <strong>Undo Log</strong> (ä¸ºäº†èƒ½é€€å›æ¥)ã€‚</p></li><li><p>æ‰§è¡Œå†…å­˜ä¿®æ”¹ã€‚</p></li><li><p>å†™ <strong>Redo Log</strong> (ä¸ºäº†é˜²æ–­ç”µ)ã€‚</p></li><li><p>æäº¤æ—¶å†™ <strong>Bin Log</strong> (ä¸ºäº†ç»™ä»åº“)ã€‚</p></li><li><p>äº‹åŠ¡ç»“æŸã€‚</p></li></ol><h1 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h1><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Redo Log (é‡åšæ—¥å¿—)</strong></th><th><strong>Bin Log (å½’æ¡£æ—¥å¿—)</strong></th><th><strong>Undo Log (å›æ»šæ—¥å¿—)</strong></th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒå…³é”®è¯</strong></td><td><strong>â€œæ¢å¤â€</strong></td><td><strong>â€œå¤åˆ¶â€</strong></td><td><strong>â€œæ’¤é”€â€</strong></td></tr><tr><td><strong>æ¯”å–»</strong></td><td>è®°è´¦æœ¬çš„è‰ç¨¿ (é˜²æ­¢æ–­ç”µå¿˜äº‹)</td><td>å®Œæ•´çš„è´¦å•æ˜ç»† (ç»™åˆ«äººçœ‹)</td><td><strong>æ©¡çš®æ“¦ &#x2F; Ctrl+Z</strong></td></tr><tr><td><strong>ä¾§é‡ç‚¹</strong></td><td>ç‰©ç†åå‘ (é¡µä¿®æ”¹)</td><td>é€»è¾‘åå‘ (SQLè¯­ä¹‰)</td><td><strong>é€»è¾‘åå‘</strong> (é€†æ“ä½œ)</td></tr><tr><td><strong>ä¸»è¦ä½œç”¨</strong></td><td>å´©æºƒæ¢å¤ (Crash Safe)<br><br>  <br><br>ä¿è¯ <strong>D</strong> (æŒä¹…æ€§)</td><td>ä¸»ä»å¤åˆ¶ã€æ•°æ®æ¢å¤<br><br>  <br><br>ä¿è¯æ•°æ®ä¸€è‡´æ€§</td><td>äº‹åŠ¡å›æ»šã€MVCC<br><br>  <br><br>ä¿è¯ <strong>A</strong> (åŸå­æ€§) å’Œ <strong>I</strong> (éš”ç¦»æ€§)</td></tr><tr><td><strong>å†™å…¥æ—¶æœº</strong></td><td>äº‹åŠ¡è¿›è¡Œä¸­ä¸æ–­å†™</td><td>äº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡æ€§å†™</td><td>äº‹åŠ¡å¼€å§‹å‰&#x2F;ä¿®æ”¹å‰å†™</td></tr><tr><td><strong>é‡Šæ”¾æ—¶æœº</strong></td><td>è½ç›˜åè¦†ç›– (å¾ªç¯å†™)</td><td>ä¸åˆ é™¤ (è¿½åŠ å†™)</td><td>äº‹åŠ¡æäº¤åï¼Œè‹¥æ—  MVCC éœ€æ±‚åˆ™æ ‡è®°åˆ é™¤ (Purge)</td></tr></tbody></table><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><h2 id="ä¸ºä»€ä¹ˆéœ€è¦â€œä¸¤é˜¶æ®µæäº¤â€-2-PC"><a href="#ä¸ºä»€ä¹ˆéœ€è¦â€œä¸¤é˜¶æ®µæäº¤â€-2-PC" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦â€œä¸¤é˜¶æ®µæäº¤â€ (2 PC)?"></a>ä¸ºä»€ä¹ˆéœ€è¦â€œä¸¤é˜¶æ®µæäº¤â€ (2 PC)?</h2><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/MySQL_2PC.webp" alt="img"></p><h3 id="èƒŒæ™¯é—®é¢˜ï¼šæ•°æ®ä¸€è‡´æ€§"><a href="#èƒŒæ™¯é—®é¢˜ï¼šæ•°æ®ä¸€è‡´æ€§" class="headerlink" title="èƒŒæ™¯é—®é¢˜ï¼šæ•°æ®ä¸€è‡´æ€§"></a>èƒŒæ™¯é—®é¢˜ï¼šæ•°æ®ä¸€è‡´æ€§</h3><p>å¦‚æœ MySQL æ²¡æœ‰ä¸¤é˜¶æ®µæäº¤ï¼ŒRedo Log å’Œ Bin Log çš„å†™å…¥é¡ºåºæ˜¯ç‹¬ç«‹çš„ã€‚å‡è®¾æˆ‘ä»¬æ‰§è¡Œä¸€æ¡ <code>UPDATE</code> è¯­å¥ï¼š</p><ol><li><p><strong>å…ˆå†™ Redo Logï¼Œå†å†™ Bin Logï¼š</strong></p><ul><li>å¦‚æœ Redo Log å†™å®Œï¼ŒBin Log è¿˜æ²¡å†™å®Œæ—¶ç³»ç»Ÿå®•æœºã€‚</li><li><em>æ¢å¤åï¼š</em> ä¸»åº“é€šè¿‡ Redo Log æ¢å¤äº†æ•°æ®ï¼ˆA&#x3D;1ï¼‰ï¼›ä½† Bin Log æ²¡è®°å½•ï¼Œä»åº“åŒæ­¥æ—¶æ•°æ®ä»æ˜¯æ—§çš„ï¼ˆA&#x3D;0ï¼‰ã€‚<strong>ä¸»ä»ä¸ä¸€è‡´ã€‚</strong></li></ul></li><li><p><strong>å…ˆå†™ Bin Logï¼Œå†å†™ Redo Logï¼š</strong></p><ul><li>å¦‚æœ Bin Log å†™å®Œï¼ŒRedo Log æ²¡å†™å®Œæ—¶ç³»ç»Ÿå®•æœºã€‚</li><li><em>æ¢å¤åï¼š</em> ä¸»åº“å›  Redo Log ç¼ºå¤±ï¼Œäº‹åŠ¡å›æ»šï¼ˆA&#x3D;0ï¼‰ï¼›ä½† Bin Log å·²ç»æœ‰äº†è®°å½•ï¼Œä»åº“ä¼šåŒæ­¥è¿™æ¡æ›´æ–°ï¼ˆA&#x3D;1ï¼‰ã€‚<strong>ä¸»ä»ä¸ä¸€è‡´ã€‚</strong></li></ul></li></ol><h3 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h3><p><strong>ä¸¤é˜¶æ®µæäº¤æ˜¯ä¸ºäº†è®© Redo Log å’Œ Bin Log åœ¨é€»è¾‘ä¸Šä¿æŒä¸€è‡´</strong>ã€‚è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><hr><h3 id="ä¸¤é˜¶æ®µæäº¤æµç¨‹è¯¦è§£"><a href="#ä¸¤é˜¶æ®µæäº¤æµç¨‹è¯¦è§£" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤æµç¨‹è¯¦è§£"></a>ä¸¤é˜¶æ®µæäº¤æµç¨‹è¯¦è§£</h3><p>å‡è®¾æ‰§è¡Œè¯­å¥ï¼š<code>UPDATE user SET age = age + 1 WHERE id = 1;</code></p><h4 id="æµç¨‹å›¾è§£"><a href="#æµç¨‹å›¾è§£" class="headerlink" title="æµç¨‹å›¾è§£"></a><strong>æµç¨‹å›¾è§£</strong></h4><p>ä»£ç æ®µ</p><div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>    sequenceDiagram    participant Client as å®¢æˆ·ç«¯    participant Executor as æ‰§è¡Œå™¨ (Serverå±‚)    participant InnoDB as InnoDB å¼•æ“    participant DiskRedo as Redo Log (ç£ç›˜)    participant DiskBin as Bin Log (ç£ç›˜)    Client-&gt;&gt;Executor: å‘èµ· Update è¯­å¥    Executor-&gt;&gt;InnoDB: æŸ¥æ‰¾ ID&#x3D;1 çš„è¡Œ    InnoDB--&gt;&gt;Executor: è¿”å›è¡Œæ•°æ® (è‹¥ä¸åœ¨å†…å­˜åˆ™ä»ç£ç›˜è¯»)        Note over Executor: 1. æ‰§è¡Œæ›´æ–°æ“ä½œ    Executor-&gt;&gt;InnoDB: å†™å…¥æ–°è¡Œæ•°æ® (å†…å­˜æ›´æ–°)    Note over InnoDB, DiskRedo: 2. Prepare é˜¶æ®µ (å‡†å¤‡)    InnoDB-&gt;&gt;DiskRedo: å†™å…¥ Redo Log (çŠ¶æ€: PREPARE)        Note over Executor, DiskBin: 3. å†™ Binlog é˜¶æ®µ    Executor-&gt;&gt;DiskBin: å†™å…¥ Bin Log        Note over InnoDB, DiskRedo: 4. Commit é˜¶æ®µ (æäº¤)    Executor-&gt;&gt;InnoDB: æäº¤äº‹åŠ¡ (è°ƒç”¨å¼•æ“æ¥å£)    InnoDB-&gt;&gt;DiskRedo: Redo Log æ ‡è®°ä¸º (çŠ¶æ€: COMMIT)        Executor--&gt;&gt;Client: è¿”å›æˆåŠŸ  </pre></div><h4 id="è¯¦ç»†æ­¥éª¤è§£æ"><a href="#è¯¦ç»†æ­¥éª¤è§£æ" class="headerlink" title="è¯¦ç»†æ­¥éª¤è§£æ"></a><strong>è¯¦ç»†æ­¥éª¤è§£æ</strong></h4><ol><li><p><strong>æ‰§è¡Œé˜¶æ®µï¼š</strong></p><ul><li>InnoDB å°†å†…å­˜ä¸­çš„æ•°æ®æ›´æ–°ï¼ˆæ­¤æ—¶æ•°æ®åœ¨å†…å­˜ä¸­æ˜¯è„é¡µï¼‰ã€‚</li></ul></li><li><p><strong>Prepare é˜¶æ®µ (ç¬¬ä¸€é˜¶æ®µ)ï¼š</strong></p><ul><li><p>InnoDB å°†æœ¬æ¬¡äº‹åŠ¡çš„å˜æ›´å†™å…¥ Redo Logï¼Œå¹¶å°† Redo Log çš„è®°å½•çŠ¶æ€æ ‡è®°ä¸º <code>PREPARE</code>ã€‚</p></li><li><p>æ­¤æ—¶ï¼Œäº‹åŠ¡å¹¶æœªçœŸæ­£å®Œæˆï¼Œä½†æ•°æ®å˜æ›´å·²ç»æŒä¹…åŒ–åˆ°äº† Redo Log ä¸­ã€‚</p></li></ul></li><li><p><strong>å†™ Bin Log é˜¶æ®µï¼š</strong></p><ul><li>MySQL Server å±‚å°†äº‹åŠ¡çš„é€»è¾‘æ“ä½œå†™å…¥ Bin Log æ–‡ä»¶ï¼Œå¹¶ç¡®ä¿å†™å…¥ç£ç›˜ï¼ˆä¾èµ– <code>sync_binlog</code> å‚æ•°ï¼‰ã€‚</li></ul></li><li><p><strong>Commit é˜¶æ®µ (ç¬¬äºŒé˜¶æ®µ)ï¼š</strong></p><ul><li><p>Server å±‚è°ƒç”¨å¼•æ“çš„æäº¤æ¥å£ã€‚</p></li><li><p>InnoDB æ”¶åˆ°é€šçŸ¥åï¼Œå°† Redo Log ä¸­åˆšæ‰é‚£æ¡è®°å½•çš„çŠ¶æ€ç”± <code>PREPARE</code> ä¿®æ”¹ä¸º <code>COMMIT</code>ã€‚</p></li><li><p>è‡³æ­¤ï¼Œäº‹åŠ¡å½»åº•å®Œæˆã€‚</p></li></ul></li></ol><hr><h3 id="å´©æºƒæ¢å¤é€»è¾‘ï¼šå®ƒæ˜¯å¦‚ä½•ä¿è¯ä¸€è‡´æ€§çš„ï¼Ÿ"><a href="#å´©æºƒæ¢å¤é€»è¾‘ï¼šå®ƒæ˜¯å¦‚ä½•ä¿è¯ä¸€è‡´æ€§çš„ï¼Ÿ" class="headerlink" title="å´©æºƒæ¢å¤é€»è¾‘ï¼šå®ƒæ˜¯å¦‚ä½•ä¿è¯ä¸€è‡´æ€§çš„ï¼Ÿ"></a>å´©æºƒæ¢å¤é€»è¾‘ï¼šå®ƒæ˜¯å¦‚ä½•ä¿è¯ä¸€è‡´æ€§çš„ï¼Ÿ</h3><p>å¦‚æœåœ¨ä¸Šè¿°æµç¨‹çš„ä»»æ„æ—¶åˆ»å‘ç”Ÿå®•æœºï¼ˆCrashï¼‰ï¼ŒMySQL é‡å¯åä¼šæ£€æŸ¥ Redo Log ä¸­çš„çŠ¶æ€ï¼š</p><ul><li><p><strong>æƒ…å†µ Aï¼šRedo Log æ˜¯å®Œæ•´çš„ <code>COMMIT</code> çŠ¶æ€</strong></p><ul><li><p><strong>å¤„ç†ï¼š</strong> ç›´æ¥æ ¹æ® Redo Log æäº¤äº‹åŠ¡ï¼Œæ¢å¤æ•°æ®ã€‚</p></li><li><p><strong>ç»“æœï¼š</strong> äº‹åŠ¡æˆåŠŸã€‚</p></li></ul></li><li><p><strong>æƒ…å†µ Bï¼šRedo Log æ˜¯ <code>PREPARE</code> çŠ¶æ€ï¼Œä¸” Bin Log å®Œæ•´</strong></p><ul><li><p><em>åœºæ™¯ï¼š</em> æ­¥éª¤ 3 å®Œæˆäº†ï¼ˆBin Log å†™äº†ï¼‰ï¼Œä½†æ­¥éª¤ 4 è¿˜æ²¡æ¥å¾—åŠæ”¹çŠ¶æ€ã€‚</p></li><li><p><strong>å¤„ç†ï¼š</strong> MySQL æ‰«æ Bin Logï¼Œå‘ç°è¯¥äº‹åŠ¡çš„ XIDï¼ˆäº‹åŠ¡ IDï¼‰åœ¨ Bin Log ä¸­å­˜åœ¨ä¸”å®Œæ•´ã€‚å¼•æ“å°† Redo Log çŠ¶æ€è¡¥é½ä¸º Commitï¼Œæäº¤äº‹åŠ¡ã€‚</p></li><li><p><strong>ç»“æœï¼š</strong> äº‹åŠ¡æˆåŠŸï¼ˆå› ä¸º Bin Log å·²ç»æœ‰äº†ï¼Œä¸ºäº†ä¸»ä»ä¸€è‡´ï¼Œä¸»åº“å¿…é¡»æäº¤ï¼‰ã€‚</p></li></ul></li><li><p><strong>æƒ…å†µ Cï¼šRedo Log æ˜¯ <code>PREPARE</code> çŠ¶æ€ï¼Œä½† Bin Log ä¸å®Œæ•´&#x2F;ç¼ºå¤±</strong></p><ul><li><p><em>åœºæ™¯ï¼š</em> æ­¥éª¤ 2 å®Œæˆäº†ï¼Œä½†åœ¨å†™ Bin Log æ—¶å®•æœºã€‚</p></li><li><p><strong>å¤„ç†ï¼š</strong> æ‰«æ Bin Log å‘ç°æ²¡æœ‰å¯¹åº”çš„ XIDã€‚å¼•æ“å›æ»šï¼ˆRollbackï¼‰è¯¥äº‹åŠ¡ã€‚</p></li><li><p><strong>ç»“æœï¼š</strong> äº‹åŠ¡å¤±è´¥ï¼ˆä¸»åº“å›æ»šï¼Œä»åº“ä¹Ÿæ²¡æ”¶åˆ° Bin Logï¼Œè¾¾æˆä¸€è‡´ï¼‰ã€‚</p></li></ul></li></ul><hr><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><p><strong>Redo Log</strong> æ•‘ä¸»åº“ï¼ˆç‰©ç†æ¢å¤ï¼‰ï¼Œ<strong>Bin Log</strong> æ•‘ä»åº“ï¼ˆé€»è¾‘åŒæ­¥ï¼‰ã€‚</p></li><li><p><strong>ä¸¤é˜¶æ®µæäº¤</strong> å°±åƒæ˜¯ä¸€ä¸ªâ€œæ¡æ‰‹åè®®â€ï¼š</p><ul><li>å…ˆè®© Redo Log åšå¥½å‡†å¤‡ï¼ˆPrepareï¼‰ã€‚</li><li>å†å†™ Bin Logï¼ˆå…³é”®ç‚¹ï¼‰ã€‚</li><li>æœ€åç¡®è®¤ Redo Logï¼ˆCommitï¼‰ã€‚</li></ul></li><li><p><strong>åˆ¤å†³æ ‡å‡†ï¼š</strong> åªè¦ <strong>Bin Log å†™æˆåŠŸäº†</strong>ï¼Œè¿™ä¸ªäº‹åŠ¡å°±ç®—æˆåŠŸï¼ŒRedo Log å³ä½¿æ˜¯ Prepare çŠ¶æ€ä¹Ÿä¼šè¢«å¼ºåˆ¶æäº¤ï¼›å¦åˆ™å°±å›æ»šã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å…«è‚¡æ–‡</title>
      <link href="/posts/65190.html"/>
      <url>/posts/65190.html</url>
      
        <content type="html"><![CDATA[<h1 id="BitMap"><a href="#BitMap" class="headerlink" title="BitMap"></a>BitMap</h1><p>æ‰€è°“çš„Bit-mapå°±æ˜¯ç”¨ä¸€ä¸ªbitä½æ¥æ ‡è®°æŸä¸ªå…ƒç´ å¯¹åº”çš„Valueï¼Œ è€ŒKeyå³æ˜¯è¯¥å…ƒç´ ã€‚ç”±äºé‡‡ç”¨äº†Bitä¸ºå•ä½æ¥å­˜å‚¨æ•°æ®ï¼Œå› æ­¤åœ¨å­˜å‚¨ç©ºé—´æ–¹é¢ï¼Œå¯ä»¥å¤§å¤§èŠ‚çœã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªunsigned intç±»å‹çš„æ•°ç»„æˆ–è€…å‘é‡æ¥è¡¨ç¤ºä½å›¾ï¼Œå‡è®¾æˆ‘ä»¬å®šä¹‰vector aï¼Œåˆ™ ç¬¬iä½å¯è¡¨ç¤ºä¸ºa[i&#x2F;32]çš„i%32ä½ï¼ˆå…¶ä¸­ï¼Œ32*N+r &#x3D; iï¼Œrä¸ºi%32ï¼Œä¹Ÿå°±æ˜¯i&#x2F;32çš„ä½™æ•°ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">class Bitmap</span><br><span class="line">&#123;</span><br><span class="line">    private:</span><br><span class="line">    vector&lt;size_t&gt; v;</span><br><span class="line">    public:</span><br><span class="line">    Bitmap(size_t num) : v((num&gt;&gt;5)+1, 0) &#123;&#125;</span><br><span class="line">    //set 1</span><br><span class="line">    void set(size_t num)</span><br><span class="line">    &#123;</span><br><span class="line">        v[num&gt;&gt;5] |= (1&lt;&lt;(num &amp; 31)); // num &amp; 31 equals num % 32</span><br><span class="line">    &#125;</span><br><span class="line">    //set 0</span><br><span class="line">    void clean(size_t num)</span><br><span class="line">    &#123;</span><br><span class="line">        v[num&gt;&gt;5] &amp;= ~(1&lt;&lt;(num &amp; 31));</span><br><span class="line">    &#125;</span><br><span class="line">    //if exist or not</span><br><span class="line">    bool isExist(size_t num)</span><br><span class="line">    &#123;</span><br><span class="line">        bool is = 0;</span><br><span class="line">        size_t r = 1 &lt;&lt; (num &amp; 31); //r represents remainder</span><br><span class="line">        if(r == (v[num&gt;&gt;5] &amp; r))</span><br><span class="line">            is = 1;</span><br><span class="line">        return is;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><ul><li>dockeræ˜¯åº”ç”¨ æ‰“åŒ…ã€åˆ†å‘å’Œéƒ¨ç½²çš„å·¥å…·</li></ul><p><strong>Linuxå†…æ ¸æä¾›namespaceå®Œæˆéš”ç¦»ï¼ŒCgroupå®Œæˆèµ„æºé™åˆ¶ã€‚namespace+Cgroupæ„æˆäº†å®¹å™¨çš„åº•å±‚æŠ€æœ¯ï¼ˆrootfsæ˜¯å®¹å™¨æ–‡ä»¶ç³»ç»Ÿå±‚æŠ€æœ¯ï¼‰ã€‚</strong></p><ul><li><strong>å¤šå®¹å™¨é€šä¿¡</strong>ï¼šdocker networkåˆ›å»ºè™šæ‹Ÿç½‘ç»œ</li><li><strong>docker-compose</strong> æŠŠé¡¹ç›®çš„å¤šä¸ªæœåŠ¡é›†åˆåˆ°ä¸€èµ·ï¼Œä¸€é”®è¿è¡Œ</li></ul><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul><li>éƒ¨ç½²æ–¹ä¾¿</li><li>éƒ¨ç½²å®‰å…¨</li><li>éš”ç¦»æ€§å¥½</li><li>å¿«é€Ÿå›æ»š</li><li>æˆæœ¬ä½</li><li>ç®¡ç†æˆæœ¬ä½</li></ul><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ul><li>éš”ç¦»æ€§ï¼š</li></ul><p>åŸºäºhypervisorçš„è™šæ‹ŸæŠ€æœ¯ï¼Œåœ¨éš”ç¦»æ€§ä¸Šæ¯”å®¹å™¨æŠ€æœ¯æ›´å¥½ï¼Œå› ä¸ºç³»ç»Ÿç¡¬ä»¶èµ„æºå®Œå…¨ä¸Šè™šæ‹ŸåŒ–ï¼Œå½“ä¸€å°è™šæ‹Ÿæœºå‡ºç°ç³»ç»Ÿçº§åˆ«é—®é¢˜ï¼Œä¸ä¼šå½±å“åˆ°åŒä¸€å®¿ä¸»æœºçš„å…¶ä»–è™šæ‹Ÿæœºã€‚ï¼ˆä½†æ˜¯å®¹å™¨å°±ä¸ä¸€æ ·äº†ï¼Œå®¹å™¨ä¹‹é—´å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸åŠå…¶å®ƒç»„ä»¶ï¼‰</p><ul><li>æ€§èƒ½ï¼š</li></ul><p>è¿ç”¨ä¸åŒçš„æŠ€æœ¯å¯¹åº”ç”¨æœ¬èº«è¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„å°è£…ä¸éš”ç¦»ï¼Œåœ¨é™ä½åº”ç”¨å’Œåº”ç”¨ä¹‹é—´ä»¥åŠåº”ç”¨å’Œç¯å¢ƒä¹‹é—´çš„è€¦åˆæ€§ä¸Šåšäº†å¾ˆå¤šåŠªåŠ›ï¼Œä½†æ˜¯éšä¹‹è€Œæ¥çš„ï¼Œå°±ä¼šäº§ç”Ÿæ›´è¿‡çš„ç½‘ç»œè¿æ¥è½¬å‘å’Œæ•°æ®äº¤äº’</p><ul><li>å­˜å‚¨æ–¹æ¡ˆ</li></ul><p>éœ€è¦å¤–æŒ‚ç½‘ç»œç£ç›˜æˆ–è€…æ˜ å°„åˆ°å®¿ä¸»æœºä¸Š</p><h1 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h1><h2 id="æœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#æœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="æœåŠ¡æ³¨å†Œä¸å‘ç°"></a>æœåŠ¡æ³¨å†Œä¸å‘ç°</h2><p>**å•ä½“æœåŠ¡æ‹†åˆ†ä¸ºå¾®æœåŠ¡åï¼Œå¦‚æœå¾®æœåŠ¡ä¹‹é—´å­˜åœ¨è°ƒç”¨ä¾èµ–ï¼Œå°±éœ€è¦å¾—åˆ°ç›®æ ‡æœåŠ¡çš„æœåŠ¡åœ°å€ï¼Œä¹Ÿå°±æ˜¯å¾®æœåŠ¡æ²»ç†çš„â€æœåŠ¡å‘ç°â€œã€‚**è¦å®ŒæˆæœåŠ¡å‘ç°ï¼Œå°±éœ€è¦å°†æœåŠ¡ä¿¡æ¯å­˜å‚¨åˆ°æŸä¸ªè½½ä½“ï¼Œè½½ä½“æœ¬èº«å³æ˜¯å¾®æœåŠ¡æ²»ç†çš„â€æœåŠ¡æ³¨å†Œä¸­å¿ƒâ€œï¼Œè€Œå­˜å‚¨åˆ°è½½ä½“çš„åŠ¨ä½œå³æ˜¯â€æœåŠ¡æ³¨å†Œâ€œã€‚</p><h2 id="å¯è§‚æµ‹æ€§"><a href="#å¯è§‚æµ‹æ€§" class="headerlink" title="å¯è§‚æµ‹æ€§"></a>å¯è§‚æµ‹æ€§</h2><p>å¾®æœåŠ¡ç”±äºè¾ƒå•ä½“åº”ç”¨æœ‰äº†æ›´å¤šçš„éƒ¨ç½²è½½ä½“ï¼Œéœ€è¦å¯¹ä¼—å¤šæœåŠ¡é—´çš„è°ƒç”¨å…³ç³»ã€çŠ¶æ€æœ‰æ¸…æ™°çš„æŒæ§ã€‚å¯è§‚æµ‹æ€§å°±åŒ…æ‹¬äº†</p><ul><li>è°ƒç”¨æ‹“æ‰‘å…³ç³»</li><li>ç›‘æ§ï¼ˆMetricsï¼‰</li><li>æ—¥å¿—ï¼ˆLoggingï¼‰</li><li>è°ƒç”¨è¿½è¸ªï¼ˆTraceï¼‰</li></ul><h2 id="æµé‡ç®¡ç†"><a href="#æµé‡ç®¡ç†" class="headerlink" title="æµé‡ç®¡ç†"></a>æµé‡ç®¡ç†</h2><ul><li>ç°åº¦å‘å¸ƒ</li><li>A&#x2F;Bå®éªŒ</li></ul><h2 id="é‰´æƒ"><a href="#é‰´æƒ" class="headerlink" title="é‰´æƒ"></a>é‰´æƒ</h2><h1 id="C-C-å‡½æ•°è°ƒç”¨è¿‡ç¨‹åˆ†æ"><a href="#C-C-å‡½æ•°è°ƒç”¨è¿‡ç¨‹åˆ†æ" class="headerlink" title="C&#x2F;C++å‡½æ•°è°ƒç”¨è¿‡ç¨‹åˆ†æ"></a><a href="https://www.cnblogs.com/biyeymyhjob/archive/2012/07/20/2601204.html">C&#x2F;C++å‡½æ•°è°ƒç”¨è¿‡ç¨‹åˆ†æ</a></h1><h1 id="è‹±æ–‡"><a href="#è‹±æ–‡" class="headerlink" title="è‹±æ–‡"></a>è‹±æ–‡</h1><p>é¡¹ç›®éš¾ç‚¹</p><p>During my tenure, I was in charge of many projects, among which the most challenging for me was the first project. Because I ran into memory leaks and concurrency issues. For the first question, by using performance analysis tools and consulting related materials, I learned that the underlying memory allocation strategy caused the memory leak problem, so I adjusted the strategy and solved the problem smoothly. The second question, I implemented CAS by combining redis and lua scripts, and cooperated with the retry mechanism to ensure that the data written in is in line with expectations.</p><p>ä¸ºä»€ä¹ˆåŠ å…¥</p><p>Iâ€™d like to join because both citrix and i share the same values, also, i think this position merges my interests with my skill set, so i can contribute to Citrix</p><p>æœªæ¥å±•æœ›</p><p>i look forward to continuing to develop my skills and carees. Citrix excite me and i hope that in five years Iâ€™ll still be here continuig to hone my skills</p><p>ä¸ºä»€ä¹ˆç¦»èŒ</p><p>For the long-term planning, I hope to return to Nanjing for development and settle down with my girlfriend</p><p>å¦‚ä½•åº”å¯¹å·¥ä½œä¸­çš„å‹åŠ›</p><p>i work well under pressure. when iâ€™m under pressure, rather than panic. the first thing i do is prioritize the most important things that need to be done first. then i tackle each task one by one</p><p>ä¼˜ç‚¹</p><p>i have strong work ethic and it makes me do better</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Redis å­¦ä¹ ç¬”è®°</title>
      <link href="/posts/16018.html"/>
      <url>/posts/16018.html</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€æ•°æ®ç»“æ„"><a href="#åŸºç¡€æ•°æ®ç»“æ„" class="headerlink" title="åŸºç¡€æ•°æ®ç»“æ„"></a>åŸºç¡€æ•°æ®ç»“æ„</h2><h3 id="SDS"><a href="#SDS" class="headerlink" title="SDS"></a>SDS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct sdshdr &#123;</span><br><span class="line">    int len; // bufä¸­å·²ä½¿ç”¨çš„å­—èŠ‚æ•°</span><br><span class="line">    int free; // bufä¸­æœªä½¿ç”¨çš„å­—èŠ‚æ•°</span><br><span class="line">    char buf[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h3><ol><li>åŒ…å«å¤´å°¾èŠ‚ç‚¹ï¼Œhead tailï¼Œä»¥åŠé“¾è¡¨é•¿åº¦è®¡æ•°å™¨len</li><li>æ— ç¯</li><li>å¤šæ€ï¼šé“¾è¡¨èŠ‚ç‚¹ä½¿ç”¨void*æ¥ä¿å­˜èŠ‚ç‚¹å€¼ï¼Œå¯ä»¥æ”¯æŒå„ç§ä¸åŒç±»å‹çš„å€¼</li></ol><h3 id="å­—å…¸"><a href="#å­—å…¸" class="headerlink" title="å­—å…¸"></a>å­—å…¸</h3><p>å±äºk-vç»“æ„çš„æ˜ å°„è¡¨ã€‚</p><ol><li>å­—å…¸ç”±ä¸¤ä¸ªå“ˆå¸Œè¡¨æ„æˆï¼Œå½“å­—å…¸å¤„äºredhashçŠ¶æ€ï¼Œht[1]æ‰æœ‰æ•°æ®ï¼Œå½“rehashå®Œæˆä¹‹åï¼Œæ•°æ®ä¼šå…¨éƒ¨å¤åˆ¶åˆ°ht[0]</li><li>å“ˆå¸Œè¡¨ä½¿ç”¨é“¾åœ°å€æ³•æ¥è§£å†³å†²çª</li><li>é‡‡ç”¨æ¸è¿›å¼rehashï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§ï¼Œé›†ä¸­å¼å®Œæˆï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼å®Œæˆã€‚rehashä¼šä¸å¢åˆ æ”¹ç­‰æ“ä½œä¸€èµ·è¿›è¡Œï¼š</li></ol><h3 id="æ¸è¿›å¼hashæ€»ç»“ï¼š"><a href="#æ¸è¿›å¼hashæ€»ç»“ï¼š" class="headerlink" title="æ¸è¿›å¼hashæ€»ç»“ï¼š"></a><strong>æ¸è¿›å¼hashæ€»ç»“ï¼š</strong></h3><p>åœ¨æ‰©å®¹å’Œæ”¶ç¼©çš„æ—¶å€™ï¼Œå¦‚æœå“ˆå¸Œå­—å…¸ä¸­æœ‰å¾ˆå¤šå…ƒç´ ï¼Œä¸€æ¬¡æ€§å°†è¿™äº›é”®å…¨éƒ¨rehashåˆ°ht[1]çš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨åœ¨ä¸€æ®µæ—¶é—´å†…åœæ­¢æœåŠ¡ã€‚æ‰€ä»¥ï¼Œé‡‡ç”¨æ¸è¿›å¼rehashçš„æ–¹å¼ï¼Œè¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ä¸ºht[1]åˆ†é…ç©ºé—´ï¼Œè®©å­—å…¸åŒæ—¶æŒæœ‰ht[0]å’Œht[1]ä¸¤ä¸ªå“ˆå¸Œè¡¨</li><li>å°†rehashindexçš„å€¼è®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºrehashå·¥ä½œæ­£å¼å¼€å§‹</li><li>åœ¨rehashæœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œæ˜¯ï¼Œç¨‹åºé™¤äº†æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œä»¥å¤–ï¼Œè¿˜ä¼šé¡ºå¸¦å°†ht[0]å“ˆå¸Œè¡¨åœ¨rehashindexç´¢å¼•ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹rehashåˆ°ht[1]ï¼Œå½“rehashå·¥ä½œå®Œæˆä»¥åï¼Œrehashindexçš„å€¼+1</li><li>éšç€å­—å…¸æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œæœ€ç»ˆä¼šåœ¨æŸä¸€æ—¶é—´æ®µä¸Šht[0]çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½ä¼šè¢«rehashåˆ°ht[1]ï¼Œè¿™æ—¶å°†rehashindexçš„å€¼è®¾ç½®ä¸º-1ï¼Œè¡¨ç¤ºrehashæ“ä½œç»“æŸ</li></ol><p><strong>æ¸è¿›å¼rehashé‡‡ç”¨çš„æ˜¯ä¸€ç§åˆ†è€Œæ²»ä¹‹çš„æ–¹å¼ï¼Œå°†rehashçš„æ“ä½œåˆ†æ‘Šåœ¨æ¯ä¸€ä¸ªçš„è®¿é—®ä¸­ï¼Œé¿å…é›†ä¸­å¼rehashè€Œå¸¦æ¥çš„åºå¤§è®¡ç®—é‡ã€‚</strong></p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨æ¸è¿›å¼rehashçš„è¿‡ç¨‹ï¼Œå¦‚æœæœ‰å¢åˆ æ”¹æŸ¥æ“ä½œæ—¶ï¼Œå¦‚æœ<strong><strong>index</strong></strong>å¤§äº**<strong>rehashindex</strong></strong>ï¼Œè®¿é—®<strong><strong>ht[0]</strong></strong>ï¼Œå¦åˆ™è®¿é—®**<strong>ht[1]ã€‚</strong></p><h3 id="è·³è·ƒè¡¨"><a href="#è·³è·ƒè¡¨" class="headerlink" title="è·³è·ƒè¡¨"></a>è·³è·ƒè¡¨</h3><ul><li>æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®ç»“æ„ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶ä»–çš„èŠ‚ç‚¹æŒ‡é’ˆï¼Œé€šè¿‡ç»´æŒç´¢å¼•å±‚ï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿè®¿é—®çš„ç›®çš„ã€‚</li><li>ä¸€å®šç¨‹åº¦æ¥è®²ï¼Œè·³è¡¨æ˜¯ç®€åŒ–ç‰ˆçš„çº¢é»‘æ ‘ï¼Œå¹³å‡å¤æ‚åº¦ä¸ºlognï¼Œå·®åˆ«æ˜¯ç©ºé—´å¤æ‚åº¦ä¼š</li></ul><p>åº”ç”¨ï¼šæœ‰åºé›†åˆã€é›†ç¾¤èŠ‚ç‚¹ä¸­ç”¨ä½œå†…éƒ¨æ•°æ®ç»“æ„</p><h3 id="æ•´æ•°é›†åˆ"><a href="#æ•´æ•°é›†åˆ" class="headerlink" title="æ•´æ•°é›†åˆ"></a>æ•´æ•°é›†åˆ</h3><p>æ•´æ•°é›†åˆæ˜¯é›†åˆé”®ï¼ˆsetï¼‰çš„å®ç°ä¹‹ä¸€ï¼Œå½“é›†åˆéƒ½æ˜¯æ•´æ•°ï¼Œä¸”æ•°ç›®ä¸å¤šæ—¶ï¼Œä¼šä½¿ç”¨æ•´æ•°é›†åˆä½œä¸ºåº•å±‚çš„å®ç°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef struct intset &#123;</span><br><span class="line">    uint32_t encoding;// è¡¨æ˜äº†æ•´æ•°é›†åˆçš„ç±»å‹ï¼Œå¦‚int16 int32 int64</span><br><span class="line">    uint32_t length;</span><br><span class="line">    int8_t contents[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå½“æ–°å¢å…ƒç´ è¶…è¿‡å…ƒç´ çš„å¯è¡¨ç¤ºèŒƒå›´ï¼Œä¼šå°†å·²å­˜å‚¨å…ƒç´ è¿›è¡Œå‡çº§ï¼ˆæ¯”å¦‚åŸæ¥æ˜¯uint32ï¼Œä½†æ˜¯æ–°å¢å…ƒç´ æ˜¯uint64,ï¼Œä¼šæŠŠå·²å­˜å‚¨å…ƒç´ éƒ½å‡çº§ä¸ºuint64ï¼‰ã€‚ä¼˜åŠ¿ï¼š</p><ol><li>æä¾›çµæ´»æ€§</li><li>èŠ‚çº¦å†…å­˜</li></ol><h3 id="å‹ç¼©åˆ—è¡¨"><a href="#å‹ç¼©åˆ—è¡¨" class="headerlink" title="å‹ç¼©åˆ—è¡¨"></a>å‹ç¼©åˆ—è¡¨</h3><p>æŒ‰ç…§å…ƒç´ å ç”¨å¤§å°è¿›è¡Œè®¾è®¡çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šæœ‰ä¸€ä¸ªlengthå­—æ®µï¼Œé€šè¿‡å…¶å¯ä»¥è®¡ç®—å‡ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ã€‚ä¸åŒäºæ•°ç»„ï¼Œè¿™ä¹ˆåšå¯ä»¥èŠ‚çœå†…å­˜</p><p>åº”ç”¨ï¼šåˆ—è¡¨å’Œå“ˆå¸Œï¼Œéƒ½æ˜¯å…¶æ•°æ®é‡å°‘ï¼Œä¸”æ•°æ®å ç”¨è¾ƒå°çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨è¯¥æ•°æ®ç»“æ„ï¼Œä¸ç„¶å°±æ˜¯é“¾è¡¨å’Œå­—å…¸äº†ã€‚</p><h2 id="åŸºç¡€æ•°æ®ç±»å‹"><a href="#åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="åŸºç¡€æ•°æ®ç±»å‹"></a>åŸºç¡€æ•°æ®ç±»å‹</h2><p>Redisæ˜¯key-valueæ•°æ®åº“ï¼Œkeyçš„ç±»å‹åªèƒ½æ˜¯Stringï¼Œä½†æ˜¯valueçš„æ•°æ®ç±»å‹å°±æ¯”è¾ƒä¸°å¯Œäº†ï¼Œä¸»è¦åŒ…æ‹¬äº”ç§ï¼š</p><h3 id="Stringï¼š"><a href="#Stringï¼š" class="headerlink" title="Stringï¼š"></a>Stringï¼š</h3><ol><li>stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„</li><li>ä¸€ä¸ªé”®æœ€å¤§èƒ½å­˜å‚¨512MBçš„æ•°æ®ï¼Œåº•å±‚æ˜¯ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰ï¼šå†…éƒ¨æœ‰ä¸ªå‡½æ•°checkStringLengthä¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œæ ¡éªŒï¼Œé»˜è®¤å°±æ˜¯512MBï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹è¿™ä¸ªå€¼</li></ol><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>æ˜¯ä¸€ä¸ªé”®å€¼(key&#x3D;&gt;value)å¯¹é›†åˆã€‚ Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚åº•å±‚ä½¿ç”¨å‹ç¼©åˆ—è¡¨å’Œå­—å…¸</p><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>åº•å±‚ä½¿ç”¨å‹ç¼©åˆ—è¡¨å’Œé“¾è¡¨å®ç°</p><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>åº•å±‚ä½¿æ•´æ•°é›†åˆå’Œå­—å…¸å®ç°ï¼Œkeyä¸å…è®¸é‡å¤</p><h3 id="Sorted-Set"><a href="#Sorted-Set" class="headerlink" title="Sorted Set"></a>Sorted Set</h3><p>æœ‰åºé›†åˆï¼Œä¸å…è®¸é‡å¤ã€‚ç›¸å¯¹äºsetï¼Œæ”¯æŒæŒ‰ç…§scoreæ’åºï¼Œkeyä¸å…è®¸é‡å¤ï¼Œä½†æ˜¯scoreå…è®¸é‡å¤ï¼Œåº•å±‚å®ç°ä½¿ç”¨åˆ°äº†å‹ç¼©åˆ—è¡¨å’Œè·³è¡¨</p><h2 id="slot"><a href="#slot" class="headerlink" title="slot"></a>slot</h2><p>åœ¨redisé›†ç¾¤å†…éƒ¨ï¼Œé‡‡ç”¨slotæ§½ä½çš„é€»è¾‘ç®¡ç†æ–¹å¼ï¼Œ é›†ç¾¤å†…éƒ¨å…±æœ‰16384(2çš„14æ¬¡æ–¹)ä¸ªSlotï¼Œé›†ç¾¤å†…æ¯ä¸ªRedis Instanceè´Ÿè´£å…¶ä¸­ä¸€éƒ¨åˆ†çš„Slotçš„è¯»å†™ã€‚ä¸€ä¸ªKeyåˆ°åº•å±äºå“ªä¸ªSlotï¼Œç”±åˆ†ç‰‡ç®—æ³•ï¼š</p><p>crc16(key) % 16384</p><p>å†³å®šã€‚ä¹Ÿæ­£æ˜¯é€šè¿‡æ­¤åˆ†ç‰‡ç®—æ³•ï¼Œå°†ä¸åŒçš„keyä»¥ç›¸å¯¹å‡åŒ€çš„æ–¹å¼åˆ†é…åˆ°ä¸åŒçš„slotä¸Šã€‚</p><h2 id="watchï¼šå½“æ‰§è¡Œå¤šé”®å€¼äº‹åŠ¡æ“ä½œæ—¶ï¼ŒRedisä¸ä»…è¦æ±‚è¿™äº›é”®å€¼éœ€è¦è½åœ¨åŒä¸€ä¸ªRediså®ä¾‹ä¸Šï¼Œè¿˜è¦æ±‚è½åœ¨åŒä¸€ä¸ªslotä¸Šã€‚"><a href="#watchï¼šå½“æ‰§è¡Œå¤šé”®å€¼äº‹åŠ¡æ“ä½œæ—¶ï¼ŒRedisä¸ä»…è¦æ±‚è¿™äº›é”®å€¼éœ€è¦è½åœ¨åŒä¸€ä¸ªRediså®ä¾‹ä¸Šï¼Œè¿˜è¦æ±‚è½åœ¨åŒä¸€ä¸ªslotä¸Šã€‚" class="headerlink" title="watchï¼šå½“æ‰§è¡Œå¤šé”®å€¼äº‹åŠ¡æ“ä½œæ—¶ï¼ŒRedisä¸ä»…è¦æ±‚è¿™äº›é”®å€¼éœ€è¦è½åœ¨åŒä¸€ä¸ªRediså®ä¾‹ä¸Šï¼Œè¿˜è¦æ±‚è½åœ¨åŒä¸€ä¸ªslotä¸Šã€‚"></a>watchï¼šå½“æ‰§è¡Œå¤šé”®å€¼äº‹åŠ¡æ“ä½œæ—¶ï¼ŒRedisä¸ä»…è¦æ±‚è¿™äº›é”®å€¼éœ€è¦è½åœ¨åŒä¸€ä¸ªRediså®ä¾‹ä¸Šï¼Œè¿˜è¦æ±‚è½åœ¨åŒä¸€ä¸ªslotä¸Šã€‚</h2><p>å®˜æ–¹ä»‹ç»MULTI ã€ EXEC ã€ DISCARD å’Œ WATCH æ˜¯ Redis äº‹åŠ¡ç›¸å…³çš„å‘½ä»¤ï¼Œäº‹åŠ¡å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä½†æ˜¯å¿…é¡»æ»¡è¶³2ä¸ªæ¡ä»¶ï¼š</p><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚<br>äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼šäº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚æ‰§è¡Œå’Œæ˜¯å¦æˆåŠŸæ˜¯2ä¸ªæ¦‚å¿µï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¤±è´¥æŠ¥é”™ç­‰ï¼Œå…¶ä»–å°±å¤±è´¥ã€‚rediså¯¹äº‹åŠ¡æ˜¯éƒ¨åˆ†æ”¯æŒã€‚å¦‚æœæœ€å¼€å§‹è¯­æ³•ç­‰å°±æœ‰æäº¤é”™è¯¯ï¼Œå°±ç›¸å½“äºjavaçš„ç¼–è¯‘å™¨éƒ½è¿‡ä¸äº†ï¼Œé‚£ä¹ˆè‚¯å®šå…¨éƒ¨ä¸æ‰§è¡Œã€‚å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ï¼Œå·²ç»å…¨éƒ¨æ‰§è¡Œäº†ï¼Œä½†æ˜¯è°æŠ¥é”™æ‰¾è°ï¼Œå…¶ä»–æ­£å¸¸æ‰§è¡Œæ”¾è¡Œã€‚å„å–æ‰€éœ€ï¼è¿™é‡Œçš„äº‹åŠ¡å¹¶ä¸æ˜¯è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œå…¨éƒ¨æ‰§è¡Œå’Œå…¨éƒ¨æˆåŠŸï¼ˆæˆ–è€…éƒ½å¤±è´¥ï¼‰æ˜¯2ä¸ªæ¦‚å¿µã€‚</p><h2 id="hashtag"><a href="#hashtag" class="headerlink" title="hashtag"></a><a href="https://www.cnblogs.com/kismetv/p/9853040.html#t54">hashtag</a></h2><p>Hash TagåŸç†æ˜¯ï¼šå½“ä¸€ä¸ªkeyåŒ…å« {} çš„æ—¶å€™ï¼Œä¸å¯¹æ•´ä¸ªkeyåšhashï¼Œè€Œä»…å¯¹ {}åŒ…æ‹¬çš„å­—ç¬¦ä¸²åšhashã€‚</p><p>Hash Tagå¯ä»¥è®©ä¸åŒçš„keyæ‹¥æœ‰ç›¸åŒçš„hashå€¼ï¼Œä»è€Œåˆ†é…åœ¨åŒä¸€ä¸ªæ§½é‡Œï¼›è¿™æ ·é’ˆå¯¹ä¸åŒkeyçš„æ‰¹é‡æ“ä½œ(mget&#x2F;msetç­‰)ï¼Œä»¥åŠäº‹åŠ¡ã€Luaè„šæœ¬ç­‰éƒ½å¯ä»¥æ”¯æŒã€‚ä¸è¿‡Hash Tagå¯èƒ½ä¼šå¸¦æ¥æ•°æ®åˆ†é…ä¸å‡çš„é—®é¢˜ï¼Œè¿™æ—¶éœ€è¦ï¼š(1)è°ƒæ•´ä¸åŒèŠ‚ç‚¹ä¸­æ§½çš„æ•°é‡ï¼Œä½¿æ•°æ®åˆ†å¸ƒå°½é‡å‡åŒ€ï¼›(2)é¿å…å¯¹çƒ­ç‚¹æ•°æ®ä½¿ç”¨Hash Tagï¼Œå¯¼è‡´è¯·æ±‚åˆ†å¸ƒä¸å‡ã€‚</p><h2 id="bigkey"><a href="#bigkey" class="headerlink" title="bigkey"></a><a href="https://blog.csdn.net/huxianbo0807/article/details/102912172">bigkey</a></h2><ul><li>æ¶‰åŠåˆ°bigkeyçš„æ“ä½œï¼Œç½‘å¡ä¼šæˆä¸ºç“¶é¢ˆ</li><li>è‹¥éœ€è¦åˆ é™¤bigkeyï¼Œç›´æ¥delï¼Œè¢«æ“ä½œçš„å®ä¾‹å¯èƒ½ä¼šç›´æ¥å¡æ­»</li><li>ä¸šåŠ¡ä¸Šå¯¹bigkeyå–ä½™ï¼Œå°†æ•°æ®åˆ†æ•£ï¼Œé¿å…ç”Ÿæˆbigkey</li></ul><h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><ol><li>ä¸€å°redisæœåŠ¡çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å¤šå°redisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹ï¼Œåè€…ä¸ºä»èŠ‚ç‚¹</li><li>æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ä»ä¸»èŠ‚ç‚¹å¤åˆ¶åˆ°ä»èŠ‚ç‚¹</li></ol><ul><li>ä½œç”¨ï¼š</li></ul><ol><li>æ•°æ®å†—ä½™ï¼šå®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„æ•°æ®å†—ä½™æ–¹å¼</li><li>æ•…éšœæ¢å¤ï¼šä¸»èŠ‚ç‚¹å¤±æ•ˆï¼Œä¸›èŠ‚ç‚¹æä¾›æœåŠ¡</li><li>è´Ÿè½½å‡è¡¡ï¼šå®ç°è¯»å†™åˆ†ç¦»ï¼Œä¸»èŠ‚ç‚¹å†™ï¼Œä¸›èŠ‚ç‚¹è¯»</li><li>é«˜å¯ç”¨çš„åŸºç¡€ï¼šä¸»ä»å¤åˆ¶æ˜¯å“¨å…µå’Œé›†ç¾¤æ¨¡å¼èƒ½å¤Ÿå®æ–½çš„åŸºç¡€</li></ol><ul><li>æ•°æ®åŒæ­¥ï¼š</li></ul><ol><li><strong>ä¸»ä»èŠ‚ç‚¹è¿æ¥å»ºç«‹</strong>åï¼Œä¾¿å¼€å§‹æ•°æ®åŒæ­¥ã€‚</li><li>æ ¹æ®<strong>ä¸»ä»èŠ‚ç‚¹å½“å‰çŠ¶æ€</strong>ï¼Œåˆ†ä¸ºå…¨é‡å’Œéƒ¨åˆ†å¤åˆ¶</li><li>å…·ä½“æ‰§è¡Œæ–¹å¼ï¼šä»èŠ‚ç‚¹æœä¸»èŠ‚ç‚¹å‘é€psyncå‘½ä»¤ï¼Œå¼€å§‹åŒæ­¥</li></ol><ul><li>å‘½ä»¤ä¼ æ’­ï¼š<br>  ä¸»ä»æ•°æ®åŒæ­¥å®Œæˆåï¼Œä¸»èŠ‚ç‚¹å°†è‡ªå·±æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä¸›èŠ‚ç‚¹ï¼ˆè¯¥è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼‰ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ul><h3 id="å“¨å…µ"><a href="#å“¨å…µ" class="headerlink" title="å“¨å…µ"></a>å“¨å…µ</h3><ol><li>èƒ½å¤Ÿè‡ªåŠ¨å®Œæˆæ•…éšœå‘ç°å’Œè½¬ç§»ï¼Œä»è€Œå®ç°é«˜å¯ç”¨</li><li>ç”±ä¸€ç»„å“¨å…µèŠ‚ç‚¹å’Œä¸€ç»„ï¼ˆæˆ–å¤šç»„ï¼‰ä¸»ä»å¤åˆ¶èŠ‚ç‚¹ç»„æˆ</li></ol><ul><li>å¿ƒè·³æœºåˆ¶</li><li>æ•…éšœè½¬ç§»</li></ul><ol><li>æ¯ä¸ª Sentinel éƒ½ä¼šå®šæ—¶è¿›è¡Œå¿ƒè·³æ£€æŸ¥ï¼Œå½“å‘ç°ä¸»èŠ‚ç‚¹å‡ºç°å¿ƒè·³æ£€æµ‹è¶…æ—¶çš„æƒ…å†µæ—¶ï¼Œæ­¤æ—¶è®¤ä¸ºè¯¥ä¸»èŠ‚ç‚¹å·²ç»ä¸å¯ç”¨ï¼Œè¿™ç§åˆ¤å®šç§°ä¸º<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€‚</li><li>å“¨å…µèŠ‚ç‚¹å¼€å§‹æŠ•ç¥¨ï¼Œå½“<strong>è¶…è¿‡åŠæ•°</strong>è®¤ä¸ºè¯¥ä¸»èŠ‚ç‚¹æ•…éšœï¼Œä¼šå°†å…¶ä¸‹çº¿ï¼šåŸºäºraftç®—æ³•ï¼Œé€‰å–ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹æ¥æ‰§è¡Œè¯¥è¿‡ç¨‹</li></ol><ul><li>é€‰å–ä¸€ä¸ªä»èŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œå°†å…¶ä»–ä»èŠ‚ç‚¹å’Œè¯¥èŠ‚ç‚¹ç»‘å®š</li><li>åŸæ¥çš„ä¸»èŠ‚ç‚¹æ›´æ–°ä¸ºä»èŠ‚ç‚¹ï¼Œå¯¹å…¶ç›‘æ§ï¼Œç­‰æ¢å¤åï¼Œå‘½ä»¤å…¶å»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹</li></ul><h3 id="clusteré›†ç¾¤"><a href="#clusteré›†ç¾¤" class="headerlink" title="clusteré›†ç¾¤"></a>clusteré›†ç¾¤</h3><ol><li>ç”±å¤šä¸ªä¸»ä»å¤åˆ¶çš„ç»“æ„ç»„æˆ</li><li>æ¯ä¸ªä¸»ä»å¤åˆ¶çš„ç»“æ„çœ‹åšä¸€ä¸ªèŠ‚ç‚¹</li></ol><h2 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h2><h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><p>ä¼˜åŠ¿ï¼š</p><ol><li>RDB æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘ï¼ˆcompactï¼‰çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½“ç§¯å°ï¼Œå› æ­¤åœ¨ä¼ è¾“é€Ÿåº¦ä¸Šæ¯”è¾ƒå¿«ï¼Œå› æ­¤é€‚åˆç¾éš¾æ¢å¤ã€‚</li><li>æ•°æ®æ¢å¤é€Ÿåº¦æ¯”aofå¿«</li></ol><p>åŠ£åŠ¿ï¼š</p><ol><li>rdbå‡ºç°æ•…éšœä¸¢çš„æ•°æ®ä¼šæ¯”aofå¤šã€‚ä½ é€šå¸¸ä¼šæ¯éš”5åˆ†é’Ÿæˆ–è€…æ›´ä¹…åšä¸€æ¬¡å®Œæ•´çš„ä¿å­˜,ä¸‡ä¸€åœ¨ Redis æ„å¤–å®•æœº,ä½ å¯èƒ½ä¼šä¸¢å¤±å‡ åˆ†é’Ÿçš„æ•°æ®ã€‚</li><li>rdbéœ€è¦forkå­è¿›ç¨‹æ¥ä¿å­˜æ•°æ®åˆ°ç¡¬ç›˜ï¼Œå½“æ•°æ®é›†æ¯”è¾ƒå¤§æ—¶ï¼Œ forkæ¯”è¾ƒè€—æ—¶ï¼Œä»è€Œå¯¼è‡´redisä¸»çº¿ç¨‹åœ¨ä¸€äº›æ¯«ç§’çº§åˆ«å†…æ— æ³•å“åº”å®¢æˆ·ç«¯</li></ol><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><p>ä¼˜åŠ¿ï¼š</p><ol><li>æ•°æ®æ›´å®Œæ•´ï¼Œç§’çº§ä¸¢å¤±ï¼ˆæ—  fsyncã€æ¯ç§’ fsync ã€æ¯æ¬¡å†™çš„æ—¶å€™ fsync ï¼‰</li><li>å…¼å®¹æ€§é«˜ï¼Œæ˜¯åŸºäºredisé€šè®¯åè®®è€Œå½¢æˆçš„å‘½ä»¤è¿½åŠ æ–¹å¼ï¼Œæ— è®ºä½•ç§ç‰ˆæœ¬çš„rediséƒ½å…¼å®¹ï¼Œ</li><li>aofæ–‡ä»¶æ˜¯æ˜æ–‡çš„ï¼Œå¯é˜…è¯»æ€§è¾ƒå¥½ã€‚</li></ol><p>åŠ£åŠ¿ï¼š</p><ol><li>æ•°æ®æ–‡ä»¶å¤§ï¼Œå³ä½¿æœ‰é‡å†™æœºåˆ¶ï¼ˆåˆå¹¶å‘½ä»¤ã€åˆ å‡æ— ç”¨å‘½ä»¤ï¼‰ï¼Œä½†æ˜¯åŒæ ·é‡çº§è¿˜æ˜¯æ¯”rdbå ç”¨å¤§</li><li>æ•°æ®æ¢å¤æ…¢</li><li>aofæ›´åƒæ€§èƒ½ï¼ˆéœ€è¦é¢‘ç¹åŒæ­¥å‘½ä»¤ï¼Œè™½ç„¶ä¼šå…ˆå†™åˆ°å†…å­˜ä¸­ï¼Œå†åŒæ­¥åˆ°ç£ç›˜é‡Œï¼‰</li></ol><h3 id="æ··åˆæŒä¹…åŒ–"><a href="#æ··åˆæŒä¹…åŒ–" class="headerlink" title="æ··åˆæŒä¹…åŒ–"></a>æ··åˆæŒä¹…åŒ–</h3><p>æ··åˆæŒä¹…åŒ–ç»“åˆäº†RDBæŒä¹…åŒ– å’Œ AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹, ç”±äºç»å¤§éƒ¨åˆ†éƒ½æ˜¯RDBæ ¼å¼ï¼ŒåŠ è½½é€Ÿåº¦å¿«ï¼ŒåŒæ—¶ç»“åˆAOFï¼Œå¢é‡çš„æ•°æ®ä»¥AOFæ–¹å¼ä¿å­˜äº†ï¼Œæ•°æ®æ›´å°‘çš„ä¸¢å¤±ã€‚</p><h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><h3 id="redisåˆ†å¸ƒå¼é”"><a href="#redisåˆ†å¸ƒå¼é”" class="headerlink" title="redisåˆ†å¸ƒå¼é”"></a>redisåˆ†å¸ƒå¼é”</h3><p>rediså®ç°åˆ†å¸ƒå¼é”å¸¸è§çš„æœ‰ä»¥å¾ˆå¤šï¼Œå®˜æ–¹æ¨èä¸‹é¢çš„è¿™ç§å®ç°ï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬ç›®å‰çš„æ–¹å¼ï¼‰</p><p>setå‘½ä»¤åŠ é”ï¼Œluaè„šæœ¬é‡Šæ”¾é”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET key value NX PX milliseconds</span><br></pre></td></tr></table></figure><ul><li>key: èµ„æºçš„key,æ ‡è¯†ä¸€ç§èµ„æºã€‚</li><li>value: æ­¤å€¼å¿…é¡»åœ¨æ‰€æœ‰è¿›ç¨‹å’Œæ‰€æœ‰è·å–é”çš„è¯·æ±‚ä¸­éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li>NX: è¯¥å‘½ä»¤ä»…åœ¨keyä¸å­˜åœ¨æ—¶æ‰è®¾ç½®ã€‚</li><li>PX <em>milliseconds</em>: è¿‡æœŸæ—¶é—´,å•ä½ä¸ºæ¯«ç§’ã€‚</li></ul><p>è¿™é‡Œçš„value,è®¾ç½®ä¸ºå”¯ä¸€å€¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†é‡Šæ”¾é”ï¼Œè‡ªå·±åªèƒ½é‡Šæ”¾è‡ªå·±åŠ çš„é”ã€‚æ³¨æ„åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä¹Ÿå¯ä»¥ä¸é‡Šæ”¾é”ï¼Œå› ä¸ºæœ¬èº«è®¾ç½®äº†æœ‰æ•ˆæœŸã€‚</p><p>é‡Šæ”¾é”ä¸€èˆ¬æ˜¯é€šè¿‡æ‰§è¡Œä¸‹é¢çš„luaè„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if redis.call(&quot;get&quot;,KEYS[1]) == ARGV[1] then</span><br><span class="line">    return redis.call(&quot;del&quot;,KEYS[1])</span><br><span class="line">else</span><br><span class="line">    return 0</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h4 id="å­˜åœ¨çš„é—®é¢˜ï¼š"><a href="#å­˜åœ¨çš„é—®é¢˜ï¼š" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜ï¼š"></a>å­˜åœ¨çš„é—®é¢˜ï¼š</h4><p>å¯¹äºRedisä¸»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å¤åˆ¶æ˜¯å¼‚æ­¥å¤åˆ¶çš„ï¼Œå½“å®¢æˆ·ç«¯å‘é€å†™è¯·æ±‚ç»™masterèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šè¿”å›OKï¼ˆè¿™ä¸ªæ—¶å€™Aå·²ç»è·å¾—é”ï¼‰ï¼Œç„¶ååŒæ­¥åˆ°å„ä¸ªslaveèŠ‚ç‚¹ä¸­ã€‚å¦‚æœæ­¤æ—¶masterè¿˜æ²¡æ¥å¾—åŠåŒæ­¥ç»™slaveèŠ‚ç‚¹æ—¶å‘ç”Ÿå®•æœºï¼Œé‚£ä¹ˆmasterå†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±ï¼ˆè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´Bä¹Ÿèƒ½è·å¾—é”ï¼‰ã€‚</p><h4 id="redlock"><a href="#redlock" class="headerlink" title="redlock:"></a>redlock:</h4><p>å®ƒçš„åŸºæœ¬æ€è·¯å°±æ˜¯ä¸ºé”å‡†å¤‡å¤šä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ï¼Œåœ¨é”è¿‡æœŸæ—¶é—´å†…åªè¦è¶…è¿‡åŠæ•°è·å–åˆ°é”ï¼Œå°±ç®—æˆåŠŸï¼Œé¿å…redisä¸»ä»åˆ‡æ¢çš„æ—¶å€™ï¼Œæ•°æ®ä¸¢å¤±ã€‚</p><ul><li>é—®é¢˜ï¼š</li></ul><ol><li>å®•æœºé‡å¯åï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯æ‹¿åˆ°åŒä¸€æŠŠé”</li></ol><p>å‡è®¾5ä¸ªèŠ‚ç‚¹æ˜¯A, B, C, D, Eï¼Œå®¢æˆ·ç«¯1åœ¨A, B, Cä¸Šé¢æ‹¿åˆ°é”ï¼ŒD, Eæ²¡æœ‰æ‹¿åˆ°é”ï¼Œå®¢æˆ·ç«¯1æ‹¿é”æˆåŠŸã€‚ æ­¤æ—¶ï¼ŒCæŒ‚äº†é‡å¯ï¼ŒCä¸Šé¢é”çš„æ•°æ®ä¸¢å¤±ï¼ˆå‡è®¾æœºå™¨æ–­ç”µï¼Œæ•°æ®è¿˜æ²¡æ¥å¾—åŠåˆ·ç›˜ï¼‰ã€‚å®¢æˆ·ç«¯2å»å–é”ï¼Œä»C, D, E 3ä¸ªèŠ‚ç‚¹æ‹¿åˆ°é”ï¼ŒA, Bæ²¡æœ‰æ‹¿åˆ°ï¼ˆè¿˜è¢«å®¢æˆ·ç«¯1æŒæœ‰ï¼‰ï¼Œå®¢æˆ·ç«¯2ä¹Ÿè¶…è¿‡å¤šæ•°æ´¾ï¼Œä¹Ÿä¼šæ‹¿åˆ°é”</p><p>è§£å†³æ–¹æ¡ˆï¼šå»¶è¿Ÿé‡å¯ï¼Œç­‰å¾…ttlä¹‹åå†é‡å¯ã€‚</p><ol start="2"><li>æ—¶é’Ÿè·³è·ƒï¼šæ˜¯æŒ‡ç³»ç»Ÿæ—¶é—´å‘ç”Ÿäº†è·³è·ƒ</li></ol><p>æ—¶é’Ÿè·³è·ƒå¯èƒ½å»¶è¿Ÿé‡å¯æœºåˆ¶å¤±æ•ˆï¼Œæ—¶é’Ÿè·³è·ƒå¯èƒ½å¯¼è‡´æœºå™¨æŒ‚äº†ç«‹é©¬é‡å¯ï¼Œä»è€Œå‡ºç°ä¸Šé¢çš„é—®é¢˜ã€‚æ—¶é’Ÿè·³è·ƒå¯èƒ½å¯¼è‡´å®¢æˆ·ç«¯æ‹¿åˆ°é”ä¹‹åç«‹é©¬å¤±æ•ˆï¼Œè·ŸæœåŠ¡å™¨æŒ‚æ‰ç±»ä¼¼ã€‚åŸºäºè‡ªåŠ¨è¿‡æœŸæœºåˆ¶ï¼Œä¾ç„¶æ²¡æœ‰è§£å†³é•¿æ—¶é—´çš„gc pauseç­‰é—®é¢˜å¸¦æ¥çš„é”è‡ªåŠ¨å¤±æ•ˆï¼Œä»è€Œå¸¦æ¥çš„å®‰å…¨æ€§é—®é¢˜</p><h3 id="zookeeperåˆ†å¸ƒå¼é”"><a href="#zookeeperåˆ†å¸ƒå¼é”" class="headerlink" title="zookeeperåˆ†å¸ƒå¼é”"></a>zookeeperåˆ†å¸ƒå¼é”</h3><ul><li><p>ä½¿ç”¨ ZK çš„ä¸´æ—¶èŠ‚ç‚¹å’Œæœ‰åºèŠ‚ç‚¹ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–é”å°±æ˜¯åœ¨ ZK åˆ›å»ºä¸€ä¸ªä¸´æ—¶æœ‰åºçš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚åœ¨ &#x2F;lock&#x2F; ç›®å½•ä¸‹</p></li><li><p>åˆ›å»ºèŠ‚ç‚¹æˆåŠŸåï¼Œè·å– &#x2F;lock ç›®å½•ä¸‹çš„æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹ï¼Œå†åˆ¤æ–­å½“å‰çº¿ç¨‹åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹çš„åºå·æœ€å°çš„èŠ‚ç‚¹</p></li><li><p>å¦‚æœå½“å‰çº¿ç¨‹åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯æ‰€æœ‰èŠ‚ç‚¹åºå·æœ€å°çš„èŠ‚ç‚¹ï¼Œåˆ™è®¤ä¸ºè·å–é”æˆåŠŸ</p></li><li><p>å¦‚æœå½“å‰çº¿ç¨‹åˆ›å»ºçš„èŠ‚ç‚¹ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹åºå·æœ€å°çš„èŠ‚ç‚¹ï¼Œåˆ™å¯¹èŠ‚ç‚¹åºå·çš„å‰ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬ã€‚</p></li></ul><h3 id="redis-zkå¯¹æ¯”"><a href="#redis-zkå¯¹æ¯”" class="headerlink" title="redis zkå¯¹æ¯”"></a>redis zkå¯¹æ¯”</h3><ul><li>Zookeeperçš„åˆ†å¸ƒå¼é”æ˜¯å®¢æˆ·ç«¯åŸºäºåˆ›å»ºä¸´æ—¶èŠ‚ç‚¹å®ç°çš„ï¼Œå¯¹äºæ’ä»–é”ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½å°è¯•åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æˆåŠŸåˆ›å»ºï¼Œåˆ›å»ºæˆåŠŸåˆ™ç›¸å½“äºè·å–äº†é”ã€‚å¯¹äºå…±äº«é”ï¼Œåˆ™ä¼šæŒ‰ç…§ä¸€å®šçš„é¡ºåºé˜Ÿåˆ—åˆ›å»ºå¸¦åºå·çš„ä¸´æ—¶èŠ‚ç‚¹å¹¶å°è¯•è·å–é”ï¼ˆå¯ä»¥æœ‰å¤šä¸ªå®¢æˆ·ç«¯è·å–å…±äº«é”ï¼‰ã€‚Redisçš„åˆ†å¸ƒå¼é”åˆ™æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªä»æœªåˆ›å»ºè¿‡çš„keyå¹¶è®¾ç½®å…¶è¿‡æœŸæ—¶é—´å®ç°çš„ï¼Œåˆ›å»ºæˆåŠŸåˆ™è·å¾—äº†é”ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯ä¼šåœ¨ä¸€å®šæ—¶é—´å†…å¾ªç¯è·å–é”ï¼Œæ¯”è¾ƒæ¶ˆè€—æœåŠ¡å™¨æ€§èƒ½ã€‚</li><li>Zookeeperé‡Šæ”¾é”æ—¶ï¼Œè¦ä¹ˆæ­£å¸¸æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘åï¼Œäº‹åŠ¡ä¸»åŠ¨é‡Šæ”¾ï¼Œè¦ä¹ˆæ˜¯æ£€æµ‹åˆ°ä¸å®¢æˆ·ç«¯çš„ä¼šè¯å¤±æ•ˆåé‡Šæ”¾ã€‚Redisé‡Šæ”¾é”æ—¶ï¼Œè¦ä¹ˆæ­£å¸¸æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘åï¼Œäº‹åŠ¡ä¸»åŠ¨é‡Šæ”¾ï¼Œè¦ä¹ˆæ˜¯é”®è¶…æ—¶åé‡Šæ”¾é”ã€‚</li><li>å¯¹äºRedisçš„ä¸»ä»ç»“æ„ä¸­å‡ºç°çš„ä¸»æœåŠ¡å™¨å®•æœºæƒ…å†µï¼ˆå•ç‚¹æ•…éšœï¼‰ï¼Œå®¢æˆ·ç«¯Aå·²ç»è·å–åˆ°é”äº†ï¼Œä½†æ˜¯ä¸»æœåŠ¡å™¨è¿˜æ²¡æ¥å¾—åŠå°†é”®å¤åˆ¶åˆ°ä»æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä»æœåŠ¡å™¨æ™‹å‡ä¸ºäº†ä¸»æœåŠ¡å™¨ï¼Œè¿™æ—¶å®¢æˆ·ç«¯Bä¹Ÿå¯ä»¥è·å–é”ï¼Œé”äº’æ–¥æ•ˆæœå°±å¤±æ•ˆäº†ã€‚å¯ä»¥ä½¿ç”¨RedLockè§£å†³ï¼Œä½†æ˜¯ä¸å»ºè®®ï¼Œå¯ä»¥ä½¿ç”¨Zookeeperã€‚</li><li>Redisæ€§èƒ½æ›´é«˜ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TODO</title>
      <link href="/posts/4947.html"/>
      <url>/posts/4947.html</url>
      
        <content type="html"><![CDATA[<h3 id="Pending-Issues"><a href="#Pending-Issues" class="headerlink" title="Pending Issues"></a>Pending Issues</h3><h3 id="Fixed"><a href="#Fixed" class="headerlink" title="Fixed"></a>Fixed</h3><ul><li><input checked="" disabled="" type="checkbox"> å¤šçº§ç›®å½•æ—¶ï¼Œé€šè¿‡ç›®å½•å®šä½ä¼šå‡ºé—®é¢˜<ul><li>ç›®å½•åä¸€è‡´ï¼Œä½†æ˜¯å±‚çº§å…³ç³»ä¸ä¸€è‡´ï¼Œä¸ä¼šè¢«è§†ä¸ºåŒä¸€ç›®å½•ï¼Œå»ºè®®ä¸è¦è¿™æ ·è®¾ç½®</li></ul></li><li><input checked="" disabled="" type="checkbox"> Obsidian åŒé“¾è½¬ hexo é“¾æ¥<ul><li>å¼•ç”¨hexo-filter-titlebased-link åº“ï¼Œæ·»åŠ é…ç½®é¡¹è§£å†³è¯¥é—®é¢˜</li></ul></li><li><input checked="" disabled="" type="checkbox"> Mermaid ä»£ç å—æ¸²æŸ“å¤±è´¥ï¼Œéœ€è¦å¼•ç”¨ JS è¯­æ³•<ul><li>å¼•ç”¨hexo-filter-mermaid-diagrams åº“ï¼Œä½†æ˜¯é—´æ­‡æ€§è¿˜æ˜¯ä¼šæ¸²æŸ“ä¸å‡ºæ¥ï¼Œæ¨èè¿˜æ˜¯ä½¿ç”¨<strong>æ ‡ç­¾æ’ä»¶ (Tag Plugin)</strong> è¯­æ³•</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid %&#125;</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul><li><p><input checked="" disabled="" type="checkbox"> æœ¬åœ°æµ‹è¯•ç»å¸¸æ€§æŠ¥ fontawesome failure</p><blockquote><pre><code>ä½¿ç”¨éšç§æ¨¡å¼è®¿é—®ï¼Œå¤§æ¦‚ç‡æ²¡é—®é¢˜</code></pre></blockquote></li><li><p><input checked="" disabled="" type="checkbox"> å›¾ç‰‡å¤šå¤§å¤ªå¤§ï¼Œå¯¼è‡´åŠ è½½ç¼“æ…¢çš„é—®é¢˜ã€‚å‚è€ƒ: <a href="https://gemini.google.com/share/320865e42713">https://gemini.google.com/share/320865e42713</a></p><ul><li><input checked="" disabled="" type="checkbox"> é…ç½®å›¾åºŠ(github repo: <a href="%5BSupremes/blog-images%5D(https://github.com/Supremes/blog-images)">blog-images</a>)ï¼Œå¹¶ä½¿ç”¨CDN - <code>cdn.jsdelivr.net </code> åŠ é€Ÿè®¿é—®</li><li><input checked="" disabled="" type="checkbox"> å‹ç¼©å›¾ç‰‡å¤§å°</li></ul></li><li><p><input checked="" disabled="" type="checkbox"> é¦–é¡µæŒ‰ç…§æ›´æ–°æ—¶é—´å±•ç¤ºæ–‡ç« åˆ—è¡¨</p><ul><li>æ›´æ–°æ—¶é—´æ˜¾ç¤ºæœ‰è¯¯ï¼Œå¯¼è‡´åˆ—è¡¨å±•ç¤ºä¹±åºï¼šç”±äºæ˜¯ github action ç¼–è¯‘éƒ¨ç½²ï¼Œä¼šå¯¼è‡´æŠŠæ‰€æœ‰æ–‡ç« ç»Ÿä¸€æ›´æ–°åˆ°ç¼–è¯‘æ—¶é—´ï¼Œå› æ­¤é€‰æ‹©ä½¿ç”¨ Obsidian çš„ Linter æ’ä»¶åº”ç”¨æ›´æ–°æ—¶é—´ã€‚</li><li>é…ç½®æ›´æ–°æ—¶é—´å…·ä½“åˆ°åˆ†é’Ÿ: æ›´æ–° date format å³å¯ - â€˜YYYY MM DD HH:MMâ€™</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ‚ä¸ƒæ‚å…« </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQL å­¦ä¹ ç¬”è®°</title>
      <link href="/posts/8508.html"/>
      <url>/posts/8508.html</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-æ¶æ„"><a href="#MySQL-æ¶æ„" class="headerlink" title="MySQL æ¶æ„"></a>MySQL æ¶æ„</h1><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/MySQL1.png" alt="img"></p><h2 id="è¿æ¥å™¨"><a href="#è¿æ¥å™¨" class="headerlink" title="è¿æ¥å™¨"></a>è¿æ¥å™¨</h2><p>è´Ÿè´£å’Œå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚è¿æ¥å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h $ip -P $port -u $user -p</span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢ç¼“å­˜"><a href="#æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="æŸ¥è¯¢ç¼“å­˜"></a>æŸ¥è¯¢ç¼“å­˜</h2><ol><li><strong>ä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä¼šå»ºè®®ä½ ä¸è¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ã€‚</strong></li></ol><p>æŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ï¼Œåªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚å› æ­¤å¾ˆå¯èƒ½ä½ è´¹åŠ²åœ°æŠŠç»“æœå­˜èµ·æ¥ï¼Œè¿˜æ²¡ä½¿ç”¨å‘¢ï¼Œå°±è¢«ä¸€ä¸ªæ›´æ–°å…¨æ¸…ç©ºäº†ã€‚å¯¹äºæ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½ã€‚é™¤éä½ çš„ä¸šåŠ¡å°±æ˜¯æœ‰ä¸€å¼ é™æ€è¡¨ï¼Œå¾ˆé•¿æ—¶é—´æ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨ï¼Œé‚£è¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚</p><ol start="2"><li><strong>MySQL 8.0 ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ 8.0 å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚</strong></li></ol><h2 id="åˆ†æå™¨"><a href="#åˆ†æå™¨" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h2><p>è¯æ³•ã€è¯­æ³•åˆ†æï¼Œåˆ†æä½ SQLè¯­å¥ä¸­çš„å„ä¸ªå­—æ®µï¼Œç¡®ä¿æ²¡æœ‰å‡ºé”™ã€‚æ¯”å¦‚è¯†åˆ«SELECT å…³é”®å­—ï¼Œè¯†åˆ«å‡ºè¡¨å•åt.</p><p>select * from t;</p><h2 id="ä¼˜åŒ–å™¨"><a href="#ä¼˜åŒ–å™¨" class="headerlink" title="ä¼˜åŒ–å™¨"></a>ä¼˜åŒ–å™¨</h2><ol><li>åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•</li><li>åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåºã€‚æ¯”å¦‚ä½ æ‰§è¡Œä¸‹é¢è¿™æ ·çš„è¯­å¥ï¼Œè¿™ä¸ªè¯­å¥æ˜¯æ‰§è¡Œä¸¤ä¸ªè¡¨çš„ joinï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from t1 join t2 using(ID)  where t1.c=10 and t2.d=20;</span><br></pre></td></tr></table></figure><ul><li>æ—¢å¯ä»¥å…ˆä»è¡¨ t1 é‡Œé¢å–å‡º c&#x3D;10 çš„è®°å½•çš„ ID å€¼ï¼Œå†æ ¹æ® ID å€¼å…³è”åˆ°è¡¨ t2ï¼Œå†åˆ¤æ–­ t2 é‡Œé¢ d çš„å€¼æ˜¯å¦ç­‰äº 20ã€‚</li><li>ä¹Ÿå¯ä»¥å…ˆä»è¡¨ t2 é‡Œé¢å–å‡º d&#x3D;20 çš„è®°å½•çš„ ID å€¼ï¼Œå†æ ¹æ® ID å€¼å…³è”åˆ° t1ï¼Œå†åˆ¤æ–­ t1 é‡Œé¢ c çš„å€¼æ˜¯å¦ç­‰äº 10ã€‚</li></ul><h2 id="æ‰§è¡Œå™¨"><a href="#æ‰§è¡Œå™¨" class="headerlink" title="æ‰§è¡Œå™¨"></a>æ‰§è¡Œå™¨</h2><ol><li>åˆ¤æ–­æ‰§è¡Œæƒé™</li><li>æ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œè°ƒç”¨å¼•æ“æ¥å£å»æ‰§è¡Œ</li></ol><h1 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h1><blockquote><p> å†…å®¹è¯¦è§ - <a  href="/posts/356a30bc.html">MySQL-æ—¥å¿—</a></p></blockquote><h2 id="redo-log-é‡åšæ—¥å¿—"><a href="#redo-log-é‡åšæ—¥å¿—" class="headerlink" title="redo log - é‡åšæ—¥å¿—"></a>redo log - é‡åšæ—¥å¿—</h2><p>é‡‡ç”¨WALï¼ˆWrite - Ahead Loggingï¼‰, å…ˆå†™æ—¥å¿—ï¼Œåå†™ç£ç›˜ã€‚</p><p>è¯¦ç»†ä»‹ç»ï¼š</p><ul><li><a href="https://www.cnblogs.com/zlia/p/14508366.html">https://www.cnblogs.com/zlia/p/14508366.html</a></li><li><a href="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/MySQL%e5%ae%9e%e6%88%9845%e8%ae%b2/02%20%20%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%ef%bc%9a%e4%b8%80%e6%9d%a1SQL%e6%9b%b4%e6%96%b0%e8%af%ad%e5%8f%a5%e6%98%af%e5%a6%82%e4%bd%95%e6%89%a7%e8%a1%8c%e7%9a%84%ef%bc%9f.md">https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/MySQL%e5%ae%9e%e6%88%9845%e8%ae%b2/02%20%20%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%ef%bc%9a%e4%b8%80%e6%9d%a1SQL%e6%9b%b4%e6%96%b0%e8%af%ad%e5%8f%a5%e6%98%af%e5%a6%82%e4%bd%95%e6%89%a7%e8%a1%8c%e7%9a%84%ef%bc%9f.md</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/MySQL_RedoLog.webp" alt="img"></p><h2 id="bin-log"><a href="#bin-log" class="headerlink" title="bin log"></a>bin log</h2><p>å­˜åœ¨äºServerå±‚ã€‚</p><h2 id="Undo-log"><a href="#Undo-log" class="headerlink" title="Undo log"></a>Undo log</h2><p>å­˜å‚¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ•°æ®ä¿®æ”¹å‰çš„<strong>æ—§å€¼ã€‚<strong>ç›®çš„åœ¨</strong>äº‹åŠ¡å›æ»š</strong>æ—¶ï¼Œèƒ½å¤Ÿåˆ©ç”¨è¿™äº›æ—§å€¼ã€‚</p><p>å‡è®¾ä¸€ä¸ªå€¼ä» 1 è¢«æŒ‰é¡ºåºæ”¹æˆäº† 2ã€3ã€4ï¼Œåœ¨<strong>å›æ»šæ—¥å¿—</strong>é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/MySQL2.png" alt="img"></p><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><ul><li>redo logæ˜¯å­˜å‚¨å¼•æ“ç‰¹æœ‰çš„ï¼Œbin logæ˜¯åœ¨Serverå±‚å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚</li><li>redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä½ å°†æŸä¸ªå€¼ç”±1æ”¹æˆ2ï¼Œåˆå°†2æ”¹æˆ3ï¼Œé‚£ä¹ˆæœ€ç»ˆç‰©ç†æ—¥å¿—å‘ˆç°çš„åªæœ‰3ï¼ˆè€Œæ²¡æœ‰è®°å½•3çš„ç”±æ¥ï¼‰ï¼Œåªä¸è¿‡ä¸æ˜¯ç›´æ¥å°†3å†™å…¥ï¼Œå¯èƒ½æ˜¯é‡‡ç”¨åç§»é‡ä¹‹ç±»çš„æ“ä½œæ–¹å¼ï¼ˆæ— å¥ˆæˆ‘çœ‹ä¸æ‡‚ï¼‰ï¼Œbin logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œé€»è¾‘æ—¥å¿—è¡¨ç¤ºè®°å½•ä»1-2-3è¿™æ ·å­çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</li><li>redo logæ˜¯å¾ªç¯å†™çš„ï¼Œå¤§å°æ˜¯å›ºå®šçš„ï¼Œbin logæ˜¯è¿½åŠ çš„æ–¹å¼å†™çš„ï¼Œä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚</li></ul><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Redo Log (é‡åšæ—¥å¿—)</strong></th><th><strong>Bin Log (å½’æ¡£æ—¥å¿—)</strong></th><th><strong>Undo Log (å›æ»šæ—¥å¿—)</strong></th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒå…³é”®è¯</strong></td><td><strong>â€œæ¢å¤â€</strong></td><td><strong>â€œå¤åˆ¶â€</strong></td><td><strong>â€œæ’¤é”€â€</strong></td></tr><tr><td><strong>æ¯”å–»</strong></td><td>è®°è´¦æœ¬çš„è‰ç¨¿ (é˜²æ­¢æ–­ç”µå¿˜äº‹)</td><td>å®Œæ•´çš„è´¦å•æ˜ç»† (ç»™åˆ«äººçœ‹)</td><td><strong>æ©¡çš®æ“¦ &#x2F; Ctrl+Z</strong></td></tr><tr><td><strong>ä¾§é‡ç‚¹</strong></td><td>ç‰©ç†åå‘ (é¡µä¿®æ”¹)</td><td>é€»è¾‘åå‘ (SQLè¯­ä¹‰)</td><td><strong>é€»è¾‘åå‘</strong> (é€†æ“ä½œ)</td></tr><tr><td><strong>ä¸»è¦ä½œç”¨</strong></td><td>å´©æºƒæ¢å¤ (Crash Safe)<br><br>  <br><br>ä¿è¯ <strong>D</strong> (æŒä¹…æ€§)</td><td>ä¸»ä»å¤åˆ¶ã€æ•°æ®æ¢å¤<br><br>  <br><br>ä¿è¯æ•°æ®ä¸€è‡´æ€§</td><td>äº‹åŠ¡å›æ»šã€MVCC<br><br>  <br><br>ä¿è¯ <strong>A</strong> (åŸå­æ€§) å’Œ <strong>I</strong> (éš”ç¦»æ€§)</td></tr><tr><td><strong>å†™å…¥æ—¶æœº</strong></td><td>äº‹åŠ¡è¿›è¡Œä¸­ä¸æ–­å†™</td><td>äº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡æ€§å†™</td><td>äº‹åŠ¡å¼€å§‹å‰&#x2F;ä¿®æ”¹å‰å†™</td></tr><tr><td><strong>é‡Šæ”¾æ—¶æœº</strong></td><td>è½ç›˜åè¦†ç›– (å¾ªç¯å†™)</td><td>ä¸åˆ é™¤ (è¿½åŠ å†™)</td><td>äº‹åŠ¡æäº¤åï¼Œè‹¥æ—  MVCC éœ€æ±‚åˆ™æ ‡è®°åˆ é™¤ (Purge)</td></tr></tbody></table><h1 id="äº‹åŠ¡éš”ç¦»"><a href="#äº‹åŠ¡éš”ç¦»" class="headerlink" title="äº‹åŠ¡éš”ç¦»"></a>äº‹åŠ¡éš”ç¦»</h1><h2 id="äº‹åŠ¡çš„ç‰¹æ€§"><a href="#äº‹åŠ¡çš„ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡çš„ç‰¹æ€§"></a>äº‹åŠ¡çš„ç‰¹æ€§</h2><p>ACIDï¼Œå³å¯¹åº”åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚é€šè¿‡undo logæ¥ä¿è¯åŸå­æ€§ï¼Œèƒ½å¤Ÿæ’¤é”€äº‹åŠ¡å†…çš„æ‰€ä»¥æ“ä½œæ¥ä¿è¯åŸå­æ€§ï¼Œè¦ä¹ˆæ˜¯å…¨éƒ¨éƒ½æˆåŠŸï¼Œé€šè¿‡redo logæ¥ä¿è¯æŒä¹…æ€§ï¼Œä¼šæ ¹æ®ç­–ç•¥è¿›è¡Œåˆ·è„ï¼Œé€šè¿‡é”+MVCCçš„æ–¹å¼æ¥ä¿è¯éš”ç¦»æ€§ï¼Œè€Œä¸€è‡´æ€§æŒ‡çš„æ˜¯ä»ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€è¿ç§»åˆ°å¦å¤–ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ä¸‹ï¼Œå…¶å®å°±æ˜¯é€šè¿‡äº‹åŠ¡ä¸­çš„AIDæ¥ä¿è¯Cã€‚</p><h2 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h2><p>éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ€§èƒ½è¶Šä½ã€‚å¦‚ä¸‹çš„éš”ç¦»çº§åˆ«é€æ¬¡å‡é«˜ã€‚</p><h3 id="è¯»æœªæäº¤-read-uncommited"><a href="#è¯»æœªæäº¤-read-uncommited" class="headerlink" title="è¯»æœªæäº¤ - read uncommited"></a>è¯»æœªæäº¤ - read uncommited</h3><p>å½“å‰äº‹åŠ¡å¯ä»¥è¯»å–åˆ°æœªæäº¤çš„äº‹åŠ¡ã€‚è¿™ç§çº§åˆ«ä¼šé€ æˆè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</p><h3 id="è¯»æäº¤-read-commited"><a href="#è¯»æäº¤-read-commited" class="headerlink" title="è¯»æäº¤ - read commited"></a>è¯»æäº¤ - read commited</h3><p>å½“å‰äº‹åŠ¡èƒ½å¤Ÿè¯»å–å·²æäº¤äº‹åŠ¡çš„ä¿®æ”¹ï¼Œè¿™ç§éš”ç¦»çº§åˆ«ä¼šé€ æˆä¸å¯é‡å¤è¯»ã€å¹»è¯»</p><h3 id="å¯é‡å¤è¯»-repeatable-read"><a href="#å¯é‡å¤è¯»-repeatable-read" class="headerlink" title="å¯é‡å¤è¯» - repeatable read"></a>å¯é‡å¤è¯» - repeatable read</h3><p>å½“å‰äº‹åŠ¡ä¸€å¼€å§‹è¯»çš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·å­ï¼Œé‚£åœ¨å®ƒæäº¤ä¹‹å‰ä¸€ç›´éƒ½æ˜¯è¿™æ ·å­ï¼Œå³ä½¿å¤šæ¬¡è¯»å–ã€‚ä¼šæœ‰å¹»è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¸ªäººè®¤ä¸ºå®ƒ<code>**ä¸ä¼šé€ æˆå¹»è¯»**</code>ï¼ˆé€šè¿‡MVCC + é”çš„æ–¹å¼ï¼‰ï¼›</p><h3 id="ä¸²è¡ŒåŒ–-serializable"><a href="#ä¸²è¡ŒåŒ–-serializable" class="headerlink" title="ä¸²è¡ŒåŒ– - serializable"></a>ä¸²è¡ŒåŒ– - serializable</h3><p>å¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œå†™æ“ä½œä¼šåŠ å†™é”ï¼Œè¯»æ“ä½œä¼šåŠ è¯»é”ï¼Œå½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œ</p><h2 id="å„ç±»è¯»é—®é¢˜"><a href="#å„ç±»è¯»é—®é¢˜" class="headerlink" title="å„ç±»è¯»é—®é¢˜"></a>å„ç±»è¯»é—®é¢˜</h2><h3 id="è„è¯»ï¼ˆDirty-Readï¼‰"><a href="#è„è¯»ï¼ˆDirty-Readï¼‰" class="headerlink" title="è„è¯»ï¼ˆDirty Readï¼‰"></a>è„è¯»ï¼ˆDirty Readï¼‰</h3><ul><li><strong>å®šä¹‰</strong>ï¼šè„è¯»æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­è¯»å–äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæ­£åœ¨ä¿®æ”¹ä½†å°šæœªæäº¤çš„æ•°æ®ï¼Œä¹‹åå¦‚æœäº‹åŠ¡Bå›æ»šï¼Œé‚£ä¹ˆäº‹åŠ¡Aè¯»å–çš„æ•°æ®å°±æ˜¯æ— æ•ˆçš„ã€â€œè„â€çš„æ•°æ®ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šå‡è®¾æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡Aæ˜¯ä¸€ä¸ªæŸ¥è¯¢æ“ä½œï¼Œäº‹åŠ¡Bæ˜¯ä¸€ä¸ªæ›´æ–°æ“ä½œã€‚äº‹åŠ¡Bæ›´æ–°äº†æ•°æ®åº“ä¸­æŸæ¡è®°å½•çš„ä¸€ä¸ªå­—æ®µå€¼ï¼Œä½†è¿˜æ²¡æäº¤ã€‚æ­¤æ—¶äº‹åŠ¡AæŸ¥è¯¢è¿™æ¡è®°å½•ï¼Œè·å–åˆ°äº†äº‹åŠ¡Bä¿®æ”¹åçš„å­—æ®µå€¼ã€‚éšåï¼Œäº‹åŠ¡Bç”±äºæŸç§åŸå› å›æ»šäº†ï¼Œé‚£ä¹ˆäº‹åŠ¡Aä¹‹å‰è¯»å–åˆ°çš„å­—æ®µå€¼å°±ä¸å†æœ‰æ•ˆï¼Œè¿™ç§æƒ…å†µå°±æ˜¯è„è¯»ã€‚</li><li><strong>äº§ç”ŸåŸå› </strong>ï¼šä¸»è¦æ˜¯å› ä¸ºäº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾ç½®è¾ƒä½ï¼Œå…è®¸ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ã€‚åœ¨æ•°æ®åº“å¹¶å‘æ“ä½œä¸­ï¼Œå¦‚æœæ²¡æœ‰é€‚å½“çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œå°±å®¹æ˜“å‡ºç°è„è¯»ç°è±¡ã€‚</li></ul><h3 id="ä¸å¯é‡å¤è¯»ï¼ˆNon-repeatable-Readï¼‰"><a href="#ä¸å¯é‡å¤è¯»ï¼ˆNon-repeatable-Readï¼‰" class="headerlink" title="ä¸å¯é‡å¤è¯»ï¼ˆNon - repeatable Readï¼‰"></a>ä¸å¯é‡å¤è¯»ï¼ˆNon - repeatable Readï¼‰</h3><ul><li><strong>å®šä¹‰</strong>ï¼šä¸å¯é‡å¤è¯»æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œç”±äºå…¶ä»–äº‹åŠ¡å¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹æˆ–åˆ é™¤æ“ä½œï¼Œå¯¼è‡´æ¯æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šäº‹åŠ¡Aåœ¨å¼€å§‹æ—¶è¯»å–äº†æ•°æ®åº“ä¸­æŸæ¡è®°å½•çš„æŸä¸ªå­—æ®µå€¼ä¸º10ã€‚éšåï¼Œäº‹åŠ¡Bæ›´æ–°äº†è¿™æ¡è®°å½•çš„è¯¥å­—æ®µå€¼ä¸º20å¹¶æäº¤ã€‚å½“äº‹åŠ¡Aå†æ¬¡è¯»å–è¿™æ¡è®°å½•çš„è¯¥å­—æ®µæ—¶ï¼Œå¾—åˆ°çš„å€¼ä¸º20ï¼Œä¸ç¬¬ä¸€æ¬¡è¯»å–çš„å€¼ä¸åŒï¼Œè¿™ç§æƒ…å†µå°±æ˜¯ä¸å¯é‡å¤è¯»ã€‚</li><li><strong>äº§ç”ŸåŸå› </strong>ï¼šè¿™æ˜¯ç”±äºäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ²¡æœ‰å®Œå…¨é™åˆ¶å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®çš„ä¿®æ”¹æ“ä½œã€‚åœ¨å¤šäº‹åŠ¡å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡å…è®¸å…¶ä»–äº‹åŠ¡åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹å®ƒæ­£åœ¨è¯»å–çš„æ•°æ®æ—¶ï¼Œå°±å¯èƒ½å‡ºç°ä¸å¯é‡å¤è¯»çš„æƒ…å†µã€‚</li></ul><h3 id="å¹»è¯»ï¼ˆPhantom-Readï¼‰"><a href="#å¹»è¯»ï¼ˆPhantom-Readï¼‰" class="headerlink" title="å¹»è¯»ï¼ˆPhantom Readï¼‰"></a>å¹»è¯»ï¼ˆPhantom Readï¼‰</h3><ul><li><strong>å®šä¹‰</strong>ï¼šå¹»è¯»æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒæŒ‰ç…§æŸä¸ªæ¡ä»¶è¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢å’Œç¬¬äºŒæ¬¡æŸ¥è¯¢å¾—åˆ°çš„ç»“æœé›†æ•°é‡ä¸åŒã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºåœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥æˆ–åˆ é™¤äº†æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šäº‹åŠ¡AæŸ¥è¯¢æ•°æ®åº“ä¸­å¹´é¾„å¤§äº30å²çš„å‘˜å·¥æ•°é‡ï¼Œå¾—åˆ°ç»“æœä¸º10äººã€‚åœ¨äº‹åŠ¡Aæ‰§è¡ŒæœŸé—´ï¼Œäº‹åŠ¡Bæ’å…¥äº†å‡ æ¡å¹´é¾„å¤§äº30å²çš„æ–°å‘˜å·¥è®°å½•å¹¶æäº¤ã€‚å½“äº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢å¹´é¾„å¤§äº30å²çš„å‘˜å·¥æ•°é‡æ—¶ï¼Œå¾—åˆ°çš„ç»“æœæ¯”ç¬¬ä¸€æ¬¡å¤šï¼Œå¥½åƒå‡ºç°äº†â€œå¹»è§‰â€ä¸€æ ·ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯å¹»è¯»ã€‚</li><li><strong>äº§ç”ŸåŸå› </strong>ï¼šä¸»è¦æ˜¯å› ä¸ºäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸èƒ½é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æˆ–åˆ é™¤ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•ã€‚åœ¨å¹¶å‘äº‹åŠ¡ç¯å¢ƒä¸‹ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡å¯¹æ•°æ®çš„æ’å…¥æˆ–åˆ é™¤æ“ä½œå½±å“äº†è¯¥äº‹åŠ¡çš„æŸ¥è¯¢ç»“æœé›†ï¼Œå°±ä¼šäº§ç”Ÿå¹»è¯»ã€‚</li></ul><h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸è¿™ä¸‰ç§æƒ…å†µçš„å…³ç³»"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸è¿™ä¸‰ç§æƒ…å†µçš„å…³ç³»" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸è¿™ä¸‰ç§æƒ…å†µçš„å…³ç³»"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸è¿™ä¸‰ç§æƒ…å†µçš„å…³ç³»</h3><ul><li><strong>è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰</strong>ï¼šè¿™æ˜¯æœ€ä½çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå…è®¸è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚åœ¨è¿™ç§éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å‡ºç°ä¸Šè¿°ä¸‰ç§æƒ…å†µã€‚</li><li><strong>è¯»å·²æäº¤ï¼ˆRead Committedï¼‰</strong>ï¼šè¿™ç§éš”ç¦»çº§åˆ«å¯ä»¥é¿å…è„è¯»ã€‚åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–æ•°æ®æ—¶ï¼Œåªèƒ½è¯»å–å…¶ä»–å·²æäº¤äº‹åŠ¡çš„æ•°æ®ï¼Œä½†æ˜¯ä»ç„¶å¯èƒ½å‡ºç°ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li><li><strong>å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰</strong>ï¼šå¯ä»¥é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»ã€‚åœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå®ƒæ‰€è¯»å–çš„æ•°æ®ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å¹»è¯»ã€‚åœ¨ä¸€äº›æ•°æ®åº“ç³»ç»Ÿï¼ˆå¦‚MySQLçš„InnoDBå­˜å‚¨å¼•æ“ï¼‰ä¸­ï¼Œé€šè¿‡ä½¿ç”¨é—´éš™é”ç­‰æŠ€æœ¯å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¹»è¯»çš„å‘ç”Ÿã€‚</li><li><strong>ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰</strong>ï¼šè¿™æ˜¯æœ€é«˜çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚åœ¨è¿™ç§éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œç›¸å½“äºå¯¹å¹¶å‘äº‹åŠ¡è¿›è¡Œäº†ä¸¥æ ¼çš„é™åˆ¶ï¼Œè™½ç„¶ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†ä¼šä¸¥é‡å½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œå¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</li></ul><h2 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h2><p>Multi Version Concurrency Control - å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œä¸€ç§æ•°æ®åº“å¹¶å‘æ§åˆ¶çš„æŠ€æœ¯ï¼Œç”¨æ¥å®ç°å„ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</p><h2 id="å¿«ç…§è¯»"><a href="#å¿«ç…§è¯»" class="headerlink" title="å¿«ç…§è¯»"></a>å¿«ç…§è¯»</h2><p>è¯»çš„æ˜¯æ•°æ®çš„å†å²ç‰ˆæœ¬ã€‚å¸¸ç”¨ä»¥å®ç°ä¸åŒäº‹åŠ¡ä¹‹é—´çš„éš”ç¦»ã€‚</p><p>MVCC ä¸ºæ¯ä¸ªäº‹åŠ¡æä¾›äº†ä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œäº‹åŠ¡åœ¨è¿™ä¸ªå¿«ç…§èŒƒå›´å†…è¯»å–æ•°æ®ã€‚è¿™ä¸ªå¿«ç…§åŒ…å«äº†åœ¨äº‹åŠ¡å¼€å§‹æ—¶å·²ç»æäº¤çš„æ•°æ®ç‰ˆæœ¬ã€‚é€šè¿‡å¿«ç…§è¯»ï¼Œäº‹åŠ¡å¯ä»¥é¿å…å—åˆ°å…¶ä»–äº‹åŠ¡åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„å½±å“ï¼Œä»è€Œå®ç°äº†ä¸åŒäº‹åŠ¡ä¹‹é—´çš„éš”ç¦»</p><p>SELECT æ˜¯å¿«ç…§è¯»ï¼Œå¦‚æœåŠ é”çš„è¯ï¼Œä¾¿æ˜¯å½“å‰è¯»ã€‚</p><h2 id="å½“å‰è¯»"><a href="#å½“å‰è¯»" class="headerlink" title="å½“å‰è¯»"></a>å½“å‰è¯»</h2><p>è¯»çš„æ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p><p>å¸¸ç”¨äºå¯¹æ•°æ®å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚<strong>å¢åˆ æ”¹</strong>ç­‰ç”¨æ¥<strong>æ›´æ–°æ•°æ®</strong>çš„åœºæ™¯ï¼Œéƒ½éœ€è¦è¯»å–åˆ°æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p><ul><li>æ›´æ–°æ•°æ® - UPDATE ã€DELETEã€INSERT</li></ul><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><ul><li>MVCC çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸ºæ¯ä¸ªäº‹åŠ¡æä¾›ä¸€ä¸ªæ•°æ®å¿«ç…§ï¼ˆsnapshotï¼‰ã€‚å½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹æ—¶ï¼Œå®ƒä¼šçœ‹åˆ°æ•°æ®åº“åœ¨æŸä¸ªç‰¹å®šæ—¶åˆ»çš„çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´ï¼Œè¿™ä¸ªçŠ¶æ€å¯¹äºè¯¥äº‹åŠ¡æ˜¯ç›¸å¯¹å›ºå®šçš„ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œå½“å‰äº‹åŠ¡çœ‹åˆ°çš„ä»ç„¶æ˜¯å®ƒå¼€å§‹æ—¶çš„æ•°æ®ç‰ˆæœ¬ã€‚</li><li>æ•°æ®åº“ä¼šä¸ºæ¯ä¸ªæ•°æ®è¡Œä¿å­˜å¤šä¸ªç‰ˆæœ¬ï¼Œè¿™äº›ç‰ˆæœ¬å¯ä»¥é€šè¿‡æ—¶é—´æˆ³æˆ–è€…ç‰ˆæœ¬å·æ¥åŒºåˆ†ã€‚æ¯å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œä¸æ˜¯ç›´æ¥è¦†ç›–åŸæ¥çš„æ•°æ®ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç®€å•çš„é“¶è¡Œè´¦æˆ·ä½™é¢æ•°æ®è¡¨ä¸­ï¼Œå½“ç”¨æˆ· A è¿›è¡Œå–æ¬¾æ“ä½œä¿®æ”¹ä½™é¢æ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¸ä¼šç«‹å³åˆ é™¤åŸæ¥çš„ä½™é¢è®°å½•ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ä½™é¢ç‰ˆæœ¬è®°å½•ï¼Œå¹¶æ ‡è®°ä¸Šç›¸åº”çš„äº‹åŠ¡æ—¶é—´æˆ³æˆ–è€…ç‰ˆæœ¬å·ã€‚</li></ul><h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><ul><li>æé«˜å¹¶å‘æ€§èƒ½ï¼šä¸ä¼šå› ä¸ºé”çš„ç«äº‰è€Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚æ¯ä¸ªäº‹åŠ¡çœ‹åˆ°çš„æ˜¯è‡ªå·±çš„ç‰ˆæœ¬æ•°æ®ï¼Œè¯»å†™æ“ä½œä¸ä¼šé˜»å¡</li><li>ä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ï¼šMVCC èƒ½å¤Ÿæä¾›ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œé€šè¿‡åˆç†è®¾ç½®ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³çš„æ£€æŸ¥è§„åˆ™ï¼Œå¯ä»¥å®ç°å¦‚è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ç­‰éš”ç¦»çº§åˆ«ã€‚</li></ul><h1 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h1><p>InnoDBä½¿ç”¨B+æ ‘ä½œä¸ºç´¢å¼•æ¨¡å‹ã€‚</p><ul><li>éå¶å­èŠ‚ç‚¹ä¸ä¿å­˜æ•°æ®</li><li>å¶å­èŠ‚ç‚¹é—´ä½¿ç”¨ æŒ‡é’ˆç›¸è¿ï¼Œå¹¶æŒ‰ç…§å¤§å°é¡ºåºæ’åˆ—</li></ul><h2 id="ä¸»é”®ç´¢å¼•"><a href="#ä¸»é”®ç´¢å¼•" class="headerlink" title="ä¸»é”®ç´¢å¼•"></a>ä¸»é”®ç´¢å¼•</h2><p>ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚åœ¨ InnoDB é‡Œï¼Œä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸º<strong>èšç°‡ç´¢å¼•</strong>ï¼ˆclustered indexï¼‰ã€‚éä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚åœ¨ InnoDB é‡Œï¼Œéä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸º<strong>äºŒçº§ç´¢å¼•</strong>ï¼ˆsecondary indexï¼‰ã€‚</p><h2 id="å¦‚ä½•é€‰æ‹©ç´¢å¼•"><a href="#å¦‚ä½•é€‰æ‹©ç´¢å¼•" class="headerlink" title="å¦‚ä½•é€‰æ‹©ç´¢å¼•"></a>å¦‚ä½•é€‰æ‹©ç´¢å¼•</h2><ul><li>åŸºäºç´¢å¼•çš„â€œåŒºåˆ†åº¦â€æ¥é€‰æ‹©ï¼Œä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼è¶Šå¤šï¼ŒåŒºåˆ†åº¦è¶Šé«˜ã€‚ç´¢å¼•ä¸Šä¸åŒçš„å€¼çš„ä¸ªæ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œåŸºæ•°â€ï¼ˆcardinalityï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªåŸºæ•°è¶Šå¤§ï¼Œç´¢å¼•çš„åŒºåˆ†åº¦è¶Šå¥½ã€‚</li></ul><h2 id="å¦‚ä½•åŠ ç´¢å¼•"><a href="#å¦‚ä½•åŠ ç´¢å¼•" class="headerlink" title="å¦‚ä½•åŠ ç´¢å¼•"></a>å¦‚ä½•åŠ ç´¢å¼•</h2><p>é’ˆå¯¹è¶…é•¿å­—ç¬¦ä¸²ï¼Œå¯ä»¥è€ƒè™‘é€‰æ‹©å¦‚ä¸‹å…¶ä¸€æ–¹å¼å»ºç«‹ç´¢å¼•ï¼š</p><ul><li>å€’åºå­˜å‚¨+å‰ç¼€ç´¢å¼•</li><li>æ·»åŠ hashå­—æ®µï¼Œä¸ºå…¶å»ºç«‹ç´¢å¼•ï¼Œcrc32</li></ul><h2 id="å›è¡¨"><a href="#å›è¡¨" class="headerlink" title="å›è¡¨"></a>å›è¡¨</h2><p>æ™®é€šç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ä¸»é”®ï¼Œåœ¨é€šè¿‡ä¸»é”®æ‰¾åˆ°æ‰€éœ€è¦çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åšå›è¡¨ï¼Œå¦‚æœç›´æ¥é€šè¿‡äºŒçº§ç´¢å¼•å°±èƒ½æ‰¾åˆ°æ•°æ®çš„è¯æ˜¯ä¸éœ€è¦å›è¡¨çš„ã€‚</p><h2 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h2><p>å¦‚æœæŸ¥æ‰¾çš„åˆ—æœ¬èº«å°±åœ¨äºŒçº§ç´¢å¼•ä¸Šï¼Œé‚£ä¹ˆå°±ä¸è¦å›è¡¨äº†ï¼Œè¿™æ ·å­çš„ç´¢å¼•å«åšè¦†ç›–ç´¢å¼•ï¼Œé€šå¸¸ç”¨æ¥å‡å°‘å›è¡¨çš„æ¬¡æ•°ä»¥æé«˜æ€§èƒ½ã€‚</p><h2 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h2><p>ä½¿ç”¨å¤šä¸ªå­—æ®µç»„åˆçš„ç´¢å¼•ï¼Œå‡è®¾æœ‰è”åˆç´¢å¼•ï¼ˆaï¼Œbï¼‰ï¼Œé‚£ä¹ˆåœ¨ç´¢å¼•æ ‘ä¸­å®ƒä¼šå…ˆæ ¹æ®açš„å¤§å°è¿›è¡Œæ’åºï¼Œå¦‚æœæœ‰ç›¸åŒå€¼çš„aåœ¨æŒ‰ç…§bçš„å¤§å°è¿›è¡Œæ’åºã€‚</p><h3 id="æœ€å·¦å‰ç¼€"><a href="#æœ€å·¦å‰ç¼€" class="headerlink" title="æœ€å·¦å‰ç¼€"></a>æœ€å·¦å‰ç¼€</h3><p>å¯ä»¥æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦Nä¸ªå­—æ®µï¼Œæ¯”å¦‚è¯´æœ‰è”åˆç´¢å¼•ï¼ˆaï¼Œbï¼Œcï¼‰ï¼Œé‚£ä¹ˆç­‰å€¼æŸ¥è¯¢æ¡ä»¶æ˜¯a &#x3D; 1çš„æ—¶å€™ä¼šç”¨åˆ°è”åˆç´¢å¼•ä¸­çš„éƒ¨åˆ†ç´¢å¼•aï¼Œæ¡ä»¶æ˜¯a &#x3D; 1 and b &#x3D; 2çš„æ—¶å€™ä¼šç”¨åˆ°è”åˆç´¢å¼•ä¸­çš„éƒ¨åˆ†ç´¢å¼•ï¼ˆaï¼Œbï¼‰ï¼ŒåŒç†æ¡ä»¶æ˜¯a &#x3D; 1 and b &#x3D; 2 and c &#x3D; 3ï¼Œè€Œå¯¹äºæ¡ä»¶æ˜¯a &#x3D; 1 and c &#x3D; 3çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¹Ÿåªèƒ½ç”¨åˆ°è”åˆç´¢å¼•ä¸­çš„éƒ¨åˆ†ç´¢å¼•aã€‚</p><h3 id="ç´¢å¼•ä¸‹æ¨"><a href="#ç´¢å¼•ä¸‹æ¨" class="headerlink" title="ç´¢å¼•ä¸‹æ¨"></a>ç´¢å¼•ä¸‹æ¨</h3><ol><li><strong>ç´¢å¼•ä¸‹æ¨ï¼ˆIndex Condition Pushdownï¼ŒICPï¼‰æ¦‚è¿°</strong></li></ol><ul><li><strong>å®šä¹‰</strong>ï¼šç´¢å¼•ä¸‹æ¨æ˜¯ä¸€ç§æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯ï¼Œä¸»è¦åº”ç”¨äºæ•°æ®åº“å¼•æ“ï¼ˆå¦‚MySQLçš„InnoDBå­˜å‚¨å¼•æ“ï¼‰åœ¨å¤„ç†è”åˆç´¢å¼•æŸ¥è¯¢æ—¶ã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯å°†åŸæœ¬éœ€è¦åœ¨æœåŠ¡å™¨å±‚ï¼ˆMySQL Serverï¼‰è¿›è¡Œçš„éƒ¨åˆ†æ¡ä»¶åˆ¤æ–­ä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚ï¼ˆInnoDBï¼‰ï¼Œåœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­å°±è¿›è¡Œæ¡ä»¶è¿‡æ»¤ï¼Œä»è€Œå‡å°‘ä¸å¿…è¦çš„æ•°æ®å›è¡¨æ“ä½œï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li><strong>èƒŒæ™¯</strong>ï¼šåœ¨æ²¡æœ‰ç´¢å¼•ä¸‹æ¨ä¹‹å‰ï¼Œå½“ä½¿ç”¨è”åˆç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå­˜å‚¨å¼•æ“é€šè¿‡ç´¢å¼•è·å–åˆ°æ»¡è¶³éƒ¨åˆ†ç´¢å¼•åˆ—æ¡ä»¶çš„æ•°æ®è¡Œçš„ä¸»é”®ï¼ˆä»¥InnoDBä¸ºä¾‹ï¼‰ï¼Œç„¶åå°†è¿™äº›ä¸»é”®å¯¹åº”çš„å®Œæ•´æ•°æ®è¡Œå›è¡¨ï¼ˆå›åˆ°æ•°æ®è¡¨ï¼‰è¯»å–ï¼Œæœ€ååœ¨æœåŠ¡å™¨å±‚å¯¹è¿™äº›å®Œæ•´çš„æ•°æ®è¡Œè¿›è¡Œå…¶ä»–å‰©ä½™æ¡ä»¶çš„åˆ¤æ–­ã€‚è¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´å¤§é‡ä¸å¿…è¦çš„æ•°æ®å›è¡¨æ“ä½œï¼Œæµªè´¹ç³»ç»Ÿèµ„æºã€‚</li></ul><ol start="2"><li><strong>ç´¢å¼•ä¸‹æ¨çš„å·¥ä½œåŸç†</strong></li></ol><ul><li><p>å‡è®¾åœ¨ä¸€ä¸ª<code>employees</code>è¡¨ä¸­æœ‰ä¸€ä¸ªè”åˆç´¢å¼•<code>idx_name_age</code>ï¼ˆåŒ…å«<code>name</code>å’Œ<code>age</code>ä¸¤ä¸ªåˆ—ï¼‰ï¼Œç°åœ¨è¦æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢<code>SELECT * FROM employees WHERE name LIKE &#39;J%&#39; AND age &gt; 30;</code>ã€‚</p></li><li><p><strong>ä¼ ç»Ÿæ–¹å¼</strong>ï¼š</p></li><li><p>å­˜å‚¨å¼•æ“é¦–å…ˆä½¿ç”¨è”åˆç´¢å¼•<code>idx_name_age</code>æ‰¾åˆ°<code>name</code>ä»¥<code>J</code>å¼€å¤´çš„æ‰€æœ‰è®°å½•çš„ä¸»é”®å€¼ã€‚</p></li><li><p>ç„¶åå¯¹è¿™äº›ä¸»é”®å€¼å¯¹åº”çš„è®°å½•è¿›è¡Œå›è¡¨æ“ä½œï¼Œå°†å®Œæ•´çš„æ•°æ®è¡Œè¯»å–åˆ°æœåŠ¡å™¨å±‚ã€‚</p></li><li><p>æœ€ååœ¨æœåŠ¡å™¨å±‚åˆ¤æ–­è¿™äº›è®°å½•çš„<code>age</code>æ˜¯å¦å¤§äº30ï¼Œç­›é€‰å‡ºæ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚</p></li><li><p><strong>ç´¢å¼•ä¸‹æ¨æ–¹å¼</strong>ï¼š</p></li><li><p>å­˜å‚¨å¼•æ“åœ¨éå†è”åˆç´¢å¼•<code>idx_name_age</code>æ—¶ï¼Œä¸ä»…ä¼šæ£€æŸ¥<code>name</code>åˆ—æ˜¯å¦ä»¥<code>J</code>å¼€å¤´ï¼Œè¿˜ä¼šåŒæ—¶æ£€æŸ¥<code>age</code>åˆ—æ˜¯å¦å¤§äº30ã€‚åªæœ‰å½“<code>name</code>å’Œ<code>age</code>æ¡ä»¶éƒ½æ»¡è¶³çš„ç´¢å¼•è®°å½•å¯¹åº”çš„ä¸»é”®æ‰ä¼šè¢«ç”¨æ¥è¿›è¡Œå›è¡¨æ“ä½œï¼Œè¯»å–å®Œæ•´çš„æ•°æ®è¡Œã€‚è¿™æ ·å°±é¿å…äº†è®¸å¤šä¸æ»¡è¶³<code>age &gt; 30</code>æ¡ä»¶çš„è®°å½•çš„å›è¡¨æ“ä½œï¼Œå‡å°‘äº†æ•°æ®è¯»å–é‡å’Œç³»ç»Ÿå¼€é”€ã€‚</p></li></ul><ol start="3"><li><strong>ç´¢å¼•ä¸‹æ¨çš„ä¼˜åŠ¿</strong></li></ol><ul><li><strong>å‡å°‘å›è¡¨æ“ä½œæ¬¡æ•°</strong>ï¼šé€šè¿‡åœ¨å­˜å‚¨å¼•æ“å±‚æå‰è¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå¤§å¤§å‡å°‘äº†å›è¡¨æ“ä½œçš„é¢‘ç‡ã€‚å›è¡¨æ“ä½œé€šå¸¸æ¶‰åŠç£ç›˜I&#x2F;Oæˆ–è€…ç¼“å­˜è¯»å–ï¼Œå‡å°‘å›è¡¨æ“ä½œå¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®å’Œå¤æ‚æŸ¥è¯¢æ—¶ã€‚</li><li><strong>æé«˜æŸ¥è¯¢æ•ˆç‡</strong>ï¼šç”±äºå‡å°‘äº†ä¸å¿…è¦çš„æ•°æ®è¯»å–å’Œå¤„ç†ï¼ŒæŸ¥è¯¢çš„æ•´ä½“æ•ˆç‡å¾—åˆ°æå‡ã€‚åœ¨é«˜å¹¶å‘çš„æ•°æ®åº“ç¯å¢ƒä¸­ï¼Œè¿™ç§æ€§èƒ½æå‡å¯ä»¥ä½¿ç³»ç»Ÿèƒ½å¤Ÿæ›´å¿«é€Ÿåœ°å“åº”å¤§é‡çš„æŸ¥è¯¢è¯·æ±‚ã€‚</li></ul><ol start="4"><li><strong>ç´¢å¼•ä¸‹æ¨çš„é™åˆ¶å’Œæ³¨æ„äº‹é¡¹</strong></li></ol><ul><li><strong>å¯¹ç´¢å¼•çš„ä¾èµ–</strong>ï¼šç´¢å¼•ä¸‹æ¨æ˜¯åŸºäºç´¢å¼•è¿›è¡Œæ“ä½œçš„ï¼Œåªæœ‰åœ¨ä½¿ç”¨è”åˆç´¢å¼•å¹¶ä¸”æœ‰å¯ä»¥ä¸‹æ¨çš„æ¡ä»¶æ—¶æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚å¦‚æœæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰æ¶‰åŠè”åˆç´¢å¼•æˆ–è€…æ²¡æœ‰åˆé€‚çš„ä¸‹æ¨æ¡ä»¶ï¼Œå°±æ— æ³•åˆ©ç”¨ç´¢å¼•ä¸‹æ¨ã€‚</li><li><strong>ä¸åŒæ•°æ®åº“å¼•æ“çš„æ”¯æŒæƒ…å†µ</strong>ï¼šä¸æ˜¯æ‰€æœ‰çš„æ•°æ®åº“å¼•æ“éƒ½æ”¯æŒç´¢å¼•ä¸‹æ¨ã€‚ç›®å‰MySQLçš„InnoDBå­˜å‚¨å¼•æ“æ”¯æŒç´¢å¼•ä¸‹æ¨ï¼Œä½†å…¶ä»–æ•°æ®åº“å¼•æ“å¯èƒ½éœ€è¦å…·ä½“æŸ¥çœ‹å…¶æ–‡æ¡£æ¥ç¡®å®šæ˜¯å¦æ”¯æŒä»¥åŠæ”¯æŒçš„ç¨‹åº¦ã€‚</li><li><strong>ä¸å…¶ä»–ä¼˜åŒ–æŠ€æœ¯çš„ç»“åˆ</strong>ï¼šåœ¨å®é™…çš„æ•°æ®åº“ä¼˜åŒ–ä¸­ï¼Œç´¢å¼•ä¸‹æ¨é€šå¸¸éœ€è¦ä¸å…¶ä»–ä¼˜åŒ–æŠ€æœ¯ï¼ˆå¦‚åˆç†çš„ç´¢å¼•è®¾è®¡ã€æŸ¥è¯¢è¯­å¥ä¼˜åŒ–ç­‰ï¼‰ç»“åˆä½¿ç”¨ï¼Œæ‰èƒ½è¾¾åˆ°æœ€ä½³çš„æ€§èƒ½æå‡æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå³ä½¿æœ‰ç´¢å¼•ä¸‹æ¨ï¼Œå¦‚æœç´¢å¼•æœ¬èº«è®¾è®¡ä¸åˆç†ï¼ˆå¦‚ç´¢å¼•åˆ—çš„é¡ºåºä¸ç¬¦åˆæŸ¥è¯¢ä¹ æƒ¯ç­‰ï¼‰ï¼ŒæŸ¥è¯¢æ•ˆç‡å¯èƒ½ä»ç„¶ä¸é«˜ã€‚</li></ul><h2 id="é¡µåˆ†è£‚"><a href="#é¡µåˆ†è£‚" class="headerlink" title="é¡µåˆ†è£‚"></a>é¡µåˆ†è£‚</h2><p>B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¼šæŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œå¦‚æœæ’å…¥çš„ä¸»é”®è¦å¤„äºä¸­é—´ä½ç½®ï¼Œé‚£ä¹ˆéœ€è¦ç§»åŠ¨åé¢çš„æ•°æ®æ¥è…¾å‡ºä½ç½®ï¼Œè€Œå¦‚æœåœ¨æ’å…¥ä¹‹å‰æ•°æ®é¡µå°±å·²ç»æ»¡äº†çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†åé¢çš„éƒ¨åˆ†æ•°æ®ç§»åŠ¨è‡³å¦å¤–ä¸€ä¸ªæ•°æ®é¡µä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åšé¡µåˆ†è£‚ã€‚</p><h2 id="é¡µåˆå¹¶"><a href="#é¡µåˆå¹¶" class="headerlink" title="é¡µåˆå¹¶"></a>é¡µåˆå¹¶</h2><p>å½“ç›¸é‚»ä¸¤ä¸ªæ•°æ®é¡µç”±äºåˆ é™¤äº†æ•°æ®ä¹‹åï¼Œæ•´ä¸ªçš„ç©ºé—´å˜å°äº†ï¼Œé‚£ä¹ˆå°±ä¼šå°†ä¸¤ä¸ªæ•°æ®é¡µè¿›è¡Œåˆå¹¶ï¼Œä»¥æé«˜æ•°æ®é¡µç©ºé—´çš„åˆ©ç”¨ç‡ã€‚</p><h2 id="é‡å»ºäºŒçº§ç´¢å¼•å’Œé‡å»ºä¸»é”®ç´¢å¼•"><a href="#é‡å»ºäºŒçº§ç´¢å¼•å’Œé‡å»ºä¸»é”®ç´¢å¼•" class="headerlink" title="é‡å»ºäºŒçº§ç´¢å¼•å’Œé‡å»ºä¸»é”®ç´¢å¼•"></a>é‡å»ºäºŒçº§ç´¢å¼•å’Œé‡å»ºä¸»é”®ç´¢å¼•</h2><p>é¦–å…ˆé‡å»ºç´¢å¼•æ˜¯ä¸ºäº†è®©æ•°æ®é¡µçš„ç©ºé—´å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œä¹Ÿå°±çœå»äº†å¾ˆå¤šç©ºé—´çš„æµªè´¹ï¼Œå¯¹äºé‡å»ºäºŒçº§ç´¢å¼•æ¥è¯´æ˜¯å¯ä»¥å…ˆåˆ é™¤æ‰ç´¢å¼•åœ¨å¢åŠ ï¼Œå¯¹äºé‡å»ºä¸»é”®ç´¢å¼•çš„è¯å¦‚æœå…ˆåˆ é™¤çš„è¯ï¼Œå®ƒä¼šä½¿äºŒçº§ç´¢å¼•å¤±æ•ˆï¼ˆç”±äºé‡å»ºä¸»é”®ç´¢å¼•ï¼Œé‡æ–°è®¡ç®—åçš„æŒ‡é’ˆä¼šå‘ç”Ÿå˜åŒ–ï¼‰ï¼Œæ­£ç¡®åœ°é‡å»ºä¸»é”®ç´¢å¼•æ˜¯ï¼šALTER TABLE T ENGINE &#x3D; INNODBï¼Œæˆ–è€…æ˜¯è¿ç§»æ•°æ®åº“ï¼Œä¸è¿‡è¿™ç§æ–¹å¼åªé€‚åˆç¦»çº¿çš„ä¸šåŠ¡ã€‚</p><h1 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h1><h2 id="å…¨å±€é”"><a href="#å…¨å±€é”" class="headerlink" title="å…¨å±€é”"></a>å…¨å±€é”</h2><p>ç»™æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ  <strong>è¯»é” -</strong> <code>**Flush tables with read lock**</code>, å…¶ä»–çº¿ç¨‹çš„å¢åˆ è¯»å†™ä¼šè¢«é˜»å¡ï¼Œä½¿ç”¨ <code>**unlock tables**</code>è¿›è¡Œè§£é™¤ã€‚</p><p>ä¸ºä»€ä¹ˆä½¿ç”¨å…¨å±€é”è€Œä¸è¦ä½¿ç”¨å…¨åº“åªè¯»ï¼ˆset global readonly &#x3D; trueï¼‰ï¼šä¸€æ–¹é¢æ˜¯readonlyé€šå¸¸ä¼šè¢«ç”¨æ¥åšå…¶ä»–çš„é€»è¾‘ï¼Œæ¯”å¦‚è¯´ç”¨æ¥åˆ¤æ–­ä¸»å¤‡åº“ï¼Œéšæ„ä¿®æ”¹å…¨å±€å˜é‡å¯èƒ½ä¼šå½±å“ï¼›å¦å¤–ä¸€æ–¹é¢ä½¿ç”¨å…¨å±€é”çš„å®¢æˆ·ç«¯å¦‚æœå´©æºƒäº†çš„è¯ï¼ŒMySQLä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œæ•´ä¸ªåº“å¯ä»¥å›åˆ°æ­£å¸¸æ›´æ–°çš„çŠ¶æ€ï¼Œè€Œå°†æ•´ä¸ªåº“è®¾ç½®ä¸ºreadonlyä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ•°æ®åº“ä¼šä¸€ç›´ä¿æŒreadonlyçŠ¶æ€ï¼Œå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶é—´å¤„äºä¸å¯å†™çŠ¶æ€ã€‚</p><h2 id="è¡¨é”"><a href="#è¡¨é”" class="headerlink" title="è¡¨é”"></a>è¡¨é”</h2><p>åŠ è¡¨é” - <code>lock tables t1 read/write</code></p><h2 id="è¡Œé”"><a href="#è¡Œé”" class="headerlink" title="è¡Œé”"></a>è¡Œé”</h2><ul><li>äºŒé˜¶æ®µé”åè®®ï¼šåœ¨äº‹åŠ¡ä¸­ï¼Œåªæœ‰æäº¤(commit)æˆ–è€…å›æ»š(rollback)æ—¶æ‰æ˜¯è§£é”é˜¶æ®µï¼Œ å…¶ä½™æ—¶é—´ä¸ºåŠ é”é˜¶æ®µã€‚</li><li>å‘èµ·æ­»é”æ£€æµ‹ï¼š<strong>innodb_deadlock_detect</strong>è®¾ç½®ä¸ºonï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯onï¼Œç¼ºç‚¹å°±æ˜¯ä¼šè€—è´¹å¤§é‡çš„CPUèµ„æºï¼ˆå‘ç°æ­»é”åä¸»åŠ¨å›æ»šæŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œï¼‰ã€‚</li></ul><h2 id="å…ƒæ•°æ®é”-metadata-lock-MDL"><a href="#å…ƒæ•°æ®é”-metadata-lock-MDL" class="headerlink" title="å…ƒæ•°æ®é” - metadata lock - MDL"></a>å…ƒæ•°æ®é” - metadata lock - MDL</h2><p>å±äºServerå±‚çš„é”ï¼Œè¡¨çº§é”ï¼Œä¸»è¦ç”¨äºéš”ç¦»DMLå’ŒDDLæ“ä½œä¹‹é—´çš„å¹²æ‰°ï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹è‚¯å®šä¸èƒ½ä¿®æ”¹è¡¨ç»“æ„ï¼Œä¸ç„¶å°±ä¹±å¥—äº†ï¼Œæ‰€ä»¥DMLæ“ä½œéœ€è¦ç”³è¯·MDLè¯»é”ï¼Œè€ŒDDLæ“ä½œéœ€è¦ç”³è¯·MDLå†™é”ï¼Œè¯»è¯»ä¹‹é—´å…±äº«ï¼Œè¯»å†™ä¹‹é—´äº’æ–¥ï¼Œå†™å†™ä¹‹é—´äº’æ–¥ã€‚</p><ul><li>DMLï¼šæ•°æ®åº“æ“ä½œè¯­è¨€</li><li>DDLï¼šæ•°æ®åº“å®šä¹‰è¯­è¨€</li><li>MDL è¯»é” - å…±äº«è¯»é”ï¼šå½“ä¸€ä¸ªäº‹åŠ¡åªæ˜¯è¯»å–æ•°æ®åº“å¯¹è±¡çš„å…ƒæ•°æ®ï¼ˆå¦‚æŸ¥è¯¢è¡¨çš„ç»“æ„ä¿¡æ¯ï¼‰æ—¶ï¼Œä¼šè·å–å…±äº«è¯»é”ã€‚è¿™ç§é”<strong>å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶å¯¹åŒä¸€å¯¹è±¡çš„å…ƒæ•°æ®è¿›è¡Œè¯»å–æ“ä½œ</strong>ï¼Œä½†<strong>ä¸å…è®¸å…¶ä»–äº‹åŠ¡å¯¹è¯¥å¯¹è±¡çš„å…ƒæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œ</strong>ã€‚</li><li>MDL å†™é”- æ’ä»–é”ï¼šå½“ä¸€ä¸ªäº‹åŠ¡éœ€è¦ä¿®æ”¹æ•°æ®åº“å¯¹è±¡çš„å…ƒæ•°æ®ï¼ˆå¦‚æ·»åŠ åˆ—ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰æ—¶ï¼Œä¼šè·å–æ’ä»–é”ã€‚è¿™ç§é”ä¼š<strong>é˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥å¯¹è±¡çš„å…ƒæ•°æ®è¿›è¡Œè¯»å–æˆ–ä¿®æ”¹æ“ä½œ</strong>ï¼Œç›´åˆ°è¯¥äº‹åŠ¡å®Œæˆå¯¹å…ƒæ•°æ®çš„ä¿®æ”¹å¹¶é‡Šæ”¾é”ã€‚</li></ul><h1 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h1><ul><li>è„é¡µï¼šæŒ‡å†…å­˜ï¼ˆç¼“å­˜æ± ï¼‰ä¸­çš„æ•°æ®é¡µä¸ç£ç›˜ä¸Šçš„æ•°æ®é¡µä¸ä¸€è‡´çš„æƒ…å†µã€‚æ•°æ®åº“è¡¨å•çš„å¢åˆ æ”¹ç­‰å†™æ“ä½œï¼Œéƒ½ä¼šäº§ç”Ÿè„é¡µã€‚</li></ul><h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul><li><a href="https://zzk.cnblogs.com/s/blogpost?Keywords=blog:zlia%20mysql45&pageindex=1">https://zzk.cnblogs.com/s/blogpost?Keywords=blog%3Azlia%20mysql45&amp;pageindex=1</a></li><li><a href="https://www.cnblogs.com/zlia/p/14571050.html">https://www.cnblogs.com/zlia/p/14571050.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>APNS</title>
      <link href="/posts/45153.html"/>
      <url>/posts/45153.html</url>
      
        <content type="html"><![CDATA[<p><strong>APNS</strong>ã€<strong>iPhone</strong>ï¼ˆè®¾å¤‡ï¼‰å’Œ <strong>åå°æœåŠ¡å™¨ï¼ˆServerï¼‰</strong> ä¸‰è€…ä¹‹é—´çš„å…³ç³»å’Œæ•°æ®æµã€‚</p><p>ä»¥ä¸‹æ˜¯APNSçš„æ—¶åºå›¾ï¼Œå±•ç¤ºäº†è®¾å¤‡ã€APNSå’ŒæœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’æµç¨‹ï¼š<br>ä½¿ç”¨ code block - mermaid</p><div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>    sequenceDiagram    participant I as iPhone (è®¾å¤‡)    participant A as APNS    participant S as Server (åå°æœåŠ¡å™¨)    autonumber        %% è®¾å¤‡æ³¨å†Œæ¨é€å¹¶è·å–è®¾å¤‡ä»¤ç‰Œ    I-&gt;&gt;A: æ³¨å†Œæ¨é€é€šçŸ¥ (registerForRemoteNotifications)    A--&gt;&gt;I: è¿”å›è®¾å¤‡ä»¤ç‰Œ (Device Token)    I-&gt;&gt;S: å‘é€è®¾å¤‡ä»¤ç‰Œç»™åå°æœåŠ¡å™¨ (via HTTPS)    %% è®¾å¤‡ä¸ APNS å»ºç«‹é•¿è¿æ¥    I-&gt;&gt;A: å»ºç«‹ TCP é•¿è¿æ¥ (ç«¯å£ 5223&#x2F;443)    Note right of A: é•¿è¿æ¥ç»´æŒï¼Œè®¾å¤‡ä¸»åŠ¨å‘èµ·    %% æ¨é€é€šçŸ¥æµç¨‹    S-&gt;&gt;A: å‘é€æ¨é€è¯·æ±‚ (HTTP&#x2F;2, æºå¸¦ Device Token)    Note right of S: çŸ­è¿æ¥ï¼ŒæŒ‰éœ€å‘èµ·    A-&gt;&gt;I: é€šè¿‡é•¿è¿æ¥æ¨é€é€šçŸ¥ç»™è®¾å¤‡    Note right of I: ç³»ç»Ÿå¤„ç†é€šçŸ¥ (æ˜¾ç¤º&#x2F;è§’æ ‡ç­‰)    %% æ–­ç½‘åé‡è¿    I--xA: ç½‘ç»œæ–­å¼€ï¼Œé•¿è¿æ¥ä¸­æ–­    I-&gt;&gt;A: ç½‘ç»œæ¢å¤ï¼Œä¸»åŠ¨é‡è¿ (æºå¸¦ Device Token)    Note right of A: APNS æ›´æ–°è¿æ¥çŠ¶æ€    %% å†æ¬¡æ¨é€    S-&gt;&gt;A: å‘é€æ–°çš„æ¨é€è¯·æ±‚    A-&gt;&gt;I: é€šè¿‡æ–°è¿æ¥æ¨é€é€šçŸ¥  </pre></div><blockquote><p>å¯ä»¥åœ¨ <a href="https://mermaid.live/">https://mermaid.live</a> åœ¨çº¿ç¼–è¾‘å’Œæ¸²æŸ“Mermaidå›¾è¡¨</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> APNS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AI Agent æŠ€æœ¯æ ¸å¿ƒæ¦‚å¿µå­¦ä¹ è·¯çº¿</title>
      <link href="/posts/51504.html"/>
      <url>/posts/51504.html</url>
      
        <content type="html"><![CDATA[<h3 id="LLMåº”ç”¨æŠ€æœ¯æ ¸å¿ƒæ¦‚å¿µå­¦ä¹ è·¯çº¿"><a href="#LLMåº”ç”¨æŠ€æœ¯æ ¸å¿ƒæ¦‚å¿µå­¦ä¹ è·¯çº¿" class="headerlink" title="LLMåº”ç”¨æŠ€æœ¯æ ¸å¿ƒæ¦‚å¿µå­¦ä¹ è·¯çº¿"></a><strong>LLMåº”ç”¨æŠ€æœ¯æ ¸å¿ƒæ¦‚å¿µå­¦ä¹ è·¯çº¿</strong></h3><p>è¿™æ¡è·¯çº¿éµå¾ªä»â€œåŸºç¡€æ„ä»¶â€åˆ°â€œæ ¸å¿ƒèƒ½åŠ›â€å†åˆ°â€œé«˜çº§æ¨¡å¼â€çš„é€»è¾‘ã€‚</p><hr><h4 id="ç¬¬ä¸€é˜¶æ®µï¼šç†è§£åŸºçŸ³â€”â€”è®©è®¡ç®—æœºâ€œæ‡‚å¾—â€å«ä¹‰ï¼ˆEmbeddingï¼‰"><a href="#ç¬¬ä¸€é˜¶æ®µï¼šç†è§£åŸºçŸ³â€”â€”è®©è®¡ç®—æœºâ€œæ‡‚å¾—â€å«ä¹‰ï¼ˆEmbeddingï¼‰" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µï¼šç†è§£åŸºçŸ³â€”â€”è®©è®¡ç®—æœºâ€œæ‡‚å¾—â€å«ä¹‰ï¼ˆEmbeddingï¼‰"></a><strong>ç¬¬ä¸€é˜¶æ®µï¼šç†è§£åŸºçŸ³â€”â€”è®©è®¡ç®—æœºâ€œæ‡‚å¾—â€å«ä¹‰ï¼ˆEmbeddingï¼‰</strong></h4><ul><li><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šè®¡ç®—æœºåªè®¤è¯†æ•°å­—ï¼Œæˆ‘ä»¬å¦‚ä½•è®©å®ƒä»¬ç†è§£æ–‡å­—ã€å›¾ç‰‡ã€è§†é¢‘çš„â€œæ„æ€â€ï¼Ÿ</li><li><strong>ä»€ä¹ˆæ˜¯ Embeddingï¼ˆåµŒå…¥ï¼‰ï¼Ÿ</strong> <strong>æ¯”å–»</strong>ï¼šæƒ³è±¡ä¸€ä¸ªâ€œè¯­ä¹‰åœ°å›¾â€ã€‚æ¯ä¸ªè¯ï¼ˆæˆ–å¥å­ã€å›¾ç‰‡ï¼‰éƒ½æ˜¯è¿™ä¸ªåœ°å›¾ä¸Šçš„ä¸€ä¸ªç‚¹ã€‚å«ä¹‰ç›¸è¿‘çš„è¯ï¼ˆå¦‚â€œå›½ç‹â€å’Œâ€œçš‡å¸â€ï¼‰åœ¨åœ°å›¾ä¸Šçš„ä½ç½®ä¼šéå¸¸æ¥è¿‘ï¼›å«ä¹‰ç›¸åçš„è¯ï¼ˆå¦‚â€œå›½ç‹â€å’Œâ€œå¹³æ°‘â€ï¼‰åˆ™ç›¸è·ç”šè¿œã€‚ <strong>æœ¬è´¨</strong>ï¼šEmbedding å°±æ˜¯ä¸€å¥—ç®—æ³•ï¼Œå°†éç»“æ„åŒ–çš„æ•°æ®ï¼ˆæ–‡å­—ã€å›¾ç‰‡ç­‰ï¼‰è½¬æ¢æˆä¸€ä¸²æœ‰æ„ä¹‰çš„æ•°å­—å‘é‡ã€‚è¿™ä¸ªå‘é‡å°±æ˜¯æ•°æ®ç‚¹åœ¨â€œè¯­ä¹‰åœ°å›¾â€ä¸Šçš„<strong>åæ ‡</strong>ã€‚ **ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ**åªæœ‰æŠŠæ•°æ®å˜æˆæ•°å­—åæ ‡ï¼Œè®¡ç®—æœºæ‰èƒ½è¿›è¡Œæ•°å­¦è®¡ç®—ï¼Œä»è€Œæ¯”è¾ƒç›¸ä¼¼æ€§ã€è¿›è¡Œåˆ†ç±»ã€èšç±»ç­‰æ“ä½œã€‚<strong>è¿™æ˜¯åç»­æ‰€æœ‰æŠ€æœ¯çš„åŸºç¡€ã€‚</strong></li></ul><h4 id="ç¬¬äºŒé˜¶æ®µï¼šå®ç°æ£€ç´¢â€”â€”æ„å»ºâ€œå¤–éƒ¨è®°å¿†åº“â€ï¼ˆå‘é‡æ•°æ®åº“ï¼‰"><a href="#ç¬¬äºŒé˜¶æ®µï¼šå®ç°æ£€ç´¢â€”â€”æ„å»ºâ€œå¤–éƒ¨è®°å¿†åº“â€ï¼ˆå‘é‡æ•°æ®åº“ï¼‰" class="headerlink" title="ç¬¬äºŒé˜¶æ®µï¼šå®ç°æ£€ç´¢â€”â€”æ„å»ºâ€œå¤–éƒ¨è®°å¿†åº“â€ï¼ˆå‘é‡æ•°æ®åº“ï¼‰"></a><strong>ç¬¬äºŒé˜¶æ®µï¼šå®ç°æ£€ç´¢â€”â€”æ„å»ºâ€œå¤–éƒ¨è®°å¿†åº“â€ï¼ˆå‘é‡æ•°æ®åº“ï¼‰</strong></h4><ul><li><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šæœ‰äº†â€œè¯­ä¹‰åœ°å›¾â€ï¼Œä½†å½“æ•°æ®é‡æå…¶åºå¤§æ—¶ï¼ˆæ¯”å¦‚æ•´ä¸ªå…¬å¸çŸ¥è¯†åº“ï¼‰ï¼Œå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°ä¸é—®é¢˜æœ€ç›¸å…³çš„ä¿¡æ¯ï¼Ÿ</li><li><strong>ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æ•°æ®åº“ï¼Ÿ</strong> <strong>ä¼ ç»Ÿæ•°æ®åº“çš„å±€é™</strong>ï¼šå®ƒä»¬æ“…é•¿ç²¾ç¡®åŒ¹é…ï¼ˆå¦‚â€œæ‰¾åˆ°id&#x3D;1çš„ç”¨æˆ·â€ï¼‰ï¼Œä½†ä¸æ“…é•¿æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆå¦‚â€œæ‰¾åˆ°æ„æ€æœ€æ¥è¿‘â€˜å¯æŒç»­å‘å±•â€™çš„æ–‡æ¡£â€ï¼‰ã€‚ <strong>å‘é‡æ•°æ®åº“çš„å¼ºé¡¹</strong>ï¼šå®ƒå°±æ˜¯ä¸ºâ€œè¯­ä¹‰åœ°å›¾â€é‡èº«å®šåˆ¶çš„æ•°æ®åº“ã€‚å®ƒä¸“é—¨åšä¸€ä»¶äº‹â€”â€”<strong>è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢</strong>ã€‚ä½ ç»™å®ƒä¸€ä¸ªé—®é¢˜çš„åæ ‡ï¼ˆé—®é¢˜æœ¬èº«çš„å‘é‡ï¼‰ï¼Œå®ƒèƒ½ä»¥æå¿«çš„é€Ÿåº¦åœ¨æ•´ä¸ªæµ·é‡å‘é‡åº“ä¸­ï¼Œæ‰¾åˆ°åæ ‡æœ€æ¥è¿‘çš„å‡ ä¸ªç‚¹ï¼ˆå³è¯­ä¹‰æœ€ç›¸å…³çš„æ–‡æœ¬ç‰‡æ®µï¼‰ã€‚ <strong>æœ¬è´¨</strong>ï¼šå‘é‡æ•°æ®åº“æ˜¯LLMçš„â€œå¤–éƒ¨è®°å¿†åº“â€æˆ–â€œçŸ¥è¯†ç´¢å¼•ç³»ç»Ÿâ€ï¼Œè´Ÿè´£é«˜æ•ˆã€ç²¾å‡†åœ°æ£€ç´¢ä¿¡æ¯ã€‚</li></ul><h4 id="ç¬¬ä¸‰é˜¶æ®µï¼šè¡¡é‡ç›¸å…³æ€§â€”â€”å®šä¹‰â€œç›¸ä¼¼â€çš„æ ‡å‡†ï¼ˆCosine-Similarityï¼‰"><a href="#ç¬¬ä¸‰é˜¶æ®µï¼šè¡¡é‡ç›¸å…³æ€§â€”â€”å®šä¹‰â€œç›¸ä¼¼â€çš„æ ‡å‡†ï¼ˆCosine-Similarityï¼‰" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µï¼šè¡¡é‡ç›¸å…³æ€§â€”â€”å®šä¹‰â€œç›¸ä¼¼â€çš„æ ‡å‡†ï¼ˆCosine Similarityï¼‰"></a><strong>ç¬¬ä¸‰é˜¶æ®µï¼šè¡¡é‡ç›¸å…³æ€§â€”â€”å®šä¹‰â€œç›¸ä¼¼â€çš„æ ‡å‡†ï¼ˆCosine Similarityï¼‰</strong></h4><ul><li><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šåœ¨â€œè¯­ä¹‰åœ°å›¾â€ä¸Šï¼Œå¦‚ä½•æ•°å­¦åœ°å®šä¹‰ä¸¤ä¸ªç‚¹â€œç›¸ä¼¼â€ï¼Ÿæ˜¯çœ‹å®ƒä»¬çš„ç›´çº¿è·ç¦»å—ï¼Ÿ</li><li><strong>Cosine Similarityï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰åˆ°åº•åœ¨ç®—ä¸ªå•¥ï¼Ÿ</strong> <strong>æ¯”å–»</strong>ï¼šä¸æ¯”â€œè·ç¦»â€ï¼Œæ¯”â€œæ–¹å‘â€ã€‚æƒ³è±¡ä¸¤ä¸ªä»åŸç‚¹å‡ºå‘çš„ç®­å¤´ã€‚æˆ‘ä»¬ä¸å…³å¿ƒç®­å¤´çš„é•¿çŸ­ï¼ˆå‘é‡çš„ç»å¯¹å¤§å°ï¼Œæ¯”å¦‚æ–‡æ¡£çš„é•¿çŸ­ï¼‰ï¼Œåªå…³å¿ƒä¸¤ä¸ªç®­å¤´æŒ‡å‘çš„æ–¹å‘æ˜¯å¦ä¸€è‡´ã€‚ <strong>è®¡ç®—ä»€ä¹ˆ</strong>ï¼šå®ƒè®¡ç®—çš„æ˜¯ä¸¤ä¸ªå‘é‡ä¹‹é—´å¤¹è§’çš„ä½™å¼¦å€¼ã€‚å¤¹è§’ä¸º0åº¦ï¼ˆæ–¹å‘å®Œå…¨ä¸€è‡´ï¼‰ï¼Œä½™å¼¦å€¼ä¸º1ï¼Œè¡¨ç¤ºå®Œå…¨ç›¸ä¼¼ï¼›å¤¹è§’ä¸º90åº¦ï¼ˆæ–¹å‘å‚ç›´ï¼‰ï¼Œä½™å¼¦å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸ç›¸å…³ã€‚ <strong>ä¸ºä»€ä¹ˆåœ¨NLPä¸­å¸¸ç”¨</strong>ï¼šå› ä¸ºå®ƒæ›´å…³æ³¨è¯­ä¹‰ä¸Šçš„æ–¹å‘æ€§ï¼Œè€Œå¿½ç•¥æ–‡æœ¬é•¿åº¦çš„å½±å“ï¼Œè¿™æ›´ç¬¦åˆæˆ‘ä»¬åˆ¤æ–­â€œæ„æ€æ˜¯å¦ç›¸ä¼¼â€çš„ç›´è§‰ã€‚</li></ul><p><strong>ğŸ‘‰ è‡³æ­¤ï¼Œä½ å·²ç»æŒæ¡äº†RAGçš„â€œæ£€ç´¢â€éƒ¨åˆ†çš„æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š<code>æ–‡æœ¬ -&gt; Embedding -&gt; å‘é‡æ•°æ®åº“ -&gt; ä½™å¼¦ç›¸ä¼¼åº¦æ£€ç´¢</code>ã€‚</strong></p><hr><h4 id="ç¬¬å››é˜¶æ®µï¼šæ„å»ºåº”ç”¨â€”â€”ç»™LLMâ€œå¼€å°ç¶â€ï¼ˆRAGï¼‰"><a href="#ç¬¬å››é˜¶æ®µï¼šæ„å»ºåº”ç”¨â€”â€”ç»™LLMâ€œå¼€å°ç¶â€ï¼ˆRAGï¼‰" class="headerlink" title="ç¬¬å››é˜¶æ®µï¼šæ„å»ºåº”ç”¨â€”â€”ç»™LLMâ€œå¼€å°ç¶â€ï¼ˆRAGï¼‰"></a><strong>ç¬¬å››é˜¶æ®µï¼šæ„å»ºåº”ç”¨â€”â€”ç»™LLMâ€œå¼€å°ç¶â€ï¼ˆRAGï¼‰</strong></h4><ul><li><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šLLMå†…éƒ¨çŸ¥è¯†è€æ—§ã€ä¼šäº§ç”Ÿå¹»è§‰ï¼ˆèƒ¡è¯´å…«é“ï¼‰ï¼Œå¦‚ä½•è®©å®ƒèƒ½å›ç­”æœªçŸ¥çš„ã€ä¸“ä¸šé¢†åŸŸçš„é—®é¢˜ï¼Ÿ</li><li><strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong> <strong>ä¸åªæ˜¯â€œå–‚çŸ¥è¯†åº“â€</strong>ï¼šä½ çš„ç†è§£éå¸¸åˆ°ä½ã€‚å®ƒçš„æœ¬è´¨æ˜¯<strong>å°†LLMçš„æ¨ç†èƒ½åŠ›ä¸å¤–éƒ¨çŸ¥è¯†æºçš„åŠ¨æ€æ£€ç´¢èƒ½åŠ›ç›¸ç»“åˆ</strong>ã€‚ <strong>å·¥ä½œæµç¨‹</strong>ï¼š <strong>æ£€ç´¢</strong>ï¼šå½“ç”¨æˆ·æå‡ºé—®é¢˜æ—¶ï¼Œ<strong>ä¸ç›´æ¥</strong>å°†é—®é¢˜æ‰”ç»™LLMã€‚è€Œæ˜¯å…ˆç”¨ä¸Šé¢çš„æŠ€æœ¯æ ˆï¼ˆEmbedding+å‘é‡æ•°æ®åº“+ç›¸ä¼¼åº¦è®¡ç®—ï¼‰ï¼Œä»å¤–éƒ¨çŸ¥è¯†åº“ä¸­â€œç²¾å‡†åœ°æ£€ç´¢â€å‡ºä¸é—®é¢˜æœ€ç›¸å…³çš„å‡ æ®µä¿¡æ¯ï¼ˆä¸Šä¸‹æ–‡ï¼‰ã€‚ <strong>å¢å¼º</strong>ï¼šå°†â€œ<strong>åŸå§‹é—®é¢˜ + æ£€ç´¢åˆ°çš„ç²¾å‡†ä¸Šä¸‹æ–‡</strong>â€ä¸€èµ·æ‰“åŒ…ï¼Œä½œä¸ºä¸€ä¸ªæ–°çš„ã€ä¿¡æ¯æ›´ä¸°å¯Œçš„æç¤ºè¯ï¼ˆPromptï¼‰äº¤ç»™LLMã€‚ <strong>ç”Ÿæˆ</strong>ï¼šLLMåŸºäºè¿™ä¸ªåŒ…å«äº†â€œæ ‡å‡†ç­”æ¡ˆâ€çº¿ç´¢çš„Promptæ¥ç”Ÿæˆå›ç­”ã€‚ <strong>æ ¸å¿ƒæŒ‘æˆ˜ä¸ä½ çš„æ€è€ƒä¸€è‡´</strong>ï¼šå¦‚ä½•â€œç²¾å‡†åœ°æ£€ç´¢â€ï¼Ÿå¦‚æœæ£€ç´¢åˆ°çš„ä¿¡æ¯ä¸ç›¸å…³ï¼ŒLLMçš„å›ç­”å°±ä¼šè·‘åã€‚å› æ­¤ï¼Œæ£€ç´¢å™¨çš„è´¨é‡ï¼ˆEmbeddingæ¨¡å‹ã€å‘é‡æ•°æ®åº“ã€æ’åºç®—æ³•ï¼‰ç›´æ¥å†³å®šäº†RAGçš„å¤©èŠ±æ¿ã€‚ <strong>å®ƒè§£å†³äº†</strong>ï¼šçŸ¥è¯†æ›´æ–°é—®é¢˜ï¼ˆæ”¹çŸ¥è¯†åº“å³å¯ï¼‰ã€å¹»è§‰é—®é¢˜ï¼ˆç­”æ¡ˆæœ‰æ®å¯æŸ¥ï¼‰ã€æº¯æºé—®é¢˜ï¼ˆå¯ä»¥æ³¨æ˜ç­”æ¡ˆæ¥æºï¼‰ã€‚</li></ul><hr><h4 id="ç¬¬äº”é˜¶æ®µï¼šå‡çº§äº¤äº’â€”â€”è®©LLMâ€œå­¦ä¼šä½¿ç”¨å·¥å…·â€ï¼ˆFunction-Calling-ReActï¼‰"><a href="#ç¬¬äº”é˜¶æ®µï¼šå‡çº§äº¤äº’â€”â€”è®©LLMâ€œå­¦ä¼šä½¿ç”¨å·¥å…·â€ï¼ˆFunction-Calling-ReActï¼‰" class="headerlink" title="ç¬¬äº”é˜¶æ®µï¼šå‡çº§äº¤äº’â€”â€”è®©LLMâ€œå­¦ä¼šä½¿ç”¨å·¥å…·â€ï¼ˆFunction Calling &amp; ReActï¼‰"></a><strong>ç¬¬äº”é˜¶æ®µï¼šå‡çº§äº¤äº’â€”â€”è®©LLMâ€œå­¦ä¼šä½¿ç”¨å·¥å…·â€ï¼ˆFunction Calling &amp; ReActï¼‰</strong></h4><ul><li><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šLLMæ— æ³•æ„ŸçŸ¥å®æ—¶ä¿¡æ¯ï¼ˆå¤©æ°”ã€è‚¡ä»·ï¼‰ï¼Œæ— æ³•æ‰§è¡Œå…·ä½“åŠ¨ä½œï¼ˆå‘é‚®ä»¶ã€æŸ¥æ•°æ®åº“ï¼‰ã€‚å¦‚ä½•è®©å®ƒä¸å¤–éƒ¨ä¸–ç•Œäº’åŠ¨ï¼Ÿ</li><li><strong>Function Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰çš„å·¥ä½œæµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong> <strong>æ¯”å–»</strong>ï¼šç»™LLMä¸€ä¸ªâ€œå·¥å…·æ¸…å•â€ï¼Œä¸Šé¢åˆ—å‡ºäº†æ¯ä¸ªå·¥å…·çš„åç§°ã€åŠŸèƒ½å’Œç”¨æ³•è¯´æ˜ï¼ˆè¿™å°±æ˜¯æ‰€è°“çš„â€œå‡½æ•°æ¨¡å¼â€æˆ–â€œå·¥å…·æ¨¡å¼â€ï¼‰ã€‚ <strong>å·¥ä½œæµç¨‹</strong>ï¼š <strong>ç”¨æˆ·è¯·æ±‚</strong>ï¼šç”¨æˆ·æå‡ºä¸€ä¸ªéœ€è¦å·¥å…·çš„è¯·æ±‚ï¼Œå¦‚â€œä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€ <strong>LLMåˆ†æ</strong>ï¼šLLMä¸ä¼šç›´æ¥å›ç­”ï¼Œè€Œæ˜¯åˆ†æè¯·æ±‚ï¼Œç„¶å<strong>ä»â€œå·¥å…·æ¸…å•â€ä¸­é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·</strong>ï¼ˆå¦‚ <code>get_weather(location)</code>ï¼‰ã€‚ <strong>è¾“å‡ºè°ƒç”¨æŒ‡ä»¤</strong>ï¼šLLM<strong>ä¸æ‰§è¡Œ</strong>ï¼Œè€Œæ˜¯<strong>è¿”å›ä¸€ä¸ªç»“æ„åŒ–çš„è°ƒç”¨è¯·æ±‚</strong>ï¼Œå¦‚ <code>{&quot;name&quot;: &quot;get_weather&quot;, &quot;arguments&quot;: {&quot;location&quot;: &quot;åŒ—äº¬&quot;}}</code>ã€‚ <strong>ç¨‹åºæ‰§è¡Œ</strong>ï¼šä½ çš„å¤–éƒ¨ç¨‹åºæ”¶åˆ°è¿™ä¸ªç»“æ„åŒ–è¯·æ±‚ï¼Œ<strong>ä»£ä¸ºæ‰§è¡Œ</strong>çœŸæ­£çš„å‡½æ•°è°ƒç”¨ï¼ˆæ¯”å¦‚è°ƒç”¨å¤©æ°”APIï¼‰ã€‚ <strong>è¿”å›ç»“æœ</strong>ï¼šå°†æ‰§è¡Œç»“æœï¼ˆå¦‚<code>{&quot;city&quot;: &quot;åŒ—äº¬&quot;, &quot;temperature&quot;: &quot;25Â°C&quot;}</code>ï¼‰å†äº¤å›ç»™LLMã€‚ <strong>LLMç»„ç»‡å›ç­”</strong>ï¼šLLMå°†APIè¿”å›çš„åŸå§‹æ•°æ®ç»„ç»‡æˆè‡ªç„¶è¯­è¨€å›ç­”ç”¨æˆ·ï¼šâ€œä»Šå¤©åŒ—äº¬å¤©æ°”æ™´æœ—ï¼Œæ°”æ¸©25æ‘„æ°åº¦ã€‚â€ <strong>æœ¬è´¨</strong>ï¼šä¸€ä¸ª<strong>å†³ç­–-æ‰§è¡Œ</strong>çš„<strong>å•æ¬¡å›åˆ</strong>ã€‚LLMè´Ÿè´£â€œæ€è€ƒâ€è¯¥ç”¨ä»€ä¹ˆå·¥å…·ã€ä¼ å…¥ä»€ä¹ˆå‚æ•°ï¼Œå¤–éƒ¨ç³»ç»Ÿè´Ÿè´£â€œæ‰§è¡Œâ€ã€‚</li><li><strong>ReActï¼ˆReasoning and Actingï¼‰æ¨¡å¼æ˜¯æ€ä¹ˆè®©äº¤äº’æ›´è¿›ä¸€æ­¥çš„ï¼Ÿ</strong> <strong>æ¯”å–»</strong>ï¼šFunction Calling æ˜¯LLMä¸‹è¾¾ä¸€ä¸ªå‘½ä»¤ã€‚è€ŒReActæ˜¯LLMåœ¨<strong>æ¨¡æ‹Ÿä¸€ä¸ªäººè§£å†³å¤æ‚é—®é¢˜çš„å®Œæ•´æ€è€ƒè¿‡ç¨‹</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½åŒ…å«å¤šä¸ªâ€œæ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿâ€çš„å¾ªç¯ã€‚ <strong>å·¥ä½œæµç¨‹</strong>ï¼šå¯¹äºå¤æ‚é—®é¢˜ï¼ˆå¦‚â€œæˆ‘ä»¬å…¬å¸ä»Šå¹´é”€å”®é¢æœ€é«˜çš„äº§å“æ˜¯ä»€ä¹ˆï¼Œå®ƒçš„ä¸»è¦å®¢æˆ·ç”»åƒæ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼‰ï¼š <strong>Reasonï¼ˆæ€è€ƒï¼‰</strong>ï¼šLLMä¼š<strong>å…ˆäº§ç”Ÿä¸€æ®µå†…éƒ¨æ¨ç†</strong>ï¼Œä¾‹å¦‚ï¼šâ€œè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦ä¸¤æ­¥ã€‚é¦–å…ˆï¼Œéœ€è¦æŸ¥è¯¢æ•°æ®åº“æ‰¾åˆ°é”€å”®é¢æœ€é«˜çš„äº§å“IDã€‚ç„¶åï¼Œå†æ ¹æ®è¿™ä¸ªäº§å“IDå»æŸ¥è¯¢å®¢æˆ·ç”»åƒæ•°æ®ã€‚â€ <strong>Actï¼ˆè¡ŒåŠ¨ï¼‰</strong>ï¼šæ ¹æ®æ¨ç†ï¼ŒLLMå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼Œæ¯”å¦‚è°ƒç”¨ <code>query_database(sql=&quot;SELECT ...&quot;)</code>å‡½æ•°ã€‚è¿™ä¸€æ­¥ç±»ä¼¼Function Callingã€‚ <strong>Observeï¼ˆè§‚å¯Ÿï¼‰</strong>ï¼šå¤–éƒ¨ç³»ç»Ÿæ‰§è¡Œå‡½æ•°ï¼Œè¿”å›ç»“æœï¼ˆå¦‚äº§å“IDæ˜¯<code>P-1001</code>ï¼‰ã€‚è¿™ä¸ªç»“æœè¢«åé¦ˆç»™LLMã€‚ <strong>å¾ªç¯</strong>ï¼šLLMæ¥æ”¶åˆ°è§‚å¯Ÿç»“æœï¼Œ<strong>å†æ¬¡è¿›è¡ŒReasoning</strong>ï¼šâ€œå¥½çš„ï¼Œæˆ‘å·²ç»æ‹¿åˆ°äº†äº§å“IDæ˜¯P-1001ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦æŸ¥è¯¢å®¢æˆ·è¡¨â€¦â€ ç„¶åå†æ¬¡ <strong>Act</strong>ï¼Œè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°â€¦ <strong>æœ¬è´¨</strong>ï¼šä¸€ä¸ª<strong>å¤šæ­¥æ¨ç†çš„å¾ªç¯æ¡†æ¶</strong>ã€‚å®ƒé€šè¿‡å¼ºåˆ¶LLMå±•ç¤ºâ€œæ€ç»´é“¾â€ï¼Œä½¿å…¶è§„åˆ’èƒ½åŠ›æ›´å¼ºï¼Œæ›´èƒ½å¤„ç†éœ€è¦å¤šæ­¥éª¤å·¥å…·è°ƒç”¨çš„å¤æ‚ä»»åŠ¡ã€‚</li></ul><h3 id="æ€»ç»“ï¼šä½ çš„å­¦ä¹ è·¯å¾„å›¾"><a href="#æ€»ç»“ï¼šä½ çš„å­¦ä¹ è·¯å¾„å›¾" class="headerlink" title="æ€»ç»“ï¼šä½ çš„å­¦ä¹ è·¯å¾„å›¾"></a><strong>æ€»ç»“ï¼šä½ çš„å­¦ä¹ è·¯å¾„å›¾</strong></h3><ol><li><strong>ä»Embeddingå¼€å§‹</strong>ï¼šç†è§£ä¸€åˆ‡æ˜¯å¦‚ä½•ä»â€œå°†ä¿¡æ¯è½¬åŒ–ä¸ºè¯­ä¹‰ç©ºé—´åæ ‡â€å¼€å§‹çš„ã€‚</li><li><strong>å­¦ä¹ å‘é‡æ•°æ®åº“å’Œç›¸ä¼¼åº¦è®¡ç®—</strong>ï¼šç†è§£å¦‚ä½•åœ¨è¿™ä¸ªç©ºé—´é‡Œè¿›è¡Œé«˜æ•ˆã€ç²¾å‡†çš„æ£€ç´¢ã€‚è¿™æ˜¯RAGçš„åŸºçŸ³ã€‚</li><li><strong>æ·±å…¥ç†è§£RAG</strong>ï¼šæŒæ¡å¦‚ä½•é€šè¿‡æ£€ç´¢å¤–éƒ¨çŸ¥è¯†æ¥å¢å¼ºLLMï¼Œè§£å†³å…¶æ ¸å¿ƒç—›ç‚¹ã€‚</li><li><strong>å­¦ä¹ Function Calling</strong>ï¼šç†è§£LLMä¸å¤–éƒ¨å·¥å…·äº¤äº’çš„åŸºæœ¬å•å…ƒã€‚</li><li><strong>æœ€ç»ˆæŒæ¡ReActæ¨¡å¼</strong>ï¼šç†è§£å¦‚ä½•åˆ©ç”¨LLMçš„æ¨ç†èƒ½åŠ›ï¼Œä¸²è”å¤šä¸ªFunction Callingæ¥è§£å†³å¤æ‚é—®é¢˜ã€‚</li></ol><p>è¿™æ¡è·¯çº¿æ¸…æ™°åœ°å±•ç¤ºäº†ç°ä»£LLMåº”ç”¨æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥è¢«æ„å»ºèµ·æ¥çš„ï¼š<strong>ä»é™æ€çš„çŸ¥è¯†æ£€ç´¢ï¼ˆRAGï¼‰ï¼Œåˆ°åŠ¨æ€çš„å·¥å…·ä½¿ç”¨ï¼ˆFunction Callingï¼‰ï¼Œå†åˆ°å¤æ‚çš„ä»»åŠ¡åˆ†è§£ä¸è§„åˆ’ï¼ˆReActï¼‰</strong>ã€‚ç¥ä½ å­¦ä¹ é¡ºåˆ©ï¼</p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI-Agent </tag>
            
            <tag> LLM </tag>
            
            <tag> RAG </tag>
            
            <tag> Function-Calling </tag>
            
            <tag> ReAct </tag>
            
            <tag> Embedding </tag>
            
            <tag> å‘é‡æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MCPï¼ˆModel Context Protocolï¼‰è¯¦è§£</title>
      <link href="/posts/27915.html"/>
      <url>/posts/27915.html</url>
      
        <content type="html"><![CDATA[<h2 id="What-is-the-MCP"><a href="#What-is-the-MCP" class="headerlink" title="What is the MCP?"></a>What is the MCP?</h2><ul><li>MCP (Model Context Protocol) is an <strong>open-source standard</strong> for connecting AI applications to external systems.</li><li>Using MCP, AI applications like Claude or ChatGPT can connect to <strong>data sources</strong> (e.g. local files, databases), <strong>tools</strong> (e.g. search engines, calculators) and <strong>workflows</strong> (e.g. specialized prompts)â€”enabling them to access key information and perform tasks.</li><li>Think of MCP like a USB-C port for AI applications. Just as USB-C provides a standardized way to connect electronic devices, MCP provides a standardized way to connect AI applications to external systems.</li></ul><p><img src="https://mintcdn.com/mcp/bEUxYpZqie0DsluH/images/mcp-simple-diagram.png?fit=max&auto=format&n=bEUxYpZqie0DsluH&q=85&s=35268aa0ad50b8c385913810e7604550" alt="img"></p><h3 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h3><p>Key participants in the MCP architecture are:</p><ul><li><strong>MCP Host</strong>: The AI application that coordinates and manages one or multiple MCP clients</li><li><strong>MCP Client</strong>: A component that maintains a connection to an MCP server and obtains context from an MCP server for the MCP host to use</li><li><strong>MCP Server</strong>: A program that provides context to MCP clients</li></ul><p><img src="/../Pics/WX20251124-172727@2x.png" alt="img"></p><h4 id="Data-Layer"><a href="#Data-Layer" class="headerlink" title="Data Layer"></a>Data Layer</h4><p>Defines the <a href="https://en.wikipedia.org/wiki/JSON-RPC#Implementations"><strong>JSON-RPC</strong></a> based protocol for client-server communication, including lifecycle management, and core primitives, such as tools, resources, prompts and notifications.</p><p>Core Primitives:</p><ul><li><strong>Tools</strong>: Executable functions that AI applications can invoke to perform actions (e.g., file operations, API calls, database queries)</li><li><strong>Resources</strong>: Data sources that provide contextual information to AI applications (e.g., file contents, database records, API responses)</li><li><strong>Prompts</strong>: Reusable templates that help structure interactions with language models (e.g., system prompts, few-shot examples)</li></ul><h4 id="Transport-Layer"><a href="#Transport-Layer" class="headerlink" title="Transport Layer"></a>Transport Layer</h4><p>Defines the communication mechanisms and channels that enable data exchange between clients and servers, including transport-specific connection establishment, message framing, and authorization.</p><ul><li><strong>STDIO</strong> : Uses standard input&#x2F;output streams for direct process communication between <strong>local processes</strong> on the same machine, providing optimal performance with no network overhead.</li><li><strong>Server-Sent Events (SSE)</strong> : This approach required two separate endpoints:<ol><li>An SSE endpoint (<code>/sse</code>) that established a persistent connection for the client to receive responses</li><li>A separate messages endpoint (<code>/sse/messages</code>) where clients would send request</li></ol></li><li><strong>Streamable HTTP</strong> : Offers a more elegant solution by enabling <strong>bidirectional communication through a single endpoint</strong>.</li></ul><p><img src="https://picx.zhimg.com/50/v2-987260a35809fece3edb804df7691c0a_720w.jpg?source=2c26e567" alt="img"></p><h2 id="Develop-a-MCP-Server"><a href="#Develop-a-MCP-Server" class="headerlink" title="Develop a MCP Server"></a>Develop a MCP Server</h2><ol><li>Integrate MCP SDK</li><li>Develop tools&#x2F;resources&#x2F;prompts as your business needs</li><li>Debug it with MCP Inspector</li></ol>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MCP </tag>
            
            <tag> Model Context Protocol </tag>
            
            <tag> AI </tag>
            
            <tag> Claude </tag>
            
            <tag> åè®®æ ‡å‡† </tag>
            
            <tag> å¼€å‘æŒ‡å— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç°ä»£èº«ä»½è®¤è¯ä¸æˆæƒæŠ€æœ¯å®Œå…¨æŒ‡å— - OAuthã€JWTã€SAML ç­‰åè®®è¯¦è§£</title>
      <link href="/posts/64545.html"/>
      <url>/posts/64545.html</url>
      
        <content type="html"><![CDATA[<h1 id="è®¤è¯å’Œæˆæƒå®Œå…¨æŒ‡å—"><a href="#è®¤è¯å’Œæˆæƒå®Œå…¨æŒ‡å—" class="headerlink" title="è®¤è¯å’Œæˆæƒå®Œå…¨æŒ‡å—"></a>è®¤è¯å’Œæˆæƒå®Œå…¨æŒ‡å—</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨ç°ä»£ç½‘ç»œå®‰å…¨ä½“ç³»ä¸­ï¼Œ<strong>è®¤è¯ï¼ˆAuthenticationï¼‰</strong> å’Œ <strong>æˆæƒï¼ˆAuthorizationï¼‰</strong> æ˜¯ä¿éšœç³»ç»Ÿå®‰å…¨çš„ä¸¤å¤§æ ¸å¿ƒæœºåˆ¶ï¼š</p><ul><li><strong>è®¤è¯</strong>ï¼šéªŒè¯ç”¨æˆ·èº«ä»½ï¼ˆâ€ä½ æ˜¯è°ï¼Ÿâ€ï¼‰</li><li><strong>æˆæƒ</strong>ï¼šç¡®è®¤è®¿é—®æƒé™ï¼ˆâ€ä½ èƒ½åšä»€ä¹ˆï¼Ÿâ€ï¼‰</li></ul><p>æœ¬æ–‡å°†ä»åè®®å’ŒTokenä¸¤ä¸ªç»´åº¦ï¼Œç³»ç»Ÿæ€§é˜è¿°è®¤è¯æˆæƒçš„æŠ€æœ¯ä½“ç³»ã€‚</p><hr><h2 id="ä¸€ã€è®¤è¯æˆæƒåè®®ä½“ç³»"><a href="#ä¸€ã€è®¤è¯æˆæƒåè®®ä½“ç³»" class="headerlink" title="ä¸€ã€è®¤è¯æˆæƒåè®®ä½“ç³»"></a>ä¸€ã€è®¤è¯æˆæƒåè®®ä½“ç³»</h2><h3 id="1-OAuth-2-0-æˆæƒæ ‡å‡†åè®®"><a href="#1-OAuth-2-0-æˆæƒæ ‡å‡†åè®®" class="headerlink" title="1. OAuth 2.0 - æˆæƒæ ‡å‡†åè®®"></a>1. OAuth 2.0 - æˆæƒæ ‡å‡†åè®®</h3><p><strong>OAuth 2.0</strong> æ˜¯ç°ä»£äº’è”ç½‘æˆæƒçš„åŸºçŸ³ï¼Œä¸“æ³¨äº<strong>æˆæƒ</strong>ï¼ˆèµ„æºè®¿é—®æƒé™çš„å§”æ´¾ï¼‰ï¼Œè€Œéç›´æ¥å¤„ç†ç”¨æˆ·èº«ä»½è®¤è¯ã€‚</p><h4 id="æ ¸å¿ƒè§’è‰²"><a href="#æ ¸å¿ƒè§’è‰²" class="headerlink" title="æ ¸å¿ƒè§’è‰²"></a>æ ¸å¿ƒè§’è‰²</h4><table><thead><tr><th>è§’è‰²</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>èµ„æºæ‰€æœ‰è€…ï¼ˆResource Ownerï¼‰</td><td>æ‹¥æœ‰èµ„æºçš„ç”¨æˆ·</td><td>å¾®ä¿¡ç”¨æˆ·</td></tr><tr><td>å®¢æˆ·ç«¯ï¼ˆClientï¼‰</td><td>è¯·æ±‚è®¿é—®èµ„æºçš„åº”ç”¨</td><td>ç¬¬ä¸‰æ–¹å°ç¨‹åº</td></tr><tr><td>æˆæƒæœåŠ¡å™¨ï¼ˆAuthorization Serverï¼‰</td><td>é¢å‘Tokençš„æœåŠ¡</td><td>å¾®ä¿¡æˆæƒæœåŠ¡å™¨</td></tr><tr><td>èµ„æºæœåŠ¡å™¨ï¼ˆResource Serverï¼‰</td><td>å­˜å‚¨å—ä¿æŠ¤èµ„æºçš„æœåŠ¡</td><td>å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯API</td></tr></tbody></table><h4 id="å››ç§æˆæƒæ¨¡å¼"><a href="#å››ç§æˆæƒæ¨¡å¼" class="headerlink" title="å››ç§æˆæƒæ¨¡å¼"></a>å››ç§æˆæƒæ¨¡å¼</h4><ol><li><p><strong>æˆæƒç æ¨¡å¼ï¼ˆAuthorization Codeï¼‰</strong></p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šWebåº”ç”¨ï¼ˆæœåŠ¡ç«¯å®‰å…¨ï¼‰</li><li><strong>å®‰å…¨æ€§</strong>ï¼šæœ€é«˜ï¼Œæ¨èä½¿ç”¨</li><li><strong>æµç¨‹</strong>ï¼šç”¨æˆ·æˆæƒ â†’ è·å–æˆæƒç  â†’ åç«¯äº¤æ¢Token</li></ul></li><li><p><strong>éšå¼æ¨¡å¼ï¼ˆImplicitï¼‰</strong></p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šSPAæˆ–åŸç”ŸAppï¼ˆå®¢æˆ·ç«¯ä¸å®‰å…¨ï¼‰</li><li><strong>æ³¨æ„</strong>ï¼šOAuth 2.1å·²åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨PKCE</li></ul></li><li><p><strong>å¯†ç æ¨¡å¼ï¼ˆResource Owner Password Credentialsï¼‰</strong></p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé«˜åº¦ä¿¡ä»»çš„å®¢æˆ·ç«¯</li><li><strong>é£é™©</strong>ï¼šç›´æ¥æš´éœ²ç”¨æˆ·å¯†ç </li></ul></li><li><p><strong>å®¢æˆ·ç«¯å‡­è¯æ¨¡å¼ï¼ˆClient Credentialsï¼‰</strong></p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæœåŠ¡ç«¯é—´é€šä¿¡ï¼ˆæ— ç”¨æˆ·å‚ä¸ï¼‰</li><li><strong>ç‰¹ç‚¹</strong>ï¼šæœºå™¨å¯¹æœºå™¨çš„æˆæƒ</li></ul></li></ol><h4 id="å…¸å‹åº”ç”¨åœºæ™¯"><a href="#å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="å…¸å‹åº”ç”¨åœºæ™¯"></a>å…¸å‹åº”ç”¨åœºæ™¯</h4><ul><li>ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¾®ä¿¡ã€QQã€GitHubç™»å½•ï¼‰</li><li>APIè®¿é—®æ§åˆ¶</li><li>ç§»åŠ¨åº”ç”¨æˆæƒ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/OAuth.webp" alt="img"></p><h3 id="2-OpenID-Connect-OIDC-èº«ä»½è®¤è¯å±‚"><a href="#2-OpenID-Connect-OIDC-èº«ä»½è®¤è¯å±‚" class="headerlink" title="2. OpenID Connect (OIDC) - èº«ä»½è®¤è¯å±‚"></a>2. OpenID Connect (OIDC) - èº«ä»½è®¤è¯å±‚</h3><p><strong>OpenID Connect</strong> åœ¨OAuth 2.0åŸºç¡€ä¸Šæ‰©å±•ï¼Œä¸“é—¨è§£å†³<strong>èº«ä»½è®¤è¯</strong>é—®é¢˜ï¼Œæ˜¯OAuth 2.0 + èº«ä»½è®¤è¯çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="æ ¸å¿ƒç‰¹æ€§"><a href="#æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§"></a>æ ¸å¿ƒç‰¹æ€§</h4><ul><li><strong>ID Token</strong>ï¼šJWTæ ¼å¼ï¼ŒåŒ…å«ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼ˆå¦‚å§“åã€é‚®ç®±ã€ç”¨æˆ·IDï¼‰</li><li><strong>UserInfoç«¯ç‚¹</strong>ï¼šé€šè¿‡Access Tokenè·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯</li><li><strong>æ ‡å‡†åŒ–å£°æ˜</strong>ï¼šå®šä¹‰äº†æ ‡å‡†çš„ç”¨æˆ·å±æ€§å­—æ®µ</li></ul><h4 id="OIDC-æµç¨‹"><a href="#OIDC-æµç¨‹" class="headerlink" title="OIDC æµç¨‹"></a>OIDC æµç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯åº”ç”¨</span><br><span class="line">2. é‡å®šå‘åˆ°OIDCæä¾›å•†è¿›è¡Œè®¤è¯</span><br><span class="line">3. ç”¨æˆ·æˆæƒåè¿”å›æˆæƒç </span><br><span class="line">4. å®¢æˆ·ç«¯äº¤æ¢æˆæƒç è·å–Token</span><br><span class="line">5. è¿”å›Access Token + ID Token</span><br><span class="line">6. é€šè¿‡UserInfoç«¯ç‚¹è·å–ç”¨æˆ·ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/OIDC.webp" alt="img"></p><h4 id="å…¸å‹åº”ç”¨åœºæ™¯-1"><a href="#å…¸å‹åº”ç”¨åœºæ™¯-1" class="headerlink" title="å…¸å‹åº”ç”¨åœºæ™¯"></a>å…¸å‹åº”ç”¨åœºæ™¯</h4><ul><li><strong>ä¼ä¸šSSO</strong>ï¼šä½¿ç”¨Google Workspaceç™»å½•ä¼ä¸šåº”ç”¨</li><li><strong>æ¶ˆè´¹çº§SSO</strong>ï¼šä½¿ç”¨Apple IDç™»å½•ç¬¬ä¸‰æ–¹åº”ç”¨</li><li><strong>è·¨åŸŸè®¤è¯</strong>ï¼šå¤šä¸ªå­åŸŸåç³»ç»Ÿçš„ç»Ÿä¸€ç™»å½•</li></ul><h3 id="3-SAML-2-0-ä¼ä¸šçº§èº«ä»½è”é‚¦"><a href="#3-SAML-2-0-ä¼ä¸šçº§èº«ä»½è”é‚¦" class="headerlink" title="3. SAML 2.0 - ä¼ä¸šçº§èº«ä»½è”é‚¦"></a>3. SAML 2.0 - ä¼ä¸šçº§èº«ä»½è”é‚¦</h3><p><strong>SAML 2.0</strong> æ˜¯ä¼ä¸šçº§<strong>è®¤è¯ä¸æˆæƒ</strong>æ ‡å‡†ï¼ŒåŸºäºXMLå®ç°è·¨åŸŸå•ç‚¹ç™»å½•ï¼Œåœ¨ä¼ä¸šç¯å¢ƒä¸­å¹¿æ³›éƒ¨ç½²ã€‚</p><h4 id="æ ¸å¿ƒæ¶æ„"><a href="#æ ¸å¿ƒæ¶æ„" class="headerlink" title="æ ¸å¿ƒæ¶æ„"></a>æ ¸å¿ƒæ¶æ„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Identity Provider (IdP) â†â†’ Service Provider (SP)</span><br><span class="line">      â†“                           â†“</span><br><span class="line">   ç”¨æˆ·è®¤è¯                    èµ„æºè®¿é—®</span><br></pre></td></tr></table></figure><h4 id="å…³é”®ç»„ä»¶"><a href="#å…³é”®ç»„ä»¶" class="headerlink" title="å…³é”®ç»„ä»¶"></a>å…³é”®ç»„ä»¶</h4><ul><li><strong>æ–­è¨€ï¼ˆAssertionï¼‰</strong>ï¼šXMLæ ¼å¼çš„å®‰å…¨å£°æ˜ï¼ŒåŒ…å«ç”¨æˆ·èº«ä»½å’Œæƒé™ä¿¡æ¯</li><li><strong>èº«ä»½æä¾›è€…ï¼ˆIdPï¼‰</strong>ï¼šè®¤è¯ç”¨æˆ·å¹¶ç”ŸæˆSAMLæ–­è¨€ï¼ˆå¦‚ä¼ä¸šADï¼‰</li><li><strong>æœåŠ¡æä¾›è€…ï¼ˆSPï¼‰</strong>ï¼šä¾èµ–IdPçš„æ–­è¨€æä¾›æœåŠ¡è®¿é—®ï¼ˆå¦‚SaaSåº”ç”¨ï¼‰</li></ul><h4 id="SAML-SSO-æµç¨‹"><a href="#SAML-SSO-æµç¨‹" class="headerlink" title="SAML SSO æµç¨‹"></a>SAML SSO æµç¨‹</h4><ol><li>ç”¨æˆ·è®¿é—®SPåº”ç”¨</li><li>SPé‡å®šå‘åˆ°ä¼ä¸šIdP</li><li>IdPéªŒè¯ç”¨æˆ·èº«ä»½</li><li>ç”ŸæˆSAMLæ–­è¨€å¹¶è¿”å›SP</li><li>SPéªŒè¯æ–­è¨€å¹¶æˆæƒè®¿é—®</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/SAML.webp" alt="img"></p><h4 id="ä¼ä¸šåº”ç”¨åœºæ™¯"><a href="#ä¼ä¸šåº”ç”¨åœºæ™¯" class="headerlink" title="ä¼ä¸šåº”ç”¨åœºæ™¯"></a>ä¼ä¸šåº”ç”¨åœºæ™¯</h4><ul><li><strong>Office 365é›†æˆ</strong>ï¼šé€šè¿‡ADFSå®ç°ä¼ä¸šSSO</li><li><strong>SaaSåº”ç”¨é›†æˆ</strong>ï¼šSalesforceã€ServiceNowç­‰ä¼ä¸šåº”ç”¨</li><li><strong>æ··åˆäº‘ç¯å¢ƒ</strong>ï¼šæœ¬åœ°ADä¸äº‘æœåŠ¡çš„èº«ä»½è”é‚¦</li></ul><h3 id="4-Kerberos-ç¥¨æ®è®¤è¯åè®®"><a href="#4-Kerberos-ç¥¨æ®è®¤è¯åè®®" class="headerlink" title="4. Kerberos - ç¥¨æ®è®¤è¯åè®®"></a>4. Kerberos - ç¥¨æ®è®¤è¯åè®®</h3><p><strong>Kerberos</strong> æ˜¯åŸºäºç¥¨æ®çš„ç½‘ç»œè®¤è¯åè®®ï¼Œé€šè¿‡å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKDCï¼‰å®ç°å®‰å…¨è®¤è¯ï¼Œæœ‰æ•ˆé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</p><h4 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h4><ul><li><strong>KDCï¼ˆKey Distribution Centerï¼‰</strong>ï¼šå¯†é’¥åˆ†å‘ä¸­å¿ƒ</li><li><strong>TGTï¼ˆTicket-Granting Ticketï¼‰</strong>ï¼šç”¨æˆ·é¦–æ¬¡è®¤è¯åçš„é•¿æœŸç¥¨æ®</li><li><strong>æœåŠ¡ç¥¨æ®ï¼ˆService Ticketï¼‰</strong>ï¼šè®¿é—®å…·ä½“æœåŠ¡çš„ä¸´æ—¶ç¥¨æ®</li></ul><h4 id="Kerberos-è®¤è¯æµç¨‹"><a href="#Kerberos-è®¤è¯æµç¨‹" class="headerlink" title="Kerberos è®¤è¯æµç¨‹"></a>Kerberos è®¤è¯æµç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Client â†’ AS (Authentication Server): AS_REQ</span><br><span class="line">AS â†’ Client: AS_REP (TGT)</span><br><span class="line">Client â†’ TGS (Ticket-Granting Server): TGS_REQ (TGT)</span><br><span class="line">TGS â†’ Client: TGS_REP (Service Ticket)</span><br><span class="line">Client â†’ Service: AP_REQ (Service Ticket)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/Kerberos.webp" alt="img"></p><h3 id="5-LDAP-ç›®å½•æœåŠ¡åè®®"><a href="#5-LDAP-ç›®å½•æœåŠ¡åè®®" class="headerlink" title="5. LDAP - ç›®å½•æœåŠ¡åè®®"></a>5. LDAP - ç›®å½•æœåŠ¡åè®®</h3><p><strong>LDAPï¼ˆLightweight Directory Access Protocolï¼‰</strong> æ˜¯è®¿é—®å’Œç»´æŠ¤ç›®å½•æœåŠ¡çš„æ ‡å‡†åè®®ï¼Œä¸»è¦ç”¨äºç”¨æˆ·å’Œç»„ç»‡ä¿¡æ¯çš„æŸ¥è¯¢ä¸ç®¡ç†ã€‚</p><h4 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a>æ ¸å¿ƒåŠŸèƒ½</h4><ul><li><strong>ç›®å½•æŸ¥è¯¢</strong>ï¼šç”¨æˆ·ã€ç»„ç»‡æ¶æ„ã€æƒé™ä¿¡æ¯æŸ¥è¯¢</li><li><strong>èº«ä»½éªŒè¯</strong>ï¼šç”¨æˆ·åå¯†ç éªŒè¯</li><li><strong>å±æ€§ç®¡ç†</strong>ï¼šç”¨æˆ·å±æ€§çš„å¢åˆ æ”¹æŸ¥</li></ul><h4 id="å¸¸è§å®ç°"><a href="#å¸¸è§å®ç°" class="headerlink" title="å¸¸è§å®ç°"></a>å¸¸è§å®ç°</h4><ul><li><strong>Microsoft Active Directory (AD)</strong>ï¼šWindowsåŸŸç¯å¢ƒçš„æ ‡å‡†</li><li><strong>OpenLDAP</strong>ï¼šå¼€æºLDAPå®ç°</li><li><strong>Apache Directory Server</strong>ï¼šJavaå®ç°çš„LDAPæœåŠ¡</li></ul><h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><ul><li>ä¼ä¸šå†…éƒ¨ç”¨æˆ·è®¤è¯ï¼ˆVPNã€é‚®ç®±ã€OAç³»ç»Ÿï¼‰</li><li>ç»„ç»‡æ¶æ„ç®¡ç†</li><li>æƒé™æ§åˆ¶å’Œç”¨æˆ·å±æ€§æŸ¥è¯¢</li></ul><h4 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h4><ol><li><strong>å®‰å…¨æ€§å·®ï¼š</strong>Â LDAP ä¸»è¦æ˜¯ä¸ºå—ä¿¡ä»»çš„å†…ç½‘è®¾è®¡çš„ã€‚è™½ç„¶æœ‰ LDAPS (SSL)ï¼Œä½†åœ¨å…¬ç½‘æš´éœ² LDAP ç«¯å£æ˜¯éå¸¸å±é™©çš„è¡Œä¸ºã€‚</li><li><strong>Web ä¸å‹å¥½ï¼š</strong>Â LDAP æ˜¯åŸºäº TCP çš„é•¿è¿æ¥äºŒè¿›åˆ¶åè®®ï¼Œä¸æ˜¯ HTTPã€‚æµè§ˆå™¨é‡Œçš„ JavaScript æ ¹æœ¬æ²¡æ³•ç›´æ¥å‘ LDAP è¯·æ±‚ã€‚</li><li><strong>æ²¡æœ‰ Token æ¦‚å¿µï¼š</strong>Â LDAP éªŒè¯å®Œå°±æ˜¯éªŒè¯å®Œäº†ï¼Œå®ƒä¸ä¼šç»™ä½ å‘ä¸€ä¸ªâ€œä»¤ç‰Œâ€è®©ä½ å»è®¿é—®å…¶ä»– APIã€‚è€Œ OAuth&#x2F;OIDC çš„æ ¸å¿ƒå°±æ˜¯é‚£ä¸ª Tokenï¼Œå¯ä»¥åœ¨å¾®æœåŠ¡ä¹‹é—´ä¼ é€’ã€‚</li><li><strong>æ ‡å‡†åŒ–ä¸è¶³ï¼š</strong>Â è™½ç„¶ LDAP æ˜¯æ ‡å‡†ï¼Œä½†ä¸åŒå‚å•†ï¼ˆAD vs OpenLDAPï¼‰çš„ Schemaï¼ˆå­—æ®µå®šä¹‰ï¼‰å·®å¼‚å¾ˆå¤§ã€‚OIDC&#x2F;SAML åœ¨è¿™æ–¹é¢å±è”½äº†åº•å±‚å·®å¼‚ã€‚</li></ol><h4 id="LDAP-vs-SAML-OIDC-OAuth"><a href="#LDAP-vs-SAML-OIDC-OAuth" class="headerlink" title="LDAP vs. SAML &#x2F; OIDC &#x2F; OAuth"></a>LDAP vs. SAML &#x2F; OIDC &#x2F; OAuth</h4><ul><li><strong>æœ¬è´¨åŒºåˆ«ï¼š</strong><ul><li><strong>LDAP</strong>Â æ˜¯é’ˆå¯¹<strong>å†…ç½‘</strong>è®¾è®¡çš„ã€åŸºäº TCP çš„æŸ¥è¯¢åè®®ã€‚å®ƒå¾ˆå¤è€ï¼Œä¸é€‚åˆåœ¨äº’è”ç½‘ä¸Šè£¸å¥”ï¼ˆå®¹æ˜“è¢«æŠ“åŒ…ï¼Œä¸”é˜²ç«å¢™ä¸å‹å¥½ï¼‰ã€‚</li><li><strong>SAML&#x2F;OIDC</strong>Â æ˜¯åŸºäºÂ <strong>HTTP&#x2F;æµè§ˆå™¨</strong>Â çš„ã€‚å®ƒä»¬æ˜¯ä¸ºäº†è§£å†³ LDAP æ— æ³•è·¨åŸŸã€æ— æ³•ä¸Šäº‘çš„é—®é¢˜è€Œè¯ç”Ÿçš„ã€‚</li></ul></li><li><strong>é…åˆæ–¹å¼ï¼š</strong><ul><li>ç”¨æˆ·åœ¨æµè§ˆå™¨ç”¨ OIDC ç™»å½• -&gt; è¯·æ±‚å‘ç»™ IdPï¼ˆå¦‚ Keycloakï¼‰ -&gt; Keycloak é€šè¿‡ LDAP åè®®å»é—®åç«¯çš„ ADï¼šâ€œå¯†ç å¯¹ä¸å¯¹ï¼Ÿâ€ -&gt; AD è¯´â€œå¯¹â€ -&gt; Keycloak ç­¾å‘ OIDC Token ç»™ç”¨æˆ·ã€‚</li></ul></li></ul><h4 id="LDAP-vs-Kerberos"><a href="#LDAP-vs-Kerberos" class="headerlink" title="LDAP vs. Kerberos"></a>LDAP vs. Kerberos</h4><p>è¿™æ˜¯ä¸€å¯¹<strong>ç„¦ä¸ç¦»å­Ÿçš„å¥½åŸºå‹</strong>ï¼Œç‰¹åˆ«æ˜¯åœ¨ Windows Active Directory (AD) ç¯å¢ƒä¸‹ã€‚</p><ul><li><strong>å…³ç³»ï¼š</strong><ul><li><strong>LDAP</strong>Â è´Ÿè´£<strong>æŸ¥ä¿¡æ¯</strong>ï¼ˆè¿™ä¸ªäººå±äºå“ªä¸ªç»„ï¼Ÿä»–çš„é‚®ç®±æ˜¯å¤šå°‘ï¼Ÿï¼‰ã€‚</li><li><strong>Kerberos</strong>Â è´Ÿè´£<strong>éªŒè¯å¯†ç </strong>ï¼ˆç¥¨æ®äº¤æ¢ï¼Œè¯æ˜ä½ æ˜¯ä½ ï¼‰ã€‚</li></ul></li><li><strong>åŒºåˆ«ï¼š</strong><ul><li>LDAP ä¹Ÿå¯ä»¥éªŒè¯å¯†ç ï¼ˆé€šè¿‡Â <code>bind</code>Â æ“ä½œï¼‰ï¼Œä½†åœ¨ Windows åŸŸç¯å¢ƒä¸­ï¼Œç™»å½•è¿‡ç¨‹ä¸»è¦æ˜¯ Kerberos åœ¨è·‘ï¼Œç™»å½•æˆåŠŸåï¼Œç³»ç»Ÿä¼šç”¨ LDAP å»æ‹‰å–ä½ çš„ä¸ªäººç­–ç•¥ã€ç»„ä¿¡æ¯ç­‰ã€‚</li><li>Kerberos æå…¶ä¾èµ–å†…ç½‘ç¯å¢ƒå’Œæ—¶é—´åŒæ­¥ï¼Œ<strong>å‡ºäº†å±€åŸŸç½‘å°±åŸºæœ¬åºŸäº†</strong>ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ²¡æ³•ç”¨äºäº’è”ç½‘ SSOã€‚</li></ul></li></ul><h4 id="å…¸å‹åº”ç”¨"><a href="#å…¸å‹åº”ç”¨" class="headerlink" title="å…¸å‹åº”ç”¨"></a>å…¸å‹åº”ç”¨</h4><ul><li><strong>WindowsåŸŸç¯å¢ƒ</strong>ï¼šADåŸŸçš„é»˜è®¤è®¤è¯æœºåˆ¶</li><li><strong>Hadoopé›†ç¾¤</strong>ï¼šå¤§æ•°æ®å¹³å°çš„å®‰å…¨è®¤è¯</li><li><strong>ä¼ä¸šç½‘ç»œ</strong>ï¼šå†…ç½‘èµ„æºçš„å®‰å…¨è®¿é—®</li></ul><h3 id="å„åè®®å¯¹æ¯”"><a href="#å„åè®®å¯¹æ¯”" class="headerlink" title="å„åè®®å¯¹æ¯”"></a>å„åè®®å¯¹æ¯”</h3><table><thead><tr><th><strong>åè®®</strong></th><th><strong>è§’è‰²å®šä½</strong></th><th><strong>å…¸å‹â€œå¯¹è¯â€å†…å®¹</strong></th><th><strong>é€‚ç”¨èŒƒå›´</strong></th><th><strong>æ˜¯å¦å­˜æ”¾æ•°æ®?</strong></th></tr></thead><tbody><tr><td><strong>LDAP</strong></td><td><strong>å¤§ç®¡å®¶ (æ•°æ®åº“)</strong></td><td>â€œå¸®æˆ‘æŸ¥ä¸‹å¼ ä¸‰çš„éƒ¨é—¨â€ &#x2F; â€œå¯†ç å¯¹ä¸å¯¹?â€</td><td><strong>å±€åŸŸç½‘æ·±å¤„</strong> (åç«¯)</td><td><strong>æ˜¯</strong> (æ ¸å¿ƒæ•°æ®æº)</td></tr><tr><td><strong>Kerberos</strong></td><td><strong>å†…ç½‘ä¿å®‰</strong></td><td>â€œè¿™æ˜¯å¼ ä¸‰çš„ç¥¨æ®(Ticket)ï¼Œæ”¾è¡Œå—?â€</td><td><strong>å±€åŸŸç½‘</strong> (WindowsåŸŸ)</td><td>å¦ (ä¾èµ–KDC)</td></tr><tr><td><strong>SAML</strong></td><td><strong>ä¼ä¸šä¿¡ä½¿</strong></td><td>â€œæˆ‘æ˜¯IdPï¼Œæˆ‘è¯æ˜è¿™ä¸ªXMLé‡Œçš„å¼ ä¸‰å·²ç™»å½•â€</td><td>äº’è”ç½‘ &#x2F; ä¼ä¸šäº’ä¿¡</td><td>å¦</td></tr><tr><td><strong>OIDC</strong></td><td><strong>ç°ä»£æŠ¤ç…§</strong></td><td>â€œè¿™æ˜¯å¼ ä¸‰çš„ID Token(JWT)ï¼Œä½ è‡ªå·±çœ‹â€</td><td>äº’è”ç½‘ &#x2F; App &#x2F; SPA</td><td>å¦</td></tr><tr><td><strong>OAuth</strong></td><td><strong>æˆæƒé’¥åŒ™</strong></td><td>â€œæˆ‘æœ‰ä»¤ç‰Œï¼Œè®©æˆ‘è¿›å±‹æ‹¿ç…§ç‰‡â€</td><td>API æˆæƒ</td><td>å¦</td></tr></tbody></table><pre class="mermaid">graph TD    subgraph "å‰ç«¯åº”ç”¨å±‚ (App / Web)"    A[ç°ä»£ Web åº”ç”¨]     B[ç¬¬ä¸‰æ–¹ SaaS æ¯”å¦‚ Salesforce]    end    subgraph "ä¸­é—´ä»¶å±‚ (IdP / è®¤è¯ä¸­å¿ƒ)"    C[SSO å¹³å° æ¯”å¦‚ Keycloak, Okta, ADFS]    end    subgraph "åç«¯å­˜å‚¨å±‚ (Source of Truth)"    D[LDAP ç›®å½•æœåŠ¡ æ¯”å¦‚ AD, OpenLDAP]    E[SQL æ•°æ®åº“]    end    A -- "OIDC / OAuth" --> C    B -- "SAML" --> C    C -- "LDAP åè®®" --> D</pre><hr><h2 id="äºŒã€TokenæŠ€æœ¯ä½“ç³»"><a href="#äºŒã€TokenæŠ€æœ¯ä½“ç³»" class="headerlink" title="äºŒã€TokenæŠ€æœ¯ä½“ç³»"></a>äºŒã€TokenæŠ€æœ¯ä½“ç³»</h2><h3 id="1-Access-Token-èµ„æºè®¿é—®å‡­è¯"><a href="#1-Access-Token-èµ„æºè®¿é—®å‡­è¯" class="headerlink" title="1. Access Token - èµ„æºè®¿é—®å‡­è¯"></a>1. Access Token - èµ„æºè®¿é—®å‡­è¯</h3><p><strong>Access Token</strong> æ˜¯å®¢æˆ·ç«¯è®¿é—®èµ„æºæœåŠ¡å™¨çš„æ ¸å¿ƒå‡­è¯ï¼Œæ˜¯OAuth 2.0ä½“ç³»çš„å…³é”®ç»„ä»¶ã€‚</p><h4 id="Tokenæ ¼å¼å¯¹æ¯”"><a href="#Tokenæ ¼å¼å¯¹æ¯”" class="headerlink" title="Tokenæ ¼å¼å¯¹æ¯”"></a>Tokenæ ¼å¼å¯¹æ¯”</h4><table><thead><tr><th>ç±»å‹</th><th>ç‰¹ç‚¹</th><th>éªŒè¯æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>ä¸é€æ˜Token</strong></td><td>éšæœºå­—ç¬¦ä¸²ï¼Œæ— æ³•è§£æ</td><td>éœ€è°ƒç”¨æˆæƒæœåŠ¡å™¨éªŒè¯</td><td>é«˜å®‰å…¨è¦æ±‚çš„ä¼ä¸šç¯å¢ƒ</td></tr><tr><td><strong>JWT Token</strong></td><td>è‡ªåŒ…å«ï¼Œå¯æœ¬åœ°è§£æ</td><td>æœ¬åœ°éªŒè¯ç­¾å</td><td>å¾®æœåŠ¡ã€åˆ†å¸ƒå¼ç³»ç»Ÿ</td></tr></tbody></table><h4 id="ç”Ÿå‘½å‘¨æœŸç®¡ç†"><a href="#ç”Ÿå‘½å‘¨æœŸç®¡ç†" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸç®¡ç†"></a>ç”Ÿå‘½å‘¨æœŸç®¡ç†</h4><ul><li><strong>çŸ­æœŸæœ‰æ•ˆ</strong>ï¼šé€šå¸¸1å°æ—¶å†…è¿‡æœŸ</li><li><strong>ç»­æœŸæœºåˆ¶</strong>ï¼šé…åˆRefresh Tokenå®ç°è‡ªåŠ¨ç»­æœŸ</li><li><strong>æ’¤é”€èƒ½åŠ›</strong>ï¼šæ”¯æŒä¸»åŠ¨æ’¤é”€å’Œé»‘åå•æœºåˆ¶</li></ul><h3 id="2-Refresh-Token-ä»¤ç‰Œç»­æœŸæœºåˆ¶"><a href="#2-Refresh-Token-ä»¤ç‰Œç»­æœŸæœºåˆ¶" class="headerlink" title="2. Refresh Token - ä»¤ç‰Œç»­æœŸæœºåˆ¶"></a>2. Refresh Token - ä»¤ç‰Œç»­æœŸæœºåˆ¶</h3><p><strong>Refresh Token</strong> ä¸“é—¨ç”¨äºåœ¨Access Tokenè¿‡æœŸåè·å–æ–°çš„Access Tokenï¼Œå®ç°é•¿æœŸä¼šè¯ç®¡ç†ã€‚</p><h4 id="æ ¸å¿ƒç‰¹æ€§-1"><a href="#æ ¸å¿ƒç‰¹æ€§-1" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§"></a>æ ¸å¿ƒç‰¹æ€§</h4><ul><li><strong>é•¿æœŸæœ‰æ•ˆæ€§</strong>ï¼š7-30å¤©æœ‰æ•ˆæœŸï¼Œä½†å¯è¢«æ’¤é”€</li><li><strong>å­˜å‚¨é™åˆ¶</strong>ï¼šä»…åœ¨å®¢æˆ·ç«¯å’ŒæˆæƒæœåŠ¡å™¨é—´æµè½¬</li><li><strong>å•æ¬¡ä½¿ç”¨</strong>ï¼šä½¿ç”¨åç«‹å³å¤±æ•ˆï¼Œè¿”å›æ–°çš„Refresh Tokenï¼ˆRotationæœºåˆ¶ï¼‰</li></ul><h4 id="å®‰å…¨è¦æ±‚"><a href="#å®‰å…¨è¦æ±‚" class="headerlink" title="å®‰å…¨è¦æ±‚"></a>å®‰å…¨è¦æ±‚</h4><ul><li><strong>HTTPSä¼ è¾“</strong>ï¼šé˜²æ­¢ç½‘ç»œä¼ è¾“ä¸­è¢«æˆªè·</li><li><strong>å®‰å…¨å­˜å‚¨</strong>ï¼šå®¢æˆ·ç«¯éœ€å®‰å…¨å­˜å‚¨ï¼ˆå¦‚Keychainã€Keystoreï¼‰</li><li><strong>æ’¤é”€æœºåˆ¶</strong>ï¼šæ”¯æŒç”¨æˆ·ä¸»åŠ¨æ’¤é”€æˆ–å¼‚å¸¸æ£€æµ‹è‡ªåŠ¨æ’¤é”€</li></ul><h3 id="3-ID-Token-èº«ä»½ä¿¡æ¯è½½ä½“"><a href="#3-ID-Token-èº«ä»½ä¿¡æ¯è½½ä½“" class="headerlink" title="3. ID Token - èº«ä»½ä¿¡æ¯è½½ä½“"></a>3. ID Token - èº«ä»½ä¿¡æ¯è½½ä½“</h3><p><strong>ID Token</strong> æ˜¯OpenID Connectçš„æ ¸å¿ƒç»„ä»¶ï¼Œä»¥JWTæ ¼å¼æ‰¿è½½ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚</p><h4 id="æ ‡å‡†å£°æ˜ï¼ˆClaimsï¼‰"><a href="#æ ‡å‡†å£°æ˜ï¼ˆClaimsï¼‰" class="headerlink" title="æ ‡å‡†å£°æ˜ï¼ˆClaimsï¼‰"></a>æ ‡å‡†å£°æ˜ï¼ˆClaimsï¼‰</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;iss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://accounts.google.com&quot;</span><span class="punctuation">,</span>        <span class="comment">// å‘è¡Œè€…</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span>                         <span class="comment">// ç”¨æˆ·å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">  <span class="attr">&quot;aud&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-client-id&quot;</span><span class="punctuation">,</span>                     <span class="comment">// ç›®æ ‡å®¢æˆ·ç«¯</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1620000000</span><span class="punctuation">,</span>                           <span class="comment">// è¿‡æœŸæ—¶é—´</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1619996400</span><span class="punctuation">,</span>                           <span class="comment">// ç­¾å‘æ—¶é—´</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user@example.com&quot;</span><span class="punctuation">,</span>                 <span class="comment">// é‚®ç®±</span></span><br><span class="line">  <span class="attr">&quot;email_verified&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                      <span class="comment">// é‚®ç®±éªŒè¯çŠ¶æ€</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span>                          <span class="comment">// å§“å</span></span><br><span class="line">  <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.com/avatar.jpg&quot;</span>  <span class="comment">// å¤´åƒ</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="å®‰å…¨ç‰¹æ€§"><a href="#å®‰å…¨ç‰¹æ€§" class="headerlink" title="å®‰å…¨ç‰¹æ€§"></a>å®‰å…¨ç‰¹æ€§</h4><ul><li><strong>æ•°å­—ç­¾å</strong>ï¼šRS256&#x2F;ES256ç®—æ³•ç­¾åï¼Œé˜²ç¯¡æ”¹</li><li><strong>æ—¶æ•ˆæ€§</strong>ï¼šçŸ­æœŸæœ‰æ•ˆï¼ˆé€šå¸¸15-60åˆ†é’Ÿï¼‰</li><li><strong>å®Œæ•´æ€§</strong>ï¼šåŒ…å«å®Œæ•´çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯</li></ul><h3 id="4-JWT-è‡ªåŒ…å«ä»¤ç‰Œæ ‡å‡†"><a href="#4-JWT-è‡ªåŒ…å«ä»¤ç‰Œæ ‡å‡†" class="headerlink" title="4. JWT - è‡ªåŒ…å«ä»¤ç‰Œæ ‡å‡†"></a>4. JWT - è‡ªåŒ…å«ä»¤ç‰Œæ ‡å‡†</h3><p><strong>JWTï¼ˆJSON Web Tokenï¼‰</strong> æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚</p><h4 id="ä¸‰æ®µå¼ç»“æ„"><a href="#ä¸‰æ®µå¼ç»“æ„" class="headerlink" title="ä¸‰æ®µå¼ç»“æ„"></a>ä¸‰æ®µå¼ç»“æ„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Header.Payload.Signature</span><br></pre></td></tr></table></figure><h4 id="è¯¦ç»†ç»“æ„è§£æ"><a href="#è¯¦ç»†ç»“æ„è§£æ" class="headerlink" title="è¯¦ç»†ç»“æ„è§£æ"></a>è¯¦ç»†ç»“æ„è§£æ</h4><p><strong>Headerï¼ˆå¤´éƒ¨ï¼‰</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RS256&quot;</span><span class="punctuation">,</span>    <span class="comment">// ç­¾åç®—æ³•</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span><span class="punctuation">,</span>      <span class="comment">// ä»¤ç‰Œç±»å‹</span></span><br><span class="line">  <span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;key-id&quot;</span>    <span class="comment">// å¯†é’¥æ ‡è¯†</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>Payloadï¼ˆè´Ÿè½½ï¼‰</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user123&quot;</span><span class="punctuation">,</span>           <span class="comment">// ä¸»é¢˜ï¼ˆç”¨æˆ·IDï¼‰</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1646092800</span><span class="punctuation">,</span>          <span class="comment">// ç­¾å‘æ—¶é—´</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1646096400</span><span class="punctuation">,</span>          <span class="comment">// è¿‡æœŸæ—¶é—´</span></span><br><span class="line">  <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;read write&quot;</span><span class="punctuation">,</span>      <span class="comment">// æƒé™èŒƒå›´</span></span><br><span class="line">  <span class="attr">&quot;aud&quot;</span><span class="punctuation">:</span> <span class="string">&quot;api.example.com&quot;</span>    <span class="comment">// å—ä¼—</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>Signatureï¼ˆç­¾åï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RSASHA256(</span><br><span class="line">  base64UrlEncode(header) + &quot;.&quot; +</span><br><span class="line">  base64UrlEncode(payload),</span><br><span class="line">  private_key</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="ç®—æ³•é€‰æ‹©æŒ‡å—"><a href="#ç®—æ³•é€‰æ‹©æŒ‡å—" class="headerlink" title="ç®—æ³•é€‰æ‹©æŒ‡å—"></a>ç®—æ³•é€‰æ‹©æŒ‡å—</h4><table><thead><tr><th>ç®—æ³•</th><th>ç±»å‹</th><th>å®‰å…¨æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>HS256</strong></td><td>å¯¹ç§°åŠ å¯†</td><td>ä¸­ç­‰</td><td>å†…éƒ¨å¾®æœåŠ¡</td></tr><tr><td><strong>RS256</strong></td><td>éå¯¹ç§°åŠ å¯†</td><td>é«˜</td><td>è·¨åŸŸè®¤è¯</td></tr><tr><td><strong>ES256</strong></td><td>æ¤­åœ†æ›²çº¿</td><td>é«˜</td><td>ç§»åŠ¨ç«¯åº”ç”¨</td></tr></tbody></table><h4 id="å®‰å…¨æ³¨æ„äº‹é¡¹"><a href="#å®‰å…¨æ³¨æ„äº‹é¡¹" class="headerlink" title="å®‰å…¨æ³¨æ„äº‹é¡¹"></a>å®‰å…¨æ³¨æ„äº‹é¡¹</h4><ul><li><strong>å¯†é’¥ç®¡ç†</strong>ï¼šå®šæœŸè½®æ¢ç­¾åå¯†é’¥</li><li><strong>ç®—æ³•éªŒè¯</strong>ï¼šæ˜ç¡®æŒ‡å®šå…è®¸çš„ç­¾åç®—æ³•</li><li><strong>æ—¶æ•ˆæ§åˆ¶</strong>ï¼šè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´</li><li><strong>æ•æ„Ÿä¿¡æ¯</strong>ï¼šé¿å…åœ¨Payloadä¸­åŒ…å«æ•æ„Ÿæ•°æ®</li></ul><h3 id="5-Session-Token-ä¼šè¯çŠ¶æ€ç®¡ç†"><a href="#5-Session-Token-ä¼šè¯çŠ¶æ€ç®¡ç†" class="headerlink" title="5. Session Token - ä¼šè¯çŠ¶æ€ç®¡ç†"></a>5. Session Token - ä¼šè¯çŠ¶æ€ç®¡ç†</h3><p><strong>Session Token</strong> æ˜¯ä¼ ç»Ÿçš„ä¼šè¯ç®¡ç†æœºåˆ¶ï¼Œé€šè¿‡æœåŠ¡ç«¯çŠ¶æ€å­˜å‚¨ç»´æŠ¤ç”¨æˆ·ä¼šè¯ã€‚</p><h4 id="æ¶æ„æ¨¡å¼"><a href="#æ¶æ„æ¨¡å¼" class="headerlink" title="æ¶æ„æ¨¡å¼"></a>æ¶æ„æ¨¡å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Client (SessionID) â†â†’ Server (Session Store)</span><br><span class="line">                           â†“</span><br><span class="line">                    Redis/Database/Memory</span><br></pre></td></tr></table></figure><h4 id="å­˜å‚¨ç­–ç•¥"><a href="#å­˜å‚¨ç­–ç•¥" class="headerlink" title="å­˜å‚¨ç­–ç•¥"></a>å­˜å‚¨ç­–ç•¥</h4><p><strong>æœåŠ¡ç«¯å­˜å‚¨</strong></p><ul><li><strong>å†…å­˜å­˜å‚¨</strong>ï¼šæ€§èƒ½æœ€ä¼˜ï¼Œä½†ä¸æ”¯æŒé›†ç¾¤</li><li><strong>Redisé›†ç¾¤</strong>ï¼šé«˜æ€§èƒ½åˆ†å¸ƒå¼å­˜å‚¨</li><li><strong>æ•°æ®åº“å­˜å‚¨</strong>ï¼šæŒä¹…åŒ–ä½†æ€§èƒ½è¾ƒä½</li></ul><p><strong>å®¢æˆ·ç«¯ä¼ è¾“</strong></p><ul><li><strong>HTTP Cookie</strong>ï¼šè‡ªåŠ¨ä¼ è¾“ï¼Œæ”¯æŒHttpOnlyå’ŒSecureæ ‡å¿—</li><li><strong>LocalStorage</strong>ï¼šæ‰‹åŠ¨ç®¡ç†ï¼Œå­˜åœ¨XSSé£é™©</li></ul><h4 id="Session-vs-JWT-å¯¹æ¯”"><a href="#Session-vs-JWT-å¯¹æ¯”" class="headerlink" title="Session vs JWT å¯¹æ¯”"></a>Session vs JWT å¯¹æ¯”</h4><table><thead><tr><th>ç‰¹æ€§</th><th>Session Token</th><th>JWT</th></tr></thead><tbody><tr><td><strong>çŠ¶æ€ç®¡ç†</strong></td><td>æœ‰çŠ¶æ€ï¼ˆæœåŠ¡ç«¯å­˜å‚¨ï¼‰</td><td>æ— çŠ¶æ€ï¼ˆè‡ªåŒ…å«ï¼‰</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td>éœ€è¦å…±äº«å­˜å‚¨</td><td>å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>éœ€è¦æŸ¥åº“éªŒè¯</td><td>æœ¬åœ°éªŒè¯</td></tr><tr><td><strong>æ’¤é”€èƒ½åŠ›</strong></td><td>ç«‹å³æ’¤é”€</td><td>éœ€è¦é»‘åå•æœºåˆ¶</td></tr><tr><td><strong>å­˜å‚¨å¼€é”€</strong></td><td>æœåŠ¡ç«¯å­˜å‚¨æˆæœ¬</td><td>ç½‘ç»œä¼ è¾“æˆæœ¬</td></tr></tbody></table><h3 id="6-SAML-æ–­è¨€-XMLå®‰å…¨å£°æ˜"><a href="#6-SAML-æ–­è¨€-XMLå®‰å…¨å£°æ˜" class="headerlink" title="6. SAML æ–­è¨€ - XMLå®‰å…¨å£°æ˜"></a>6. SAML æ–­è¨€ - XMLå®‰å…¨å£°æ˜</h3><p><strong>SAMLæ–­è¨€</strong> æ˜¯SAML 2.0åè®®çš„æ ¸å¿ƒè½½ä½“ï¼Œä»¥XMLæ ¼å¼æ‰¿è½½å®‰å…¨å£°æ˜ä¿¡æ¯ã€‚</p><h4 id="æ–­è¨€ç±»å‹"><a href="#æ–­è¨€ç±»å‹" class="headerlink" title="æ–­è¨€ç±»å‹"></a>æ–­è¨€ç±»å‹</h4><p><strong>è®¤è¯æ–­è¨€ï¼ˆAuthentication Assertionï¼‰</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">saml:Assertion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">saml:AuthnStatement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">saml:AuthnContext</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">saml:AuthnContextClassRef</span>&gt;</span></span><br><span class="line">        urn:oasis:names:tc:SAML:2.0:ac:classes:Password</span><br><span class="line">      <span class="tag">&lt;/<span class="name">saml:AuthnContextClassRef</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">saml:AuthnContext</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">saml:AuthnStatement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">saml:Assertion</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>å±æ€§æ–­è¨€ï¼ˆAttribute Assertionï¼‰</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">saml:AttributeStatement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">saml:Attribute</span> <span class="attr">Name</span>=<span class="string">&quot;email&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">saml:AttributeValue</span>&gt;</span>user@company.com<span class="tag">&lt;/<span class="name">saml:AttributeValue</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">saml:Attribute</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">saml:Attribute</span> <span class="attr">Name</span>=<span class="string">&quot;department&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">saml:AttributeValue</span>&gt;</span>Engineering<span class="tag">&lt;/<span class="name">saml:AttributeValue</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">saml:Attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">saml:AttributeStatement</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æˆæƒå†³ç­–æ–­è¨€ï¼ˆAuthorization Decision Assertionï¼‰</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">saml:AuthzDecisionStatement</span> <span class="attr">Resource</span>=<span class="string">&quot;https://app.company.com&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Decision</span>=<span class="string">&quot;Permit&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">saml:Action</span>&gt;</span>Read<span class="tag">&lt;/<span class="name">saml:Action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">saml:Action</span>&gt;</span>Write<span class="tag">&lt;/<span class="name">saml:Action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">saml:AuthzDecisionStatement</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="ä¸‰ã€åè®®ä¸TokenååŒæ¶æ„"><a href="#ä¸‰ã€åè®®ä¸TokenååŒæ¶æ„" class="headerlink" title="ä¸‰ã€åè®®ä¸TokenååŒæ¶æ„"></a>ä¸‰ã€åè®®ä¸TokenååŒæ¶æ„</h2><h3 id="1-OAuth-2-0-OpenID-Connect-ç»„åˆ"><a href="#1-OAuth-2-0-OpenID-Connect-ç»„åˆ" class="headerlink" title="1. OAuth 2.0 + OpenID Connect ç»„åˆ"></a>1. OAuth 2.0 + OpenID Connect ç»„åˆ</h3><p>è¿™æ˜¯ç°ä»£åº”ç”¨æœ€å¸¸ç”¨çš„è®¤è¯æˆæƒç»„åˆï¼ŒåŒæ—¶è§£å†³èº«ä»½è®¤è¯å’Œèµ„æºæˆæƒé—®é¢˜ã€‚</p><h4 id="å®Œæ•´æµç¨‹"><a href="#å®Œæ•´æµç¨‹" class="headerlink" title="å®Œæ•´æµç¨‹"></a>å®Œæ•´æµç¨‹</h4><pre class="mermaid">sequenceDiagram    participant User as ç”¨æˆ·    participant Client as å®¢æˆ·ç«¯åº”ç”¨    participant AuthServer as è®¤è¯æœåŠ¡å™¨    participant Resource as èµ„æºæœåŠ¡å™¨    User->>Client: è®¿é—®åº”ç”¨    Client->>AuthServer: é‡å®šå‘åˆ°è®¤è¯é¡µé¢    User->>AuthServer: ç™»å½•å¹¶æˆæƒ    AuthServer->>Client: è¿”å›æˆæƒç     Client->>AuthServer: äº¤æ¢Token    AuthServer->>Client: è¿”å›Access Token + ID Token    Client->>Resource: ä½¿ç”¨Access Tokenè®¿é—®èµ„æº    Client->>AuthServer: ä½¿ç”¨Access Tokenè·å–UserInfo</pre><h4 id="æŠ€æœ¯ä¼˜åŠ¿"><a href="#æŠ€æœ¯ä¼˜åŠ¿" class="headerlink" title="æŠ€æœ¯ä¼˜åŠ¿"></a>æŠ€æœ¯ä¼˜åŠ¿</h4><ul><li><strong>èŒè´£åˆ†ç¦»</strong>ï¼šOAuthè´Ÿè´£æˆæƒï¼ŒOIDCè´Ÿè´£è®¤è¯</li><li><strong>æ ‡å‡†åŒ–</strong>ï¼šå¹¿æ³›çš„è¡Œä¸šæ”¯æŒå’Œäº’æ“ä½œæ€§</li><li><strong>å®‰å…¨æ€§</strong>ï¼šå¤šå±‚å®‰å…¨æœºåˆ¶å’Œæœ€ä½³å®è·µ</li><li><strong>çµæ´»æ€§</strong>ï¼šæ”¯æŒå¤šç§å®¢æˆ·ç«¯ç±»å‹å’Œåœºæ™¯</li></ul><h3 id="2-SAML-LDAP-ä¼ä¸šé›†æˆ"><a href="#2-SAML-LDAP-ä¼ä¸šé›†æˆ" class="headerlink" title="2. SAML + LDAP ä¼ä¸šé›†æˆ"></a>2. SAML + LDAP ä¼ä¸šé›†æˆ</h3><p>ä¼ ç»Ÿä¼ä¸šç¯å¢ƒä¸­ï¼ŒSAMLå’ŒLDAPçš„ç»„åˆæä¾›äº†å®Œæ•´çš„ä¼ä¸šèº«ä»½ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="é›†æˆæ¶æ„"><a href="#é›†æˆæ¶æ„" class="headerlink" title="é›†æˆæ¶æ„"></a>é›†æˆæ¶æ„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Enterprise AD/LDAP â†â†’ SAML IdP â†â†’ SaaS Applications</span><br><span class="line">       â†“                â†“              â†“</span><br><span class="line">   ç”¨æˆ·ç›®å½•        èº«ä»½è”é‚¦        ä¸šåŠ¡åº”ç”¨</span><br></pre></td></tr></table></figure><h4 id="é›†æˆæµç¨‹"><a href="#é›†æˆæµç¨‹" class="headerlink" title="é›†æˆæµç¨‹"></a>é›†æˆæµç¨‹</h4><ol><li><strong>ç”¨æˆ·è®¤è¯</strong>ï¼šç”¨æˆ·é€šè¿‡ä¼ä¸šAD&#x2F;LDAPè¿›è¡Œèº«ä»½éªŒè¯</li><li><strong>æ–­è¨€ç”Ÿæˆ</strong>ï¼šIdPç”ŸæˆåŒ…å«ç”¨æˆ·å±æ€§çš„SAMLæ–­è¨€</li><li><strong>åº”ç”¨æˆæƒ</strong>ï¼šSaaSåº”ç”¨éªŒè¯SAMLæ–­è¨€å¹¶æˆæƒè®¿é—®</li><li><strong>å±æ€§åŒæ­¥</strong>ï¼šé€šè¿‡LDAPæŸ¥è¯¢è·å–æœ€æ–°çš„ç”¨æˆ·å±æ€§</li></ol><h4 id="ä¼ä¸šä»·å€¼"><a href="#ä¼ä¸šä»·å€¼" class="headerlink" title="ä¼ä¸šä»·å€¼"></a>ä¼ä¸šä»·å€¼</h4><ul><li><strong>ç»Ÿä¸€èº«ä»½</strong>ï¼šä¸€å¥—ç”¨æˆ·ç›®å½•ç®¡ç†æ‰€æœ‰åº”ç”¨</li><li><strong>åˆè§„è¦æ±‚</strong>ï¼šæ»¡è¶³ä¼ä¸šå®‰å…¨å’Œåˆè§„æ ‡å‡†</li><li><strong>æˆæœ¬æ•ˆç›Š</strong>ï¼šå‡å°‘é‡å¤çš„èº«ä»½ç®¡ç†å·¥ä½œ</li></ul><hr><h2 id="å››ã€å®‰å…¨æœ€ä½³å®è·µ"><a href="#å››ã€å®‰å…¨æœ€ä½³å®è·µ" class="headerlink" title="å››ã€å®‰å…¨æœ€ä½³å®è·µ"></a>å››ã€å®‰å…¨æœ€ä½³å®è·µ</h2><h3 id="1-ä¼ è¾“å±‚å®‰å…¨"><a href="#1-ä¼ è¾“å±‚å®‰å…¨" class="headerlink" title="1. ä¼ è¾“å±‚å®‰å…¨"></a>1. ä¼ è¾“å±‚å®‰å…¨</h3><h4 id="HTTPS-å¼ºåˆ¶è¦æ±‚"><a href="#HTTPS-å¼ºåˆ¶è¦æ±‚" class="headerlink" title="HTTPS å¼ºåˆ¶è¦æ±‚"></a>HTTPS å¼ºåˆ¶è¦æ±‚</h4><ul><li><strong>æ‰€æœ‰Tokenä¼ è¾“</strong>å¿…é¡»ä½¿ç”¨HTTPSåŠ å¯†</li><li><strong>è¯ä¹¦éªŒè¯</strong>ï¼šç¡®ä¿SSLè¯ä¹¦æœ‰æ•ˆæ€§å’ŒåŸŸååŒ¹é…</li><li><strong>HSTSç­–ç•¥</strong>ï¼šå¯ç”¨HTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨</li></ul><h4 id="Tokenä¼ è¾“æ–¹å¼"><a href="#Tokenä¼ è¾“æ–¹å¼" class="headerlink" title="Tokenä¼ è¾“æ–¹å¼"></a>Tokenä¼ è¾“æ–¹å¼</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># âœ… æ¨èï¼šAuthorization Header</span><br><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer eyJhbGciOiJSUzI1NiIs...</span><br><span class="line"></span><br><span class="line"># âŒ é¿å…ï¼šURLå‚æ•°ä¼ é€’</span><br><span class="line">GET /api/user?access_token=eyJhbGciOiJSUzI1NiIs...</span><br></pre></td></tr></table></figure><h3 id="2-å­˜å‚¨å®‰å…¨ç­–ç•¥"><a href="#2-å­˜å‚¨å®‰å…¨ç­–ç•¥" class="headerlink" title="2. å­˜å‚¨å®‰å…¨ç­–ç•¥"></a>2. å­˜å‚¨å®‰å…¨ç­–ç•¥</h3><h4 id="æµè§ˆå™¨ç«¯å®‰å…¨å­˜å‚¨"><a href="#æµè§ˆå™¨ç«¯å®‰å…¨å­˜å‚¨" class="headerlink" title="æµè§ˆå™¨ç«¯å®‰å…¨å­˜å‚¨"></a>æµè§ˆå™¨ç«¯å®‰å…¨å­˜å‚¨</h4><table><thead><tr><th>å­˜å‚¨æ–¹å¼</th><th>å®‰å…¨æ€§</th><th>XSSé£é™©</th><th>CSRFé£é™©</th><th>æ¨èåœºæ™¯</th></tr></thead><tbody><tr><td><strong>HttpOnly Cookie</strong></td><td>é«˜</td><td>å…ç–«</td><td>éœ€é˜²æŠ¤</td><td>ä¼ ç»ŸWebåº”ç”¨</td></tr><tr><td><strong>Secure Cookie</strong></td><td>é«˜</td><td>å…ç–«</td><td>éœ€é˜²æŠ¤</td><td>HTTPSç¯å¢ƒ</td></tr><tr><td><strong>LocalStorage</strong></td><td>ä½</td><td>é«˜é£é™©</td><td>å…ç–«</td><td>ä¸æ¨èå­˜å‚¨æ•æ„ŸToken</td></tr><tr><td><strong>Memory</strong></td><td>æœ€é«˜</td><td>å…ç–«</td><td>å…ç–«</td><td>SPAçŸ­æœŸå­˜å‚¨</td></tr></tbody></table><h4 id="ç§»åŠ¨ç«¯å®‰å…¨å­˜å‚¨"><a href="#ç§»åŠ¨ç«¯å®‰å…¨å­˜å‚¨" class="headerlink" title="ç§»åŠ¨ç«¯å®‰å…¨å­˜å‚¨"></a>ç§»åŠ¨ç«¯å®‰å…¨å­˜å‚¨</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// iOS - Keychain Services</span></span><br><span class="line"><span class="keyword">const</span> keychain = <span class="built_in">require</span>(<span class="string">&#x27;react-native-keychain&#x27;</span>);</span><br><span class="line">keychain.<span class="title function_">setInternetCredentials</span>(<span class="string">&#x27;server&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;token&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Android - Keystore</span></span><br><span class="line"><span class="keyword">import</span> &#123; encrypt, decrypt &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native-keystore&#x27;</span>;</span><br><span class="line"><span class="title function_">encrypt</span>(<span class="string">&#x27;tokenKey&#x27;</span>, accessToken);</span><br></pre></td></tr></table></figure><h3 id="3-å¯†é’¥ç®¡ç†ä½“ç³»"><a href="#3-å¯†é’¥ç®¡ç†ä½“ç³»" class="headerlink" title="3. å¯†é’¥ç®¡ç†ä½“ç³»"></a>3. å¯†é’¥ç®¡ç†ä½“ç³»</h3><h4 id="å¯†é’¥è½®æ¢ç­–ç•¥"><a href="#å¯†é’¥è½®æ¢ç­–ç•¥" class="headerlink" title="å¯†é’¥è½®æ¢ç­–ç•¥"></a>å¯†é’¥è½®æ¢ç­–ç•¥</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">JWTç­¾åå¯†é’¥è½®æ¢:</span></span><br><span class="line">  <span class="string">é¢‘ç‡:</span> <span class="string">æ¯3-6ä¸ªæœˆ</span></span><br><span class="line">  <span class="string">è¿‡ç¨‹:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">ç”Ÿæˆæ–°å¯†é’¥</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">åŒæ—¶æ”¯æŒæ–°æ—§å¯†é’¥éªŒè¯</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">é€æ­¥æ·˜æ±°æ—§å¯†é’¥</span></span><br><span class="line">  </span><br><span class="line"><span class="string">å¯†é’¥å­˜å‚¨:</span></span><br><span class="line">  <span class="string">å¼€å‘ç¯å¢ƒ:</span> <span class="string">ç¯å¢ƒå˜é‡</span></span><br><span class="line">  <span class="string">ç”Ÿäº§ç¯å¢ƒ:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">AWS</span> <span class="string">KMS</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Azure</span> <span class="string">Key</span> <span class="string">Vault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HashiCorp</span> <span class="string">Vault</span></span><br></pre></td></tr></table></figure><h4 id="å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ"><a href="#å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ" class="headerlink" title="å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ"></a>å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ</h4><ul><li><strong>åˆ†ç¦»å­˜å‚¨</strong>ï¼šå¯†é’¥ä¸åº”ç”¨ä»£ç åˆ†ç¦»</li><li><strong>è®¿é—®æ§åˆ¶</strong>ï¼šæœ€å°æƒé™åŸåˆ™</li><li><strong>å®¡è®¡æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰å¯†é’¥æ“ä½œ</li><li><strong>å¤‡ä»½æ¢å¤</strong>ï¼šå»ºç«‹å¯†é’¥å¤‡ä»½å’Œæ¢å¤æœºåˆ¶</li></ul><h3 id="4-æ”»å‡»é˜²æŠ¤æœºåˆ¶"><a href="#4-æ”»å‡»é˜²æŠ¤æœºåˆ¶" class="headerlink" title="4. æ”»å‡»é˜²æŠ¤æœºåˆ¶"></a>4. æ”»å‡»é˜²æŠ¤æœºåˆ¶</h3><h4 id="é‡æ”¾æ”»å‡»é˜²æŠ¤"><a href="#é‡æ”¾æ”»å‡»é˜²æŠ¤" class="headerlink" title="é‡æ”¾æ”»å‡»é˜²æŠ¤"></a>é‡æ”¾æ”»å‡»é˜²æŠ¤</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;jti&quot;</span><span class="punctuation">:</span> <span class="string">&quot;unique-token-id&quot;</span><span class="punctuation">,</span>     <span class="comment">// JWT IDï¼Œé˜²æ­¢é‡å¤ä½¿ç”¨</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1646092800</span><span class="punctuation">,</span>            <span class="comment">// ç­¾å‘æ—¶é—´</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1646096400</span><span class="punctuation">,</span>            <span class="comment">// è¿‡æœŸæ—¶é—´</span></span><br><span class="line">  <span class="attr">&quot;nonce&quot;</span><span class="punctuation">:</span> <span class="string">&quot;random-value&quot;</span>       <span class="comment">// éšæœºæ•°ï¼ŒOIDCä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="å¸¸è§æ”»å‡»ä¸é˜²æŠ¤"><a href="#å¸¸è§æ”»å‡»ä¸é˜²æŠ¤" class="headerlink" title="å¸¸è§æ”»å‡»ä¸é˜²æŠ¤"></a>å¸¸è§æ”»å‡»ä¸é˜²æŠ¤</h4><table><thead><tr><th>æ”»å‡»ç±»å‹</th><th>é˜²æŠ¤æªæ–½</th><th>å®ç°æ–¹å¼</th></tr></thead><tbody><tr><td><strong>TokenåŠ«æŒ</strong></td><td>HTTPS + Secure Cookie</td><td>ä¼ è¾“åŠ å¯†</td></tr><tr><td><strong>XSSæ”»å‡»</strong></td><td>HttpOnly Cookie + CSP</td><td>å­˜å‚¨éš”ç¦»</td></tr><tr><td><strong>CSRFæ”»å‡»</strong></td><td>SameSite Cookie + CSRF Token</td><td>è·¨ç«™é˜²æŠ¤</td></tr><tr><td><strong>é‡æ”¾æ”»å‡»</strong></td><td>æ—¶é—´æˆ³ + Nonce + JTI</td><td>å”¯ä¸€æ€§éªŒè¯</td></tr></tbody></table><hr><h2 id="äº”ã€æŠ€æœ¯é€‰å‹æŒ‡å—"><a href="#äº”ã€æŠ€æœ¯é€‰å‹æŒ‡å—" class="headerlink" title="äº”ã€æŠ€æœ¯é€‰å‹æŒ‡å—"></a>äº”ã€æŠ€æœ¯é€‰å‹æŒ‡å—</h2><h3 id="åœºæ™¯åŒ–é€‰å‹çŸ©é˜µ"><a href="#åœºæ™¯åŒ–é€‰å‹çŸ©é˜µ" class="headerlink" title="åœºæ™¯åŒ–é€‰å‹çŸ©é˜µ"></a>åœºæ™¯åŒ–é€‰å‹çŸ©é˜µ</h3><table><thead><tr><th>åº”ç”¨åœºæ™¯</th><th>æ¨èåè®®</th><th>Tokenç±»å‹</th><th>ä¼˜åŠ¿</th><th>è€ƒè™‘å› ç´ </th></tr></thead><tbody><tr><td><strong>æ¶ˆè´¹çº§åº”ç”¨</strong></td><td>OAuth 2.0 + OIDC</td><td>Access Token + ID Token</td><td>æ ‡å‡†åŒ–ã€æ˜“é›†æˆ</td><td>ç”¨æˆ·ä½“éªŒ</td></tr><tr><td><strong>ä¼ä¸šSSO</strong></td><td>SAML 2.0</td><td>SAMLæ–­è¨€</td><td>æˆç†Ÿç¨³å®šã€åˆè§„</td><td>å¤æ‚åº¦è¾ƒé«˜</td></tr><tr><td><strong>ç§»åŠ¨åº”ç”¨</strong></td><td>OIDC + JWT</td><td>JWT + Refresh Token</td><td>ç¦»çº¿å¯ç”¨ã€æ€§èƒ½å¥½</td><td>å­˜å‚¨å®‰å…¨</td></tr><tr><td><strong>å¾®æœåŠ¡æ¶æ„</strong></td><td>JWT</td><td>è‡ªåŒ…å«JWT</td><td>æ— çŠ¶æ€ã€å¯æ‰©å±•</td><td>å¯†é’¥ç®¡ç†</td></tr><tr><td><strong>APIç½‘å…³</strong></td><td>OAuth 2.0</td><td>Bearer Token</td><td>ç»†ç²’åº¦æ§åˆ¶</td><td>æ€§èƒ½è¦æ±‚</td></tr></tbody></table><h3 id="ç°ä»£åŒ–é€‰å‹å»ºè®®"><a href="#ç°ä»£åŒ–é€‰å‹å»ºè®®" class="headerlink" title="ç°ä»£åŒ–é€‰å‹å»ºè®®"></a>ç°ä»£åŒ–é€‰å‹å»ºè®®</h3><h4 id="æ–°é¡¹ç›®æ¨è"><a href="#æ–°é¡¹ç›®æ¨è" class="headerlink" title="æ–°é¡¹ç›®æ¨è"></a>æ–°é¡¹ç›®æ¨è</h4><ol><li><strong>OAuth 2.1 + OIDC</strong>ï¼šç°ä»£åº”ç”¨çš„é¦–é€‰</li><li><strong>PKCEæ‰©å±•</strong>ï¼šå…¬å…±å®¢æˆ·ç«¯å¿…é¡»å¯ç”¨</li><li><strong>JWTæ ¼å¼</strong>ï¼šAccess Tokenä½¿ç”¨JWTæ ¼å¼</li><li><strong>çŸ­æœŸToken</strong>ï¼šAccess Token 15-60åˆ†é’Ÿè¿‡æœŸ</li></ol><h4 id="ä¼ä¸šçº§è¦æ±‚"><a href="#ä¼ä¸šçº§è¦æ±‚" class="headerlink" title="ä¼ä¸šçº§è¦æ±‚"></a>ä¼ä¸šçº§è¦æ±‚</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">å®‰å…¨è¦æ±‚:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">SAML</span> <span class="number">2.0</span><span class="string">ç”¨äºä¼ä¸šSSO</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mTLSç”¨äºæœåŠ¡é—´é€šä¿¡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">HSMç”¨äºå¯†é’¥å­˜å‚¨</span></span><br><span class="line"></span><br><span class="line"><span class="string">åˆè§„è¦æ±‚:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">GDPR:</span> <span class="string">æ•°æ®ä¿æŠ¤å’Œç”¨æˆ·åŒæ„</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">SOX:</span> <span class="string">è®¿é—®æ§åˆ¶å’Œå®¡è®¡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">HIPAA:</span> <span class="string">åŒ»ç–—æ•°æ®ä¿æŠ¤</span></span><br></pre></td></tr></table></figure><h3 id="å®æ–½è·¯çº¿å›¾"><a href="#å®æ–½è·¯çº¿å›¾" class="headerlink" title="å®æ–½è·¯çº¿å›¾"></a>å®æ–½è·¯çº¿å›¾</h3><h4 id="ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®æ–½"><a href="#ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®æ–½" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®æ–½"></a>ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®æ–½</h4><ul><li><input disabled="" type="checkbox"> é€‰æ‹©è®¤è¯åè®®ï¼ˆOAuth 2.0 + OIDCï¼‰</li><li><input disabled="" type="checkbox"> éƒ¨ç½²èº«ä»½æä¾›å•†ï¼ˆå¦‚Auth0ã€Oktaï¼‰</li><li><input disabled="" type="checkbox"> å®ç°åŸºç¡€çš„ç™»å½•ç™»å‡ºåŠŸèƒ½</li><li><input disabled="" type="checkbox"> é…ç½®HTTPSå’ŒåŸºç¡€å®‰å…¨ç­–ç•¥</li></ul><h4 id="ç¬¬äºŒé˜¶æ®µï¼šå®‰å…¨åŠ å›º"><a href="#ç¬¬äºŒé˜¶æ®µï¼šå®‰å…¨åŠ å›º" class="headerlink" title="ç¬¬äºŒé˜¶æ®µï¼šå®‰å…¨åŠ å›º"></a>ç¬¬äºŒé˜¶æ®µï¼šå®‰å…¨åŠ å›º</h4><ul><li><input disabled="" type="checkbox"> å¯ç”¨å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰</li><li><input disabled="" type="checkbox"> å®æ–½Tokenè½®æ¢å’Œæ’¤é”€</li><li><input disabled="" type="checkbox"> é…ç½®å®‰å…¨å­˜å‚¨å’Œä¼ è¾“</li><li><input disabled="" type="checkbox"> å»ºç«‹ç›‘æ§å’Œå®¡è®¡æœºåˆ¶</li></ul><h4 id="ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§"><a href="#ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§"></a>ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§</h4><ul><li><input disabled="" type="checkbox"> ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼ˆRBAC&#x2F;ABACï¼‰</li><li><input disabled="" type="checkbox"> è·¨åŸŸSSOé›†æˆ</li><li><input disabled="" type="checkbox"> é›¶ä¿¡ä»»æ¶æ„å®æ–½</li><li><input disabled="" type="checkbox"> æŒç»­å®‰å…¨è¯„ä¼°</li></ul><h2 id="å…­ã€æŠ€æœ¯å‘å±•è¶‹åŠ¿"><a href="#å…­ã€æŠ€æœ¯å‘å±•è¶‹åŠ¿" class="headerlink" title="å…­ã€æŠ€æœ¯å‘å±•è¶‹åŠ¿"></a>å…­ã€æŠ€æœ¯å‘å±•è¶‹åŠ¿</h2><h3 id="æ–°å…´æŠ€æœ¯æ ‡å‡†"><a href="#æ–°å…´æŠ€æœ¯æ ‡å‡†" class="headerlink" title="æ–°å…´æŠ€æœ¯æ ‡å‡†"></a>æ–°å…´æŠ€æœ¯æ ‡å‡†</h3><h4 id="OAuth-2-1"><a href="#OAuth-2-1" class="headerlink" title="OAuth 2.1"></a>OAuth 2.1</h4><p>OAuth 2.1æ•´åˆäº†OAuth 2.0çš„å®‰å…¨æœ€ä½³å®è·µï¼Œä¸»è¦æ”¹è¿›åŒ…æ‹¬ï¼š</p><ul><li><strong>å¼ºåˆ¶PKCE</strong>ï¼šæ‰€æœ‰å…¬å…±å®¢æˆ·ç«¯å¿…é¡»ä½¿ç”¨PKCE</li><li><strong>ç§»é™¤éšå¼æµ</strong>ï¼šä¸å†æ”¯æŒéšå¼æˆæƒæ¨¡å¼</li><li><strong>åˆ·æ–°ä»¤ç‰Œå®‰å…¨</strong>ï¼šå¼ºåŒ–Refresh Tokençš„å®‰å…¨è¦æ±‚</li></ul><h4 id="WebAuthn-FIDO2"><a href="#WebAuthn-FIDO2" class="headerlink" title="WebAuthn (FIDO2)"></a>WebAuthn (FIDO2)</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebAuthnæ³¨å†Œç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> credential = <span class="keyword">await</span> navigator.<span class="property">credentials</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">publicKey</span>: &#123;</span><br><span class="line">    <span class="attr">challenge</span>: <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="attr">rp</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Example Corp&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(<span class="string">&quot;user123&quot;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;user@example.com&quot;</span>,</span><br><span class="line">      <span class="attr">displayName</span>: <span class="string">&quot;John Doe&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">pubKeyCredParams</span>: [&#123;<span class="attr">alg</span>: -<span class="number">7</span>, <span class="attr">type</span>: <span class="string">&quot;public-key&quot;</span>&#125;],</span><br><span class="line">    <span class="attr">authenticatorSelection</span>: &#123;</span><br><span class="line">      <span class="attr">authenticatorAttachment</span>: <span class="string">&quot;platform&quot;</span>,</span><br><span class="line">      <span class="attr">userVerification</span>: <span class="string">&quot;required&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="é›¶ä¿¡ä»»æ¶æ„ä¸‹çš„è®¤è¯"><a href="#é›¶ä¿¡ä»»æ¶æ„ä¸‹çš„è®¤è¯" class="headerlink" title="é›¶ä¿¡ä»»æ¶æ„ä¸‹çš„è®¤è¯"></a>é›¶ä¿¡ä»»æ¶æ„ä¸‹çš„è®¤è¯</h3><h4 id="åŠ¨æ€æˆæƒæ¨¡å‹"><a href="#åŠ¨æ€æˆæƒæ¨¡å‹" class="headerlink" title="åŠ¨æ€æˆæƒæ¨¡å‹"></a>åŠ¨æ€æˆæƒæ¨¡å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">é›¶ä¿¡ä»»åŸåˆ™:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ°¸ä¸ä¿¡ä»»ï¼Œå§‹ç»ˆéªŒè¯</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æœ€å°æƒé™è®¿é—®</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æŒç»­éªŒè¯å’Œç›‘æ§</span></span><br><span class="line"></span><br><span class="line"><span class="string">å®æ–½ç­–ç•¥:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">åŸºäºé£é™©çš„è‡ªé€‚åº”è®¤è¯</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„è®¿é—®æ§åˆ¶</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å®æ—¶å¨èƒæ£€æµ‹å’Œå“åº”</span></span><br></pre></td></tr></table></figure><h3 id="æ ‡å‡†å‚è€ƒæ–‡æ¡£"><a href="#æ ‡å‡†å‚è€ƒæ–‡æ¡£" class="headerlink" title="æ ‡å‡†å‚è€ƒæ–‡æ¡£"></a>æ ‡å‡†å‚è€ƒæ–‡æ¡£</h3><h4 id="RFCæ ‡å‡†"><a href="#RFCæ ‡å‡†" class="headerlink" title="RFCæ ‡å‡†"></a>RFCæ ‡å‡†</h4><ul><li><strong>RFC 6749</strong>: OAuth 2.0 Authorization Framework</li><li><strong>RFC 7519</strong>: JSON Web Token (JWT)</li><li><strong>RFC 7636</strong>: Proof Key for Code Exchange (PKCE)</li><li><strong>RFC 8414</strong>: OAuth 2.0 Authorization Server Metadata</li></ul><h4 id="å®‰å…¨æ¡†æ¶"><a href="#å®‰å…¨æ¡†æ¶" class="headerlink" title="å®‰å…¨æ¡†æ¶"></a>å®‰å…¨æ¡†æ¶</h4><ul><li><strong>OWASP API Security Top 10</strong>: APIå®‰å…¨æœ€ä½³å®è·µ</li><li><strong>NIST Cybersecurity Framework</strong>: ç½‘ç»œå®‰å…¨æ¡†æ¶</li><li><strong>ISO 27001</strong>: ä¿¡æ¯å®‰å…¨ç®¡ç†ä½“ç³»æ ‡å‡†</li></ul><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è®¤è¯å’ŒæˆæƒæŠ€æœ¯ä½“ç³»æ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œä»ä¼ ç»Ÿçš„Sessionç®¡ç†åˆ°ç°ä»£çš„JWTå’ŒOAuthä½“ç³»ï¼Œå†åˆ°æ–°å…´çš„é›¶ä¿¡ä»»æ¶æ„ï¼ŒæŠ€æœ¯é€‰æ‹©éœ€è¦ç»¼åˆè€ƒè™‘å®‰å…¨æ€§ã€å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§ç­‰å¤šä¸ªç»´åº¦ã€‚</p><p><strong>å…³é”®è¦ç‚¹ï¼š</strong></p><ol><li><strong>OAuth 2.0 + OIDC</strong> æ˜¯ç°ä»£åº”ç”¨çš„ä¸»æµé€‰æ‹©</li><li><strong>JWT</strong> åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿</li><li><strong>SAML</strong> åœ¨ä¼ä¸šç¯å¢ƒä¸­ä»ç„¶é‡è¦</li><li><strong>å®‰å…¨æ€§</strong> å§‹ç»ˆæ˜¯ç¬¬ä¸€è€ƒè™‘å› ç´ </li><li><strong>æ ‡å‡†åŒ–</strong> æœ‰åŠ©äºç³»ç»Ÿé›†æˆå’Œç»´æŠ¤</li></ol><p>é€‰æ‹©åˆé€‚çš„è®¤è¯æˆæƒæ–¹æ¡ˆï¼Œéœ€è¦åŸºäºå…·ä½“çš„ä¸šåŠ¡åœºæ™¯ã€æŠ€æœ¯æ¶æ„å’Œå®‰å…¨è¦æ±‚è¿›è¡Œç»¼åˆè¯„ä¼°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OAuth </tag>
            
            <tag> JWT </tag>
            
            <tag> SAML </tag>
            
            <tag> OIDC </tag>
            
            <tag> è®¤è¯ </tag>
            
            <tag> æˆæƒ </tag>
            
            <tag> Token </tag>
            
            <tag> Kerberos </tag>
            
            <tag> LDAP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°å­—è¯ä¹¦ä¸ PKI æŠ€æœ¯è¯¦è§£</title>
      <link href="/posts/6104.html"/>
      <url>/posts/6104.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°å­—è¯ä¹¦ä¸-PKI-æŠ€æœ¯è¯¦è§£"><a href="#æ•°å­—è¯ä¹¦ä¸-PKI-æŠ€æœ¯è¯¦è§£" class="headerlink" title="æ•°å­—è¯ä¹¦ä¸ PKI æŠ€æœ¯è¯¦è§£"></a>æ•°å­—è¯ä¹¦ä¸ PKI æŠ€æœ¯è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ•°å­—è¯ä¹¦æ˜¯ç°ä»£ç½‘ç»œå®‰å…¨çš„åŸºçŸ³ï¼ŒPKI (Public Key Infrastructure) å…¬é’¥åŸºç¡€è®¾æ–½åˆ™æ˜¯ç®¡ç†è¿™äº›è¯ä¹¦çš„å®Œæ•´æ¡†æ¶ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ PKI çš„æ ¸å¿ƒæ¦‚å¿µã€ç»„ä»¶æ¶æ„ã€è¯ä¹¦æ ¼å¼æ ‡å‡†ä»¥åŠè‡ªåŠ¨åŒ–ç®¡ç†åè®®ã€‚</p><h2 id="PKI-Public-Key-Infrastructure-å…¬é’¥åŸºç¡€è®¾æ–½"><a href="#PKI-Public-Key-Infrastructure-å…¬é’¥åŸºç¡€è®¾æ–½" class="headerlink" title="PKI (Public Key Infrastructure) å…¬é’¥åŸºç¡€è®¾æ–½"></a>PKI (Public Key Infrastructure) å…¬é’¥åŸºç¡€è®¾æ–½</h2><h3 id="å®šä¹‰ä¸æ ¸å¿ƒä»·å€¼"><a href="#å®šä¹‰ä¸æ ¸å¿ƒä»·å€¼" class="headerlink" title="å®šä¹‰ä¸æ ¸å¿ƒä»·å€¼"></a>å®šä¹‰ä¸æ ¸å¿ƒä»·å€¼</h3><p><strong>PKI</strong> æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„å®‰å…¨æ¡†æ¶ï¼Œä¸“é—¨ç”¨äºç®¡ç†æ•°å­—è¯ä¹¦å’Œå…¬é’¥åŠ å¯†çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚å®ƒé€šè¿‡å»ºç«‹å¯ä¿¡çš„æ•°å­—èº«ä»½ä½“ç³»ï¼Œä¸ºç°ä»£ç½‘ç»œé€šä¿¡æä¾›èº«ä»½éªŒè¯ã€æ•°æ®å®Œæ•´æ€§å’Œæœºå¯†æ€§ä¿éšœã€‚</p><h3 id="æ ¸å¿ƒç»„ä»¶æ¶æ„"><a href="#æ ¸å¿ƒç»„ä»¶æ¶æ„" class="headerlink" title="æ ¸å¿ƒç»„ä»¶æ¶æ„"></a>æ ¸å¿ƒç»„ä»¶æ¶æ„</h3><h4 id="1-CA-Certificate-Authority-è¯ä¹¦é¢å‘æœºæ„"><a href="#1-CA-Certificate-Authority-è¯ä¹¦é¢å‘æœºæ„" class="headerlink" title="1. CA (Certificate Authority) - è¯ä¹¦é¢å‘æœºæ„"></a>1. CA (Certificate Authority) - è¯ä¹¦é¢å‘æœºæ„</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">æ ¸å¿ƒèŒèƒ½:</span> <span class="string">PKI</span> <span class="string">çš„ä¿¡ä»»æ ¹èŠ‚ç‚¹ï¼Œè´Ÿè´£æ•°å­—è¯ä¹¦çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line"><span class="string">ä¸»è¦èŒè´£:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ä¸¥æ ¼éªŒè¯ç”³è¯·è€…èº«ä»½å’Œèµ„è´¨</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">é¢å‘ç¬¦åˆæ ‡å‡†çš„æ•°å­—è¯ä¹¦</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å®æ—¶ç»´æŠ¤è¯ä¹¦çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">åŠæ—¶å‘å¸ƒè¯ä¹¦æ’¤é”€åˆ—è¡¨</span> <span class="string">(CRL)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ç®¡ç†è¯ä¹¦æœ‰æ•ˆæœŸå’Œç»­æœŸæµç¨‹</span></span><br></pre></td></tr></table></figure><h4 id="2-RA-Registration-Authority-æ³¨å†Œæœºæ„"><a href="#2-RA-Registration-Authority-æ³¨å†Œæœºæ„" class="headerlink" title="2. RA (Registration Authority) - æ³¨å†Œæœºæ„"></a>2. RA (Registration Authority) - æ³¨å†Œæœºæ„</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">å®šä½:</span> <span class="string">CA</span> <span class="string">çš„æˆæƒä»£ç†ï¼Œä¸“æ³¨äºè¯ä¹¦ç”³è¯·å‰ç«¯å¤„ç†</span></span><br><span class="line"><span class="string">æ ¸å¿ƒåŠŸèƒ½:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ‰§è¡Œä¸¥æ ¼çš„èº«ä»½éªŒè¯æµç¨‹</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ ‡å‡†åŒ–è¯ä¹¦ç”³è¯·å¤„ç†ç¨‹åº</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å‘</span> <span class="string">CA</span> <span class="string">è½¬å‘å·²éªŒè¯çš„åˆè§„ç”³è¯·</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æä¾›ç”¨æˆ·æ”¯æŒå’Œå’¨è¯¢æœåŠ¡</span></span><br></pre></td></tr></table></figure><h4 id="3-è¯ä¹¦å­˜å‚¨ä¸åˆ†å‘ç³»ç»Ÿ"><a href="#3-è¯ä¹¦å­˜å‚¨ä¸åˆ†å‘ç³»ç»Ÿ" class="headerlink" title="3. è¯ä¹¦å­˜å‚¨ä¸åˆ†å‘ç³»ç»Ÿ"></a>3. è¯ä¹¦å­˜å‚¨ä¸åˆ†å‘ç³»ç»Ÿ</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">åŠŸèƒ½:</span> <span class="string">å®‰å…¨å­˜å‚¨å’Œé«˜æ•ˆåˆ†å‘å·²é¢å‘è¯ä¹¦</span></span><br><span class="line"><span class="string">å®ç°æ–¹å¼:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">LDAP</span> <span class="string">ç›®å½•æœåŠ¡</span> <span class="string">(ä¼ä¸šç¯å¢ƒé¦–é€‰)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å…³ç³»å‹æ•°æ®åº“</span> <span class="string">(é«˜æ€§èƒ½åœºæ™¯)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Web</span> <span class="string">æœåŠ¡å™¨</span> <span class="string">(å…¬ç½‘è®¿é—®)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</span> <span class="string">(å¤§è§„æ¨¡éƒ¨ç½²)</span></span><br></pre></td></tr></table></figure><h4 id="4-è¯ä¹¦çŠ¶æ€éªŒè¯ç³»ç»Ÿ"><a href="#4-è¯ä¹¦çŠ¶æ€éªŒè¯ç³»ç»Ÿ" class="headerlink" title="4. è¯ä¹¦çŠ¶æ€éªŒè¯ç³»ç»Ÿ"></a>4. è¯ä¹¦çŠ¶æ€éªŒè¯ç³»ç»Ÿ</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ç»„ä»¶æ„æˆ:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">CRL</span> <span class="string">(Certificate</span> <span class="string">Revocation</span> <span class="string">List)</span> <span class="bullet">-</span> <span class="string">ä¼ ç»Ÿæ’¤é”€åˆ—è¡¨</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">OCSP</span> <span class="string">(Online</span> <span class="string">Certificate</span> <span class="string">Status</span> <span class="string">Protocol)</span> <span class="bullet">-</span> <span class="string">å®æ—¶çŠ¶æ€æŸ¥è¯¢</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">è¯ä¹¦é€æ˜åº¦æ—¥å¿—</span> <span class="string">(Certificate</span> <span class="string">Transparency)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">è‡ªåŠ¨åŒ–çŠ¶æ€ç›‘æ§æœåŠ¡</span></span><br></pre></td></tr></table></figure><h3 id="PKI-æ¶æ„å…³ç³»"><a href="#PKI-æ¶æ„å…³ç³»" class="headerlink" title="PKI æ¶æ„å…³ç³»"></a>PKI æ¶æ„å…³ç³»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PKI (å…¬é’¥åŸºç¡€è®¾æ–½ç”Ÿæ€ç³»ç»Ÿ)</span><br><span class="line">â”œâ”€â”€ CA (è¯ä¹¦é¢å‘æœºæ„) â† ä¿¡ä»»é”šç‚¹</span><br><span class="line">â”œâ”€â”€ RA (æ³¨å†Œæœºæ„) â† èº«ä»½éªŒè¯ç½‘å…³</span><br><span class="line">â”œâ”€â”€ è¯ä¹¦å­˜å‚¨ä¸åˆ†å‘ç³»ç»Ÿ â† æ•°æ®ç®¡ç†å±‚</span><br><span class="line">â”œâ”€â”€ è¯ä¹¦çŠ¶æ€éªŒè¯ç³»ç»Ÿ â† å®‰å…¨ç›‘æ§å±‚</span><br><span class="line">â”œâ”€â”€ å¯†é’¥ç®¡ç†ä¸æ‰˜ç®¡ç³»ç»Ÿ â† å¯†ç å­¦æ ¸å¿ƒ</span><br><span class="line">â”œâ”€â”€ ç­–ç•¥å¼•æ“ä¸åˆè§„æ¡†æ¶ â† æ²»ç†å±‚</span><br><span class="line">â””â”€â”€ ç”¨æˆ·æ¥å£ä¸APIæœåŠ¡ â† åº”ç”¨æ¥å£å±‚</span><br></pre></td></tr></table></figure><p><strong>ç»„ä»¶ååŒå…³ç³»</strong>:</p><ul><li><strong>CA</strong> ä½œä¸ºä¿¡ä»»çš„æ ¹åŸºï¼Œå»ºç«‹æ•´ä¸ªä¿¡ä»»é“¾æ¡</li><li><strong>PKI</strong> æä¾›å®Œæ•´çš„æ²»ç†æ¡†æ¶å’Œè¿è¥ä½“ç³»</li><li><strong>å„ç»„ä»¶ååŒå·¥ä½œ</strong>ï¼Œç¡®ä¿ç«¯åˆ°ç«¯çš„å®‰å…¨ä¿éšœ</li></ul><h3 id="ä¿¡ä»»æ¨¡å‹æ¶æ„"><a href="#ä¿¡ä»»æ¨¡å‹æ¶æ„" class="headerlink" title="ä¿¡ä»»æ¨¡å‹æ¶æ„"></a>ä¿¡ä»»æ¨¡å‹æ¶æ„</h3><h4 id="å±‚æ¬¡åŒ–ä¿¡ä»»æ¨¡å‹-ä¸»æµæ¶æ„"><a href="#å±‚æ¬¡åŒ–ä¿¡ä»»æ¨¡å‹-ä¸»æµæ¶æ„" class="headerlink" title="å±‚æ¬¡åŒ–ä¿¡ä»»æ¨¡å‹ (ä¸»æµæ¶æ„)"></a>å±‚æ¬¡åŒ–ä¿¡ä»»æ¨¡å‹ (ä¸»æµæ¶æ„)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Root CA (æ ¹è¯ä¹¦é¢å‘æœºæ„)</span><br><span class="line">â”œâ”€â”€ Policy CA (ç­–ç•¥è¯ä¹¦é¢å‘æœºæ„)</span><br><span class="line">â”‚   â”œâ”€â”€ Issuing CA 1 (é¢å‘è¯ä¹¦é¢å‘æœºæ„)</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ SSL/TLS Server Certificate</span><br><span class="line">â”‚   â”‚   â””â”€â”€ Code Signing Certificate</span><br><span class="line">â”‚   â””â”€â”€ Issuing CA 2</span><br><span class="line">â”‚       â”œâ”€â”€ Email Certificate</span><br><span class="line">â”‚       â””â”€â”€ User Authentication Certificate</span><br><span class="line">â””â”€â”€ Cross-Certified CA (äº¤å‰è®¤è¯è¯ä¹¦é¢å‘æœºæ„)</span><br><span class="line">    â”œâ”€â”€ Partner Organization Certificate</span><br><span class="line">    â””â”€â”€ Federal Bridge Certificate</span><br></pre></td></tr></table></figure><h4 id="ä¿¡ä»»é“¾éªŒè¯æµç¨‹"><a href="#ä¿¡ä»»é“¾éªŒè¯æµç¨‹" class="headerlink" title="ä¿¡ä»»é“¾éªŒè¯æµç¨‹"></a>ä¿¡ä»»é“¾éªŒè¯æµç¨‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">éªŒè¯æ­¥éª¤:</span></span><br><span class="line"><span class="number">1</span><span class="string">.</span> <span class="string">è·å–ç›®æ ‡å®ä½“è¯ä¹¦</span></span><br><span class="line"><span class="number">2</span><span class="string">.</span> <span class="string">æå–é¢å‘è€…CAä¿¡æ¯</span></span><br><span class="line"><span class="number">3</span><span class="string">.</span> <span class="string">é€’å½’éªŒè¯ä¸Šçº§CAè¯ä¹¦</span></span><br><span class="line"><span class="number">4</span><span class="string">.</span> <span class="string">è¿½æº¯è‡³å—ä¿¡ä»»æ ¹CA</span></span><br><span class="line"><span class="number">5</span><span class="string">.</span> <span class="string">éªŒè¯æ•´æ¡é“¾çš„æ•°å­—ç­¾å</span></span><br><span class="line"><span class="number">6</span><span class="string">.</span> <span class="string">æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸå’Œæ’¤é”€çŠ¶æ€</span></span><br><span class="line"><span class="number">7</span><span class="string">.</span> <span class="string">åº”ç”¨è¯ä¹¦ç­–ç•¥çº¦æŸ</span></span><br></pre></td></tr></table></figure><h3 id="è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†"><a href="#è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†" class="headerlink" title="è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†"></a>è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†</h3><h4 id="å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµç¨‹"><a href="#å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµç¨‹" class="headerlink" title="å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµç¨‹"></a>å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¯†é’¥å¯¹ç”Ÿæˆ â†’ è¯ä¹¦ç”³è¯·æäº¤ â†’ èº«ä»½éªŒè¯å®¡æ ¸ â†’ </span><br><span class="line">è¯ä¹¦é¢å‘ç­¾å â†’ è¯ä¹¦åˆ†å‘éƒ¨ç½² â†’ æ—¥å¸¸ä½¿ç”¨ç›‘æ§ â†’ </span><br><span class="line">å®šæœŸæ›´æ–°ç»­æœŸ â†’ å¿…è¦æ—¶æ’¤é”€é”€æ¯</span><br></pre></td></tr></table></figure><h4 id="å„é˜¶æ®µè¯¦ç»†è¯´æ˜"><a href="#å„é˜¶æ®µè¯¦ç»†è¯´æ˜" class="headerlink" title="å„é˜¶æ®µè¯¦ç»†è¯´æ˜"></a>å„é˜¶æ®µè¯¦ç»†è¯´æ˜</h4><ul><li><strong>å¯†é’¥ç”Ÿæˆ</strong>: é‡‡ç”¨å®‰å…¨éšæœºæ•°ç”Ÿæˆå™¨ï¼Œç¡®ä¿å¯†é’¥å¼ºåº¦</li><li><strong>èº«ä»½éªŒè¯</strong>: å¤šå› ç´ éªŒè¯ï¼ŒåŒ…æ‹¬æ–‡æ¡£å®¡æ ¸å’ŒåŸŸåæ§åˆ¶éªŒè¯</li><li><strong>è¯ä¹¦é¢å‘</strong>: éµå¾ª X.509 æ ‡å‡†ï¼ŒåµŒå…¥å¿…è¦çš„æ‰©å±•å­—æ®µ</li><li><strong>ä½¿ç”¨ç›‘æ§</strong>: å®æ—¶ç›‘æ§è¯ä¹¦ä½¿ç”¨æƒ…å†µå’Œå®‰å…¨äº‹ä»¶</li><li><strong>æ›´æ–°ç»­æœŸ</strong>: è‡ªåŠ¨åŒ–æˆ–åŠè‡ªåŠ¨åŒ–çš„è¯ä¹¦æ›´æ–°æµç¨‹</li><li><strong>æ’¤é”€ç®¡ç†</strong>: åŸºäº CRL å’Œ OCSP çš„å®æ—¶æ’¤é”€æ£€æŸ¥</li></ul><h3 id="ä¸»æµ-PKI-å®ç°æ–¹æ¡ˆ"><a href="#ä¸»æµ-PKI-å®ç°æ–¹æ¡ˆ" class="headerlink" title="ä¸»æµ PKI å®ç°æ–¹æ¡ˆ"></a>ä¸»æµ PKI å®ç°æ–¹æ¡ˆ</h3><h4 id="Microsoft-Active-Directory-Certificate-Services-AD-CS"><a href="#Microsoft-Active-Directory-Certificate-Services-AD-CS" class="headerlink" title="Microsoft Active Directory Certificate Services (AD CS)"></a>Microsoft Active Directory Certificate Services (AD CS)</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ç‰¹ç‚¹:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Windows</span> <span class="string">Server</span> <span class="string">åŸç”Ÿ</span> <span class="string">PKI</span> <span class="string">è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ä¸</span> <span class="string">Active</span> <span class="string">Directory</span> <span class="string">æ·±åº¦é›†æˆ</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ”¯æŒä¼ä¸šçº§è¯ä¹¦æ¨¡æ¿å’Œè‡ªåŠ¨æ³¨å†Œ</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å†…ç½®</span> <span class="string">Web</span> <span class="string">æ³¨å†Œç•Œé¢å’Œ</span> <span class="string">SCEP</span> <span class="string">æ”¯æŒ</span></span><br><span class="line"><span class="string">åº”ç”¨åœºæ™¯:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ä¼ä¸šå†…éƒ¨</span> <span class="string">PKI</span> <span class="string">éƒ¨ç½²</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Windows</span> <span class="string">åŸŸç¯å¢ƒè¯ä¹¦ç®¡ç†</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ™ºèƒ½å¡å’Œ</span> <span class="string">EFS</span> <span class="string">æ–‡ä»¶åŠ å¯†</span></span><br></pre></td></tr></table></figure><h4 id="Letâ€™s-Encrypt-å¼€æºå…è´¹-CA"><a href="#Letâ€™s-Encrypt-å¼€æºå…è´¹-CA" class="headerlink" title="Letâ€™s Encrypt (å¼€æºå…è´¹ CA)"></a>Letâ€™s Encrypt (å¼€æºå…è´¹ CA)</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ç‰¹ç‚¹:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">åŸºäº</span> <span class="string">ACME</span> <span class="string">åè®®çš„è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å…è´¹æä¾›</span> <span class="string">DV</span> <span class="string">(åŸŸåéªŒè¯)</span> <span class="string">è¯ä¹¦</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">90</span><span class="string">å¤©çŸ­æœŸè¯ä¹¦ï¼Œå¼ºåˆ¶è‡ªåŠ¨åŒ–æ›´æ–°</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ”¯æŒé€šé…ç¬¦è¯ä¹¦å’Œå¤šåŸŸåè¯ä¹¦</span></span><br><span class="line"><span class="string">åº”ç”¨åœºæ™¯:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å…¬ç½‘</span> <span class="string">HTTPS</span> <span class="string">ç½‘ç«™åŠ å¯†</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å¼€å‘æµ‹è¯•ç¯å¢ƒ</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">å°å‹ä¼ä¸šå’Œä¸ªäººé¡¹ç›®</span></span><br></pre></td></tr></table></figure><h4 id="ä¼ä¸šçº§å•†ä¸š-PKI-è§£å†³æ–¹æ¡ˆ"><a href="#ä¼ä¸šçº§å•†ä¸š-PKI-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¼ä¸šçº§å•†ä¸š PKI è§£å†³æ–¹æ¡ˆ"></a>ä¼ä¸šçº§å•†ä¸š PKI è§£å†³æ–¹æ¡ˆ</h4><ul><li><strong>Entrust PKI</strong>: é«˜å®‰å…¨ç­‰çº§ï¼Œæ”¿åºœå’Œé‡‘èè¡Œä¸šé¦–é€‰</li><li><strong>DigiCert CertCentral</strong>: å…¨çƒé¢†å…ˆçš„å•†ä¸šè¯ä¹¦æœåŠ¡</li><li><strong>GlobalSign</strong>: æ¬§æ´²ä¸»å¯¼çš„å›½é™…åŒ– PKI æœåŠ¡å•†</li></ul><h2 id="æ•°å­—è¯ä¹¦æ ¼å¼æ ‡å‡†"><a href="#æ•°å­—è¯ä¹¦æ ¼å¼æ ‡å‡†" class="headerlink" title="æ•°å­—è¯ä¹¦æ ¼å¼æ ‡å‡†"></a>æ•°å­—è¯ä¹¦æ ¼å¼æ ‡å‡†</h2><h3 id="X-509-è¯ä¹¦æ ‡å‡†æ¦‚è¿°"><a href="#X-509-è¯ä¹¦æ ‡å‡†æ¦‚è¿°" class="headerlink" title="X.509 è¯ä¹¦æ ‡å‡†æ¦‚è¿°"></a>X.509 è¯ä¹¦æ ‡å‡†æ¦‚è¿°</h3><p>æ‰€æœ‰æ•°å­—è¯ä¹¦å‡åŸºäº <strong>ITU-T X.509 æ ‡å‡†</strong>ï¼Œå®šä¹‰äº†è¯ä¹¦çš„åŸºæœ¬ç»“æ„å’Œå­—æ®µã€‚æ— è®ºæ˜¯ PKCS#1ã€PKCS#12ã€SCEP è¿˜æ˜¯ ACME è·å–çš„è¯ä¹¦ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ X.509 æ ¼å¼çš„ä¸åŒå°è£…å’Œä¼ è¾“æ–¹å¼ã€‚</p><h3 id="PKCS-æ ‡å‡†æ—ç³»"><a href="#PKCS-æ ‡å‡†æ—ç³»" class="headerlink" title="PKCS æ ‡å‡†æ—ç³»"></a>PKCS æ ‡å‡†æ—ç³»</h3><p><strong>PKCS (Public-Key Cryptography Standards)</strong> æ˜¯ç”± RSA å®éªŒå®¤åˆ¶å®šçš„å…¬é’¥å¯†ç å­¦æ ‡å‡†ç³»åˆ—ï¼Œå…¶ä¸­ PKCS#1 å’Œ PKCS#12 æ˜¯æ•°å­—è¯ä¹¦é¢†åŸŸçš„é‡è¦æ ‡å‡†ã€‚</p><h4 id="PKCS-1-æ ¼å¼è¯ä¹¦-ä»…è¯ä¹¦å†…å®¹"><a href="#PKCS-1-æ ¼å¼è¯ä¹¦-ä»…è¯ä¹¦å†…å®¹" class="headerlink" title="PKCS#1 æ ¼å¼è¯ä¹¦ (ä»…è¯ä¹¦å†…å®¹)"></a>PKCS#1 æ ¼å¼è¯ä¹¦ (ä»…è¯ä¹¦å†…å®¹)</h4><p><strong>æ ¸å¿ƒç‰¹å¾</strong>:</p><ul><li><strong>å†…å®¹</strong>: ä»…åŒ…å« X.509 å…¬é’¥è¯ä¹¦ï¼Œä¸åŒ…å«ç§é’¥</li><li><strong>å®‰å…¨æ€§</strong>: å¯å…¬å¼€åˆ†å‘ï¼Œç”¨äºèº«ä»½éªŒè¯å’ŒåŠ å¯†</li><li><strong>ç¼–ç æ–¹å¼</strong>: æ”¯æŒ DER (äºŒè¿›åˆ¶) å’Œ PEM (Base64æ–‡æœ¬) ä¸¤ç§ç¼–ç </li></ul><p><strong>å¸¸è§æ–‡ä»¶æ‰©å±•å</strong>:</p><table><thead><tr><th>æ‰©å±•å</th><th>ç¼–ç æ ¼å¼</th><th>ä¸»è¦ç”¨é€”</th><th>é€‚ç”¨å¹³å°</th></tr></thead><tbody><tr><td><strong>.crt</strong></td><td>DER&#x2F;PEM</td><td>æœåŠ¡å™¨è¯ä¹¦ã€é€šç”¨è¯ä¹¦æ–‡ä»¶</td><td>è·¨å¹³å°é€šç”¨</td></tr><tr><td><strong>.cer</strong></td><td>DER&#x2F;PEM</td><td>Windows ç³»ç»Ÿåå¥½æ ¼å¼</td><td>Windowsä¸»å¯¼</td></tr><tr><td><strong>.der</strong></td><td>DER</td><td>äºŒè¿›åˆ¶ç¼–ç è¯ä¹¦</td><td>ç³»ç»Ÿçº§åº”ç”¨</td></tr><tr><td><strong>.pem</strong></td><td>PEM</td><td>Base64æ–‡æœ¬è¯ä¹¦ã€è¯ä¹¦é“¾</td><td>Linux&#x2F;Unix</td></tr></tbody></table><p><strong>å®é™…åº”ç”¨ç¤ºä¾‹</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¸å‹è¯ä¹¦æ–‡ä»¶å‘½å</span></span><br><span class="line">ssl-certificate.crt      <span class="comment"># WebæœåŠ¡å™¨SSLè¯ä¹¦</span></span><br><span class="line">root-ca.cer             <span class="comment"># æ ¹è¯ä¹¦é¢å‘æœºæ„è¯ä¹¦</span></span><br><span class="line">intermediate.der        <span class="comment"># ä¸­é—´è¯ä¹¦é¢å‘æœºæ„è¯ä¹¦</span></span><br><span class="line">certificate-chain.pem   <span class="comment"># å®Œæ•´è¯ä¹¦é“¾æ–‡ä»¶</span></span><br><span class="line">client-auth.crt         <span class="comment"># å®¢æˆ·ç«¯è®¤è¯è¯ä¹¦</span></span><br></pre></td></tr></table></figure><h4 id="PKCS-12-æ ¼å¼è¯ä¹¦-å®Œæ•´èº«ä»½åŒ…"><a href="#PKCS-12-æ ¼å¼è¯ä¹¦-å®Œæ•´èº«ä»½åŒ…" class="headerlink" title="PKCS#12 æ ¼å¼è¯ä¹¦ (å®Œæ•´èº«ä»½åŒ…)"></a>PKCS#12 æ ¼å¼è¯ä¹¦ (å®Œæ•´èº«ä»½åŒ…)</h4><p><strong>æ ¸å¿ƒç‰¹å¾</strong>:</p><ul><li><strong>å†…å®¹</strong>: è¯ä¹¦ + ç§é’¥ + å¯é€‰çš„è¯ä¹¦é“¾</li><li><strong>å®‰å…¨æ€§</strong>: å¯†ç ä¿æŠ¤çš„äºŒè¿›åˆ¶å®¹å™¨æ ¼å¼</li><li><strong>ç”¨é€”</strong>: å®Œæ•´æ•°å­—èº«ä»½çš„å®‰å…¨ä¼ è¾“å’Œå­˜å‚¨</li></ul><p><strong>å¸¸è§æ–‡ä»¶æ‰©å±•å</strong>:</p><table><thead><tr><th>æ‰©å±•å</th><th>ä¸»è¦å¹³å°</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>.p12</strong></td><td>è·¨å¹³å°æ ‡å‡†</td><td>æ ‡å‡† PKCS#12 æ ¼å¼</td></tr><tr><td><strong>.pfx</strong></td><td>Windows</td><td>Microsoft ä¸ªäººä¿¡æ¯äº¤æ¢æ ¼å¼</td></tr><tr><td><strong>.pkcs12</strong></td><td>Linux&#x2F;Unix</td><td>æ˜ç¡®æ ‡è¯†çš„ PKCS#12 æ ¼å¼</td></tr></tbody></table><p><strong>å…¸å‹ä½¿ç”¨åœºæ™¯</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®é™…åº”ç”¨ç¤ºä¾‹</span></span><br><span class="line">user-identity.p12        <span class="comment"># ç”¨æˆ·ä¸ªäººæ•°å­—èº«ä»½</span></span><br><span class="line">client-certificate.pfx   <span class="comment"># å®¢æˆ·ç«¯åŒå‘è®¤è¯è¯ä¹¦</span></span><br><span class="line">device-identity.pkcs12   <span class="comment"># IoTè®¾å¤‡èº«ä»½è¯ä¹¦</span></span><br><span class="line">code-signing.p12         <span class="comment"># ä»£ç ç­¾åè¯ä¹¦</span></span><br><span class="line">email-certificate.pfx    <span class="comment"># S/MIMEé‚®ä»¶åŠ å¯†è¯ä¹¦</span></span><br></pre></td></tr></table></figure><h4 id="æ ¼å¼å¯¹æ¯”æ€»ç»“"><a href="#æ ¼å¼å¯¹æ¯”æ€»ç»“" class="headerlink" title="æ ¼å¼å¯¹æ¯”æ€»ç»“"></a>æ ¼å¼å¯¹æ¯”æ€»ç»“</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PKCS#1</span> <span class="string">è¯ä¹¦:</span></span><br><span class="line">  <span class="string">åŒ…å«å†…å®¹:</span> <span class="string">ä»…</span> <span class="string">X.509</span> <span class="string">è¯ä¹¦</span> <span class="string">(å…¬é’¥)</span></span><br><span class="line">  <span class="string">ç§é’¥ä½ç½®:</span> <span class="string">å•ç‹¬å­˜å‚¨ç®¡ç†</span></span><br><span class="line">  <span class="string">å®‰å…¨ç­‰çº§:</span> <span class="string">ä¸­ç­‰</span> <span class="string">(è¯ä¹¦å¯å…¬å¼€)</span></span><br><span class="line">  <span class="string">ä½¿ç”¨å¤æ‚åº¦:</span> <span class="string">éœ€è¦é¢å¤–ç®¡ç†ç§é’¥</span></span><br><span class="line">  <span class="string">ä¸»è¦ç”¨é€”:</span> <span class="string">æœåŠ¡å™¨è¯ä¹¦ã€è¯ä¹¦é“¾éªŒè¯</span></span><br><span class="line"></span><br><span class="line"><span class="string">PKCS#12</span> <span class="string">è¯ä¹¦:</span></span><br><span class="line">  <span class="string">åŒ…å«å†…å®¹:</span> <span class="string">è¯ä¹¦</span> <span class="string">+</span> <span class="string">ç§é’¥</span> <span class="string">+</span> <span class="string">è¯ä¹¦é“¾</span></span><br><span class="line">  <span class="string">ç§é’¥ä¿æŠ¤:</span> <span class="string">å¯†ç åŠ å¯†ä¿æŠ¤</span></span><br><span class="line">  <span class="string">å®‰å…¨ç­‰çº§:</span> <span class="string">é«˜</span> <span class="string">(å®Œæ•´èº«ä»½ä¿æŠ¤)</span></span><br><span class="line">  <span class="string">ä½¿ç”¨ä¾¿åˆ©æ€§:</span> <span class="string">ä¸€ç«™å¼èº«ä»½è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">  <span class="string">ä¸»è¦ç”¨é€”:</span> <span class="string">å®¢æˆ·ç«¯èº«ä»½è®¤è¯ã€æ•°å­—ç­¾å</span></span><br></pre></td></tr></table></figure><h2 id="SCEP"><a href="#SCEP" class="headerlink" title="SCEP"></a>SCEP</h2><p>SCEPï¼ˆSimple Certificate Enrollment Protocolï¼Œç®€å•è¯ä¹¦æ³¨å†Œåè®®ï¼‰è¯ä¹¦æ˜¯é€šè¿‡ SCEP åè®®ä» CA è·å–çš„æ•°å­—è¯ä¹¦ï¼ˆä¹Ÿæ˜¯ X.509 æ ¼å¼ï¼‰ï¼ŒåŒ…å«å…¬é’¥å’Œç§é’¥ï¼ˆè®¾å¤‡æœ¬åœ°ç”Ÿæˆï¼Œä¸ç”±CAä¼ è¾“ï¼‰ã€‚</p><ul><li>ç›¸è¾ƒäºP12è¯ä¹¦è¦æ‰‹åŠ¨æ›´æ–°ï¼Œ SCEPè¯ä¹¦ï¼Œéœ€è¦è”ç½‘ï¼Œæ ¹æ®é…ç½®å‚æ•°ç”³è¯·è¯ä¹¦ï¼ŒåŠ¨æ€æ›´æ–°ï¼Œæ”¯æŒè‡ªåŠ¨ç»­æœŸï¼Œ</li><li>åœºæ™¯ï¼šå¸¸ç”¨äºä¼ä¸šå†…éƒ¨ï¼Œä¸“æ³¨äºè®¾å¤‡èº«ä»½éªŒè¯ï¼ˆVPN ã€WIFIï¼‰</li><li>ä½¿ç”¨è€…ï¼šä¼ä¸š IT ç®¡ç†å‘˜ã€è®¾å¤‡ç®¡ç†ã€‚</li></ul><h2 id="ACME"><a href="#ACME" class="headerlink" title="ACME"></a>ACME</h2><p>ACMEï¼ˆAutomatic Certificate Management Environmenï¼‰è¯ä¹¦æ˜¯é€šè¿‡ ACME åè®®ä» CAï¼ˆå¦‚ Letâ€™s Encryptï¼‰è·å–çš„æ•°å­—è¯ä¹¦ï¼Œé€šå¸¸æ˜¯ X.509 æ ¼å¼ï¼ŒåŒ…å«å…¬é’¥å’Œç§é’¥ï¼ˆè®¾å¤‡æœ¬åœ°ç”Ÿæˆï¼Œä¸ç”±CAä¼ è¾“ï¼‰ï¼Œç”¨äºè¯æ˜èº«ä»½å’ŒåŠ å¯†é€šä¿¡ã€‚</p><ul><li>åœºæ™¯ï¼šä¸“æ³¨äºWEBå®‰å…¨ï¼Œå¤šç”¨äºç½‘ç«™çš„HTTPSéªŒè¯</li><li>ä½¿ç”¨è€…ï¼šç½‘ç«™ç®¡ç†å‘˜ã€å¼€å‘è€…ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PKI </tag>
            
            <tag> æ•°å­—è¯ä¹¦ </tag>
            
            <tag> CA </tag>
            
            <tag> åŠ å¯† </tag>
            
            <tag> PKCS </tag>
            
            <tag> SCEP </tag>
            
            <tag> ACME </tag>
            
            <tag> X.509 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hibernate ORM æ¡†æ¶è¯¦è§£</title>
      <link href="/posts/22172.html"/>
      <url>/posts/22172.html</url>
      
        <content type="html"><![CDATA[<h1 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h1><p>Hibernate æ˜¯ä¸€ä¸ªç”¨äº Java ç¯å¢ƒçš„å¼€æºå¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æ¡†æ¶ï¼ŒXML æ˜ å°„æ–‡ä»¶æ˜¯ Hibernate é…ç½®å®ä½“ç±»å’Œæ•°æ®åº“è¡¨ä¹‹é—´æ˜ å°„å…³ç³»çš„é‡è¦æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ Hibernate XML æ˜ å°„æ–‡ä»¶ä¸­å¸¸è§æ ‡ç­¾çš„ä»‹ç»ï¼š</p><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><p>åœ¨ Spring æ¡†æ¶ä¸­ä½¿ç”¨ Hibernate ä½œä¸º ORM æ¡†æ¶æ—¶ï¼Œéœ€è¦å¯¼å…¥ä»¥ä¸‹ç›¸å…³åº“ï¼ˆä¾èµ–é¡¹ï¼‰ã€‚ä»¥ä¸‹æ˜¯åŸºäº Maven æˆ– Gradle çš„ä¾èµ–é…ç½®ï¼Œå…·ä½“ä¾èµ–å–å†³äºä½ ä½¿ç”¨çš„ Spring ç‰ˆæœ¬ã€Hibernate ç‰ˆæœ¬ä»¥åŠæ˜¯å¦ä½¿ç”¨ JPAã€‚</p><h3 id="1-æ ¸å¿ƒ-Dependencies"><a href="#1-æ ¸å¿ƒ-Dependencies" class="headerlink" title="1. æ ¸å¿ƒ Dependencies"></a>1. <strong>æ ¸å¿ƒ D</strong>ependencies</h3><h4 id="Hibernate-Core"><a href="#Hibernate-Core" class="headerlink" title="Hibernate Core"></a>Hibernate Core</h4><p>Hibernate çš„æ ¸å¿ƒåº“ï¼Œæä¾›åŸºæœ¬çš„ ORM åŠŸèƒ½ã€‚</p><ul><li><strong>Maven</strong>:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.15.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- æ›¿æ¢ä¸ºæœ€æ–°ç¨³å®šç‰ˆæœ¬ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>Gradle</strong>:<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.hibernate:hibernate-core:5.6.15.Final&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="Spring-ORM"><a href="#Spring-ORM" class="headerlink" title="Spring ORM"></a>Spring ORM</h4><p>Spring æä¾›çš„ ORM æ¨¡å—ï¼Œé›†æˆ Hibernate å¹¶ç®€åŒ–é…ç½®ï¼ˆå¦‚ <code>SessionFactory</code> ç®¡ç†ï¼‰ã€‚</p><ul><li><strong>Maven</strong>:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- ä¸ä½ çš„ Spring ç‰ˆæœ¬ä¿æŒä¸€è‡´ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>Gradle</strong>:<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.springframework:spring-orm:5.3.27&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-æ•°æ®åº“é©±åŠ¨"><a href="#2-æ•°æ®åº“é©±åŠ¨" class="headerlink" title="2. æ•°æ®åº“é©±åŠ¨"></a>2. <strong>æ•°æ®åº“é©±åŠ¨</strong></h3><p>éœ€è¦æ ¹æ®ä½ ä½¿ç”¨çš„æ•°æ®åº“ï¼ˆå¦‚ MySQLã€PostgreSQL ç­‰ï¼‰æ·»åŠ å¯¹åº”çš„ JDBC é©±åŠ¨ã€‚ä¾‹å¦‚ï¼š</p><ul><li><p><strong>MySQL é©±åŠ¨</strong>:</p><ul><li><strong>Maven</strong>:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- æ›¿æ¢ä¸ºæœ€æ–°ç‰ˆæœ¬ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>Gradle</strong>:<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;mysql:mysql-connector-java:8.0.33&#x27;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>PostgreSQL é©±åŠ¨</strong>ï¼ˆç¤ºä¾‹ï¼‰:</p><ul><li><strong>Maven</strong>:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.postgresql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>postgresql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>42.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>Gradle</strong>:<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.postgresql:postgresql:42.7.3&#x27;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="3-å¯é€‰ä¾èµ–"><a href="#3-å¯é€‰ä¾èµ–" class="headerlink" title="3. å¯é€‰ä¾èµ–"></a>3. <strong>å¯é€‰ä¾èµ–</strong></h3><h4 id="è¿æ¥æ± ï¼ˆæ¨èï¼‰"><a href="#è¿æ¥æ± ï¼ˆæ¨èï¼‰" class="headerlink" title="è¿æ¥æ± ï¼ˆæ¨èï¼‰"></a>è¿æ¥æ± ï¼ˆæ¨èï¼‰</h4><p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œé€šå¸¸ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ï¼ˆå¦‚ HikariCPã€C3P0 æˆ– DBCPï¼‰ã€‚Spring Boot é»˜è®¤ä½¿ç”¨ HikariCPã€‚</p><ul><li><strong>HikariCP</strong>:<ul><li><strong>Maven</strong>:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>Gradle</strong>:<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.zaxxer:HikariCP:5.0.1&#x27;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="å¦‚æœä½¿ç”¨-Spring-Boot"><a href="#å¦‚æœä½¿ç”¨-Spring-Boot" class="headerlink" title="å¦‚æœä½¿ç”¨ Spring Boot"></a>å¦‚æœä½¿ç”¨ Spring Boot</h4><p>Spring Boot æä¾›äº† starter ä¾èµ–ï¼Œç®€åŒ–é…ç½®ï¼š</p><ul><li><strong>Maven</strong>:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- ä¸ä½ çš„ Spring Boot ç‰ˆæœ¬ä¸€è‡´ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><strong>Gradle</strong>:<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-data-jpa:2.7.18&#x27;</span></span><br></pre></td></tr></table></figure><strong>è¯´æ˜</strong>ï¼š<code>spring-boot-starter-data-jpa</code> å·²ç»åŒ…å«äº† Hibernateã€Spring ORM å’Œ JPA ç›¸å…³ä¾èµ–ï¼Œå¹¶é»˜è®¤é…ç½® HikariCPã€‚ä½ è¿˜éœ€è¦å•ç‹¬æ·»åŠ æ•°æ®åº“é©±åŠ¨ï¼ˆå¦‚ MySQLï¼‰ã€‚</li></ul><h3 id="4-ç‰ˆæœ¬æ³¨æ„äº‹é¡¹"><a href="#4-ç‰ˆæœ¬æ³¨æ„äº‹é¡¹" class="headerlink" title="4. ç‰ˆæœ¬æ³¨æ„äº‹é¡¹"></a>4. <strong>ç‰ˆæœ¬æ³¨æ„äº‹é¡¹</strong></h3><ul><li><strong>Hibernate ç‰ˆæœ¬</strong>ï¼šæ¨èä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆï¼ˆæˆªè‡³ 2025 å¹´ 4 æœˆï¼Œ5.6.x æˆ– 6.x ç³»åˆ—ï¼‰ã€‚Hibernate 6.x è¦æ±‚ JDK 11+ å¹¶æœ‰é‡å¤§å˜æ›´ï¼ˆå¦‚å»æ‰ <code>hibernate-entitymanager</code> åŒ…ï¼‰ã€‚</li><li><strong>Spring ç‰ˆæœ¬</strong>ï¼šç¡®ä¿ Spring å’Œ Hibernate ç‰ˆæœ¬å…¼å®¹ã€‚ä¾‹å¦‚ï¼ŒSpring 5.x é€šå¸¸ä¸ Hibernate 5.x æ­é…ï¼ŒSpring 6.x ä¸ Hibernate 6.x æ›´å…¼å®¹ã€‚</li><li><strong>Spring Boot</strong>ï¼šå¦‚æœä½¿ç”¨ Spring Bootï¼Œ<code>spring-boot-starter-data-jpa</code> ä¼šè‡ªåŠ¨ç®¡ç†å…¼å®¹çš„ Hibernate ç‰ˆæœ¬ã€‚</li></ul><h3 id="5-å…¸å‹é…ç½®ç¤ºä¾‹ï¼ˆé-Spring-Bootï¼‰"><a href="#5-å…¸å‹é…ç½®ç¤ºä¾‹ï¼ˆé-Spring-Bootï¼‰" class="headerlink" title="5. å…¸å‹é…ç½®ç¤ºä¾‹ï¼ˆé Spring Bootï¼‰"></a>5. <strong>å…¸å‹é…ç½®ç¤ºä¾‹ï¼ˆé Spring Bootï¼‰</strong></h3><p>åœ¨ Spring é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>applicationContext.xml</code>ï¼‰ä¸­é…ç½® Hibernateï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.zaxxer.hikari.HikariDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/yourdb&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.hibernate5.LocalSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;packagesToScan&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.example.model&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernateProperties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;hibernate.dialect&quot;</span>&gt;</span>org.hibernate.dialect.MySQL8Dialect<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;hibernate.show_sql&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;hibernate.hbm2ddl.auto&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.hibernate5.HibernateTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sessionFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-Spring-Boot-é…ç½®"><a href="#6-Spring-Boot-é…ç½®" class="headerlink" title="6. Spring Boot é…ç½®"></a>6. <strong>Spring Boot é…ç½®</strong></h3><p>å¦‚æœä½¿ç”¨ Spring Bootï¼Œåªéœ€åœ¨ <code>application.properties</code> æˆ– <code>application.yml</code> ä¸­é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/yourdb</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">password</span></span><br><span class="line"><span class="attr">spring.jpa.hibernate.ddl-auto</span>=<span class="string">update</span></span><br><span class="line"><span class="attr">spring.jpa.show-sql</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.jpa.properties.hibernate.dialect</span>=<span class="string">org.hibernate.dialect.MySQL8Dialect</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>æœ€å°ä¾èµ–</strong>ï¼š<code>hibernate-core</code>ã€<code>spring-orm</code>ã€æ•°æ®åº“é©±åŠ¨ã€‚</li><li><strong>æ¨èï¼ˆSpring Bootï¼‰</strong>ï¼š<code>spring-boot-starter-data-jpa</code> + æ•°æ®åº“é©±åŠ¨ã€‚</li><li><strong>JPA åœºæ™¯</strong>ï¼šæ·»åŠ  <code>hibernate-entitymanager</code>ï¼ˆHibernate 5.xï¼‰ã€‚</li><li><strong>è¿æ¥æ± </strong>ï¼šå»ºè®®ä½¿ç”¨ HikariCPã€‚</li></ul><p>å¦‚æœä½¿ç”¨ Spring Bootï¼Œ<code>spring-boot-starter-data-jpa</code> æ˜¯æœ€ç®€ä¾¿çš„æ–¹å¼ã€‚å¦‚æœæ˜¯ä¼ ç»Ÿ Spring é¡¹ç›®ï¼Œéœ€æ‰‹åŠ¨æ·»åŠ  Hibernate å’Œ Spring ORM ä¾èµ–ã€‚ç¡®ä¿ç‰ˆæœ¬å…¼å®¹ï¼Œå¹¶æ ¹æ®æ•°æ®åº“ç±»å‹é€‰æ‹©åˆé€‚çš„é©±åŠ¨ã€‚</p><p>å¦‚æœä½ æœ‰å…·ä½“åœºæ™¯ï¼ˆä¾‹å¦‚ Spring Boot ç‰ˆæœ¬ã€æ•°æ®åº“ç±»å‹ï¼‰æˆ–é‡åˆ°é…ç½®é—®é¢˜ï¼Œè¯·æä¾›æ›´å¤šç»†èŠ‚ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ç­”æ¡ˆï¼</p><h2 id="XML-é…ç½®æ–‡ä»¶"><a href="#XML-é…ç½®æ–‡ä»¶" class="headerlink" title="XML é…ç½®æ–‡ä»¶"></a>XML é…ç½®æ–‡ä»¶</h2><h3 id=""><a href="#" class="headerlink" title="&lt;hibernate-mapping&gt;"></a><code>&lt;hibernate-mapping&gt;</code></h3><p>è¿™æ˜¯ Hibernate XML æ˜ å°„æ–‡ä»¶çš„æ ¹æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªæ˜ å°„æ–‡æ¡£çš„å¼€å§‹å’Œç»“æŸï¼Œå®ƒå¯ä»¥åŒ…å«å¤šä¸ª <code>&lt;class&gt;</code> æ ‡ç­¾ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- å…¶ä»–æ ‡ç­¾ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="-1"><a href="#-1" class="headerlink" title="&lt;class&gt;"></a><code>&lt;class&gt;</code></h3><p><code>&lt;class&gt;</code> æ ‡ç­¾ç”¨äºå®šä¹‰ Java ç±»å’Œæ•°æ®åº“è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p><ul><li><p><code>name</code> å±æ€§ï¼šæŒ‡å®š Java ç±»çš„å…¨é™å®šåã€‚</p></li><li><p><code>table</code> å±æ€§ï¼šæŒ‡å®šå¯¹åº”çš„æ•°æ®åº“è¡¨åã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">&quot;com.example.User&quot;</span> <span class="attr">table</span>=<span class="string">&quot;users&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å…¶ä»–æ ‡ç­¾ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="-2"><a href="#-2" class="headerlink" title="&lt;id&gt;"></a><code>&lt;id&gt;</code></h3><p>  <code>&lt;id&gt;</code> æ ‡ç­¾ç”¨äºæ˜ å°„ Java ç±»ä¸­çš„ä¸»é”®å±æ€§åˆ°æ•°æ®åº“è¡¨çš„ä¸»é”®åˆ—ã€‚</p><ul><li><p><code>name</code> å±æ€§ï¼šæŒ‡å®š Java ç±»ä¸­çš„ä¸»é”®å±æ€§åã€‚</p></li><li><p><code>column</code> å±æ€§ï¼šæŒ‡å®šæ•°æ®åº“è¡¨ä¸­çš„ä¸»é”®åˆ—åã€‚</p></li><li><p><code>type</code> å±æ€§ï¼šæŒ‡å®šå±æ€§çš„æ•°æ®ç±»å‹ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¸»é”®ç”Ÿæˆç­–ç•¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">&quot;native&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="-3"><a href="#-3" class="headerlink" title="&lt;generator&gt;"></a><code>&lt;generator&gt;</code></h3><p><code>&lt;generator&gt;</code> æ ‡ç­¾ç”¨äºæŒ‡å®šä¸»é”®çš„ç”Ÿæˆç­–ç•¥ï¼Œé€šå¸¸åµŒå¥—åœ¨ <code>&lt;id&gt;</code> æ ‡ç­¾å†…ã€‚å¸¸è§çš„ç”Ÿæˆç­–ç•¥æœ‰ï¼š</p><ul><li><p><code>native</code>ï¼šæ ¹æ®æ•°æ®åº“çš„æ”¯æŒè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼ˆå¦‚è‡ªå¢ã€åºåˆ—ç­‰ï¼‰ã€‚</p></li><li><p><code>increment</code>ï¼šç”± Hibernate è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé€’å¢çš„ä¸»é”®å€¼ã€‚</p></li><li><p><code>uuid</code>ï¼šç”Ÿæˆä¸€ä¸ª UUID ä½œä¸ºä¸»é”®å€¼ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">&quot;native&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="-4"><a href="#-4" class="headerlink" title="&lt;property&gt;"></a><code>&lt;property&gt;</code></h3><p><code>&lt;property&gt;</code> æ ‡ç­¾ç”¨äºæ˜ å°„ Java ç±»ä¸­çš„æ™®é€šå±æ€§åˆ°æ•°æ®åº“è¡¨çš„åˆ—ã€‚</p><ul><li><p><code>name</code> å±æ€§ï¼šæŒ‡å®š Java ç±»ä¸­çš„å±æ€§åã€‚</p></li><li><p><code>column</code> å±æ€§ï¼šæŒ‡å®šæ•°æ®åº“è¡¨ä¸­çš„åˆ—åã€‚</p></li><li><p><code>type</code> å±æ€§ï¼šæŒ‡å®šå±æ€§çš„æ•°æ®ç±»å‹ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="-5"><a href="#-5" class="headerlink" title="&lt;many-to-one&gt;"></a><code>&lt;many-to-one&gt;</code></h3><p><code>&lt;many-to-one&gt;</code> æ ‡ç­¾ç”¨äºæ˜ å°„å¤šå¯¹ä¸€çš„å…³è”å…³ç³»ï¼Œä¾‹å¦‚å¤šä¸ªç”¨æˆ·å±äºä¸€ä¸ªéƒ¨é—¨ã€‚</p><ul><li><p><code>name</code> å±æ€§ï¼šæŒ‡å®š Java ç±»ä¸­å…³è”å¯¹è±¡çš„å±æ€§åã€‚</p></li><li><p><code>column</code> å±æ€§ï¼šæŒ‡å®šæ•°æ®åº“è¡¨ä¸­ç”¨äºå…³è”çš„å¤–é”®åˆ—åã€‚</p></li><li><p><code>class</code> å±æ€§ï¼šæŒ‡å®šå…³è”å¯¹è±¡çš„ Java ç±»å…¨é™å®šåã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">&quot;department&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Department&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="-6"><a href="#-6" class="headerlink" title="&lt;one-to-many&gt;"></a><code>&lt;one-to-many&gt;</code></h3><p><code>&lt;one-to-many&gt;</code> æ ‡ç­¾ç”¨äºæ˜ å°„ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ï¼Œä¾‹å¦‚ä¸€ä¸ªéƒ¨é—¨æœ‰å¤šä¸ªç”¨æˆ·ã€‚</p><ul><li><p><code>name</code> å±æ€§ï¼šæŒ‡å®š Java ç±»ä¸­å…³è”å¯¹è±¡é›†åˆçš„å±æ€§åã€‚</p></li><li><p><code>class</code> å±æ€§ï¼šæŒ‡å®šå…³è”å¯¹è±¡çš„ Java ç±»å…¨é™å®šåã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">name</span>=<span class="string">&quot;users&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.User&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="-7"><a href="#-7" class="headerlink" title="&lt;set&gt;"></a><code>&lt;set&gt;</code></h3><p><code>&lt;set&gt;</code> æ ‡ç­¾ç”¨äºæ˜ å°„ Java ç±»ä¸­çš„é›†åˆå±æ€§ï¼Œé€šå¸¸ä¸ <code>&lt;one-to-many&gt;</code> æˆ– <code>&lt;many-to-many&gt;</code> å…³è”ä½¿ç”¨ã€‚</p><ul><li><p><code>name</code> å±æ€§ï¼šæŒ‡å®š Java ç±»ä¸­çš„é›†åˆå±æ€§åã€‚</p></li><li><p><code>table</code> å±æ€§ï¼šæŒ‡å®šå…³è”è¡¨åï¼ˆåœ¨å¤šå¯¹å¤šå…³ç³»ä¸­ä½¿ç”¨ï¼‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">&quot;users&quot;</span> <span class="attr">table</span>=<span class="string">&quot;user_department&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">&quot;com.example.User&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="-8"><a href="#-8" class="headerlink" title="&lt;Bag&gt;"></a><code>&lt;Bag&gt;</code></h3><p>åœ¨ Hibernate XML æ˜ å°„æ–‡ä»¶é‡Œï¼Œ<code>&lt;bag&gt;</code>æ ‡ç­¾ç”¨äºæ˜ å°„ Java ç±»ä¸­çš„é›†åˆå±æ€§ï¼Œå®ƒè¡¨ç¤ºæ— åºä¸”å¯é‡å¤çš„é›†åˆï¼Œç±»ä¼¼äº Java é‡Œçš„<code>java.util.Collection</code>ã€‚ä¸‹é¢ä¸ºä½ è¯¦ç»†ä»‹ç»å…¶ç”¨æ³•å’Œç›¸å…³å±æ€§ï¼š</p><h4 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h4><p><code>&lt;bag&gt;</code>æ ‡ç­¾å¸¸è¢«ç”¨äºæ˜ å°„ä¸€å¯¹å¤šæˆ–è€…å¤šå¯¹å¤šçš„å…³è”å…³ç³»ã€‚å®ƒä¸€èˆ¬å’Œ<code>&lt;key&gt;</code>ã€<code>&lt;one-to-many&gt;</code>æˆ–è€…<code>&lt;many-to-many&gt;</code>æ ‡ç­¾æ­é…ä½¿ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">&quot;com.example.Department&quot;</span> <span class="attr">table</span>=<span class="string">&quot;departments&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">&quot;native&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bag</span> <span class="attr">name</span>=<span class="string">&quot;employees&quot;</span> <span class="attr">table</span>=<span class="string">&quot;dept_emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Employee&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>Department</code>ç±»æœ‰ä¸€ä¸ª<code>employees</code>å±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— åºä¸”å¯é‡å¤çš„<code>Employee</code>å¯¹è±¡é›†åˆã€‚<code>&lt;bag&gt;</code>æ ‡ç­¾å®šä¹‰äº†è¿™ä¸ªé›†åˆå±æ€§çš„æ˜ å°„ï¼Œ<code>&lt;key&gt;</code>æ ‡ç­¾æŒ‡æ˜äº†å…³è”è¡¨ä¸­çš„å¤–é”®åˆ—ï¼Œ<code>&lt;one-to-many&gt;</code>æ ‡ç­¾è¡¨æ˜äº†ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ã€‚</p><h4 id="å¸¸ç”¨å±æ€§"><a href="#å¸¸ç”¨å±æ€§" class="headerlink" title="å¸¸ç”¨å±æ€§"></a>å¸¸ç”¨å±æ€§</h4><ul><li><p><strong><code>name</code></strong>ï¼šæŒ‡å®š Java ç±»ä¸­çš„é›†åˆå±æ€§åï¼Œå°±åƒä¸Šé¢ä¾‹å­ä¸­çš„<code>employees</code>ã€‚</p></li><li><p><strong><code>table</code></strong>ï¼šæŒ‡å®šå…³è”è¡¨åï¼Œåœ¨ä¸€å¯¹å¤šæˆ–è€…å¤šå¯¹å¤šå…³ç³»é‡Œä½¿ç”¨ã€‚æ¯”å¦‚åœ¨å¤šå¯¹å¤šå…³ç³»ä¸­ï¼Œéœ€è¦ä¸€ä¸ªä¸­é—´è¡¨æ¥å­˜å‚¨å…³è”ä¿¡æ¯ï¼Œ<code>table</code>å±æ€§å°±æŒ‡å®šäº†è¿™ä¸ªä¸­é—´è¡¨çš„åç§°ã€‚</p></li><li><p><strong><code>cascade</code></strong>ï¼šå®šä¹‰çº§è”æ“ä½œï¼Œå®ƒç¡®å®šäº†åœ¨å¯¹çˆ¶å¯¹è±¡æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆå¦‚ä¿å­˜ã€æ›´æ–°ã€åˆ é™¤ï¼‰æ—¶ï¼Œæ˜¯å¦è¦å¯¹å…³è”å¯¹è±¡ä¹Ÿæ‰§è¡Œç›¸åŒæ“ä½œã€‚å¸¸è§çš„å€¼æœ‰<code>save-update</code>ã€<code>delete</code>ã€<code>all</code>ç­‰ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bag</span> <span class="attr">name</span>=<span class="string">&quot;employees&quot;</span> <span class="attr">table</span>=<span class="string">&quot;dept_emp&quot;</span> <span class="attr">cascade</span>=<span class="string">&quot;save-update&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Employee&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bag</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong><code>inverse</code></strong>ï¼šæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥æŒ‡å®šå…³è”å…³ç³»çš„æ§åˆ¶æƒåœ¨å“ªä¸€æ–¹ã€‚è‹¥è®¾ä¸º<code>true</code>ï¼Œåˆ™è¡¨ç¤ºå…³è”å…³ç³»çš„ç»´æŠ¤ç”±å¦ä¸€æ–¹è´Ÿè´£ï¼›è‹¥è®¾ä¸º<code>false</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™å½“å‰å¯¹è±¡è´Ÿè´£ç»´æŠ¤å…³è”å…³ç³»ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bag</span> <span class="attr">name</span>=<span class="string">&quot;employees&quot;</span> <span class="attr">table</span>=<span class="string">&quot;dept_emp&quot;</span> <span class="attr">inverse</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Employee&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bag</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>ä¸<code>&lt;set&gt;</code>æ ‡ç­¾å¯¹æ¯”</p><p>å’Œ<code>&lt;set&gt;</code>æ ‡ç­¾ä¸åŒï¼Œ<code>&lt;bag&gt;</code>å…è®¸é›†åˆä¸­æœ‰é‡å¤å…ƒç´ ï¼Œè€Œ<code>&lt;set&gt;</code>è¦æ±‚å…ƒç´ å”¯ä¸€ã€‚æ‰€ä»¥ï¼Œå½“ä½ éœ€è¦ä¸€ä¸ªå¯åŒ…å«é‡å¤å…ƒç´ çš„é›†åˆæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>&lt;bag&gt;</code>æ ‡ç­¾ã€‚ </p><h3 id="-9"><a href="#-9" class="headerlink" title="&lt;discriminator&gt;"></a><code>&lt;discriminator&gt;</code></h3><p>åœ¨ Hibernate çš„ XML é…ç½®æ–‡ä»¶é‡Œï¼Œ<code>&lt;discriminator&gt;</code>æ ‡ç­¾ä¸»è¦ç”¨äºå®ç°ç»§æ‰¿æ˜ å°„ã€‚å½“ Java ç±»å­˜åœ¨ç»§æ‰¿å…³ç³»æ—¶ï¼Œè¯¥æ ‡ç­¾èƒ½å¤ŸæŠŠè¿™äº›å…·æœ‰ç»§æ‰¿å…³ç³»çš„ç±»æ˜ å°„åˆ°æ•°æ®åº“çš„åŒä¸€å¼ è¡¨ä¸­ï¼Œå€ŸåŠ©ä¸€ä¸ªç‰¹å®šçš„åˆ—æ¥åŒºåˆ†ä¸åŒçš„å­ç±»ã€‚ä¸‹é¢ä¸ºä½ è¯¦ç»†ä»‹ç»å…¶ä½¿ç”¨æ–¹å¼å’Œç›¸å…³å±æ€§ã€‚</p><h4 id="åŸºæœ¬ä½¿ç”¨åœºæ™¯"><a href="#åŸºæœ¬ä½¿ç”¨åœºæ™¯" class="headerlink" title="åŸºæœ¬ä½¿ç”¨åœºæ™¯"></a>åŸºæœ¬ä½¿ç”¨åœºæ™¯</h4><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªå­ç±»ç»§æ‰¿è‡ªåŒä¸€ä¸ªçˆ¶ç±»çš„æƒ…å†µã€‚è‹¥æŠŠè¿™äº›å­ç±»åˆ†åˆ«æ˜ å°„åˆ°ä¸åŒçš„æ•°æ®åº“è¡¨ï¼Œä¼šä½¿æ•°æ®åº“ç»“æ„å˜å¾—å¤æ‚ã€‚é€šè¿‡<code>&lt;discriminator&gt;</code>æ ‡ç­¾ï¼Œå¯å°†æ‰€æœ‰å­ç±»çš„æ•°æ®å­˜å‚¨åœ¨åŒä¸€å¼ è¡¨ä¸­ï¼Œå†ç”¨ä¸€ä¸ªç‰¹æ®Šçš„åˆ—æ¥è¾¨åˆ«ä¸åŒçš„å­ç±»ã€‚</p><h4 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">&quot;com.example.Animal&quot;</span> <span class="attr">table</span>=<span class="string">&quot;animals&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;animal_id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">&quot;native&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">column</span>=<span class="string">&quot;animal_type&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">subclass</span> <span class="attr">name</span>=<span class="string">&quot;com.example.Dog&quot;</span> <span class="attr">discriminator-value</span>=<span class="string">&quot;dog&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Dog ç±»ç‰¹æœ‰çš„å±æ€§æ˜ å°„ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">subclass</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">subclass</span> <span class="attr">name</span>=<span class="string">&quot;com.example.Cat&quot;</span> <span class="attr">discriminator-value</span>=<span class="string">&quot;cat&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Cat ç±»ç‰¹æœ‰çš„å±æ€§æ˜ å°„ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">subclass</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼š</p><ul><li><code>Animal</code>æ˜¯çˆ¶ç±»ï¼Œ<code>Dog</code>å’Œ<code>Cat</code>æ˜¯å®ƒçš„å­ç±»ã€‚</li><li><code>&lt;discriminator&gt;</code>æ ‡ç­¾æŒ‡å®šäº†ä¸€ä¸ªåä¸º<code>animal_type</code>çš„åˆ—ï¼Œæ•°æ®ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å­ç±»ã€‚</li><li><code>&lt;subclass&gt;</code>æ ‡ç­¾å®šä¹‰äº†å­ç±»çš„æ˜ å°„ï¼Œ<code>discriminator-value</code>å±æ€§æŒ‡å®šäº†è¯¥å­ç±»åœ¨<code>animal_type</code>åˆ—ä¸­å¯¹åº”çš„å€¼ã€‚</li></ul><h4 id="å¸¸ç”¨å±æ€§-1"><a href="#å¸¸ç”¨å±æ€§-1" class="headerlink" title="å¸¸ç”¨å±æ€§"></a>å¸¸ç”¨å±æ€§</h4><ul><li><strong><code>column</code></strong>ï¼šæŒ‡å®šæ•°æ®åº“è¡¨ä¸­ç”¨äºåŒºåˆ†ä¸åŒå­ç±»çš„åˆ—åã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>column=&quot;animal_type&quot;</code>è¡¨ç¤ºä½¿ç”¨<code>animal_type</code>åˆ—æ¥å­˜å‚¨å­ç±»çš„åŒºåˆ†ä¿¡æ¯ã€‚</li><li><strong><code>type</code></strong>ï¼šæŒ‡å®šåŒºåˆ†åˆ—çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚<code>string</code>ã€<code>integer</code>ç­‰ã€‚</li></ul><h4 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h4><p>å½“ Hibernate ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®æ—¶ï¼Œä¼šä¾æ®<code>&lt;discriminator&gt;</code>æ ‡ç­¾æŒ‡å®šçš„åˆ—çš„å€¼æ¥åˆ¤æ–­åº”è¯¥å°†æ•°æ®å®ä¾‹åŒ–ä¸ºå“ªä¸ªå­ç±»çš„å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œè‹¥<code>animal_type</code>åˆ—çš„å€¼ä¸º<code>dog</code>ï¼ŒHibernate å°±ä¼šæŠŠæ•°æ®å®ä¾‹åŒ–ä¸º<code>Dog</code>ç±»çš„å¯¹è±¡ï¼›è‹¥å€¼ä¸º<code>cat</code>ï¼Œåˆ™å®ä¾‹åŒ–ä¸º<code>Cat</code>ç±»çš„å¯¹è±¡ã€‚</p><h4 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><ul><li><strong>ç®€åŒ–æ•°æ®åº“ç»“æ„</strong>ï¼šé¿å…ä¸ºæ¯ä¸ªå­ç±»åˆ›å»ºå•ç‹¬çš„è¡¨ï¼Œå‡å°‘äº†æ•°æ®åº“è¡¨çš„æ•°é‡ï¼Œä½¿æ•°æ®åº“ç»“æ„æ›´åŠ ç®€æ´ã€‚</li><li><strong>æé«˜æ•°æ®æŸ¥è¯¢æ•ˆç‡</strong>ï¼šå› ä¸ºæ‰€æœ‰å­ç±»çš„æ•°æ®éƒ½å­˜å‚¨åœ¨åŒä¸€å¼ è¡¨ä¸­ï¼ŒæŸ¥è¯¢æ—¶æ— éœ€è¿›è¡Œå¤æ‚çš„è¡¨è¿æ¥æ“ä½œï¼Œæé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><ul><li><strong>åŒºåˆ†åˆ—çš„å”¯ä¸€æ€§</strong>ï¼š<code>discriminator-value</code>å±æ€§çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå¦åˆ™ä¼šå¯¼è‡´ Hibernate åœ¨å®ä¾‹åŒ–å¯¹è±¡æ—¶å‡ºç°æ··æ·†ã€‚</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šåœ¨æ’å…¥æ•°æ®æ—¶ï¼Œè¦ç¡®ä¿åŒºåˆ†åˆ—çš„å€¼ä¸<code>&lt;subclass&gt;</code>æ ‡ç­¾ä¸­<code>discriminator-value</code>å±æ€§çš„å€¼ä¸€è‡´ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ul><h3 id="-10"><a href="#-10" class="headerlink" title="&lt;key&gt;"></a><code>&lt;key&gt;</code></h3><p><code>&lt;key&gt;</code> æ ‡ç­¾ç”¨äºæŒ‡å®šå…³è”è¡¨ä¸­çš„å¤–é”®åˆ—ï¼Œé€šå¸¸åœ¨ <code>&lt;set&gt;</code> æˆ– <code>&lt;list&gt;</code> æ ‡ç­¾ä¸­ä½¿ç”¨ã€‚</p><ul><li><p><code>column</code> å±æ€§ï¼šæŒ‡å®šå¤–é”®åˆ—åã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>è¿™äº›æ ‡ç­¾æ˜¯ Hibernate XML æ˜ å°„æ–‡ä»¶ä¸­æœ€å¸¸ç”¨çš„éƒ¨åˆ†ï¼Œé€šè¿‡åˆç†ä½¿ç”¨å®ƒä»¬ï¼Œå¯ä»¥å®ç° Java ç±»å’Œæ•°æ®åº“è¡¨ä¹‹é—´çš„çµæ´»æ˜ å°„ã€‚</p><h2 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h2><p>Hibernate æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒå…è®¸ä½ é€šè¿‡å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰çš„æ–¹å¼æ¥æ“ä½œæ•°æ®åº“ã€‚ä»¥ä¸‹æ˜¯ Hibernate ä¸­ä¸€äº›å¸¸ç”¨çš„æ³¨è§£ï¼š</p><ol><li><p><strong>@Entity</strong>ï¼šç”¨äºæ ‡æ³¨å®ä½“ç±»ï¼Œè¡¨ç¤ºè¯¥ç±»å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>@Table</strong>ï¼šä¸ <code>@Entity</code> ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‡å®šå®ä½“ç±»æ‰€å¯¹åº”çš„æ•°æ®åº“è¡¨åã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨ç±»åä½œä¸ºè¡¨åã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>@Id</strong>ï¼šæ ‡è®°å±æ€§ä¸ºä¸»é”®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure></li><li><p><strong>@GeneratedValue</strong>ï¼šå®šä¹‰ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure><p>å¸¸è§çš„ç”Ÿæˆç­–ç•¥æœ‰ <code>AUTO</code>, <code>IDENTITY</code>, <code>SEQUENCE</code>, å’Œ <code>TABLE</code>ã€‚</p></li><li><p><strong>@Column</strong>ï¼šç”¨äºæè¿°å®ä½“ç±»ä¸­çš„å­—æ®µå¦‚ä½•æ˜ å°„åˆ°æ•°æ®åº“è¡¨ä¸­çš„åˆ—ã€‚å¯ä»¥æŒ‡å®šåˆ—åã€æ˜¯å¦å…è®¸ä¸ºç©ºç­‰å±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column(name = &quot;user_name&quot;, nullable = false, length = 30)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure></li><li><p><strong>@Transient</strong>ï¼šè¡¨ç¤ºæŸä¸ªå±æ€§ä¸ä¼šè¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> String tempValue;</span><br></pre></td></tr></table></figure></li><li><p><strong>@ManyToOne</strong>, <strong>@OneToMany</strong>, <strong>@OneToOne</strong>, <strong>@ManyToMany</strong>ï¼šç”¨äºå®šä¹‰å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚ä¾‹å¦‚ï¼Œ<code>@ManyToOne</code> è¡¨ç¤ºå¤šå¯¹ä¸€çš„å…³ç³»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ManyToOne</span></span><br><span class="line"><span class="meta">@JoinColumn(name = &quot;department_id&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Department department;</span><br></pre></td></tr></table></figure></li><li><p><strong>@JoinColumn</strong>ï¼šç”¨äºæŒ‡å®šè¿æ¥åˆ—ï¼ˆå¤–é”®ï¼‰ï¼Œé€šå¸¸åœ¨å®šä¹‰å…³è”å…³ç³»æ—¶ä½¿ç”¨ã€‚</p></li><li><p><strong>@Embedded</strong>, <strong>@Embeddable</strong>ï¼šç”¨äºç»„åˆæ¨¡å¼ï¼Œ<code>@Embeddable</code> æ ‡è®°çš„ç±»å¯ä»¥åœ¨å…¶ä»–å®ä½“ä¸­åµŒå…¥ä½¿ç”¨ï¼Œè€Œ <code>@Embedded</code> ç”¨æ¥åµŒå…¥è¿™äº›å¯åµŒå…¥çš„å¯¹è±¡ã€‚</p></li><li><p><strong>@Formula</strong>ï¼šç”¨äºå®šä¹‰åŸºäºSQLå…¬å¼æˆ–å­æŸ¥è¯¢çš„è™šæ‹Ÿå±æ€§ã€‚</p></li></ol><p>ä»¥ä¸Šä»…æ˜¯éƒ¨åˆ†å¸¸ç”¨çš„ Hibernate æ³¨è§£ï¼Œæ ¹æ®å®é™…éœ€è¦å¯èƒ½è¿˜ä¼šæ¶‰åŠåˆ°æ›´å¤šé«˜çº§ç‰¹æ€§å’Œæ³¨è§£ã€‚ä½¿ç”¨è¿™äº›æ³¨è§£å¯ä»¥å¤§å¤§ç®€åŒ–Javaåº”ç”¨ç¨‹åºä¸æ•°æ®åº“äº¤äº’çš„ä»£ç ã€‚</p><h2 id="Session-å’Œ-SessionFactory"><a href="#Session-å’Œ-SessionFactory" class="headerlink" title="Session å’Œ SessionFactory"></a>Session å’Œ SessionFactory</h2><p>åœ¨ Hibernate ä¸­ï¼Œ<code>Session</code> å’Œ <code>SessionFactory</code> æ˜¯æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†ä¸æ•°æ®åº“çš„äº¤äº’ä»¥åŠå¯¹è±¡æŒä¹…åŒ–ã€‚å®ƒä»¬ä¸ Hibernate çš„ç¼“å­˜æœºåˆ¶å¯†åˆ‡ç›¸å…³ï¼Œå…±åŒå½±å“åº”ç”¨çš„æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§ã€‚ä¸‹é¢è¯¦ç»†è§£é‡Š <code>Session</code>ã€<code>SessionFactory</code>ã€ç¼“å­˜æœºåˆ¶åŠå…¶ç›¸å…³æ€§ã€‚</p><hr><h3 id="1-Session"><a href="#1-Session" class="headerlink" title="1. Session"></a><strong>1. Session</strong></h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a><strong>å®šä¹‰</strong></h4><p><code>Session</code> æ˜¯ Hibernate çš„æ ¸å¿ƒæ¥å£ï¼ˆ<code>org.hibernate.Session</code>ï¼‰ï¼Œç”¨äºæ‰§è¡Œæ•°æ®åº“æ“ä½œï¼ˆå¦‚å¢åˆ æ”¹æŸ¥ï¼‰ï¼Œæ˜¯åº”ç”¨ç¨‹åºä¸æ•°æ®åº“äº¤äº’çš„ä¸»è¦å…¥å£ã€‚å®ƒå°è£…äº† JDBC è¿æ¥ï¼Œç®¡ç†å®ä½“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ª<strong>ä¸€çº§ç¼“å­˜</strong>ï¼ˆPersistence Contextï¼‰ã€‚</p><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a><strong>ç‰¹ç‚¹</strong></h4><ul><li><strong>éçº¿ç¨‹å®‰å…¨</strong>ï¼š<code>Session</code> è®¾è®¡ä¸ºå•çº¿ç¨‹ä½¿ç”¨ï¼Œä¸åº”åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«ã€‚æ¯ä¸ªçº¿ç¨‹æˆ–è¯·æ±‚é€šå¸¸éœ€è¦ç‹¬ç«‹çš„ <code>Session</code>ã€‚</li><li><strong>çŸ­ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š<code>Session</code> é€šå¸¸åœ¨ä¸€æ¬¡æ•°æ®åº“æ“ä½œæˆ–äº‹åŠ¡ä¸­åˆ›å»ºï¼Œç”¨å®Œåå…³é—­ï¼Œé¿å…èµ„æºæ³„æ¼ã€‚</li><li><strong>ä¸€çº§ç¼“å­˜</strong>ï¼š<code>Session</code> å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªç¼“å­˜ï¼Œå­˜å‚¨å½“å‰ä¼šè¯ä¸­çš„å®ä½“å¯¹è±¡ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®ã€‚</li><li><strong>ä»£ç† JDBC è¿æ¥</strong>ï¼š<code>Session</code> é€šè¿‡åº•å±‚çš„ JDBC è¿æ¥ä¸æ•°æ®åº“é€šä¿¡ï¼Œä½†å¼€å‘è€…æ— éœ€ç›´æ¥æ“ä½œ JDBCã€‚</li></ul><h4 id="ä¸»è¦åŠŸèƒ½"><a href="#ä¸»è¦åŠŸèƒ½" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a><strong>ä¸»è¦åŠŸèƒ½</strong></h4><ul><li><strong>CRUD æ“ä½œ</strong>ï¼šä¿å­˜ï¼ˆ<code>save</code>ï¼‰ã€æ›´æ–°ï¼ˆ<code>update</code>ï¼‰ã€åˆ é™¤ï¼ˆ<code>delete</code>ï¼‰ã€æŸ¥è¯¢ï¼ˆ<code>get</code>ã€<code>load</code>ï¼‰ã€‚</li><li><strong>æŸ¥è¯¢æ‰§è¡Œ</strong>ï¼šæ”¯æŒ HQLï¼ˆ<code>createQuery</code>ï¼‰ã€Criteria APIã€åŸç”Ÿ SQLã€‚</li><li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šé€šè¿‡ <code>beginTransaction</code> å¼€å¯äº‹åŠ¡ï¼Œç®¡ç†æ•°æ®åº“æ“ä½œã€‚</li><li><strong>ç¼“å­˜ç®¡ç†</strong>ï¼šç»´æŠ¤ä¸€çº§ç¼“å­˜ï¼Œè‡ªåŠ¨å¤„ç†è„æ£€æŸ¥ï¼ˆDirty Checkingï¼‰ã€‚</li></ul><h4 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a><strong>å¸¸ç”¨æ–¹æ³•</strong></h4><ul><li><code>save(Object)</code>ï¼šä¿å­˜å®ä½“ï¼Œè¿”å›æ ‡è¯†ç¬¦ã€‚</li><li><code>update(Object)</code>ï¼šæ›´æ–°å®ä½“ã€‚</li><li><code>merge(Object)</code>ï¼šåˆå¹¶ detached çŠ¶æ€çš„å®ä½“ã€‚</li><li><code>delete(Object)</code>ï¼šåˆ é™¤å®ä½“ã€‚</li><li><code>get(Class, Serializable)</code>ï¼šæ ¹æ® ID ç«‹å³åŠ è½½å®ä½“ã€‚</li><li><code>load(Class, Serializable)</code>ï¼šå»¶è¿ŸåŠ è½½å®ä½“ã€‚</li><li><code>createQuery(String)</code>ï¼šåˆ›å»º HQL æŸ¥è¯¢ã€‚</li><li><code>flush()</code>ï¼šåŒæ­¥æŒä¹…åŒ–ä¸Šä¸‹æ–‡åˆ°æ•°æ®åº“ã€‚</li><li><code>clear()</code>ï¼šæ¸…ç©ºä¸€çº§ç¼“å­˜ã€‚</li><li><code>beginTransaction()</code>ï¼šå¼€å¯äº‹åŠ¡ã€‚</li></ul><h4 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a><strong>ç”Ÿå‘½å‘¨æœŸ</strong></h4><ol><li>åˆ›å»ºï¼šé€šè¿‡ <code>SessionFactory.openSession()</code> æˆ– <code>SessionFactory.getCurrentSession()</code> è·å–ã€‚</li><li>ä½¿ç”¨ï¼šæ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œç®¡ç†å®ä½“ã€‚</li><li>å…³é—­ï¼šè°ƒç”¨ <code>close()</code> é‡Šæ”¾èµ„æºï¼ˆSpring å¯è‡ªåŠ¨ç®¡ç†ï¼‰ã€‚</li></ol><hr><h3 id="2-SessionFactory"><a href="#2-SessionFactory" class="headerlink" title="2. SessionFactory"></a><strong>2. SessionFactory</strong></h3><h4 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a><strong>å®šä¹‰</strong></h4><p><code>SessionFactory</code> æ˜¯ Hibernate çš„å·¥å‚æ¥å£ï¼ˆ<code>org.hibernate.SessionFactory</code>ï¼‰ï¼Œè´Ÿè´£åˆ›å»º <code>Session</code> å®ä¾‹ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>çº¿ç¨‹å®‰å…¨</strong>çš„å…¨å±€å¯¹è±¡ï¼Œåˆå§‹åŒ–æ—¶åŠ è½½ Hibernate é…ç½®å’Œæ˜ å°„å…ƒæ•°æ®ã€‚</p><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a><strong>ç‰¹ç‚¹</strong></h4><ul><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<code>SessionFactory</code> å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«ï¼Œé€šå¸¸åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºå•ä¸€å®ä¾‹ã€‚</li><li><strong>é‡é‡çº§å¯¹è±¡</strong>ï¼šåˆ›å»º <code>SessionFactory</code> å¼€é”€å¤§ï¼Œå› ä¸ºå®ƒéœ€è¦è§£æé…ç½®æ–‡ä»¶ã€æ˜ å°„å…ƒæ•°æ®å¹¶å»ºç«‹æ•°æ®åº“è¿æ¥æ± ã€‚</li><li><strong>å…¨å±€å•ä¾‹</strong>ï¼šæ•´ä¸ªåº”ç”¨é€šå¸¸åªæœ‰ä¸€ä¸ª <code>SessionFactory</code>ï¼Œé™¤éä½¿ç”¨å¤šä¸ªæ•°æ®åº“ã€‚</li><li><strong>é…ç½®ä¸­å¿ƒ</strong>ï¼šå­˜å‚¨ Hibernate é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€æ–¹è¨€ã€ç¼“å­˜è®¾ç½®ï¼‰å’Œå®ä½“æ˜ å°„ä¿¡æ¯ã€‚</li></ul><h4 id="ä¸»è¦åŠŸèƒ½-1"><a href="#ä¸»è¦åŠŸèƒ½-1" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a><strong>ä¸»è¦åŠŸèƒ½</strong></h4><ul><li>åˆ›å»º <code>Session</code> å®ä¾‹ã€‚</li><li>ç®¡ç† Hibernate é…ç½®å’Œå…ƒæ•°æ®ã€‚</li><li>æä¾›å¯¹äºŒçº§ç¼“å­˜ï¼ˆå¦‚æœå¯ç”¨ï¼‰çš„è®¿é—®ã€‚</li></ul><h4 id="å¸¸ç”¨æ–¹æ³•-1"><a href="#å¸¸ç”¨æ–¹æ³•-1" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a><strong>å¸¸ç”¨æ–¹æ³•</strong></h4><ul><li><code>openSession()</code>ï¼šåˆ›å»ºæ–°çš„ <code>Session</code>ï¼Œéœ€æ‰‹åŠ¨å…³é—­ã€‚</li><li><code>getCurrentSession()</code>ï¼šè·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„ <code>Session</code>ï¼ˆéœ€é…ç½®äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼ŒSpring å¸¸ç”¨ï¼‰ã€‚</li><li><code>close()</code>ï¼šå…³é—­å·¥å‚ï¼Œé‡Šæ”¾èµ„æºï¼ˆé€šå¸¸åœ¨åº”ç”¨å…³é—­æ—¶è°ƒç”¨ï¼‰ã€‚</li></ul><h4 id="ç”Ÿå‘½å‘¨æœŸ-1"><a href="#ç”Ÿå‘½å‘¨æœŸ-1" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a><strong>ç”Ÿå‘½å‘¨æœŸ</strong></h4><ol><li>åˆå§‹åŒ–ï¼šåº”ç”¨å¯åŠ¨æ—¶ï¼Œé€šè¿‡ <code>Configuration</code> æˆ– Spring é…ç½®åˆ›å»º <code>SessionFactory</code>ã€‚</li><li>ä½¿ç”¨ï¼šæä¾› <code>Session</code> å®ä¾‹ï¼ŒæœåŠ¡æ•´ä¸ªåº”ç”¨ã€‚</li><li>é”€æ¯ï¼šåº”ç”¨å…³é—­æ—¶è°ƒç”¨ <code>close()</code> é‡Šæ”¾èµ„æºã€‚</li></ol><hr><h3 id="3-Hibernate-ç¼“å­˜æœºåˆ¶"><a href="#3-Hibernate-ç¼“å­˜æœºåˆ¶" class="headerlink" title="3. Hibernate ç¼“å­˜æœºåˆ¶"></a><strong>3. Hibernate ç¼“å­˜æœºåˆ¶</strong></h3><p>Hibernate æä¾›ä¸¤çº§ç¼“å­˜æœºåˆ¶ï¼Œç”¨äºå‡å°‘æ•°æ®åº“è®¿é—®ï¼Œæé«˜æ€§èƒ½ï¼š<strong>ä¸€çº§ç¼“å­˜</strong>ï¼ˆä¸ <code>Session</code> ç›¸å…³ï¼‰å’Œ<strong>äºŒçº§ç¼“å­˜</strong>ï¼ˆä¸ <code>SessionFactory</code> ç›¸å…³ï¼‰ã€‚</p><h4 id="ä¸€çº§ç¼“å­˜ï¼ˆFirst-Level-Cacheï¼‰"><a href="#ä¸€çº§ç¼“å­˜ï¼ˆFirst-Level-Cacheï¼‰" class="headerlink" title="ä¸€çº§ç¼“å­˜ï¼ˆFirst-Level Cacheï¼‰"></a><strong>ä¸€çº§ç¼“å­˜ï¼ˆFirst-Level Cacheï¼‰</strong></h4><ul><li><strong>å®šä¹‰</strong>ï¼šä¸€çº§ç¼“å­˜æ˜¯ <code>Session</code> çº§åˆ«çš„ç¼“å­˜ï¼Œè‡ªåŠ¨å¯ç”¨ï¼Œå­˜å‚¨å½“å‰ <code>Session</code> å†…çš„å®ä½“å¯¹è±¡ã€‚ä¹Ÿè¢«ç§°ä¸º<strong>æŒä¹…åŒ–ä¸Šä¸‹æ–‡</strong>ï¼ˆPersistence Contextï¼‰ã€‚</li><li><strong>ä½œç”¨</strong>ï¼š<ul><li>ç¼“å­˜å®ä½“å¯¹è±¡ï¼Œé¿å…é‡å¤æŸ¥è¯¢æ•°æ®åº“ã€‚</li><li>å®ç°è„æ£€æŸ¥ï¼Œè‡ªåŠ¨æ£€æµ‹å®ä½“å˜åŒ–å¹¶åŒæ­¥åˆ°æ•°æ®åº“ã€‚</li><li>ç®¡ç†å®ä½“çŠ¶æ€ï¼ˆManagedã€Detachedã€Transientï¼‰ã€‚</li></ul></li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šä¸ <code>Session</code> ç»‘å®šï¼Œ<code>Session</code> å…³é—­æˆ–è°ƒç”¨ <code>clear()</code> æ—¶ç¼“å­˜æ¸…ç©ºã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>å¼ºåˆ¶å¯ç”¨ï¼Œæ— æ³•ç¦ç”¨ã€‚</li><li>ä»…åœ¨åŒä¸€ <code>Session</code> å†…æœ‰æ•ˆï¼Œä¸è·¨ <code>Session</code> å…±äº«ã€‚</li><li>ç¼“å­˜çš„æ˜¯å®ä½“å¯¹è±¡çš„å®Œæ•´çŠ¶æ€ï¼ˆåŒ…æ‹¬å…³è”å¯¹è±¡ï¼‰ã€‚</li></ul></li><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ul><li>å½“é€šè¿‡ <code>get()</code>ã€<code>load()</code> æˆ–æŸ¥è¯¢åŠ è½½å®ä½“æ—¶ï¼ŒHibernate å°†å®ä½“æ”¾å…¥ä¸€çº§ç¼“å­˜ã€‚</li><li>åŒä¸€ <code>Session</code> å†…é‡å¤æŸ¥è¯¢ç›¸åŒå®ä½“æ—¶ï¼Œç›´æ¥ä»ç¼“å­˜è¿”å›ï¼Œé¿å…æ•°æ®åº“è®¿é—®ã€‚</li><li>åœ¨äº‹åŠ¡æäº¤æˆ– <code>flush()</code> æ—¶ï¼ŒHibernate å¯¹æ¯”ç¼“å­˜ä¸­çš„å®ä½“ä¸æ•°æ®åº“çŠ¶æ€ï¼Œæ‰§è¡Œå¿…è¦çš„ SQL æ›´æ–°ï¼ˆè„æ£€æŸ¥ï¼‰ã€‚</li></ul></li></ul><h4 id="äºŒçº§ç¼“å­˜ï¼ˆSecond-Level-Cacheï¼‰"><a href="#äºŒçº§ç¼“å­˜ï¼ˆSecond-Level-Cacheï¼‰" class="headerlink" title="äºŒçº§ç¼“å­˜ï¼ˆSecond-Level Cacheï¼‰"></a><strong>äºŒçº§ç¼“å­˜ï¼ˆSecond-Level Cacheï¼‰</strong></h4><ul><li><strong>å®šä¹‰</strong>ï¼šäºŒçº§ç¼“å­˜æ˜¯ <code>SessionFactory</code> çº§åˆ«çš„ç¼“å­˜ï¼Œå¯é€‰å¯ç”¨ï¼Œå­˜å‚¨è·¨ <code>Session</code> çš„å®ä½“æ•°æ®æˆ–æŸ¥è¯¢ç»“æœã€‚</li><li><strong>ä½œç”¨</strong>ï¼š<ul><li>æé«˜è·¨ <code>Session</code> çš„æŸ¥è¯¢æ€§èƒ½ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®ã€‚</li><li>é€‚åˆé¢‘ç¹è¯»å–ã€ä¸å¸¸ä¿®æ”¹çš„æ•°æ®ï¼ˆå¦‚é…ç½®è¡¨ã€å­—å…¸è¡¨ï¼‰ã€‚</li></ul></li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šä¸ <code>SessionFactory</code> ç»‘å®šï¼Œåº”ç”¨è¿è¡ŒæœŸé—´æŒç»­å­˜åœ¨ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>é»˜è®¤ç¦ç”¨ï¼Œéœ€æ˜¾å¼é…ç½®ï¼ˆå¦‚ EHCacheã€Redisï¼‰ã€‚</li><li>å¯ç¼“å­˜å®ä½“ã€æŸ¥è¯¢ç»“æœæˆ–é›†åˆã€‚</li><li>è·¨ <code>Session</code> å’Œçº¿ç¨‹å…±äº«ï¼Œéœ€è€ƒè™‘å¹¶å‘ä¸€è‡´æ€§ã€‚</li></ul></li><li><strong>é…ç½®</strong>ï¼š<ul><li>å¯ç”¨äºŒçº§ç¼“å­˜ï¼šè®¾ç½® <code>hibernate.cache.use_second_level_cache=true</code>ã€‚</li><li>æŒ‡å®šç¼“å­˜æä¾›è€…ï¼ˆå¦‚ <code>org.hibernate.cache.ehcache.EhCacheRegionFactory</code>ï¼‰ã€‚</li><li>åœ¨å®ä½“ä¸Šä½¿ç”¨ <code>@Cache</code> æ³¨è§£ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery-Cacheï¼‰"><a href="#æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery-Cacheï¼‰" class="headerlink" title="æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery Cacheï¼‰"></a><strong>æŸ¥è¯¢ç¼“å­˜ï¼ˆQuery Cacheï¼‰</strong></h4><ul><li><strong>å®šä¹‰</strong>ï¼šæŸ¥è¯¢ç¼“å­˜æ˜¯äºŒçº§ç¼“å­˜çš„å­é›†ï¼Œç”¨äºç¼“å­˜ HQL&#x2F;JPQL æŸ¥è¯¢çš„ç»“æœï¼ˆä»…ç¼“å­˜å®ä½“ ID å’Œç®€å•æ•°æ®ï¼‰ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šé¿å…é‡å¤æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢ã€‚</li><li><strong>å¯ç”¨æ–¹å¼</strong>ï¼š<ul><li>è®¾ç½® <code>hibernate.cache.use_query_cache=true</code>ã€‚</li><li>åœ¨æŸ¥è¯¢æ—¶è°ƒç”¨ <code>setCacheable(true)</code>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> session.createQuery(<span class="string">&quot;from User where name = :name&quot;</span>);</span><br><span class="line">query.setParameter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">query.setCacheable(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure></li></ul></li><li><strong>æ³¨æ„</strong>ï¼šæŸ¥è¯¢ç¼“å­˜é€šå¸¸ä¸äºŒçº§ç¼“å­˜ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºæŸ¥è¯¢ç»“æœçš„å®ä½“ä»éœ€ä»äºŒçº§ç¼“å­˜åŠ è½½ã€‚</li></ul><hr><h3 id="4-Sessionã€SessionFactory-å’Œç¼“å­˜æœºåˆ¶çš„ç›¸å…³æ€§"><a href="#4-Sessionã€SessionFactory-å’Œç¼“å­˜æœºåˆ¶çš„ç›¸å…³æ€§" class="headerlink" title="4. Sessionã€SessionFactory å’Œç¼“å­˜æœºåˆ¶çš„ç›¸å…³æ€§"></a><strong>4. Sessionã€SessionFactory å’Œç¼“å­˜æœºåˆ¶çš„ç›¸å…³æ€§</strong></h3><p><code>Session</code>ã€<code>SessionFactory</code> å’Œç¼“å­˜æœºåˆ¶åœ¨ Hibernate ä¸­ç´§å¯†åä½œï¼Œå…±åŒç®¡ç†æ•°æ®è®¿é—®å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼š</p><h4 id="Session-å’Œ-SessionFactory-1"><a href="#Session-å’Œ-SessionFactory-1" class="headerlink" title="Session å’Œ SessionFactory"></a><strong>Session å’Œ SessionFactory</strong></h4><ul><li><strong>åˆ›å»ºå…³ç³»</strong>ï¼š<code>SessionFactory</code> æ˜¯å·¥å‚ï¼Œè´Ÿè´£åˆ›å»º <code>Session</code> å®ä¾‹ã€‚æ¯ä¸ª <code>Session</code> éƒ½ä¸ <code>SessionFactory</code> å…³è”ï¼Œå…±äº«å…¶é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€æ–¹è¨€ï¼‰ã€‚</li><li><strong>é…ç½®å…±äº«</strong>ï¼š<code>SessionFactory</code> æŒæœ‰ Hibernate çš„å…¨å±€é…ç½®ï¼ˆåŒ…æ‹¬æ˜ å°„å…ƒæ•°æ®ã€ç¼“å­˜è®¾ç½®ï¼‰ï¼Œ<code>Session</code> ä½¿ç”¨è¿™äº›é…ç½®æ‰§è¡Œå…·ä½“æ“ä½œã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸå·®å¼‚</strong>ï¼š<ul><li><code>SessionFactory</code> æ˜¯åº”ç”¨çº§åˆ«çš„å•ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸé•¿ã€‚</li><li><code>Session</code> æ˜¯è¯·æ±‚æˆ–äº‹åŠ¡çº§åˆ«çš„ï¼Œç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œåˆ›å»ºå’Œé”€æ¯é¢‘ç¹ã€‚</li></ul></li><li><strong>Spring é›†æˆ</strong>ï¼šåœ¨ Spring ä¸­ï¼Œ<code>SessionFactory</code> ç”±å®¹å™¨ç®¡ç†ï¼Œ<code>Session</code> é€šè¿‡ <code>getCurrentSession()</code> æˆ– Spring çš„ <code>@Transactional</code> è‡ªåŠ¨ç®¡ç†ã€‚</li></ul><h4 id="Session-å’Œä¸€çº§ç¼“å­˜"><a href="#Session-å’Œä¸€çº§ç¼“å­˜" class="headerlink" title="Session å’Œä¸€çº§ç¼“å­˜"></a><strong>Session å’Œä¸€çº§ç¼“å­˜</strong></h4><ul><li><strong>ç›´æ¥å…³è”</strong>ï¼šä¸€çº§ç¼“å­˜æ˜¯ <code>Session</code> çš„å†…ç½®åŠŸèƒ½ï¼Œå­˜å‚¨åœ¨ <code>Session</code> çš„æŒä¹…åŒ–ä¸Šä¸‹æ–‡ä¸­ã€‚</li><li><strong>ç¼“å­˜ä½œç”¨</strong>ï¼š<ul><li>åŒä¸€ <code>Session</code> å†…ï¼Œé‡å¤æŸ¥è¯¢ç›¸åŒå®ä½“ï¼ˆå¦‚ <code>get(User.class, id)</code>ï¼‰ç›´æ¥ä»ä¸€çº§ç¼“å­˜è¿”å›ã€‚</li><li>è„æ£€æŸ¥ä¾èµ–ä¸€çº§ç¼“å­˜ï¼ŒHibernate åœ¨ <code>flush()</code> æˆ–äº‹åŠ¡æäº¤æ—¶å¯¹æ¯”ç¼“å­˜ä¸­çš„å®ä½“çŠ¶æ€ã€‚</li></ul></li><li><strong>ç®¡ç†æ–¹å¼</strong>ï¼š<ul><li>è°ƒç”¨ <code>Session.clear()</code> æ¸…ç©ºä¸€çº§ç¼“å­˜ã€‚</li><li>è°ƒç”¨ <code>Session.evict(Object)</code> ç§»é™¤ç‰¹å®šå®ä½“ã€‚</li><li><code>Session</code> å…³é—­æ—¶ï¼Œä¸€çº§ç¼“å­˜è‡ªåŠ¨å¤±æ•ˆã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> sessionFactory.openSession();</span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> session.beginTransaction();</span><br><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> session.get(User.class, <span class="number">1L</span>); <span class="comment">// æŸ¥è¯¢æ•°æ®åº“ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> session.get(User.class, <span class="number">1L</span>); <span class="comment">// ç›´æ¥ä»ä¸€çº§ç¼“å­˜è¿”å›</span></span><br><span class="line">tx.commit();</span><br><span class="line">session.close(); <span class="comment">// ä¸€çº§ç¼“å­˜å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="SessionFactory-å’ŒäºŒçº§ç¼“å­˜"><a href="#SessionFactory-å’ŒäºŒçº§ç¼“å­˜" class="headerlink" title="SessionFactory å’ŒäºŒçº§ç¼“å­˜"></a><strong>SessionFactory å’ŒäºŒçº§ç¼“å­˜</strong></h4><ul><li><strong>ç®¡ç†å…³ç³»</strong>ï¼šäºŒçº§ç¼“å­˜ç”± <code>SessionFactory</code> ç®¡ç†ï¼Œè·¨ <code>Session</code> å…±äº«ã€‚<code>SessionFactory</code> è´Ÿè´£åˆå§‹åŒ–ç¼“å­˜æä¾›è€…ï¼ˆå¦‚ EHCacheï¼‰å¹¶ç»´æŠ¤ç¼“å­˜åŒºåŸŸã€‚</li><li><strong>ç¼“å­˜è®¿é—®</strong>ï¼š<ul><li>å½“ <code>Session</code> æŸ¥è¯¢å®ä½“æ—¶ï¼ŒHibernate å…ˆæ£€æŸ¥ä¸€çº§ç¼“å­˜ï¼Œè‹¥æœªå‘½ä¸­ï¼Œå†æ£€æŸ¥äºŒçº§ç¼“å­˜ï¼ˆè‹¥å¯ç”¨ï¼‰ã€‚</li><li>å¦‚æœäºŒçº§ç¼“å­˜å‘½ä¸­ï¼ŒHibernate ä»ç¼“å­˜åŠ è½½å®ä½“ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®ã€‚</li></ul></li><li><strong>é…ç½®ä¾èµ–</strong>ï¼šäºŒçº§ç¼“å­˜çš„é…ç½®ï¼ˆå¦‚ç¼“å­˜ç­–ç•¥ã€æä¾›è€…ï¼‰åœ¨ <code>SessionFactory</code> åˆå§‹åŒ–æ—¶è®¾ç½®ï¼Œå½±å“æ‰€æœ‰ <code>Session</code>ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Session</span> <span class="variable">session1</span> <span class="operator">=</span> sessionFactory.openSession();</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> session1.get(User.class, <span class="number">1L</span>); <span class="comment">// æŸ¥è¯¢æ•°æ®åº“ï¼Œæ”¾å…¥äºŒçº§ç¼“å­˜</span></span><br><span class="line">session1.close();</span><br><span class="line"></span><br><span class="line"><span class="type">Session</span> <span class="variable">session2</span> <span class="operator">=</span> sessionFactory.openSession();</span><br><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> session2.get(User.class, <span class="number">1L</span>); <span class="comment">// ä»äºŒçº§ç¼“å­˜åŠ è½½</span></span><br><span class="line">session2.close();</span><br></pre></td></tr></table></figure></li></ul><h4 id="Sessionã€SessionFactory-å’ŒæŸ¥è¯¢ç¼“å­˜"><a href="#Sessionã€SessionFactory-å’ŒæŸ¥è¯¢ç¼“å­˜" class="headerlink" title="Sessionã€SessionFactory å’ŒæŸ¥è¯¢ç¼“å­˜"></a><strong>Sessionã€SessionFactory å’ŒæŸ¥è¯¢ç¼“å­˜</strong></h4><ul><li><strong>åä½œæœºåˆ¶</strong>ï¼š<ul><li>æŸ¥è¯¢ç¼“å­˜å­˜å‚¨æŸ¥è¯¢ç»“æœçš„å…ƒæ•°æ®ï¼ˆå¦‚å®ä½“ IDï¼‰ï¼Œç”± <code>SessionFactory</code> ç®¡ç†ã€‚</li><li>å®é™…å®ä½“æ•°æ®ä»éœ€ä»äºŒçº§ç¼“å­˜æˆ–æ•°æ®åº“åŠ è½½ã€‚</li><li><code>Session</code> é€šè¿‡ <code>setCacheable(true)</code> å¯ç”¨æŸ¥è¯¢ç¼“å­˜ï¼ŒæŸ¥è¯¢ç»“æœä¸ <code>SessionFactory</code> çš„ç¼“å­˜åŒºåŸŸå…³è”ã€‚</li></ul></li><li><strong>ä¾èµ–å…³ç³»</strong>ï¼šæŸ¥è¯¢ç¼“å­˜ä¾èµ–äºŒçº§ç¼“å­˜ï¼Œå¿…é¡»åŒæ—¶å¯ç”¨äºŒçº§ç¼“å­˜æ‰èƒ½ç”Ÿæ•ˆã€‚</li></ul><h4 id="æ•´ä½“å·¥ä½œæµç¨‹"><a href="#æ•´ä½“å·¥ä½œæµç¨‹" class="headerlink" title="æ•´ä½“å·¥ä½œæµç¨‹"></a><strong>æ•´ä½“å·¥ä½œæµç¨‹</strong></h4><ol><li><strong>åˆå§‹åŒ–</strong>ï¼š<code>SessionFactory</code> åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºï¼ŒåŠ è½½é…ç½®ã€æ˜ å°„å’Œç¼“å­˜è®¾ç½®ï¼ˆåŒ…æ‹¬äºŒçº§ç¼“å­˜ï¼‰ã€‚</li><li><strong>åˆ›å»º Session</strong>ï¼šåº”ç”¨é€šè¿‡ <code>SessionFactory</code> åˆ›å»º <code>Session</code>ï¼Œæ¯ä¸ª <code>Session</code> ç»´æŠ¤ç‹¬ç«‹çš„ä¸€çº§ç¼“å­˜ã€‚</li><li><strong>æŸ¥è¯¢æ“ä½œ</strong>ï¼š<ul><li><code>Session</code> é¦–å…ˆæ£€æŸ¥ä¸€çº§ç¼“å­˜ã€‚</li><li>å¦‚æœä¸€çº§ç¼“å­˜æœªå‘½ä¸­ï¼Œæ£€æŸ¥äºŒçº§ç¼“å­˜ï¼ˆè‹¥å¯ç”¨ï¼‰ã€‚</li><li>å¦‚æœäºŒçº§ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å°†ç»“æœå­˜å…¥ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼ˆè‹¥å¯ç”¨ï¼‰ã€‚</li></ul></li><li><strong>äº‹åŠ¡æäº¤</strong>ï¼š<ul><li><code>Session</code> æ‰§è¡Œè„æ£€æŸ¥ï¼ŒåŒæ­¥ä¸€çº§ç¼“å­˜ä¸­çš„å˜åŒ–åˆ°æ•°æ®åº“ã€‚</li><li>äºŒçº§ç¼“å­˜æ ¹æ®ç­–ç•¥ï¼ˆå¦‚ <code>READ_WRITE</code>ï¼‰æ›´æ–°ã€‚</li></ul></li><li><strong>å…³é—­</strong>ï¼š<code>Session</code> å…³é—­ï¼Œä¸€çº§ç¼“å­˜å¤±æ•ˆï¼›<code>SessionFactory</code> å’ŒäºŒçº§ç¼“å­˜ä¿æŒæœ‰æ•ˆï¼Œç›´åˆ°åº”ç”¨å…³é—­ã€‚</li></ol><hr><h3 id="5-å®è·µä¸­çš„æ³¨æ„äº‹é¡¹"><a href="#5-å®è·µä¸­çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="5. å®è·µä¸­çš„æ³¨æ„äº‹é¡¹"></a><strong>5. å®è·µä¸­çš„æ³¨æ„äº‹é¡¹</strong></h3><ol><li><p><strong>Session ç®¡ç†</strong>ï¼š</p><ul><li>é¿å…é•¿æ—¶é—´æŒæœ‰ <code>Session</code>ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li><li>åœ¨ Spring ä¸­ï¼Œä½¿ç”¨ <code>@Transactional</code> è‡ªåŠ¨ç®¡ç† <code>Session</code>ï¼ˆé€šè¿‡ <code>getCurrentSession()</code>ï¼‰ã€‚</li><li>æ€»æ˜¯å…³é—­ <code>Session</code>ï¼ˆ<code>close()</code>ï¼‰ï¼Œæˆ–ä¾èµ– Spring ç®¡ç†ã€‚</li></ul></li><li><p><strong>SessionFactory é…ç½®</strong>ï¼š</p><ul><li>ç¡®ä¿ <code>SessionFactory</code> å•ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚</li><li>åˆç†é…ç½®æ•°æ®åº“è¿æ¥æ± ï¼ˆå¦‚ HikariCPï¼‰å’Œ Hibernate å±æ€§ï¼ˆå¦‚ <code>hibernate.dialect</code>ï¼‰ã€‚</li></ul></li><li><p><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼š</p><ul><li><strong>ä¸€çº§ç¼“å­˜</strong>ï¼šé¿å…åœ¨å•ä¸€ <code>Session</code> å†…åŠ è½½è¿‡å¤šå®ä½“ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºã€‚</li><li><strong>äºŒçº§ç¼“å­˜</strong>ï¼šä»…ç¼“å­˜ä¸å¸¸ä¿®æ”¹çš„æ•°æ®ï¼Œé…ç½®åˆé€‚çš„å¹¶å‘ç­–ç•¥ï¼ˆå¦‚ <code>READ_ONLY</code> æˆ– <code>READ_WRITE</code>ï¼‰ã€‚</li><li><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šè°¨æ…ä½¿ç”¨ï¼Œé€‚åˆé«˜é¢‘ã€å‚æ•°å›ºå®šçš„æŸ¥è¯¢ã€‚</li></ul></li><li><p><strong>æ€§èƒ½è°ƒè¯•</strong>ï¼š</p><ul><li>å¼€å¯ <code>hibernate.show_sql</code> å’Œ <code>hibernate.format_sql</code> æŸ¥çœ‹ç”Ÿæˆçš„ SQLã€‚</li><li>ä½¿ç”¨ <code>statistics</code> æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sessionFactory.getStatistics().setStatisticsEnabled(<span class="literal">true</span>);</span><br><span class="line">System.out.println(sessionFactory.getStatistics().getSecondLevelCacheHitCount());</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å¸¸è§é—®é¢˜</strong>ï¼š</p><ul><li><strong>LazyInitializationException</strong>ï¼šå›  <code>Session</code> å…³é—­åè®¿é—®å»¶è¿ŸåŠ è½½çš„å…³è”å¯¹è±¡ï¼Œè§£å†³æ–¹æ³•æ˜¯æå‰åŠ è½½æˆ–ä½¿ç”¨ Spring çš„ <code>OpenSessionInView</code>ã€‚</li><li><strong>N+1 æŸ¥è¯¢é—®é¢˜</strong>ï¼šå› ä¸€çº§ç¼“å­˜æœªå‘½ä¸­æˆ–å…³è”å¯¹è±¡é€ä¸ªåŠ è½½ï¼Œè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ <code>JOIN FETCH</code> æˆ–æ‰¹é‡åŠ è½½ã€‚</li></ul></li></ol><hr><h3 id="6-ç¤ºä¾‹ä»£ç ï¼šå±•ç¤º-Sessionã€SessionFactory-å’Œç¼“å­˜"><a href="#6-ç¤ºä¾‹ä»£ç ï¼šå±•ç¤º-Sessionã€SessionFactory-å’Œç¼“å­˜" class="headerlink" title="6. ç¤ºä¾‹ä»£ç ï¼šå±•ç¤º Sessionã€SessionFactory å’Œç¼“å­˜"></a><strong>6. ç¤ºä¾‹ä»£ç ï¼šå±•ç¤º Sessionã€SessionFactory å’Œç¼“å­˜</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½® SessionFactory</span></span><br><span class="line"><span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>().configure();</span><br><span class="line">config.addAnnotatedClass(User.class);</span><br><span class="line"><span class="type">SessionFactory</span> <span class="variable">sessionFactory</span> <span class="operator">=</span> config.buildSessionFactory();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ Session å’Œä¸€çº§ç¼“å­˜</span></span><br><span class="line"><span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> sessionFactory.openSession();</span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> session.get(User.class, <span class="number">1L</span>); <span class="comment">// æŸ¥è¯¢æ•°æ®åº“ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> session.get(User.class, <span class="number">1L</span>); <span class="comment">// ä»ä¸€çº§ç¼“å­˜è¿”å›</span></span><br><span class="line">System.out.println(user1 == user2); <span class="comment">// trueï¼ŒåŒä¸€å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close(); <span class="comment">// ä¸€çº§ç¼“å­˜å¤±æ•ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒçº§ç¼“å­˜ç¤ºä¾‹ï¼ˆéœ€é…ç½® EHCache å’Œ @Cacheï¼‰</span></span><br><span class="line"><span class="type">Session</span> <span class="variable">session2</span> <span class="operator">=</span> sessionFactory.openSession();</span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx2</span> <span class="operator">=</span> session2.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> session2.get(User.class, <span class="number">1L</span>); <span class="comment">// ä»äºŒçº§ç¼“å­˜åŠ è½½ï¼ˆè‹¥å‘½ä¸­ï¼‰</span></span><br><span class="line">tx2.commit();</span><br><span class="line">session2.close();</span><br><span class="line"></span><br><span class="line">sessionFactory.close(); <span class="comment">// å…³é—­ SessionFactoryï¼ŒäºŒçº§ç¼“å­˜å¤±æ•ˆ</span></span><br></pre></td></tr></table></figure><hr><h3 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a><strong>7. æ€»ç»“</strong></h3><ul><li><strong>Session</strong>ï¼š<ul><li>ä½œç”¨ï¼šç®¡ç†æ•°æ®åº“æ“ä½œå’Œä¸€çº§ç¼“å­˜ï¼Œéçº¿ç¨‹å®‰å…¨ï¼ŒçŸ­ç”Ÿå‘½å‘¨æœŸã€‚</li><li>æ ¸å¿ƒæ–¹æ³•ï¼š<code>save</code>ã€<code>get</code>ã€<code>createQuery</code>ã€<code>flush</code>ã€‚</li></ul></li><li><strong>SessionFactory</strong>ï¼š<ul><li>ä½œç”¨ï¼šåˆ›å»º <code>Session</code>ï¼Œç®¡ç†å…¨å±€é…ç½®å’ŒäºŒçº§ç¼“å­˜ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œå•ä¾‹ã€‚</li><li>æ ¸å¿ƒæ–¹æ³•ï¼š<code>openSession</code>ã€<code>getCurrentSession</code>ã€‚</li></ul></li><li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼š<ul><li><strong>ä¸€çº§ç¼“å­˜</strong>ï¼š<code>Session</code> çº§åˆ«ï¼Œè‡ªåŠ¨å¯ç”¨ï¼Œå­˜å‚¨å½“å‰ä¼šè¯å®ä½“ï¼Œè´Ÿè´£è„æ£€æŸ¥ã€‚</li><li><strong>äºŒçº§ç¼“å­˜</strong>ï¼š<code>SessionFactory</code> çº§åˆ«ï¼Œå¯é€‰å¯ç”¨ï¼Œè·¨ <code>Session</code> å…±äº«ï¼Œé€‚åˆåªè¯»æ•°æ®ã€‚</li><li><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œä¾èµ–äºŒçº§ç¼“å­˜ã€‚</li></ul></li><li><strong>ç›¸å…³æ€§</strong>ï¼š<ul><li><code>SessionFactory</code> åˆ›å»º <code>Session</code>ï¼Œæä¾›é…ç½®å’ŒäºŒçº§ç¼“å­˜ã€‚</li><li><code>Session</code> ç»´æŠ¤ä¸€çº§ç¼“å­˜ï¼Œæ‰§è¡Œæ“ä½œï¼Œå¯èƒ½è®¿é—®äºŒçº§ç¼“å­˜ã€‚</li><li>ç¼“å­˜æœºåˆ¶é€šè¿‡å‡å°‘æ•°æ®åº“è®¿é—®ä¼˜åŒ–æ€§èƒ½ï¼Œä¸ <code>Session</code> å’Œ <code>SessionFactory</code> çš„ç”Ÿå‘½å‘¨æœŸç´§å¯†ç›¸å…³ã€‚</li></ul></li></ul><hr><h3 id="è¿›ä¸€æ­¥å­¦ä¹ å»ºè®®"><a href="#è¿›ä¸€æ­¥å­¦ä¹ å»ºè®®" class="headerlink" title="è¿›ä¸€æ­¥å­¦ä¹ å»ºè®®"></a><strong>è¿›ä¸€æ­¥å­¦ä¹ å»ºè®®</strong></h3><ol><li><strong>å®è·µ</strong>ï¼šæ­å»ºä¸€ä¸ª Spring Boot + Hibernate é¡¹ç›®ï¼Œæµ‹è¯•ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜çš„æ•ˆæœã€‚</li><li><strong>è°ƒè¯•</strong>ï¼šä½¿ç”¨ Hibernate çš„ <code>Statistics</code> API ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡ï¼Œä¼˜åŒ–æŸ¥è¯¢ã€‚</li><li><strong>æ·±å…¥</strong>ï¼šå­¦ä¹ å…³è”æ˜ å°„ï¼ˆå¦‚ <code>@OneToMany</code>ï¼‰å’Œ <code>fetch</code> ç­–ç•¥ï¼Œç»“åˆç¼“å­˜ä¼˜åŒ–æ€§èƒ½ã€‚</li><li><strong>èµ„æº</strong>ï¼šå‚è€ƒ <a href="https://docs.jboss.org/hibernate/orm/5.6/userguide/html_single/Hibernate_User_Guide.html#caching">Hibernate å®˜æ–¹æ–‡æ¡£</a> çš„ç¼“å­˜ç« èŠ‚ã€‚</li></ol><p>å¦‚æœä½ æœ‰å…·ä½“åœºæ™¯ï¼ˆå¦‚ç¼“å­˜é…ç½®ã€æ€§èƒ½é—®é¢˜ã€ä»£ç è°ƒè¯•ï¼‰ï¼Œè¯·æä¾›ç»†èŠ‚ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥æä¾›å®šåˆ¶åŒ–æŒ‡å¯¼ï¼</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p>è¦ç†Ÿæ‚‰ä½¿ç”¨ Hibernate ä½œä¸º ORM æ¡†æ¶ï¼Œå»ºè®®ä»ç†è§£å…¶æ ¸å¿ƒæ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥é€šè¿‡å®è·µæŒæ¡å¸¸ç”¨ç±»ã€æ¥å£å’Œæ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç³»ç»ŸåŒ–çš„å­¦ä¹ è·¯å¾„ï¼Œä»¥åŠ Hibernate ä¸­å¸¸ç”¨çš„ç±»ã€æ¥å£å’Œæ–¹æ³•çš„è¯¦ç»†è¯´æ˜ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ã€‚</p><hr><h3 id="å­¦ä¹ è·¯å¾„ï¼šå¦‚ä½•å…¥æ‰‹-Hibernate"><a href="#å­¦ä¹ è·¯å¾„ï¼šå¦‚ä½•å…¥æ‰‹-Hibernate" class="headerlink" title="å­¦ä¹ è·¯å¾„ï¼šå¦‚ä½•å…¥æ‰‹ Hibernate"></a><strong>å­¦ä¹ è·¯å¾„ï¼šå¦‚ä½•å…¥æ‰‹ Hibernate</strong></h3><ol><li><p><strong>ç†è§£æ ¸å¿ƒæ¦‚å¿µ</strong></p><ul><li><strong>ORM åŸç†</strong>ï¼šäº†è§£å¯¹è±¡-å…³ç³»æ˜ å°„ï¼ŒHibernate å¦‚ä½•å°† Java å¯¹è±¡æ˜ å°„åˆ°æ•°æ®åº“è¡¨ã€‚</li><li><strong>Session å’Œ SessionFactory</strong>ï¼šæŒæ¡ Hibernate çš„æ ¸å¿ƒå·¥ä½œå•å…ƒã€‚</li><li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šç†è§£äº‹åŠ¡åœ¨ Hibernate ä¸­çš„ä½œç”¨ã€‚</li><li><strong>ä¸€çº§ç¼“å­˜å’ŒæŸ¥è¯¢</strong>ï¼šå­¦ä¹  Hibernate å¦‚ä½•ç¼“å­˜å¯¹è±¡å’Œæ‰§è¡ŒæŸ¥è¯¢ã€‚</li></ul></li><li><p><strong>æ­å»ºå¼€å‘ç¯å¢ƒ</strong></p><ul><li><strong>ä¾èµ–é…ç½®</strong>ï¼šä½¿ç”¨ Maven æˆ– Gradle å¼•å…¥ Hibernate ä¾èµ–ï¼ˆå‚è€ƒä¹‹å‰çš„å›ç­”ï¼‰ã€‚</li><li><strong>æ•°æ®åº“å‡†å¤‡</strong>ï¼šé€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ï¼ˆå¦‚ MySQLã€H2ï¼‰ï¼Œåˆ›å»ºè¡¨ç»“æ„ã€‚</li><li><strong>Spring é›†æˆ</strong>ï¼šæ¨èç»“åˆ Springï¼ˆæˆ– Spring Bootï¼‰ç®€åŒ–é…ç½®ï¼ŒSpring Boot çš„ <code>spring-boot-starter-data-jpa</code> æ˜¯å¿«é€Ÿå…¥é—¨çš„é¦–é€‰ã€‚</li></ul></li><li><p><strong>å®è·µåŸºç¡€æ“ä½œ</strong></p><ul><li><strong>åˆ›å»ºå®ä½“ç±»</strong>ï¼šä½¿ç”¨æ³¨è§£ï¼ˆå¦‚ <code>@Entity</code>ã€<code>@Id</code>ï¼‰å®šä¹‰ Java ç±»ä¸æ•°æ®åº“è¡¨çš„æ˜ å°„ã€‚</li><li><strong>é…ç½® Hibernate</strong>ï¼šè®¾ç½® <code>hibernate.cfg.xml</code> æˆ– <code>application.properties</code>ï¼ˆSpring Bootï¼‰ã€‚</li><li><strong>å®ç° CRUD</strong>ï¼šé€šè¿‡ <code>Session</code> æˆ– JPA çš„ <code>EntityManager</code> å®ç°å¢åˆ æ”¹æŸ¥ã€‚</li><li><strong>ç»ƒä¹ æŸ¥è¯¢</strong>ï¼šä½¿ç”¨ HQLï¼ˆHibernate Query Languageï¼‰æˆ– Criteria API ç¼–å†™æŸ¥è¯¢ã€‚</li></ul></li><li><p><strong>æ·±å…¥é«˜çº§åŠŸèƒ½</strong></p><ul><li><strong>å…³è”æ˜ å°„</strong>ï¼šå­¦ä¹  <code>@OneToMany</code>ã€<code>@ManyToOne</code> ç­‰å…³è”å…³ç³»ã€‚</li><li><strong>å»¶è¿ŸåŠ è½½</strong>ï¼šç†è§£ <code>fetch</code> ç­–ç•¥ï¼ˆå¦‚ <code>FetchType.LAZY</code>ï¼‰ã€‚</li><li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šç»“åˆ Spring çš„ <code>@Transactional</code> ç®¡ç†äº‹åŠ¡ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæ¢ç´¢ä¸€çº§ç¼“å­˜ã€äºŒçº§ç¼“å­˜ã€æ‰¹é‡æ“ä½œã€‚</li></ul></li><li><p><strong>é€šè¿‡é¡¹ç›®å·©å›º</strong></p><ul><li>æ„å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼ˆå¦‚ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼‰ï¼ŒåŒ…å«å®ä½“ã€DAOã€æœåŠ¡å±‚å’Œæ§åˆ¶å™¨ã€‚</li><li>ä½¿ç”¨ Spring Boot + Hibernate å®ç° REST APIï¼Œæ¶µç›– CRUD å’Œå…³è”æŸ¥è¯¢ã€‚</li><li>è°ƒè¯•å¸¸è§é—®é¢˜ï¼ˆå¦‚ <code>LazyInitializationException</code>ã€N+1 æŸ¥è¯¢é—®é¢˜ï¼‰ã€‚</li></ul></li><li><p><strong>æŸ¥é˜…å®˜æ–¹èµ„æº</strong></p><ul><li><strong>Hibernate æ–‡æ¡£</strong>ï¼šå‚è€ƒ <a href="https://hibernate.org/orm/documentation/">Hibernate å®˜æ–¹æ–‡æ¡£</a>ã€‚</li><li><strong>æ•™ç¨‹å’Œç¤¾åŒº</strong>ï¼šå­¦ä¹  Baeldungã€Mkyong ç­‰ç½‘ç«™çš„ Hibernate æ•™ç¨‹ï¼Œå‚ä¸ Stack Overflow è®¨è®ºã€‚</li><li><strong>æºç å’Œç¤ºä¾‹</strong>ï¼šæŸ¥çœ‹ Hibernate çš„ GitHub ä»“åº“æˆ–å®˜æ–¹ç¤ºä¾‹é¡¹ç›®ã€‚</li></ul></li></ol><hr><h3 id="å¸¸ç”¨ç±»ã€æ¥å£å’Œæ–¹æ³•"><a href="#å¸¸ç”¨ç±»ã€æ¥å£å’Œæ–¹æ³•" class="headerlink" title="å¸¸ç”¨ç±»ã€æ¥å£å’Œæ–¹æ³•"></a><strong>å¸¸ç”¨ç±»ã€æ¥å£å’Œæ–¹æ³•</strong></h3><p>ä»¥ä¸‹æ˜¯ Hibernate ä¸­æœ€å¸¸ç”¨çš„ç±»ã€æ¥å£åŠå…¶æ ¸å¿ƒæ–¹æ³•ï¼Œåˆ†ä¸º **Hibernate æ ¸å¿ƒï¼ˆSession æ¨¡å¼ï¼‰**å’Œ <strong>JPA æ¨¡å¼</strong>ï¼ˆSpring Boot å¸¸ç”¨ï¼‰ã€‚</p><h4 id="1-Hibernate-æ ¸å¿ƒï¼ˆSession-æ¨¡å¼ï¼‰"><a href="#1-Hibernate-æ ¸å¿ƒï¼ˆSession-æ¨¡å¼ï¼‰" class="headerlink" title="1. Hibernate æ ¸å¿ƒï¼ˆSession æ¨¡å¼ï¼‰"></a><strong>1. Hibernate æ ¸å¿ƒï¼ˆSession æ¨¡å¼ï¼‰</strong></h4><p>è¿™äº›ç±»å’Œæ¥å£ç”¨äºä¼ ç»Ÿçš„ Hibernate æ“ä½œï¼ŒåŸºäº <code>Session</code> å’Œ <code>SessionFactory</code>ã€‚</p><h5 id="å¸¸ç”¨ç±»å’Œæ¥å£"><a href="#å¸¸ç”¨ç±»å’Œæ¥å£" class="headerlink" title="å¸¸ç”¨ç±»å’Œæ¥å£"></a><strong>å¸¸ç”¨ç±»å’Œæ¥å£</strong></h5><ol><li><p><strong><code>org.hibernate.Session</code></strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šæ ¸å¿ƒæ¥å£ï¼Œç®¡ç†å®ä½“å¯¹è±¡çš„æŒä¹…åŒ–æ“ä½œï¼Œç»´æŠ¤ä¸€çº§ç¼“å­˜ã€‚</li><li><strong>éçº¿ç¨‹å®‰å…¨</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹åº”æœ‰ç‹¬ç«‹çš„ <code>Session</code>ã€‚</li><li><strong>è·å–æ–¹å¼</strong>ï¼šé€šè¿‡ <code>SessionFactory.openSession()</code> è·å–ã€‚</li></ul></li><li><p><strong><code>org.hibernate.SessionFactory</code></strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šçº¿ç¨‹å®‰å…¨çš„å·¥å‚ç±»ï¼Œè´Ÿè´£åˆ›å»º <code>Session</code>ï¼Œåˆå§‹åŒ– Hibernate é…ç½®ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šå…¨å±€å•ä¾‹ï¼Œåˆ›å»ºå¼€é”€å¤§ï¼Œåº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–ã€‚</li></ul></li><li><p><strong><code>org.hibernate.Transaction</code></strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šç®¡ç†æ•°æ®åº“äº‹åŠ¡ï¼Œç¡®ä¿æ“ä½œçš„åŸå­æ€§ã€‚</li><li><strong>è·å–æ–¹å¼</strong>ï¼šé€šè¿‡ <code>Session.beginTransaction()</code> è·å–ã€‚</li></ul></li><li><p><strong><code>org.hibernate.query.Query</code></strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šæ‰§è¡Œ HQL æˆ– SQL æŸ¥è¯¢ï¼Œè¿”å›ç»“æœé›†ã€‚</li><li><strong>è·å–æ–¹å¼</strong>ï¼šé€šè¿‡ <code>Session.createQuery()</code> åˆ›å»ºã€‚</li></ul></li></ol><h5 id="å¸¸ç”¨æ–¹æ³•-2"><a href="#å¸¸ç”¨æ–¹æ³•-2" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a><strong>å¸¸ç”¨æ–¹æ³•</strong></h5><ul><li><p><strong><code>Session</code> æ–¹æ³•</strong>ï¼š</p><ul><li><code>save(Object)</code>ï¼šä¿å­˜å®ä½“ï¼Œè¿”å›æ ‡è¯†ç¬¦ã€‚</li><li><code>update(Object)</code>ï¼šæ›´æ–°å®ä½“ã€‚</li><li><code>merge(Object)</code>ï¼šåˆå¹¶ detached çŠ¶æ€çš„å®ä½“ã€‚</li><li><code>delete(Object)</code>ï¼šåˆ é™¤å®ä½“ã€‚</li><li><code>get(Class, Serializable)</code>ï¼šæ ¹æ® ID ç«‹å³åŠ è½½å®ä½“ã€‚</li><li><code>load(Class, Serializable)</code>ï¼šå»¶è¿ŸåŠ è½½å®ä½“ã€‚</li><li><code>createQuery(String)</code>ï¼šåˆ›å»º HQL æŸ¥è¯¢ã€‚</li><li><code>flush()</code>ï¼šåŒæ­¥æŒä¹…åŒ–ä¸Šä¸‹æ–‡åˆ°æ•°æ®åº“ã€‚</li><li><code>clear()</code>ï¼šæ¸…ç©ºä¸€çº§ç¼“å­˜ã€‚</li><li><code>beginTransaction()</code>ï¼šå¼€å¯äº‹åŠ¡ã€‚</li></ul></li><li><p><strong><code>SessionFactory</code> æ–¹æ³•</strong>ï¼š</p><ul><li><code>openSession()</code>ï¼šåˆ›å»ºæ–°çš„ <code>Session</code>ã€‚</li><li><code>getCurrentSession()</code>ï¼šè·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„ <code>Session</code>ï¼ˆéœ€é…ç½®äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼‰ã€‚</li><li><code>close()</code>ï¼šå…³é—­å·¥å‚ï¼Œé‡Šæ”¾èµ„æºã€‚</li></ul></li><li><p><strong><code>Transaction</code> æ–¹æ³•</strong>ï¼š</p><ul><li><code>commit()</code>ï¼šæäº¤äº‹åŠ¡ã€‚</li><li><code>rollback()</code>ï¼šå›æ»šäº‹åŠ¡ã€‚</li></ul></li><li><p><strong><code>Query</code> æ–¹æ³•</strong>ï¼š</p><ul><li><code>getResultList()</code>ï¼šè¿”å›æŸ¥è¯¢ç»“æœåˆ—è¡¨ã€‚</li><li><code>getSingleResult()</code>ï¼šè¿”å›å•ä¸ªç»“æœã€‚</li><li><code>setParameter(String, Object)</code>ï¼šè®¾ç½®æŸ¥è¯¢å‚æ•°ã€‚</li><li><code>setMaxResults(int)</code>ï¼šé™åˆ¶ç»“æœæ•°é‡ã€‚</li></ul></li></ul><h5 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a><strong>ç¤ºä¾‹ä»£ç </strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SessionFactory</span> <span class="variable">sessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>().configure().buildSessionFactory();</span><br><span class="line"><span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> sessionFactory.openSession();</span><br><span class="line"><span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    tx = session.beginTransaction();</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    session.save(user); <span class="comment">// ä¿å­˜</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">loaded</span> <span class="operator">=</span> session.get(User.class, user.getId()); <span class="comment">// æŸ¥è¯¢</span></span><br><span class="line">    tx.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tx != <span class="literal">null</span>) tx.rollback();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-JPA-æ¨¡å¼ï¼ˆEntityManager-æ¨¡å¼ï¼‰"><a href="#2-JPA-æ¨¡å¼ï¼ˆEntityManager-æ¨¡å¼ï¼‰" class="headerlink" title="2. JPA æ¨¡å¼ï¼ˆEntityManager æ¨¡å¼ï¼‰"></a><strong>2. JPA æ¨¡å¼ï¼ˆEntityManager æ¨¡å¼ï¼‰</strong></h4><p>åœ¨ Spring Boot æˆ–ç°ä»£é¡¹ç›®ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ Hibernate ä½œä¸º JPA å®ç°ï¼ŒåŸºäº <code>EntityManager</code>ã€‚</p><h5 id="å¸¸ç”¨ç±»å’Œæ¥å£-1"><a href="#å¸¸ç”¨ç±»å’Œæ¥å£-1" class="headerlink" title="å¸¸ç”¨ç±»å’Œæ¥å£"></a><strong>å¸¸ç”¨ç±»å’Œæ¥å£</strong></h5><ol><li><p><strong><code>javax.persistence.EntityManager</code>ï¼ˆæˆ– <code>jakarta.persistence</code>ï¼‰</strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šJPA çš„æ ¸å¿ƒæ¥å£ï¼Œç±»ä¼¼ <code>Session</code>ï¼Œç®¡ç†å®ä½“çš„æŒä¹…åŒ–æ“ä½œã€‚</li><li><strong>è·å–æ–¹å¼</strong>ï¼šé€šè¿‡ Spring æ³¨å…¥æˆ– <code>EntityManagerFactory</code> åˆ›å»ºã€‚</li></ul></li><li><p><strong><code>javax.persistence.EntityManagerFactory</code></strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šåˆ›å»º <code>EntityManager</code>ï¼Œç±»ä¼¼ <code>SessionFactory</code>ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šçº¿ç¨‹å®‰å…¨ï¼Œå…¨å±€å•ä¾‹ã€‚</li></ul></li><li><p><strong><code>javax.persistence.Query</code></strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šæ‰§è¡Œ JPQLï¼ˆç±»ä¼¼ HQLï¼‰æˆ–åŸç”Ÿ SQL æŸ¥è¯¢ã€‚</li><li><strong>è·å–æ–¹å¼</strong>ï¼šé€šè¿‡ <code>EntityManager.createQuery()</code> åˆ›å»ºã€‚</li></ul></li><li><p><strong><code>javax.persistence.EntityTransaction</code></strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šç®¡ç† JPA äº‹åŠ¡ã€‚</li><li><strong>è·å–æ–¹å¼</strong>ï¼šé€šè¿‡ <code>EntityManager.getTransaction()</code> è·å–ã€‚</li></ul></li></ol><h5 id="å¸¸ç”¨æ–¹æ³•-3"><a href="#å¸¸ç”¨æ–¹æ³•-3" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a><strong>å¸¸ç”¨æ–¹æ³•</strong></h5><ul><li><p><strong><code>EntityManager</code> æ–¹æ³•</strong>ï¼š</p><ul><li><code>persist(Object)</code>ï¼šå°†å®ä½“è®¾ä¸ºæŒä¹…åŒ–çŠ¶æ€ã€‚</li><li><code>merge(Object)</code>ï¼šåˆå¹¶ detached çŠ¶æ€çš„å®ä½“ã€‚</li><li><code>remove(Object)</code>ï¼šåˆ é™¤å®ä½“ã€‚</li><li><code>find(Class, Object)</code>ï¼šæ ¹æ® ID æŸ¥æ‰¾å®ä½“ã€‚</li><li><code>createQuery(String)</code>ï¼šåˆ›å»º JPQL æŸ¥è¯¢ã€‚</li><li><code>createNativeQuery(String)</code>ï¼šåˆ›å»ºåŸç”Ÿ SQL æŸ¥è¯¢ã€‚</li><li><code>flush()</code>ï¼šåŒæ­¥æŒä¹…åŒ–ä¸Šä¸‹æ–‡ã€‚</li><li><code>detach(Object)</code>ï¼šå°†å®ä½“ä»æŒä¹…åŒ–ä¸Šä¸‹æ–‡ä¸­åˆ†ç¦»ã€‚</li><li><code>getTransaction()</code>ï¼šè·å–äº‹åŠ¡å¯¹è±¡ã€‚</li></ul></li><li><p><strong><code>EntityManagerFactory</code> æ–¹æ³•</strong>ï¼š</p><ul><li><code>createEntityManager()</code>ï¼šåˆ›å»º <code>EntityManager</code>ã€‚</li><li><code>close()</code>ï¼šå…³é—­å·¥å‚ã€‚</li></ul></li><li><p><strong><code>Query</code> æ–¹æ³•</strong>ï¼š</p><ul><li>ç±»ä¼¼ <code>Session</code> çš„ <code>Query</code> æ–¹æ³•ï¼Œå¦‚ <code>getResultList()</code>ã€<code>setParameter()</code>ã€‚</li></ul></li></ul><h5 id="Spring-Boot-ç¤ºä¾‹ï¼ˆJPAï¼‰"><a href="#Spring-Boot-ç¤ºä¾‹ï¼ˆJPAï¼‰" class="headerlink" title="Spring Boot ç¤ºä¾‹ï¼ˆJPAï¼‰"></a><strong>Spring Boot ç¤ºä¾‹ï¼ˆJPAï¼‰</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        entityManager.persist(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> entityManager.find(User.class, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-å¸¸ç”¨æ³¨è§£"><a href="#3-å¸¸ç”¨æ³¨è§£" class="headerlink" title="3. å¸¸ç”¨æ³¨è§£"></a><strong>3. å¸¸ç”¨æ³¨è§£</strong></h4><p>Hibernate ä¾èµ–æ³¨è§£å®šä¹‰å®ä½“å’Œæ˜ å°„å…³ç³»ï¼Œå¸¸ç”¨æ³¨è§£åŒ…æ‹¬ï¼š</p><ul><li><strong><code>@Entity</code></strong>ï¼šæ ‡è®°ç±»ä¸ºå®ä½“ã€‚</li><li><strong><code>@Table(name)</code></strong>ï¼šæŒ‡å®šæ•°æ®åº“è¡¨åã€‚</li><li><strong><code>@Id</code></strong>ï¼šæ ‡è®°ä¸»é”®ã€‚</li><li><strong><code>@GeneratedValue</code></strong>ï¼šå®šä¹‰ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼ˆå¦‚ <code>AUTO</code>ã€<code>IDENTITY</code>ï¼‰ã€‚</li><li><strong><code>@Column</code></strong>ï¼šæ˜ å°„å­—æ®µåˆ°åˆ—ï¼ŒæŒ‡å®šå±æ€§ï¼ˆå¦‚ <code>nullable</code>ã€<code>length</code>ï¼‰ã€‚</li><li><strong><code>@OneToMany</code> &#x2F; <code>@ManyToOne</code> &#x2F; <code>@ManyToMany</code></strong>ï¼šå®šä¹‰å…³è”å…³ç³»ã€‚</li><li><strong><code>@JoinColumn</code></strong>ï¼šæŒ‡å®šå¤–é”®åˆ—ã€‚</li><li><strong><code>@Fetch</code></strong>ï¼šè®¾ç½®åŠ è½½ç­–ç•¥ï¼ˆ<code>FetchType.LAZY</code> æˆ– <code>EAGER</code>ï¼‰ã€‚</li><li><strong><code>@Transactional</code></strong>ï¼ˆSpringï¼‰ï¼šç®¡ç†äº‹åŠ¡ã€‚</li></ul><hr><h3 id="å®è·µå»ºè®®ï¼šæŒæ¡-Hibernate-çš„æ­¥éª¤"><a href="#å®è·µå»ºè®®ï¼šæŒæ¡-Hibernate-çš„æ­¥éª¤" class="headerlink" title="å®è·µå»ºè®®ï¼šæŒæ¡ Hibernate çš„æ­¥éª¤"></a><strong>å®è·µå»ºè®®ï¼šæŒæ¡ Hibernate çš„æ­¥éª¤</strong></h3><ol><li><p><strong>ä»ç®€å•å®ä½“å¼€å§‹</strong>ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªç®€å•çš„å®ä½“ç±»ï¼ˆå¦‚ <code>User</code>ï¼‰ï¼Œä½¿ç”¨ <code>@Entity</code>ã€<code>@Id</code> ç­‰æ³¨è§£ã€‚</li><li>é…ç½® <code>hibernate.cfg.xml</code> æˆ– Spring Boot çš„ <code>application.properties</code>ã€‚</li><li>å®ç°åŸºæœ¬çš„ CRUD æ“ä½œï¼Œç†Ÿæ‚‰ <code>Session</code> æˆ– <code>EntityManager</code>ã€‚</li></ul></li><li><p><strong>å­¦ä¹  HQL å’Œ JPQL</strong>ï¼š</p><ul><li>ç¼–å†™ç®€å•çš„ HQL æŸ¥è¯¢ï¼ˆå¦‚ <code>from User where name = :name</code>ï¼‰ã€‚</li><li>ä½¿ç”¨ <code>Query</code> è®¾ç½®å‚æ•°å’Œåˆ†é¡µã€‚</li></ul></li><li><p><strong>æ¢ç´¢å…³è”æ˜ å°„</strong>ï¼š</p><ul><li>åˆ›å»ºä¸¤ä¸ªå®ä½“ï¼ˆå¦‚ <code>User</code> å’Œ <code>Order</code>ï¼‰ï¼Œä½¿ç”¨ <code>@OneToMany</code> å»ºç«‹å…³ç³»ã€‚</li><li>æµ‹è¯•çº§è”æ“ä½œï¼ˆå¦‚ <code>CascadeType.ALL</code>ï¼‰å’Œå»¶è¿ŸåŠ è½½ã€‚</li></ul></li><li><p><strong>é›†æˆ Spring</strong>ï¼š</p><ul><li>ä½¿ç”¨ Spring çš„ <code>@Repository</code> å’Œ <code>@Transactional</code> ç®¡ç† <code>Session</code> æˆ– <code>EntityManager</code>ã€‚</li><li>å°è¯• Spring Data JPAï¼Œç®€åŒ– DAO å±‚ä»£ç ã€‚</li></ul></li><li><p><strong>è°ƒè¯•å’Œä¼˜åŒ–</strong>ï¼š</p><ul><li>å¼€å¯ <code>hibernate.show_sql</code> å’Œ <code>hibernate.format_sql</code> æŸ¥çœ‹ç”Ÿæˆçš„ SQLã€‚</li><li>è§£å†³å¸¸è§é—®é¢˜ï¼Œå¦‚ <code>LazyInitializationException</code> æˆ– N+1 æŸ¥è¯¢ã€‚</li><li>å­¦ä¹ ä½¿ç”¨ <code>@BatchSize</code> æˆ–äºŒçº§ç¼“å­˜ä¼˜åŒ–æ€§èƒ½ã€‚</li></ul></li></ol><hr><h3 id="æ¨èç»ƒä¹ é¡¹ç›®"><a href="#æ¨èç»ƒä¹ é¡¹ç›®" class="headerlink" title="æ¨èç»ƒä¹ é¡¹ç›®"></a><strong>æ¨èç»ƒä¹ é¡¹ç›®</strong></h3><ol><li><p><strong>ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ</strong>ï¼š</p><ul><li>å®ä½“ï¼š<code>User</code>ï¼ˆIDã€å§“åã€é‚®ç®±ï¼‰ã€<code>Role</code>ï¼ˆIDã€åç§°ï¼‰ã€‚</li><li>åŠŸèƒ½ï¼šç”¨æˆ·å¢åˆ æ”¹æŸ¥ã€è§’è‰²åˆ†é…ï¼ˆå¤šå¯¹å¤šå…³ç³»ï¼‰ã€‚</li><li>æŠ€æœ¯ï¼šSpring Boot + Hibernate + MySQLã€‚</li></ul></li><li><p><strong>åšå®¢ç³»ç»Ÿ</strong>ï¼š</p><ul><li>å®ä½“ï¼š<code>Post</code>ï¼ˆIDã€æ ‡é¢˜ã€å†…å®¹ï¼‰ã€<code>Comment</code>ï¼ˆIDã€å†…å®¹ã€Postï¼‰ã€‚</li><li>åŠŸèƒ½ï¼šå‘å¸ƒå¸–å­ã€æ·»åŠ è¯„è®ºï¼ˆä¸€å¯¹å¤šå…³ç³»ï¼‰ã€‚</li><li>æŠ€æœ¯ï¼šSpring Boot + JPA + H2 æ•°æ®åº“ã€‚</li></ul></li></ol><hr><h3 id="æ³¨æ„äº‹é¡¹-1"><a href="#æ³¨æ„äº‹é¡¹-1" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a><strong>æ³¨æ„äº‹é¡¹</strong></h3><ul><li><strong>ç‰ˆæœ¬å…¼å®¹</strong>ï¼šç¡®ä¿ Hibernateã€Spring å’Œæ•°æ®åº“é©±åŠ¨ç‰ˆæœ¬å…¼å®¹ï¼ˆå¦‚ Hibernate 5.x æ­é… Spring 5.xï¼‰ã€‚</li><li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šå§‹ç»ˆåœ¨äº‹åŠ¡ä¸­æ‰§è¡Œå†™æ“ä½œï¼Œé¿å…éäº‹åŠ¡æ€§é”™è¯¯ã€‚</li><li><strong>èµ„æºé‡Šæ”¾</strong>ï¼šæ‰‹åŠ¨ç®¡ç† <code>Session</code> æ—¶ï¼Œç¡®ä¿å…³é—­ï¼ˆSpring è‡ªåŠ¨ç®¡ç†ï¼‰ã€‚</li><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šå…³æ³¨ç”Ÿæˆçš„ SQLï¼Œé¿å… N+1 æŸ¥è¯¢é—®é¢˜ã€‚</li></ul><hr><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><ul><li><strong>å…¥æ‰‹æ–¹å¼</strong>ï¼šä»é…ç½®ç¯å¢ƒã€åˆ›å»ºç®€å•å®ä½“å¼€å§‹ï¼Œé€æ­¥å­¦ä¹  CRUDã€HQL å’Œå…³è”æ˜ å°„ï¼Œç»“åˆ Spring å®è·µã€‚</li><li><strong>æ ¸å¿ƒç±»&#x2F;æ¥å£</strong>ï¼š<code>Session</code>ã€<code>SessionFactory</code>ï¼ˆHibernate æ¨¡å¼ï¼‰æˆ– <code>EntityManager</code>ã€<code>EntityManagerFactory</code>ï¼ˆJPA æ¨¡å¼ï¼‰ã€‚</li><li><strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼š<code>save</code>ã€<code>get</code>ã€<code>createQuery</code>ï¼ˆSessionï¼‰æˆ– <code>persist</code>ã€<code>find</code>ã€<code>createQuery</code>ï¼ˆEntityManagerï¼‰ã€‚</li><li><strong>å®è·µé‡ç‚¹</strong>ï¼šæ­å»ºå°é¡¹ç›®ï¼Œç†Ÿæ‚‰æ³¨è§£ã€æŸ¥è¯¢å’Œäº‹åŠ¡ç®¡ç†ã€‚</li></ul><p>å¦‚æœä½ æœ‰å…·ä½“é—®é¢˜ï¼ˆå¦‚é…ç½®ç¤ºä¾‹ã€æŸä¸ªæ–¹æ³•çš„ç”¨æ³•ã€è°ƒè¯•é”™è¯¯ï¼‰ï¼Œè¯·æä¾›æ›´å¤šç»†èŠ‚ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥æŒ‡å¯¼ï¼</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Hibernate </tag>
            
            <tag> ORM </tag>
            
            <tag> JPA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafka æ·±åº¦å­¦ä¹ ç¬”è®°</title>
      <link href="/posts/1562.html"/>
      <url>/posts/1562.html</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸ“–-ç®€ä»‹"><a href="#ğŸ“–-ç®€ä»‹" class="headerlink" title="ğŸ“– ç®€ä»‹"></a>ğŸ“– ç®€ä»‹</h2><p>Apache Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°,æœ€åˆç”± LinkedIn å¼€å‘ã€‚æ—©æœŸç‰ˆæœ¬ä½¿ç”¨ Scala ç¼–å†™å¹¶è¿è¡Œåœ¨ JVM ä¸Š,åç»­ç‰ˆæœ¬é€æ¸è¿ç§»è‡³ Java å®ç°ã€‚</p><h2 id="ğŸ”‘-æ ¸å¿ƒæ¦‚å¿µ"><a href="#ğŸ”‘-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ"></a>ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="å‰¯æœ¬æœºåˆ¶"><a href="#å‰¯æœ¬æœºåˆ¶" class="headerlink" title="å‰¯æœ¬æœºåˆ¶"></a>å‰¯æœ¬æœºåˆ¶</h3><ul><li><p><strong>Leader Replicaï¼ˆä¸»å‰¯æœ¬ï¼‰</strong></p><ul><li>è´Ÿè´£å¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚</li><li>ç»´æŠ¤æ¶ˆæ¯çš„å†™å…¥é¡ºåºå’Œåç§»é‡ç­‰å…ƒæ•°æ®</li></ul></li><li><p><strong>Follower Replicaï¼ˆä»å‰¯æœ¬ï¼‰</strong></p><ul><li>ä» Leader åŒæ­¥æœ€æ–°æ•°æ®</li><li>æä¾›æ•°æ®å†—ä½™å’Œé«˜å¯ç”¨ä¿éšœ</li><li>ä¸å¯¹å¤–æä¾›è¯»å†™æœåŠ¡</li></ul></li></ul><h3 id="æŒä¹…åŒ–æœºåˆ¶"><a href="#æŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="æŒä¹…åŒ–æœºåˆ¶"></a>æŒä¹…åŒ–æœºåˆ¶</h3><p>Kafka ä½¿ç”¨é«˜æ•ˆçš„æ—¥å¿—å­˜å‚¨æœºåˆ¶æ¥æŒä¹…åŒ–æ¶ˆæ¯ï¼š</p><ul><li><p><strong>é¡ºåº I&#x2F;O è¿½åŠ å†™å…¥</strong></p><ul><li>æ¶ˆæ¯ä»¥è¿½åŠ æ–¹å¼é¡ºåºå†™å…¥æ—¥å¿—æ–‡ä»¶</li><li>å……åˆ†åˆ©ç”¨ç£ç›˜é¡ºåºè¯»å†™çš„é«˜æ€§èƒ½ç‰¹æ€§</li></ul></li><li><p><strong>Log Segment åˆ†æ®µç®¡ç†</strong></p><ul><li>å°†æ—¥å¿—æŒ‰ç…§ Log Segment è¿›è¡Œåˆ†æ®µ</li><li>å®šæ—¶æ¸…ç†è¿‡æœŸçš„ Segment æ¥é‡Šæ”¾ç£ç›˜ç©ºé—´</li></ul></li></ul><hr><h2 id="ğŸ“š-æ ¸å¿ƒæœ¯è¯­"><a href="#ğŸ“š-æ ¸å¿ƒæœ¯è¯­" class="headerlink" title="ğŸ“š æ ¸å¿ƒæœ¯è¯­"></a>ğŸ“š æ ¸å¿ƒæœ¯è¯­</h2><table><thead><tr><th>æœ¯è¯­</th><th>è‹±æ–‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ¶ˆæ¯</strong></td><td>Record</td><td>Kafka å¤„ç†çš„ä¸»è¦å¯¹è±¡</td></tr><tr><td><strong>ä¸»é¢˜</strong></td><td>Topic</td><td>æ‰¿è½½æ¶ˆæ¯çš„é€»è¾‘å®¹å™¨ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„ä¸šåŠ¡</td></tr><tr><td><strong>åˆ†åŒº</strong></td><td>Partition</td><td>ä¸€ä¸ªæœ‰åºä¸å˜çš„æ¶ˆæ¯åºåˆ—ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒº</td></tr><tr><td><strong>æ¶ˆæ¯ä½ç§»</strong></td><td>Offset</td><td>åˆ†åŒºä¸­æ¯æ¡æ¶ˆæ¯çš„ä½ç½®ä¿¡æ¯ï¼Œå•è°ƒé€’å¢ä¸”ä¸å˜</td></tr><tr><td><strong>å‰¯æœ¬</strong></td><td>Replica</td><td>æ¶ˆæ¯çš„å¤šä¸ªæ‹·è´ï¼Œåˆ†ä¸º Leader å’Œ Follower å‰¯æœ¬</td></tr><tr><td><strong>ç”Ÿäº§è€…</strong></td><td>Producer</td><td>å‘ä¸»é¢˜å‘å¸ƒæ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº</td></tr><tr><td><strong>æ¶ˆè´¹è€…</strong></td><td>Consumer</td><td>ä»ä¸»é¢˜è®¢é˜…æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº</td></tr><tr><td><strong>æ¶ˆè´¹è€…ä½ç§»</strong></td><td>Consumer Offset</td><td>è¡¨å¾æ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦</td></tr><tr><td><strong>æ¶ˆè´¹è€…ç»„</strong></td><td>Consumer Group</td><td>å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ç»„æˆçš„ç»„ï¼ŒåŒæ—¶æ¶ˆè´¹å¤šä¸ªåˆ†åŒºä»¥å®ç°é«˜åå</td></tr><tr><td><strong>é‡å¹³è¡¡</strong></td><td>Rebalance</td><td>æ¶ˆè´¹è€…ç»„å†…æŸä¸ªå®ä¾‹æŒ‚æ‰åï¼Œå…¶ä»–å®ä¾‹è‡ªåŠ¨é‡æ–°åˆ†é…è®¢é˜…åˆ†åŒºçš„è¿‡ç¨‹</td></tr></tbody></table><h3 id="é«˜çº§æ¦‚å¿µ"><a href="#é«˜çº§æ¦‚å¿µ" class="headerlink" title="é«˜çº§æ¦‚å¿µ"></a>é«˜çº§æ¦‚å¿µ</h3><ul><li><p><strong>åˆ·ç›˜ï¼ˆFlushï¼‰</strong></p><ul><li>å°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„è¿‡ç¨‹</li><li>æ¶ˆæ¯å…ˆå†™å…¥å†…å­˜ç¼“å†²åŒºï¼Œå†æ ¹æ®ç­–ç•¥åˆ·å†™åˆ°ç£ç›˜</li><li>ä¿è¯æ•°æ®æŒä¹…æ€§ï¼Œå³ä½¿æœåŠ¡å™¨é‡å¯ä¹Ÿä¸ä¼šä¸¢å¤±</li></ul></li><li><p><strong>å‰¯æœ¬å› å­ï¼ˆReplication Factorï¼‰</strong></p><ul><li>å®šä¹‰æ¯ä¸ªåˆ†åŒºæœ‰å¤šå°‘ä¸ªå‰¯æœ¬</li><li>ä¾‹å¦‚å‰¯æœ¬å› å­ä¸º 3ï¼Œæ„å‘³ç€ 1 ä¸ª Leader + 2 ä¸ª Follower</li></ul></li><li><p><strong>Purgatoryï¼ˆç‚¼ç‹±ï¼‰</strong></p><ul><li>ç”¨äºå¤„ç†å»¶è¿Ÿæ“ä½œçš„å†…éƒ¨æœºåˆ¶</li><li>å¤„ç†ä¸èƒ½ç«‹å³å®Œæˆï¼Œéœ€è¦ç­‰å¾…æ¡ä»¶æ»¡è¶³çš„æ“ä½œ</li><li>ä¾‹å¦‚äº‹åŠ¡ç›¸å…³æ“ä½œ</li></ul></li></ul><hr><h2 id="ğŸš€-éƒ¨ç½²é…ç½®"><a href="#ğŸš€-éƒ¨ç½²é…ç½®" class="headerlink" title="ğŸš€ éƒ¨ç½²é…ç½®"></a>ğŸš€ éƒ¨ç½²é…ç½®</h2><h3 id="Broker-å‚æ•°é…ç½®"><a href="#Broker-å‚æ•°é…ç½®" class="headerlink" title="Broker å‚æ•°é…ç½®"></a>Broker å‚æ•°é…ç½®</h3><h4 id="å­˜å‚¨é…ç½®"><a href="#å­˜å‚¨é…ç½®" class="headerlink" title="å­˜å‚¨é…ç½®"></a>å­˜å‚¨é…ç½®</h4><p><strong><code>log.dirs</code></strong>ï¼ˆæ¨èï¼‰</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log.dirs</span>=<span class="string">/home/kafka/data1,/home/kafka/data2,/home/kafka/data3</span></span><br></pre></td></tr></table></figure><ul><li>å»ºè®®å°†å„ä¸ªç›®å½•æŒ‚è½½åˆ°ä¸åŒçš„ç‰©ç†ç£ç›˜</li><li><strong>ä¼˜åŠ¿</strong>ï¼šæå‡è¯»å†™æ€§èƒ½ + å®ç°æ•…éšœè½¬ç§»</li></ul><p><strong><code>log.dir</code></strong></p><ul><li>å•ä¸ªè·¯å¾„é…ç½®ï¼Œè¡¥å…… <code>log.dirs</code> ä½¿ç”¨</li></ul><h4 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h4><p><strong><code>listeners</code></strong></p><ul><li>å‘Šè¯‰å¤–éƒ¨è¿æ¥è€…ä½¿ç”¨ä»€ä¹ˆåè®®è¿æ¥</li><li>æ ¼å¼ï¼š<code>&lt;protocol&gt;://&lt;host&gt;:&lt;port&gt;</code></li><li>ç¤ºä¾‹ï¼š<code>PLAINTEXT://localhost:9092</code></li></ul><p><strong><code>advertised.listeners</code></strong></p><ul><li>Broker å¯¹å¤–å‘å¸ƒçš„ç›‘å¬å™¨åœ°å€</li><li>å®¢æˆ·ç«¯å®é™…è¿æ¥çš„åœ°å€</li></ul><p><strong>è‡ªå®šä¹‰åè®®é…ç½®</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">listeners</span>=<span class="string">CONTROLLER://localhost:9992</span></span><br><span class="line"><span class="attr">listener.security.protocol.map</span>=<span class="string">CONTROLLER:PLAINTEXT</span></span><br></pre></td></tr></table></figure><h4 id="Topic-ç®¡ç†"><a href="#Topic-ç®¡ç†" class="headerlink" title="Topic ç®¡ç†"></a>Topic ç®¡ç†</h4><table><thead><tr><th>å‚æ•°</th><th>æ¨èå€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>auto.create.topics.enable</code></td><td><strong>false</strong></td><td>ç¦æ­¢è‡ªåŠ¨åˆ›å»º Topicï¼Œé¿å…çº¿ä¸ŠæœªçŸ¥é—®é¢˜</td></tr><tr><td><code>unclean.leader.election.enable</code></td><td><strong>false</strong></td><td>ç¦æ­¢ä¸å¹²å‡€çš„ Leader é€‰ä¸¾ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±</td></tr><tr><td><code>auto.leader.rebalance.enable</code></td><td><strong>false</strong></td><td>ç¦æ­¢å®šæœŸ Leader é€‰ä¸¾ï¼Œé¿å…é¢‘ç¹åˆ‡æ¢</td></tr></tbody></table><h4 id="æ•°æ®ç®¡ç†"><a href="#æ•°æ®ç®¡ç†" class="headerlink" title="æ•°æ®ç®¡ç†"></a>æ•°æ®ç®¡ç†</h4><p><strong>æ¶ˆæ¯ä¿ç•™æ—¶é—´</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log.retention.hours</span>=<span class="string">168    # 7å¤©</span></span><br><span class="line"><span class="attr">log.retention.minutes</span>=<span class="string">10080</span></span><br><span class="line"><span class="attr">log.retention.ms</span>=<span class="string">604800000  # ä¼˜å…ˆçº§æœ€é«˜</span></span><br></pre></td></tr></table></figure><p><strong>æ¶ˆæ¯å¤§å°é™åˆ¶</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">message.max.bytes</span>=<span class="string">1048576   # 1MB</span></span><br><span class="line"><span class="attr">log.retention.bytes</span>=<span class="string">-1      # æ— é™åˆ¶</span></span><br></pre></td></tr></table></figure><h3 id="Topic-çº§åˆ«å‚æ•°"><a href="#Topic-çº§åˆ«å‚æ•°" class="headerlink" title="Topic çº§åˆ«å‚æ•°"></a>Topic çº§åˆ«å‚æ•°</h3><p>Topic å‚æ•°ä¼˜å…ˆçº§é«˜äº Broker å…¨å±€å‚æ•°ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆæ¯ä¿ç•™æ—¶é—´</span></span><br><span class="line"><span class="attr">retention.ms</span>=<span class="string">604800000  # 7å¤©</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ç£ç›˜ç©ºé—´é…é¢</span></span><br><span class="line"><span class="attr">retention.bytes</span>=<span class="string">-1      # æ— é™åˆ¶</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æœ€å¤§æ¶ˆæ¯å¤§å°</span></span><br><span class="line"><span class="attr">max.message.bytes</span>=<span class="string">1048576</span></span><br></pre></td></tr></table></figure><h3 id="JVM-å‚æ•°è°ƒä¼˜"><a href="#JVM-å‚æ•°è°ƒä¼˜" class="headerlink" title="JVM å‚æ•°è°ƒä¼˜"></a>JVM å‚æ•°è°ƒä¼˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å †å†…å­˜é…ç½®ï¼ˆæ¨è 6GBï¼‰</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_HEAP_OPTS=<span class="string">&quot;-Xms6g -Xmx6g&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GC é…ç½®</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_JVM_PERFORMANCE_OPTS=<span class="string">&quot;-XX:+UseG1GC -XX:MaxGCPauseMillis=20&quot;</span></span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ¯-åˆ†åŒºç­–ç•¥"><a href="#ğŸ¯-åˆ†åŒºç­–ç•¥" class="headerlink" title="ğŸ¯ åˆ†åŒºç­–ç•¥"></a>ğŸ¯ åˆ†åŒºç­–ç•¥</h2><p>å†³å®šç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°å“ªä¸ªåˆ†åŒºçš„ç®—æ³•ã€‚</p><h3 id="è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥"><a href="#è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥"></a>è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ç° Partitioner æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomPartitioner</span> <span class="keyword">implements</span> <span class="title class_">org</span>.apache.kafka.clients.producer.Partitioner &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(String topic, Object key, <span class="type">byte</span>[] keyBytes, </span></span><br><span class="line"><span class="params">                        Object value, <span class="type">byte</span>[] valueBytes, Cluster cluster)</span> &#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰åˆ†åŒºé€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å‚æ•°ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">partitioner.class</span>=<span class="string">com.example.CustomPartitioner</span></span><br></pre></td></tr></table></figure><h3 id="å†…ç½®åˆ†åŒºç­–ç•¥"><a href="#å†…ç½®åˆ†åŒºç­–ç•¥" class="headerlink" title="å†…ç½®åˆ†åŒºç­–ç•¥"></a>å†…ç½®åˆ†åŒºç­–ç•¥</h3><h4 id="1-è½®è¯¢ç­–ç•¥ï¼ˆRound-Robinï¼‰"><a href="#1-è½®è¯¢ç­–ç•¥ï¼ˆRound-Robinï¼‰" class="headerlink" title="1. è½®è¯¢ç­–ç•¥ï¼ˆRound-Robinï¼‰"></a>1. è½®è¯¢ç­–ç•¥ï¼ˆRound-Robinï¼‰</h4><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>Kafka é»˜è®¤ç­–ç•¥</li><li>æ¶ˆæ¯å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰åˆ†åŒº</li><li>æœ€ä½³è´Ÿè½½å‡è¡¡è¡¨ç°</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>æ— éœ€ä¿è¯æ¶ˆæ¯é¡ºåº</li><li>è¿½æ±‚è´Ÿè½½å‡è¡¡</li></ul><h4 id="2-éšæœºç­–ç•¥ï¼ˆRandomï¼‰"><a href="#2-éšæœºç­–ç•¥ï¼ˆRandomï¼‰" class="headerlink" title="2. éšæœºç­–ç•¥ï¼ˆRandomï¼‰"></a>2. éšæœºç­–ç•¥ï¼ˆRandomï¼‰</h4><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>éšæœºé€‰æ‹©åˆ†åŒº</li><li>ç†è®ºä¸Šä¹Ÿèƒ½å®ç°è´Ÿè½½å‡è¡¡</li><li>ä½†æ•ˆæœä¸å¦‚è½®è¯¢ç­–ç•¥</li></ul><h4 id="3-æŒ‰é”®ä¿åºç­–ç•¥ï¼ˆKey-Orderingï¼‰"><a href="#3-æŒ‰é”®ä¿åºç­–ç•¥ï¼ˆKey-Orderingï¼‰" class="headerlink" title="3. æŒ‰é”®ä¿åºç­–ç•¥ï¼ˆKey-Orderingï¼‰"></a>3. æŒ‰é”®ä¿åºç­–ç•¥ï¼ˆKey-Orderingï¼‰</h4><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ç›¸åŒ Key çš„æ¶ˆæ¯è¿›å…¥åŒä¸€åˆ†åŒº</li><li>ä¿è¯ç›¸åŒ Key çš„æ¶ˆæ¯é¡ºåº</li></ul><p><strong>å®ç°</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;PartitionInfo&gt; partitions = cluster.partitionsForTopic(topic);</span><br><span class="line"><span class="keyword">return</span> Math.abs(key.hashCode()) % partitions.size();</span><br></pre></td></tr></table></figure><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>éœ€è¦ä¿è¯ç›¸åŒ Key çš„æ¶ˆæ¯é¡ºåº</li><li>ä¾‹å¦‚ï¼šåŒä¸€ç”¨æˆ·çš„æ“ä½œæ—¥å¿—</li></ul><hr><h2 id="ğŸ®-Kafka-æ§åˆ¶å™¨"><a href="#ğŸ®-Kafka-æ§åˆ¶å™¨" class="headerlink" title="ğŸ® Kafka æ§åˆ¶å™¨"></a>ğŸ® Kafka æ§åˆ¶å™¨</h2><h3 id="è§’è‰²å®šä½"><a href="#è§’è‰²å®šä½" class="headerlink" title="è§’è‰²å®šä½"></a>è§’è‰²å®šä½</h3><p>Kafka é›†ç¾¤ä¸­åªèƒ½æœ‰<strong>ä¸€å° Broker</strong> å……å½“æ§åˆ¶å™¨ï¼ˆControllerï¼‰è§’è‰²ã€‚</p><h3 id="ä¸»è¦èŒè´£"><a href="#ä¸»è¦èŒè´£" class="headerlink" title="ä¸»è¦èŒè´£"></a>ä¸»è¦èŒè´£</h3><h4 id="1-åˆ†åŒºåˆ†é…"><a href="#1-åˆ†åŒºåˆ†é…" class="headerlink" title="1. åˆ†åŒºåˆ†é…"></a>1. åˆ†åŒºåˆ†é…</h4><p>æ§åˆ¶å™¨è´Ÿè´£å†³å®šæ¯ä¸ªåˆ†åŒºçš„å‰¯æœ¬åˆ†å¸ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ï¼šTopic æœ‰ 2 ä¸ªåˆ†åŒºï¼Œå‰¯æœ¬å› å­ä¸º 2</span><br><span class="line">- åˆ†åŒº1: Leaderâ†’Broker1, Followerâ†’Broker2</span><br><span class="line">- åˆ†åŒº2: Leaderâ†’Broker2, Followerâ†’Broker1</span><br></pre></td></tr></table></figure><h4 id="2-Leader-å‰¯æœ¬é€‰ä¸¾"><a href="#2-Leader-å‰¯æœ¬é€‰ä¸¾" class="headerlink" title="2. Leader å‰¯æœ¬é€‰ä¸¾"></a>2. Leader å‰¯æœ¬é€‰ä¸¾</h4><ul><li>å½“ Leader å‰¯æœ¬æ‰€åœ¨ Broker å®•æœºæ—¶</li><li>æ§åˆ¶å™¨ä» ISRï¼ˆIn-Sync Replicasï¼‰ä¸­é€‰ä¸¾æ–°çš„ Leader</li></ul><h4 id="3-ä¸»é¢˜ç®¡ç†"><a href="#3-ä¸»é¢˜ç®¡ç†" class="headerlink" title="3. ä¸»é¢˜ç®¡ç†"></a>3. ä¸»é¢˜ç®¡ç†</h4><ul><li>æ¥å—æ¥è‡ªç®¡ç†å·¥å…·æˆ– API çš„è¯·æ±‚</li><li>å¤„ç†ä¸»é¢˜çš„åˆ›å»ºå’Œåˆ é™¤æ“ä½œ</li></ul><h4 id="4-é›†ç¾¤ç›‘æ§ä¸åè°ƒ"><a href="#4-é›†ç¾¤ç›‘æ§ä¸åè°ƒ" class="headerlink" title="4. é›†ç¾¤ç›‘æ§ä¸åè°ƒ"></a>4. é›†ç¾¤ç›‘æ§ä¸åè°ƒ</h4><ul><li>é€šè¿‡å¿ƒè·³æœºåˆ¶æ£€æµ‹ Broker å­˜æ´»çŠ¶æ€</li><li>èŠ‚ç‚¹å¤±è”æ—¶é‡æ–°åˆ†é…åˆ†åŒºå’Œå‰¯æœ¬</li></ul><h3 id="æ§åˆ¶å™¨é€‰ä¸¾"><a href="#æ§åˆ¶å™¨é€‰ä¸¾" class="headerlink" title="æ§åˆ¶å™¨é€‰ä¸¾"></a>æ§åˆ¶å™¨é€‰ä¸¾</h3><p><strong>é€‰ä¸¾æœºåˆ¶</strong>ï¼š</p><ol><li>Broker å¯åŠ¨æ—¶å°è¯•åœ¨ ZooKeeper ä¸­åˆ›å»º <code>/controller</code> èŠ‚ç‚¹</li><li>ç¬¬ä¸€ä¸ªæˆåŠŸåˆ›å»ºèŠ‚ç‚¹çš„ Broker æˆä¸ºæ§åˆ¶å™¨</li><li>å…¶ä»– Broker é€šè¿‡ Watch æœºåˆ¶ç›‘æ§æ§åˆ¶å™¨çŠ¶æ€</li></ol><p><strong>Failover æœºåˆ¶</strong>ï¼š</p><ul><li>ZooKeeper æ£€æµ‹åˆ°æ§åˆ¶å™¨èŠ‚ç‚¹å¤±æ•ˆ</li><li>åˆ é™¤ <code>/controller</code> èŠ‚ç‚¹</li><li>å­˜æ´»çš„ Broker é‡æ–°ç«é€‰æ–°çš„æ§åˆ¶å™¨</li></ul><hr><h2 id="ğŸ”’-æ¶ˆæ¯äº¤ä»˜å¯é æ€§"><a href="#ğŸ”’-æ¶ˆæ¯äº¤ä»˜å¯é æ€§" class="headerlink" title="ğŸ”’ æ¶ˆæ¯äº¤ä»˜å¯é æ€§"></a>ğŸ”’ æ¶ˆæ¯äº¤ä»˜å¯é æ€§</h2><p>Kafka æä¾›ä¸‰ç§æ¶ˆæ¯äº¤ä»˜å¯é æ€§ä¿éšœï¼š</p><h3 id="1-æœ€å¤šä¸€æ¬¡ï¼ˆAt-Most-Onceï¼‰"><a href="#1-æœ€å¤šä¸€æ¬¡ï¼ˆAt-Most-Onceï¼‰" class="headerlink" title="1. æœ€å¤šä¸€æ¬¡ï¼ˆAt Most Onceï¼‰"></a>1. æœ€å¤šä¸€æ¬¡ï¼ˆAt Most Onceï¼‰</h3><ul><li><strong>ç‰¹å¾</strong>ï¼šæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œä½†ç»ä¸é‡å¤</li><li><strong>åœºæ™¯</strong>ï¼šæ—¥å¿—æ”¶é›†ç­‰å¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯</li></ul><h3 id="2-è‡³å°‘ä¸€æ¬¡ï¼ˆAt-Least-Onceï¼‰"><a href="#2-è‡³å°‘ä¸€æ¬¡ï¼ˆAt-Least-Onceï¼‰" class="headerlink" title="2. è‡³å°‘ä¸€æ¬¡ï¼ˆAt Least Onceï¼‰"></a>2. è‡³å°‘ä¸€æ¬¡ï¼ˆAt Least Onceï¼‰</h3><ul><li><strong>ç‰¹å¾</strong>ï¼šæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä½†å¯èƒ½é‡å¤</li><li><strong>é»˜è®¤</strong>ï¼šKafka é»˜è®¤æä¾›æ­¤çº§åˆ«ä¿éšœ</li><li><strong>åœºæ™¯</strong>ï¼šå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯</li></ul><h3 id="3-ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly-Onceï¼‰"><a href="#3-ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly-Onceï¼‰" class="headerlink" title="3. ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly Onceï¼‰"></a>3. ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly Onceï¼‰</h3><ul><li><strong>ç‰¹å¾</strong>ï¼šæ¶ˆæ¯ä¸ä¸¢å¤±ä¹Ÿä¸é‡å¤</li><li><strong>å®ç°</strong>ï¼šé€šè¿‡å¹‚ç­‰æ€§ + äº‹åŠ¡æœºåˆ¶</li><li><strong>åœºæ™¯</strong>ï¼šé‡‘èäº¤æ˜“ç­‰å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚æé«˜çš„åœºæ™¯</li></ul><hr><h2 id="â“-å¸¸è§é—®é¢˜"><a href="#â“-å¸¸è§é—®é¢˜" class="headerlink" title="â“ å¸¸è§é—®é¢˜"></a>â“ å¸¸è§é—®é¢˜</h2><h3 id="Q1-ä¸ºä»€ä¹ˆ-Kafka-ä¸å…è®¸ä»å‰¯æœ¬è¯»å–æ•°æ®ï¼Ÿ"><a href="#Q1-ä¸ºä»€ä¹ˆ-Kafka-ä¸å…è®¸ä»å‰¯æœ¬è¯»å–æ•°æ®ï¼Ÿ" class="headerlink" title="Q1: ä¸ºä»€ä¹ˆ Kafka ä¸å…è®¸ä»å‰¯æœ¬è¯»å–æ•°æ®ï¼Ÿ"></a>Q1: ä¸ºä»€ä¹ˆ Kafka ä¸å…è®¸ä»å‰¯æœ¬è¯»å–æ•°æ®ï¼Ÿ</h3><p>ä¸ MySQL ä¸»ä»å¤åˆ¶ä¸åŒï¼ŒKafka çš„ä»å‰¯æœ¬ä¸å¯¹å¤–æä¾›è¯»æœåŠ¡ã€‚åŸå› å¦‚ä¸‹ï¼š</p><h4 id="1-ä¸€è‡´æ€§æ¨¡å‹å·®å¼‚"><a href="#1-ä¸€è‡´æ€§æ¨¡å‹å·®å¼‚" class="headerlink" title="1. ä¸€è‡´æ€§æ¨¡å‹å·®å¼‚"></a>1. ä¸€è‡´æ€§æ¨¡å‹å·®å¼‚</h4><p><strong>Kafka</strong>ï¼š</p><ul><li>åŸºäºæ—¥å¿—çš„æ¶ˆæ¯ä¼ é€’æ¨¡å‹</li><li>å¼ºè°ƒæ¶ˆæ¯é¡ºåºå’Œå®æ—¶æ€§</li><li>ä»å‰¯æœ¬å¯èƒ½å­˜åœ¨åŒæ­¥å»¶è¿Ÿï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li></ul><p><strong>MySQL</strong>ï¼š</p><ul><li>ACID äº‹åŠ¡æ¨¡å‹</li><li>ä»åº“åº”ç”¨å®Œ Binlog åæ•°æ®ä¸€è‡´</li><li>å¯ä»¥å®‰å…¨åœ°æä¾›è¯»æœåŠ¡</li></ul><h4 id="2-è®¾è®¡ç›®æ ‡ä¸åŒ"><a href="#2-è®¾è®¡ç›®æ ‡ä¸åŒ" class="headerlink" title="2. è®¾è®¡ç›®æ ‡ä¸åŒ"></a>2. è®¾è®¡ç›®æ ‡ä¸åŒ</h4><p><strong>Kafka</strong>ï¼š</p><ul><li>ä¸“æ³¨äºé«˜ååé‡çš„æ¶ˆæ¯å†™å…¥å’Œé¡ºåºè¯»å–</li><li>å…è®¸ä»å‰¯æœ¬è¯»å–ä¼šå¢åŠ å¤æ‚æ€§</li></ul><p><strong>MySQL</strong>ï¼š</p><ul><li>æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œäº‹åŠ¡å¤„ç†</li><li>è¯»å†™åˆ†ç¦»å¯ä»¥åˆ†æ‹…ä¸»åº“å‹åŠ›</li></ul><h4 id="3-æ•…éšœæ¢å¤å¤æ‚æ€§"><a href="#3-æ•…éšœæ¢å¤å¤æ‚æ€§" class="headerlink" title="3. æ•…éšœæ¢å¤å¤æ‚æ€§"></a>3. æ•…éšœæ¢å¤å¤æ‚æ€§</h4><p><strong>Kafka</strong>ï¼š</p><ul><li>ä»å‰¯æœ¬æä¾›è¯»æœåŠ¡æ—¶ï¼Œæ•…éšœåˆ‡æ¢æ›´å¤æ‚</li><li>éœ€è¦å¤„ç†æ­£åœ¨è¿›è¡Œçš„è¯»æ“ä½œ</li></ul><p><strong>MySQL</strong>ï¼š</p><ul><li>ä»åº“æ•…éšœæ¢å¤ç›¸å¯¹ç®€å•</li><li>é‡æ–°åŒæ­¥ Binlog å³å¯</li></ul><h3 id="Q2-Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåºæ€§ï¼Ÿ"><a href="#Q2-Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåºæ€§ï¼Ÿ" class="headerlink" title="Q2: Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåºæ€§ï¼Ÿ"></a>Q2: Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåºæ€§ï¼Ÿ</h3><h4 id="1-åˆ†åŒºæœ‰åº"><a href="#1-åˆ†åŒºæœ‰åº" class="headerlink" title="1. åˆ†åŒºæœ‰åº"></a>1. åˆ†åŒºæœ‰åº</h4><ul><li>æ¯ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯ä¸¥æ ¼æœ‰åº</li><li>å…¨å±€æœ‰åºéœ€è¦ä½¿ç”¨å•åˆ†åŒºï¼ˆç‰ºç‰²å¹¶å‘æ€§ï¼‰</li></ul><h4 id="2-åŒæ­¥å‘é€"><a href="#2-åŒæ­¥å‘é€" class="headerlink" title="2. åŒæ­¥å‘é€"></a>2. åŒæ­¥å‘é€</h4><p>é…ç½® <code>acks=all</code> ä¿è¯æ¶ˆæ¯æŒä¹…æ€§ï¼š</p><table><thead><tr><th>acks å€¼</th><th>è¯´æ˜</th><th>å¯é æ€§</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td><strong>0</strong></td><td>ä¸ç­‰å¾…ç¡®è®¤ï¼Œç«‹å³è¿”å›</td><td>âŒ æœ€ä½</td><td>âœ… æœ€é«˜</td></tr><tr><td><strong>1</strong></td><td>ç­‰å¾… Leader ç¡®è®¤</td><td>âš ï¸ ä¸­ç­‰</td><td>âš ï¸ ä¸­ç­‰</td></tr><tr><td><strong>all</strong></td><td>ç­‰å¾…æ‰€æœ‰ ISR ç¡®è®¤</td><td>âœ… æœ€é«˜</td><td>âŒ æœ€ä½</td></tr></tbody></table><h4 id="3-æ¶ˆæ¯åç§»é‡"><a href="#3-æ¶ˆæ¯åç§»é‡" class="headerlink" title="3. æ¶ˆæ¯åç§»é‡"></a>3. æ¶ˆæ¯åç§»é‡</h4><ul><li>æ¯ä¸ªæ¶ˆæ¯æœ‰å”¯ä¸€çš„ Offset</li><li>æ¶ˆè´¹è€…æŒ‰ Offset é¡ºåºæ¶ˆè´¹</li><li>ä¿è¯æ¶ˆè´¹é¡ºåºä¸ç”Ÿäº§é¡ºåºä¸€è‡´</li></ul><h3 id="Q3-Kafka-æ¶ˆæ¯å¦‚ä½•å­˜å‚¨ï¼Ÿ"><a href="#Q3-Kafka-æ¶ˆæ¯å¦‚ä½•å­˜å‚¨ï¼Ÿ" class="headerlink" title="Q3: Kafka æ¶ˆæ¯å¦‚ä½•å­˜å‚¨ï¼Ÿ"></a>Q3: Kafka æ¶ˆæ¯å¦‚ä½•å­˜å‚¨ï¼Ÿ</h3><h4 id="å­˜å‚¨ç»“æ„"><a href="#å­˜å‚¨ç»“æ„" class="headerlink" title="å­˜å‚¨ç»“æ„"></a>å­˜å‚¨ç»“æ„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Topic</span><br><span class="line">â””â”€â”€ Partition</span><br><span class="line">    â””â”€â”€ Log Segment</span><br><span class="line">        â”œâ”€â”€ .log    # æ¶ˆæ¯æ•°æ®</span><br><span class="line">        â””â”€â”€ .index  # ç´¢å¼•æ–‡ä»¶</span><br></pre></td></tr></table></figure><h4 id="å­˜å‚¨ç‰¹æ€§"><a href="#å­˜å‚¨ç‰¹æ€§" class="headerlink" title="å­˜å‚¨ç‰¹æ€§"></a>å­˜å‚¨ç‰¹æ€§</h4><ul><li><strong>æ ¼å¼</strong>ï¼šä¼˜åŒ–çš„æ—¥å¿—æ ¼å¼</li><li><strong>ä¸å¯å˜</strong>ï¼šæ¶ˆæ¯ä¸€æ—¦å†™å…¥ä¸å¯ä¿®æ”¹</li><li><strong>é¡ºåºè¿½åŠ </strong>ï¼šæ–°æ¶ˆæ¯è¿½åŠ åˆ°æ—¥å¿—æœ«å°¾</li><li><strong>åˆ†æ®µç®¡ç†</strong>ï¼šLog Segment ä¾¿äºç®¡ç†å’Œæ¸…ç†</li></ul><hr><h2 id="ğŸ’¡-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ"><a href="#ğŸ’¡-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ" class="headerlink" title="ğŸ’¡ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ"></a>ğŸ’¡ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ</h2><h3 id="å…³é”®å‚æ•°é…ç½®"><a href="#å…³é”®å‚æ•°é…ç½®" class="headerlink" title="å…³é”®å‚æ•°é…ç½®"></a>å…³é”®å‚æ•°é…ç½®</h3><h4 id="auto-create-topics-enable-false"><a href="#auto-create-topics-enable-false" class="headerlink" title="auto.create.topics.enable &#x3D; false"></a>auto.create.topics.enable &#x3D; false</h4><p><strong>ç†ç”±</strong>ï¼š</p><ul><li>é¿å…å› æ‹¼å†™é”™è¯¯è‡ªåŠ¨åˆ›å»º Topic</li><li>ä¾‹å¦‚ï¼š<code>test</code> è¯¯å†™ä¸º <code>tst</code>ï¼Œä¼šè‡ªåŠ¨åˆ›å»º <code>tst</code> Topic</li><li>å¤§å…¬å¸åº”ç”±è¿ç»´ç»Ÿä¸€ç®¡ç† Topic</li></ul><h4 id="unclean-leader-election-enable-false"><a href="#unclean-leader-election-enable-false" class="headerlink" title="unclean.leader.election.enable &#x3D; false"></a>unclean.leader.election.enable &#x3D; false</h4><p><strong>åœºæ™¯</strong>ï¼šæ‰€æœ‰é«˜è´¨é‡å‰¯æœ¬éƒ½æŒ‚æ‰äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p><strong>é€‰æ‹©</strong>ï¼š</p><ul><li><code>false</code>ï¼šåšæŒåŸåˆ™ï¼Œåˆ†åŒºä¸å¯ç”¨ï¼ˆä¿è¯æ•°æ®å®Œæ•´æ€§ï¼‰</li><li><code>true</code>ï¼šé™çº§æœåŠ¡ï¼Œå…è®¸è½åå‰¯æœ¬æˆä¸º Leaderï¼ˆå¯èƒ½ä¸¢æ•°æ®ï¼‰</li></ul><p><strong>æ¨è</strong>ï¼šç”Ÿäº§ç¯å¢ƒè®¾ç½®ä¸º <code>false</code></p><h4 id="auto-leader-rebalance-enable-false"><a href="#auto-leader-rebalance-enable-false" class="headerlink" title="auto.leader.rebalance.enable &#x3D; false"></a>auto.leader.rebalance.enable &#x3D; false</h4><p><strong>é—®é¢˜</strong>ï¼šå®šæœŸæ¢ Leader çš„ä»£ä»·å¾ˆé«˜</p><ul><li>æ‰€æœ‰å®¢æˆ·ç«¯éœ€è¦åˆ‡æ¢è¿æ¥</li><li>æ²¡æœ‰å®è´¨æ€§èƒ½æ”¶ç›Š</li><li>å¯èƒ½å½±å“æœåŠ¡ç¨³å®šæ€§</li></ul><p><strong>æ¨è</strong>ï¼šç”Ÿäº§ç¯å¢ƒè®¾ç½®ä¸º <code>false</code></p><hr><h2 id="ğŸ“š-å‚è€ƒèµ„æ–™"><a href="#ğŸ“š-å‚è€ƒèµ„æ–™" class="headerlink" title="ğŸ“š å‚è€ƒèµ„æ–™"></a>ğŸ“š å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://kafka.apache.org/documentation/">Apache Kafka å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://www.confluent.io/resources/kafka-the-definitive-guide/">Kafka: The Definitive Guide</a></li><li><a href="https://time.geekbang.org/column/intro/100029201">Kafka æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¶ˆæ¯é˜Ÿåˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ç³»ç»Ÿ </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring AOP äº‹åŠ¡å¤±æ•ˆä¸åº•å±‚ä»£ç†æœºåˆ¶æ·±åº¦æ€»ç»“</title>
      <link href="/posts/60441.html"/>
      <url>/posts/60441.html</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-AOP-äº‹åŠ¡å¤±æ•ˆä¸åº•å±‚ä»£ç†æœºåˆ¶æ·±åº¦æ€»ç»“"><a href="#Spring-AOP-äº‹åŠ¡å¤±æ•ˆä¸åº•å±‚ä»£ç†æœºåˆ¶æ·±åº¦æ€»ç»“" class="headerlink" title="Spring AOP äº‹åŠ¡å¤±æ•ˆä¸åº•å±‚ä»£ç†æœºåˆ¶æ·±åº¦æ€»ç»“"></a>Spring AOP äº‹åŠ¡å¤±æ•ˆä¸åº•å±‚ä»£ç†æœºåˆ¶æ·±åº¦æ€»ç»“</h1><h2 id="1-æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆè‡ªè°ƒç”¨å¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Ÿ"><a href="#1-æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆè‡ªè°ƒç”¨å¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Ÿ" class="headerlink" title="1. æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆè‡ªè°ƒç”¨å¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Ÿ"></a>1. æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆè‡ªè°ƒç”¨å¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Ÿ</h2><h3 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h3><p>åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œæ–¹æ³• A è°ƒç”¨æ–¹æ³• Bï¼ˆ<code>this.methodB()</code>ï¼‰ï¼Œå³ä½¿æ–¹æ³• B ä¸ŠåŠ äº† <code>@Transactional</code> æ³¨è§£ï¼Œäº‹åŠ¡ä¾ç„¶ä¸ç”Ÿæ•ˆã€‚</p><h3 id="æ ¹æœ¬åŸå› "><a href="#æ ¹æœ¬åŸå› " class="headerlink" title="æ ¹æœ¬åŸå› "></a>æ ¹æœ¬åŸå› </h3><p>Spring AOP çš„é»˜è®¤å®ç°åŸºäº <strong>ä»£ç†æ¨¡å¼ (Proxy Pattern)</strong>ã€‚Spring å®¹å™¨ä¸­æ³¨å…¥çš„ Bean å®é™…ä¸Šæ˜¯ä¸€ä¸ª <strong>ä»£ç†å¯¹è±¡ (Proxy)</strong>ï¼Œå®ƒæŒæœ‰ä½ ç¼–å†™çš„ <strong>ç›®æ ‡å¯¹è±¡ (Target)</strong>ã€‚</p><ul><li><strong>ç”Ÿæ•ˆè·¯å¾„</strong>ï¼šå¤–éƒ¨è°ƒç”¨ $\rightarrow$ Proxy $\rightarrow$ äº‹åŠ¡æ‹¦æˆªå™¨ (Interceptor) $\rightarrow$ Targetã€‚</li><li><strong>å¤±æ•ˆè·¯å¾„</strong>ï¼šTarget å†…éƒ¨è°ƒç”¨ $\rightarrow$ <code>this.methodB()</code> $\rightarrow$ Targetã€‚</li></ul><p>æ­¤æ—¶ï¼Œ<code>this</code> æŒ‡é’ˆæŒ‡å‘çš„æ˜¯<strong>ç›®æ ‡å¯¹è±¡æœ¬èº«</strong>ã€‚ä»£ç æ‰§è¡Œæµç›´æ¥åœ¨ç›®æ ‡å¯¹è±¡å†…éƒ¨æµè½¬ï¼Œå®Œå…¨<strong>ç»•è¿‡</strong>äº†å¤–å±‚çš„ä»£ç†å¯¹è±¡åŠå…¶æŒæœ‰çš„äº‹åŠ¡æ‹¦æˆªå™¨ã€‚</p><h3 id="å½¢è±¡æ¯”å–»"><a href="#å½¢è±¡æ¯”å–»" class="headerlink" title="å½¢è±¡æ¯”å–»"></a>å½¢è±¡æ¯”å–»</h3><ul><li><strong>Proxy (ä»£ç†)</strong>ï¼šå¤§æ¥¼é—¨å£çš„<strong>å®‰æ£€å‘˜</strong>ã€‚</li><li><strong>Target (ç›®æ ‡)</strong>ï¼šå¤§æ¥¼é‡Œçš„<strong>å‘˜å·¥</strong>ã€‚</li><li><strong>å¤–éƒ¨è®¿é—®</strong>ï¼šè®¿å®¢æ‰¾å‘˜å·¥ï¼Œå¿…é¡»ç»è¿‡å®‰æ£€ï¼ˆäº‹åŠ¡ç”Ÿæ•ˆï¼‰ã€‚</li><li><strong>å†…éƒ¨è‡ªè°ƒç”¨</strong>ï¼šå‘˜å·¥ä¹‹é—´äº’æ‰¾ï¼Œç›´æ¥åœ¨æ¥¼é‡Œè§é¢ï¼Œä¸éœ€è¦è·‘å‡ºå»å†è¿‡ä¸€æ¬¡å®‰æ£€ï¼ˆäº‹åŠ¡å¤±æ•ˆï¼‰ã€‚</li></ul><hr><h2 id="2-è§£å†³æ–¹æ¡ˆ-æŒ‰æ¶æ„å¸ˆæ¨èåº¦æ’åº"><a href="#2-è§£å†³æ–¹æ¡ˆ-æŒ‰æ¶æ„å¸ˆæ¨èåº¦æ’åº" class="headerlink" title="2. è§£å†³æ–¹æ¡ˆ (æŒ‰æ¶æ„å¸ˆæ¨èåº¦æ’åº)"></a>2. è§£å†³æ–¹æ¡ˆ (æŒ‰æ¶æ„å¸ˆæ¨èåº¦æ’åº)</h2><table><thead><tr><th><strong>æ–¹æ¡ˆ</strong></th><th><strong>å…·ä½“åšæ³•</strong></th><th><strong>è¯„ä»·</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong>1. æ¶æ„é‡æ„ (Refactoring)</strong></td><td>å°†éœ€è¦äº‹åŠ¡çš„æ–¹æ³•æå–åˆ°<strong>ç‹¬ç«‹çš„ Service</strong> ä¸­ï¼Œé€šè¿‡ Bean æ³¨å…¥è°ƒç”¨ã€‚</td><td>â­â­â­â­â­ (å¼ºçƒˆæ¨è)</td><td>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ (SRP)ï¼Œä»£ç ç»“æ„æœ€æ¸…æ™°ã€‚</td></tr><tr><td><strong>2. è‡ªæˆ‘æ³¨å…¥ (Self-Injection)</strong></td><td>åœ¨ç±»ä¸­æ³¨å…¥è‡ªèº« (<code>@Lazy</code> è§£å†³å¾ªç¯ä¾èµ–)ï¼Œè°ƒç”¨ <code>self.methodB()</code>ã€‚</td><td>â­â­â­ (å¯ç”¨)</td><td>ä¸šåŠ¡é€»è¾‘ç´§å¯†è€¦åˆï¼Œä¸é€‚åˆæ‹†åˆ†æ–‡ä»¶æ—¶ã€‚</td></tr><tr><td><strong>3. AopContext</strong></td><td>ä½¿ç”¨ <code>AopContext.currentProxy()</code> å¼ºè½¬è·å–å½“å‰ä»£ç†å¯¹è±¡ã€‚</td><td>â­ (ä¸æ¨è)</td><td>ä»£ç ä¾µå…¥æ€§å¼ºï¼Œä¸ Spring API å¼ºè€¦åˆã€‚</td></tr><tr><td><strong>4. AspectJ</strong></td><td>æ”¾å¼ƒä»£ç†æ¨¡å¼ï¼Œä½¿ç”¨å­—èŠ‚ç ç»‡å…¥ (Weaving)ã€‚</td><td>N&#x2F;A (ç‰¹æ®Šéœ€æ±‚)</td><td>è¿½æ±‚æè‡´æ€§èƒ½æˆ–å¿…é¡»åœ¨ private&#x2F;è‡ªè°ƒç”¨ä¸­ç”Ÿæ•ˆæ—¶ã€‚</td></tr></tbody></table><hr><h2 id="3-æ·±åº¦è¾¨æï¼šJDK-åŠ¨æ€ä»£ç†-vs-CGLIB"><a href="#3-æ·±åº¦è¾¨æï¼šJDK-åŠ¨æ€ä»£ç†-vs-CGLIB" class="headerlink" title="3. æ·±åº¦è¾¨æï¼šJDK åŠ¨æ€ä»£ç† vs CGLIB"></a>3. æ·±åº¦è¾¨æï¼šJDK åŠ¨æ€ä»£ç† vs CGLIB</h2><p><img src="https://cdn.jsdelivr.net/gh/Supremes/blog-images@master/imgs/articles/SpringAOP.webp" alt="SpringAOP"></p><h3 id="å¸¸è§è¯¯åŒº"><a href="#å¸¸è§è¯¯åŒº" class="headerlink" title="å¸¸è§è¯¯åŒº"></a>å¸¸è§è¯¯åŒº</h3><blockquote><p><strong>è¯¯åŒº</strong>ï¼šâ€JDK Proxy ä¼šå¯¼è‡´è‡ªè°ƒç”¨å¤±æ•ˆï¼Œæ¢æˆ CGLIB å°±èƒ½è§£å†³äº†ã€‚â€</p><p><strong>çœŸç›¸</strong>ï¼š<strong>é”™è¯¯çš„ã€‚</strong> æ— è®ºæ˜¯ JDK Proxy è¿˜æ˜¯ CGLIBï¼Œåªè¦æ˜¯åŸºäº<strong>ä»£ç†æ¨¡å¼</strong>ï¼Œè‡ªè°ƒç”¨éƒ½ä¼šå¤±æ•ˆã€‚å› ä¸ºå®ƒä»¬åº•å±‚æ¶æ„éƒ½æ˜¯ <code>Proxy</code> æŒæœ‰ <code>Target</code>ã€‚</p></blockquote><h3 id="æŠ€æœ¯å¯¹æ¯”è¡¨"><a href="#æŠ€æœ¯å¯¹æ¯”è¡¨" class="headerlink" title="æŠ€æœ¯å¯¹æ¯”è¡¨"></a>æŠ€æœ¯å¯¹æ¯”è¡¨</h3><table><thead><tr><th><strong>ç»´åº¦</strong></th><th><strong>JDK åŠ¨æ€ä»£ç†</strong></th><th><strong>CGLIB (Code Generation Library)</strong></th></tr></thead><tbody><tr><td><strong>å®ç°æœºåˆ¶</strong></td><td>åŸºäº <strong>æ¥å£ (Interface)</strong></td><td>åŸºäº <strong>ç»§æ‰¿ (Subclass)</strong></td></tr><tr><td><strong>ç±»å…³ç³»</strong></td><td>ä»£ç†ç±»ä¸ç›®æ ‡ç±»æ˜¯ <strong>å…„å¼Ÿå…³ç³»</strong></td><td>ä»£ç†ç±»æ˜¯ç›®æ ‡ç±»çš„ <strong>å­ç±»</strong></td></tr><tr><td><strong>æ ¸å¿ƒé™åˆ¶</strong></td><td>ç›®æ ‡ç±» <strong>å¿…é¡»å®ç°æ¥å£</strong></td><td>ç›®æ ‡ç±»æˆ–æ–¹æ³• <strong>ä¸èƒ½æ˜¯ Final</strong></td></tr><tr><td><strong>è°ƒç”¨æ–¹å¼</strong></td><td><strong>åå°„</strong> (<code>Method.invoke</code>)</td><td><strong>FastClass ç´¢å¼•</strong> (ç›´æ¥è°ƒç”¨)</td></tr><tr><td><strong>è‡ªè°ƒç”¨æ”¯æŒ</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td></tr><tr><td><strong>Spring é»˜è®¤</strong></td><td>æ—§ç‰ˆæœ¬ (æœ‰æ¥å£æ—¶é»˜è®¤)</td><td><strong>Spring Boot 2.0+ é»˜è®¤</strong></td></tr></tbody></table><hr><h2 id="4-æ€§èƒ½é»‘ç§‘æŠ€ï¼šCGLIB-çš„-FastClass-æœºåˆ¶"><a href="#4-æ€§èƒ½é»‘ç§‘æŠ€ï¼šCGLIB-çš„-FastClass-æœºåˆ¶" class="headerlink" title="4. æ€§èƒ½é»‘ç§‘æŠ€ï¼šCGLIB çš„ FastClass æœºåˆ¶"></a>4. æ€§èƒ½é»‘ç§‘æŠ€ï¼šCGLIB çš„ FastClass æœºåˆ¶</h2><p>CGLIB åœ¨è¿è¡Œæ—¶ä¹‹æ‰€ä»¥é«˜æ•ˆï¼Œæ˜¯å› ä¸ºå®ƒé€šè¿‡ <strong>FastClass</strong> æœºåˆ¶è§„é¿äº† Java åå°„ API çš„å¼€é”€ã€‚</p><h3 id="FastClass-åŸç†"><a href="#FastClass-åŸç†" class="headerlink" title="FastClass åŸç†"></a>FastClass åŸç†</h3><p>CGLIB åœ¨ç”Ÿæˆä»£ç†ç±»æ—¶ï¼Œä¼šåˆ©ç”¨ ASM å­—èŠ‚ç æŠ€æœ¯é¢å¤–ç”Ÿæˆä¸€ä¸ª <code>FastClass</code>ã€‚å®ƒç›¸å½“äºæŠŠâ€åå°„æŸ¥æ‰¾â€å˜æˆäº†â€ç¡¬ç¼–ç çš„ç´¢å¼•è·³è½¬â€ã€‚</p><p><strong>ä¼ªä»£ç é€»è¾‘ï¼š</strong></p><p>Java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// FastClass å°±åƒä¸€ä¸ªå·¨å¤§çš„ switch-caseï¼Œå»ºç«‹äº† æ–¹æ³•ç­¾å -&gt; ç´¢å¼• çš„æ˜ å°„</span><br><span class="line">public Object invoke(int index, Object target, Object[] args) &#123;</span><br><span class="line">    MyService service = (MyService) target;</span><br><span class="line">    // ç›´æ¥è°ƒç”¨ï¼Œæ²¡æœ‰åå°„çš„ invoke() å¼€é”€</span><br><span class="line">    switch (index) &#123;</span><br><span class="line">        case 1: return service.login(); </span><br><span class="line">        case 2: return service.logout();</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-FastClass"><a href="#æ€»ç»“-FastClass" class="headerlink" title="æ€»ç»“ FastClass"></a>æ€»ç»“ FastClass</h3><ul><li><strong>æœ¬è´¨</strong>ï¼š<strong>ç©ºé—´æ¢æ—¶é—´</strong>ã€‚é€šè¿‡ç”Ÿæˆæ›´å¤šçš„å­—èŠ‚ç ç±»ï¼Œå»ºç«‹ç´¢å¼•ã€‚</li><li><strong>ä¼˜åŠ¿</strong>ï¼š<strong>è¿è¡Œæ—¶ (Runtime)</strong> è°ƒç”¨é€Ÿåº¦æå¿«ï¼Œæ¥è¿‘åŸç”Ÿ Java æ–¹æ³•è°ƒç”¨ï¼Œä¸ä»…çœå»äº†åå°„çš„å®‰å…¨æ£€æŸ¥ï¼Œè¿˜èƒ½äº«å— JVM çš„å†…è”ä¼˜åŒ–ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼š<strong>å¯åŠ¨æ—¶é—´</strong>ç¨æ…¢ï¼ˆéœ€è¦ç”Ÿæˆå’ŒåŠ è½½å­—èŠ‚ç ï¼‰ã€‚</li></ul><hr><h2 id="5-æ¶æ„å¸ˆå»ºè®®-â€œThe-Spring-Wayâ€"><a href="#5-æ¶æ„å¸ˆå»ºè®®-â€œThe-Spring-Wayâ€" class="headerlink" title="5. æ¶æ„å¸ˆå»ºè®® (â€œThe Spring Wayâ€)"></a>5. æ¶æ„å¸ˆå»ºè®® (â€œThe Spring Wayâ€)</h2><ol><li><strong>é¦–é€‰é‡æ„</strong>ï¼šé‡åˆ°è‡ªè°ƒç”¨å¤±æ•ˆï¼Œé¦–å…ˆåæ€ç±»çš„èŒè´£æ˜¯å¦è¿‡é‡ã€‚å°†äº‹åŠ¡é€»è¾‘æ‹†åˆ†åˆ°ä¸åŒ Service æ˜¯æœ€ä¼˜é›…çš„è§£æ³•ã€‚</li><li><strong>æ‹¥æŠ± CGLIB</strong>ï¼šåœ¨ Spring Boot 2.x&#x2F;3.x æ—¶ä»£ï¼Œé»˜è®¤ä½¿ç”¨ CGLIB æ˜¯æœ€ä½³å®è·µï¼ˆç¨³å®šã€é«˜æ•ˆã€æ— éœ€æ¥å£ï¼‰ï¼Œé™¤éä½ æœ‰ç‰¹æ®Šçš„ JDK åŸç”Ÿæ´ç™–ã€‚</li><li><strong>é¿å‘ Final</strong>ï¼šä½¿ç”¨ Spring ç®¡ç†çš„ Beanï¼ˆå°¤å…¶æ˜¯æ¶‰åŠ AOP&#x2F;äº‹åŠ¡çš„ï¼‰ï¼Œ<strong>ä¸¥ç¦</strong>å°†ç±»æˆ–æ–¹æ³•è®¾ä¸º <code>final</code>ï¼Œå¦åˆ™ CGLIB æ— æ³•ç”Ÿæˆå­ç±»ä»£ç†ï¼Œä¼šå¯¼è‡´å¯åŠ¨æŠ¥é”™æˆ– AOP å¤±æ•ˆã€‚</li><li><strong>ç†è§£åŸç†</strong>ï¼šä¸è¦ç›²ç›®èƒŒè¯µâ€œCGLIB æ¯” JDK å¿«â€ï¼Œè¦ç†è§£å®ƒæ˜¯é€šè¿‡â€œå¯åŠ¨æ—¶çš„å¤æ‚â€æ¢å–äº†â€œè¿è¡Œæ—¶çš„ç®€å•â€ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> Java </tag>
            
            <tag> AOP </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
